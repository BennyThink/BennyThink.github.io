<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>土豆不好吃</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="土豆不好吃">
<meta property="og:url" content="http://example.com/page/17/index.html">
<meta property="og:site_name" content="土豆不好吃">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Benny小土豆">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="土豆不好吃" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">土豆不好吃</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-miss-dong/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/01/03/miss-dong/index/" class="article-date">
  <time class="dt-published" datetime="2017-01-03T00:00:00.000Z" itemprop="datePublished">2017-01-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/justsay/">justsay</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/01/03/miss-dong/index/">怀念东东</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>开门就不红的2017年，被羁绊在旅途中….途中想起你，想起了好久之前就想写的怀念。</p>
<p>今年的的第一节课，和我上大学的第一节课，都是他。 很无奈的是我却被困在途中，无法亲临现场。</p>
<p>三年半之前了吧，我和室友们走进教室的时候发现早已站着一名西装革履的帅哥。他就是我们的综合英语老师，我们都叫他东东。九月份，真的是一脸严肃认真啊。当时我还对大学懵懵懂懂，之前给家里打电话的时候听到小孩喊舅舅差点哭出来；当时我还完全不知道大学是什么，身边也都是陌生的人们。Half a day?我来这是为了什么…</p>
<p>渐渐的我发现气质这种东西真的是看不见的美好。只要他站在讲台上，就好似有一种看不到的气势在督促着你但又不会让你感觉窒息；无论课前、课间、课后，我都从未见过他拿手机，伴随着他的总是一些原著、或是教科书。他不像有的老师那样无理取闹，也不像有的老师那样严加管教。大概理性、睿智、宽容、博学是最能能形容他的词语了。怎么会这样完美！</p>
<p>有的时候他会跟我们说公园里那些可笑的翻译，有的时候他会跟我们说universal grammar, 会说约翰把球推下山，还有究竟是约翰通过望远镜看到了一个人还是约翰看到了一个拿着望远镜的人？缺乏证据和没有证据，绝对权力导致绝对腐败。Democracy? 这些与课本毫无相关的内容几乎成为了当时维护我破碎的爱情的支架。</p>
<p>有的时候，每周最希望的事情就是上他的课，因为总是会听到很多好玩的东西；有的时候又有些害怕，谁叫我总是不背课文不背单词呢…有的时候有的时候，时间就这样一点点跑掉，跑到了那个被银行职员“欺负”的小男孩，跑到了胖子智斗间谍的故事，跑到了莳萝泡菜那段深情感人的对白，跑到了在水中挣扎求生的人们，跑到了美国中部那个曾经美好的死寂的春天，还有那个荒谬的、站不住脚的观点。后来我在看《学会提问》的时候，总是想起Groundless beliefs.</p>
<p>两年，没想到那一天你会告诉我们你要去进修，你还信誓旦旦的保证说你会回来的。 或许是到毕业的时候….幸运的是，一年半，终于等到了。我怀念的，是那时课上的音容笑貌…</p>
<p>三个学期都快过去了，记忆开始变得模糊，好怕忘记那两年…终于等到你。这就是幸运吧，如果我大学的综英老师不是他，可能我也无法像今天这样吧。我从小就不喜欢听人管教，又讨厌无理取闹。得知我幸，不得我不信，再不得我不幸-_-#</p>
<p>可是，唯一不幸的是，我再也无法触及你曾点赞的温暖，再也没有最后的幻想了❤</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2017/01/03/miss-dong/index/" data-id="clhp7rthj004xs2qr3nuzc1qx" data-title="怀念东东" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-win2linux/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2017/01/03/win2linux/index/" class="article-date">
  <time class="dt-published" datetime="2017-01-03T00:00:00.000Z" itemprop="datePublished">2017-01-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/linux/">linux</a>►<a class="article-category-link" href="/categories/linux/website/">website</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2017/01/03/win2linux/index/">重装腾讯云的Windows Server 2012为Ubuntu 16.04</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>2018年5月10日更新 貌似现在这个方法不管用了，我测试中18.04无法检测到磁盘，16.04检测光盘的时候出错。</p>
<p><strong>要是想全新安装18.04的话（腾讯云官方不给18.04的镜像，而且装了一大堆烂七八糟的东西，心烦），可以参考这篇文章 <a target="_blank" rel="noopener" href="https://i-meto.com/netboot-ubuntu-18-04/">https://i-meto.com/netboot-ubuntu-18-04/</a></strong></p>
<p>本文灵感源于此：<a target="_blank" rel="noopener" href="https://blog.yoitsu.moe/arch-linux/cvm_with_arch_linux.html">https://blog.yoitsu.moe/arch-linux/cvm_with_arch_linux.html</a></p>
<p>嘿嘿嘿</p>
<p>本文就以Ubuntu 16.04做例子啦。首先需要安装<a target="_blank" rel="noopener" href="http://neosmart.net/Download/Register">EasyBCD</a>，下载好<a target="_blank" rel="noopener" href="http://mirrors.aliyun.com/ubuntu-releases/16.04.1/ubuntu-16.04.1-server-amd64.iso">Ubuntu 16.04</a>的ISO</p>
<p>[v_blue]友情提示（这Comic Sans字体有点逗啊） 1.其他发行版不敢保证成功率哦。</p>
<p>2.将Win改成Linux之后，在控制台关机重启会很慢……但是开机还是一如既往的快[&#x2F;v_blue]</p>
<h2 id="压缩系统盘"><a href="#压缩系统盘" class="headerlink" title="压缩系统盘"></a>压缩系统盘</h2><p>为了方便，我们把50G的系统盘分成两部分，一部分用来存放安装镜像，一部分用于分给&#x2F;使用。首先要远程桌面连到服务器。然后呐，使用mmc.exe，文件-添加&#x2F;删除管理单元-添加磁盘管理</p>
<p><img src="/images/010317_1141_1.png"></p>
<p>之后在C盘上右键，选择压缩卷。</p>
<p><img src="/images/010317_1141_2.png"></p>
<p>不用太多，1G就够哦。</p>
<p><img src="/images/010317_1141_3.png"></p>
<p>哎嘿出现了未分配的空闲分区，右键，新建简单卷。一直下一步，选择文件系统的时候记得选择FAT32，保险起见顺便把卷标也清空了哈。</p>
<p><img src="/images/010317_1141_4.png"></p>
<h2 id="备份网络信息"><a href="#备份网络信息" class="headerlink" title="备份网络信息"></a>备份网络信息</h2><p>腾讯云不给DHCP用，所以咱就得备份下网络信息，谁希望安装一个不能联网的Ubuntu呀？</p>
<p>方法就是网络和共享中心-更改适配器设置-属性-TCP&#x2F;IP v4，大概是酱紫</p>
<p><img src="/images/010317_1141_5.png"></p>
<p>截个图或者存记事本里吧。</p>
<h2 id="挂载镜像、复制文件"><a href="#挂载镜像、复制文件" class="headerlink" title="挂载镜像、复制文件"></a>挂载镜像、复制文件</h2><p>此时我假设你的镜像已经下载好啦，本文以Ubuntu 16.04 server amd64为例（其他发行版是否能够成功我不清楚哟）</p>
<p>你就直接双击那个镜像，把所有文件都复制到D盘（也就是刚刚压缩出来的1G的分区），请再次确认这个分区的文件系统是FAT32哟~</p>
<h2 id="创建引导"><a href="#创建引导" class="headerlink" title="创建引导"></a>创建引导</h2><p>哎哟，复制完啦，咱就打开EasyBCD，定位到添加新条目-NeoGrub，下面选项卡切换到ISO</p>
<p><img src="/images/010317_1141_6.png"></p>
<p>保险起见，咱就把名称的中文去掉啦，然后路径<strong>指向你的iso文件</strong>，模式选择<strong>从磁盘运行</strong>，点击添加条目，稍等片刻~</p>
<p>漫长的等待啊……</p>
<p><img src="/images/010317_1141_7.png"> [v_tips]友情提示： 不用试从内存运行啦，会失败的哟~[&#x2F;v_tips]</p>
<h2 id="重启并挂载vda3"><a href="#重启并挂载vda3" class="headerlink" title="重启并挂载vda3"></a>重启并挂载vda3</h2><p>EasyBCD完成任务之后，咱就可以重启服务器啦。</p>
<p>之后眼疾手快的打开VNC哟。</p>
<p>当然选择第二项然后回车啦</p>
<p><img src="/images/010317_1141_8.png"></p>
<p>然后就是选择语言，配置</p>
<p><img src="/images/010317_1141_9.png"></p>
<p>差不多一路回车，直到探测键盘之后</p>
<p>也就是下图之后</p>
<p><img src="/images/010317_1141_10.png"></p>
<p>安装程序会告诉你找不到cdrom</p>
<p>别急，咱在右上角切换到第二个tty呀</p>
<p><img src="/images/010317_1141_11.png"></p>
<p>手动挂载下vda3，执行如下命令</p>
<p>mount -o ro &#x2F;dev&#x2F;vda3 &#x2F;cdrom</p>
<p>咱可以切到<code>/cdrom</code>里ls下</p>
<p>如果结果不像下图这样，那就重启检查下D盘（也就是vda3）是否为FAT32</p>
<p><img src="/images/010317_1141_12.png"></p>
<p>再回到tty1</p>
<p>在挂载失败页面选择no，然后重新运行下这一项呐</p>
<p><img src="/images/010317_1141_13.png"></p>
<p>啊哈哈成功了。</p>
<h2 id="配置系统"><a href="#配置系统" class="headerlink" title="配置系统"></a>配置系统</h2><p>之后就和正常的安装没什么两样啦，不过DHCP是不管用的哟，所以要自己手动按照保存的信息配置下系统哟。</p>
<p><img src="/images/010317_1141_14.png"></p>
<p>之后主机名随意设置，用户名自己取，密码自己选，主目录加密不加密随心情，时区呀什么的看着办，然后安装程序就告诉你了，不能碰vda3呀，确定不理他，直到选择安装磁盘的地方……</p>
<p>咱选择2号，也就是vda2，Windows的C盘，不要选择错了哦。要是某些有强迫症的童鞋，可以把1#和2#删掉放一起。</p>
<p><img src="/images/010317_1141_15.png"></p>
<p>如下图设置，<strong>挂载点选择&#x2F;，文件系统选择Ext4，启动标志选择on</strong>，然后done</p>
<p><img src="/images/010317_1141_16.png"></p>
<p>之后选择finish……</p>
<p><img src="/images/010317_1141_17.png"></p>
<p>安装程序跟你要swap，先别管啦选择no（你要非得管，就把vda1分了，要么自己好好分得了），之后安装程序又问你一遍，你就yes确定写入硬盘。</p>
<p><img src="/images/010317_1141_18.png"></p>
<p>漫长的安装过程呀</p>
<p><img src="/images/010317_1141_19.png"></p>
<p>不要着急哟，安装程序看着好像是卡住了，其实活着呐~</p>
<h2 id="配置软件包"><a href="#配置软件包" class="headerlink" title="配置软件包"></a>配置软件包</h2><p>这一步呐出现了一个比较严肃的问题，安装程序会跳出来，我们尝试选择select and install software，想要选择下安装哪些软件包，但是却总是跳回来。</p>
<p><img src="/images/010317_1141_20.png"></p>
<p>所以……跨到安装grub吧，安装个基本的系统又何妨，比busybox强、有dpkg就可以啊。</p>
<h2 id="安装grub"><a href="#安装grub" class="headerlink" title="安装grub"></a>安装grub</h2><p>如果一切顺利的话，那么就得配置grub啦。</p>
<p>选择install the grub boot loader on a hard disk，不要选错了哟。默认来说就是<code>/dev/vda</code>，直接回车就好了。</p>
<p><img src="/images/010317_1141_21.png"></p>
<p>估计接下来就没啥事了，然后重启吧~当前的VNC会挂掉，再开个新的VNC，就会发现Ubuntu已经在启动啦！</p>
<p>啊哈哈哈</p>
<p><img src="/images/010317_1141_22.png"></p>
<p>输入你的账号密码，登录吧。</p>
<p>df一个给你们看看哟。货真价实的50G呀。</p>
<p><img src="/images/010317_1141_23.png"></p>
<h2 id="一些后续问题和后遗症"><a href="#一些后续问题和后遗症" class="headerlink" title="一些后续问题和后遗症"></a>一些后续问题和后遗症</h2><h3 id="OpenSSH"><a href="#OpenSSH" class="headerlink" title="OpenSSH"></a>OpenSSH</h3><p>很遗憾咱无法选择软件包，所以就只能想办法用用光盘里的东西啦。</p>
<p>sudo mount –o ro &#x2F;dev&#x2F;vda3 &#x2F;media&#x2F;cdrom<br>sudo apt update<br>sudo apt install openssh-server</p>
<h3 id="软件源"><a href="#软件源" class="headerlink" title="软件源"></a>软件源</h3><p>既然咱已经装好了OpenSSH，那还怕啥，putty这类家伙连上，想要什么软件包不都是分分钟的事情吗。为了方便广大读者，直接粘贴这两句就可以啦。</p>
<p>sudo mount –o ro &#x2F;dev&#x2F;vda3 &#x2F;media&#x2F;cdrom<br>sudo apt install curl<br>curl <a target="_blank" rel="noopener" href="https://repogen.simplylinux.ch/txt/xenial/sources/_431af76ab4c7ca7ccb02ff30ab7d58c6d5e60000.txt">https://repogen.simplylinux.ch/txt/xenial/sources\_431af76ab4c7ca7ccb02ff30ab7d58c6d5e60000.txt</a> | sudo tee &#x2F;etc&#x2F;apt&#x2F;sources.list</p>
<p><img src="/images/010317_1141_24.png"></p>
<p>很推荐<a target="_blank" rel="noopener" href="https://repogen.simplylinux.ch/index.php">Ubuntu Sources List Generator</a>这个网站！</p>
<h3 id="1G的分区"><a href="#1G的分区" class="headerlink" title="1G的分区"></a>1G的分区</h3><p>童鞋们还记得最开始分的1G的分区吗？怎么处理他？哎，当然是做成Swap啦，或者闲着也可以啊。</p>
<p>sudo mkswap &#x2F;dev&#x2F;vda3<br>sudo swapon &#x2F;dev&#x2F;vda3</p>
<p>但是酱紫每次重启都得运行一遍，咱就修改&#x2F;etc&#x2F;fstab吧（我这里vi有点问题，就apt安装vim啦）。</p>
<p>sudo mkswap &#x2F;dev&#x2F;vda3<br>sudo apt install vim<br>sudo vim &#x2F;etc&#x2F;fstab<br>#行尾添加如下内容<br>&#x2F;dev&#x2F;vda3    swap    swap defaults        0 0</p>
<p>保存退出即可。</p>
<h3 id="防火墙"><a href="#防火墙" class="headerlink" title="防火墙"></a>防火墙</h3><p>常在江湖走，哪敢不开防火墙？</p>
<p>用ufw查查资料啦，懒得打字啦。</p>
<h3 id="缺少众多软件包的后遗症"><a href="#缺少众多软件包的后遗症" class="headerlink" title="缺少众多软件包的后遗症"></a>缺少众多软件包的后遗症</h3><p>前面咱们不是select and install software失败了嘛，所以导致我们几乎安装成了一个最小化的Ubuntu，甚至连curl也没有，但是只要有apt、有网，还怕什么呢？</p>
<p>下面的这条命令是安装vim、nano、build-essential、man手册、ppa支持、do-release upgrade、bash自动补全什么的，缺什么补什么吧，反正有apt超级牛力嘛~</p>
<p>sudo apt install -y vim  nano build-essential  man-db python-software-properties  update-manager-core bash-completion dnsutils at locate software-properties-common</p>
<p>注意，bash自动补全要编辑<code>/etc/bash.bashrc</code>文件，把 <code>enable bash completion in interactive shells</code>之后的一段全都取消注释</p>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>俺们技术宅就是这么坑蒙拐骗哒~</p>
<p>50G硬盘到手，快去做个快照吧啊哈哈~</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2017/01/03/win2linux/index/" data-id="clhp7rtnd00bcs2qr3y7o94pm" data-title="重装腾讯云的Windows Server 2012为Ubuntu 16.04" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-fear-without-rules/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2016/12/19/fear-without-rules/index/" class="article-date">
  <time class="dt-published" datetime="2016-12-19T00:00:00.000Z" itemprop="datePublished">2016-12-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/justsay/">justsay</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2016/12/19/fear-without-rules/index/">没有规则才是最可怕的</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>假如你是一位高校老师，有一名学生翘课被你点名发现了，按照二八分、平时成绩出勤占一半、三次缺勤取消考试资格的规定，你会怎么做？</p>
<p>我猜大部分人应该选择根据规则来，扣掉该扣的那一次缺勤分，而不是看心情、想扣光就扣光、想怎样就怎样。</p>
<p>但是假如那名学生说你是傻逼呢？有多少人会给他应该得到的出勤分、扣掉一部分课堂表现，而不是直接让他拜拜重修？</p>
<p>假如后来你发现说你傻逼的那学生是省长他外甥呢？有多少人会“维持原判”，有多少人会贴脸给满分来“冰释前嫌”？</p>
<p>你看，你是不是悄悄改变了自己的规则——或者直接说你根本就没有规则，你只是在跟着感觉来，你所谓的规则只是你的双重思想的一小部分而已。</p>
<p>坚持的理由很简单，规则就是这样定的。对于理性的思考来说，应得的就是应得的，你不能以感性的愤怒、羞辱、面子等为由肆意妄为、违背规则。为人师表啊。没有规则才是最可怕的。</p>
<p>想想那些没有规则的例子吧：GFW封某个网站的时候，有什么规则吗；纳粹追杀共产主义者、犹太人、工会成员，有什么规则吗；文革中被整死的人，有什么规则吗？</p>
<p>我们需要规则，如果没有规则，或定了规则却无视、凌驾规则，甚至随意修改规则，这和历史的倒退有什么区别。好似你既是裁判又是球员，这样谁能玩的过你、谁愿意跟你玩嘛。如果规则只是当权者的随意操纵的把戏，规则又有何用。</p>
<p>这就是个缩影，或许也就是无力改变的现实吧。</p>
<p>最怕，没有规则。</p>
<p>最后，盗用胡适他老人家的一句和本文没啥关系话来结束全文： 一个肮脏的国家，如果人人讲规则而不是空谈道德，最终会变成一个有人味儿的正常国家，道德自然会逐渐回归； 反之，一个干净的国家，如果人人都不讲规则却大谈道德、谈高尚，天天没事儿就谈道德规范，人人大公无私，最终这个国家会堕落成为一个伪君子遍布的肮脏国家。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2016/12/19/fear-without-rules/index/" data-id="clhp7rtg8002ms2qr512c9au5" data-title="没有规则才是最可怕的" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-compile-kernel/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2016/12/15/compile-kernel/index/" class="article-date">
  <time class="dt-published" datetime="2016-12-15T00:00:00.000Z" itemprop="datePublished">2016-12-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/linux/">linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2016/12/15/compile-kernel/index/">[备忘录]：Linux4.9内核的正确编译之路</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>几天前脱袜子大叔放出了LTS版本的Linux Kernel 4.9,听说增加了一个新的TCP拥塞控制算法BBR，想着自己从来没有编译过内核，那就试试嘛，纯当积累经验了。</p>
<p>在这个过程中遇到了一些比较可怕的问题，比如说build出了300M的initrd.img，这……好吧！</p>
<p>我的环境是：Ubuntu 16.04 64位，主要参考教程<a target="_blank" rel="noopener" href="https://kernelnewbies.org/KernelBuild">戳我吧</a></p>
<p>下面就备忘一下我编译过程的整个经过吧</p>
<h2 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h2><p>用包管理器把你的系统升级到最新吧，另外，最好别玩跨越太大的升级啊。</p>
<p>sudo apt update<br>sudo apt upgrade</p>
<h2 id="解决依赖"><a href="#解决依赖" class="headerlink" title="解决依赖"></a>解决依赖</h2><p>老生常谈了，该装的都装好吧</p>
<p>sudo apt install libncurses5-dev gcc make git exuberant-ctags bc libssl-dev</p>
<h2 id="准备目录"><a href="#准备目录" class="headerlink" title="准备目录"></a>准备目录</h2><p>通常来说我们选择在&#x2F;usr&#x2F;src下存放内核源码。实际上这并不是必须的。请注意，编译内核的时候并不需要root权限，安装的时候才需要。为了方便管理、patch内核、保持一致性起见，我们还是老实地用这个目录吧。从现在起就切换到root啦</p>
<h2 id="下载、准备内核源码"><a href="#下载、准备内核源码" class="headerlink" title="下载、准备内核源码"></a>下载、准备内核源码</h2><p>在kernel.org下载内核，如果你的速度太慢，可以试试阿里云的源。</p>
<p>#官网<br>wget <a target="_blank" rel="noopener" href="https://cdn.kernel.org/pub/linux/kernel/v4.x/linux-4.9.tar.xz">https://cdn.kernel.org/pub/linux/kernel/v4.x/linux-4.9.tar.xz</a><br>#阿里云<br>wget <a target="_blank" rel="noopener" href="http://mirrors.aliyun.com/linux-kernel/v4.x/linux-4.9.tar.xz">http://mirrors.aliyun.com/linux-kernel/v4.x/linux-4.9.tar.xz</a><br>tar xvf linux-4.9.tar.xz<br>cd linux-4.9</p>
<h2 id="配置内核"><a href="#配置内核" class="headerlink" title="配置内核"></a>配置内核</h2><p>编译内核之前，我们需要创建出来一个.config文件，由这个文件决定编译什么、编译进内核还是模块。通常来说我们有这么几种方式生成这个.config</p>
<h3 id="使用你原来内核的config"><a href="#使用你原来内核的config" class="headerlink" title="使用你原来内核的config"></a>使用你原来内核的config</h3><p>cp &#x2F;boot&#x2F;config-`uname -r`* .config</p>
<h3 id="使用默认的config（会覆盖已有的-config文件）"><a href="#使用默认的config（会覆盖已有的-config文件）" class="headerlink" title="使用默认的config（会覆盖已有的.config文件）"></a>使用默认的config（会覆盖已有的.config文件）</h3><p>make defconfig</p>
<p>我们这里当然要使用原来的内核配置文件啦，所以来一句cp &#x2F;boot&#x2F;config-`uname -r`* .config即可。</p>
<p>或者干脆来一句</p>
<p>make localmodconfig</p>
<p>就OK了。假如我们要对内核配置进行微调，那就执行</p>
<p>make menuconfig</p>
<p>会酱紫</p>
<p><img src="/images/121516_1413_Linux491.png"></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>是不是很神奇能在终端里画出这么漂亮的界面？ncurses啦</p>
<p>为了防止它没加载我们刚刚复制过来的旧内核配置文件，我们选择 Load - ok手动加载下。</p>
<p>之后导航到Kernel Hacking - Compile-time checks and compiler options，按N取消对Compile the kernel with debug info的勾选</p>
<p>剩下的一些配置就看个人需求啦，比如说我需要编译BBR并使它成为默认的TCP 拥塞算法，那就酱紫</p>
<p><img src="/images/121516_1413_Linux492.png"></p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>你需要支持XFS，就自己去开启。</p>
<p>全都配置完了之后，导航到save 保存。</p>
<p>下面我们就要准备开始编译啦！</p>
<p>[v_error]警告 如果你是第一次编译内核，那么就按照上文所述即可。如果你已经编译过了，那么请运行 make clean 来清除编译过程中产生的可能导致编译失败的各种文件 make mrproper 不但会执行make clean的所有操作，还会删除.config文件，请谨慎使用[&#x2F;v_error]</p>
<h2 id="编译内核"><a href="#编译内核" class="headerlink" title="编译内核"></a>编译内核</h2><p>在编译内核之前，建议大家想想以下几个问题：你是给自己电脑编译？还是虚拟机？还是VPS？</p>
<p>你电脑是啥处理器？几个核心几个线程的？</p>
<p>多大物理内存，有没有Swap？</p>
<p>如果是用的虚拟机，那么推荐在虚拟机的界面里开终端而不是通过OpenSSH服务；</p>
<p>如果是VPS，请一定要这样screen -S kernel然后再开始编译，否则SSH连接断开编译也就终止了。</p>
<p>你的内存比较小，比如说只有2G、4G，建议开个swap吧，免得内存耗尽编译失败</p>
<p>如果你自觉内存比较大不会耗尽，那就大胆的进行吧；</p>
<p>如果你不知道自己是啥CPU ，你就lscpu下，CPU(s)写了个4,那你就当成4核心的。（我这货是双核四线程）</p>
<p> </p>
<p>总之，这些以防万一的准备工作是要做好的，因为编译内核是个比较消耗时间的事情，万一因为些小问题失败了，再重新来太糟心。</p>
<p>嗷对了，如果你是笔记本，请做好散热……</p>
<p>说了这么多，我就当你已经准备好了！</p>
<p>那么，果断的敲</p>
<p>make</p>
<p>编译内核吧！（make会包含make bzImage等操作，详见make help）</p>
<p>但是……忘记了我们上面说的双核四核吗？并行编译不好吗？</p>
<p>那么就</p>
<p>make -jX</p>
<p>X是一个整数，假如你是双核，2和3就是比较好的选择；4核那么4或6就会是比较好的选择。双核四线程请将其视作四核。千万不要尝试双核来个make -j10,这样你的电脑就得比狗还慢啦。</p>
<p>我就make -j4啦</p>
<p>该约妹子的约妹子，该睡觉的睡觉……</p>
<p> </p>
<p>[v_tips]小提示：开启Swap的方法（128M的Swap为例）</p>
<p>sudo dd if&#x3D;&#x2F;dev&#x2F;zero of&#x3D;test bs&#x3D;1M count&#x3D;128<br>sudo chmod 600 test<br>sudo mkswap test<br>sudo swapon test</p>
<p>free确定swap已开启 为了避免出现权限的问题，就全是用root啦[&#x2F;v_tips]</p>
<h2 id="安装内核和模块"><a href="#安装内核和模块" class="headerlink" title="安装内核和模块"></a>安装内核和模块</h2><p>进过了很长时间，终于编译完啦。那就安装吧，ls -lh一下就会发现vmlinuz其实很小的。</p>
<p>sudo make modules_install install</p>
<p>之后reboot体验新内核吧！ 重启之后uname -a即可查看新内核哦，如果旧的内核没有留下来的必要了，那就使用类似</p>
<p>sudo apt remove linux-headers-版本号</p>
<p>等移除旧版本的内核</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2016/12/2016121514232992.png"><img src="/images/2016121514232992-300x34.png" alt="qq%e6%88%aa%e5%9b%be20161215222225"></a></p>
<p> </p>
<p>服务器上的4.9<a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2016/12/2016121514232992.png"></a></p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>Some of us get dipped in flat, some in satin, some in gloss. But every once in a while you find someone who’s iridescent, and when you do, nothing will ever compare.</p>
<p>Nothing will ever compare. :oops:</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2016/12/15/compile-kernel/index/" data-id="clhp7rtew0019s2qr9tbbbeyj" data-title="[备忘录]：Linux4.9内核的正确编译之路" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-play-vps/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2016/11/25/play-vps/index/" class="article-date">
  <time class="dt-published" datetime="2016-11-25T00:00:00.000Z" itemprop="datePublished">2016-11-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/linux/">linux</a>►<a class="article-category-link" href="/categories/linux/website/">website</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2016/11/25/play-vps/index/">花样玩：把闲置的VPS用起来</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>像我这种流量比较小的网站，往往服务器都一直是0负载，这样一天天过去总觉得是一种浪费。浪费可耻，浪费就是犯罪啊。于是咱就得琢磨琢磨，服务器通常CPU性能都很好（别看是单核，那也是志强啊），带宽也比较充足，还24小时开机，所以嘛….咱来点奇葩的玩法，像是建站、ss这种常见的玩法咱就不说啦。 [v_blue] 友情提示： 1.下文的一些思路<strong>仅供参考</strong>，各位各取所需 2.拿来做生产的服务器（比如跑我的网站的这个），尽量<strong>专机专用少折腾</strong>，比如说我的这个服务器只负责网站和中转文件… 3.请记得遵守主机商的ToS、服务器所在地的法律、主机商所属国的法律。 4.OpenVZ的VPS还是悠着点，用太多CPU可能会被封停哦；KVM和Xen的就不必太多考虑这点了，如果你不放心，ticket走起。 5.海外VPS请注意如果你做某些事情，可能会导致你的IP被墙或者被严重干扰。 6.那种超低价的超售狂，就别折腾啦，搭个ss偷着乐就好了。 [&#x2F;v_blue]</p>
<hr>
<h2 id="搭建Tor中继节点、网桥"><a href="#搭建Tor中继节点、网桥" class="headerlink" title="搭建Tor中继节点、网桥"></a>搭建Tor中继节点、网桥</h2><p><strong>仅限海外VPS</strong></p>
<p>Tor是什么？是一个很厉害的匿名工具啦。如果你想为这个匿名网络做一些贡献，可以选择搭建Tor Relay（中继）、Tor Bridges（网桥），Exit Nodes（出口节点）还是别想啦。大部分主机商都允许搭建中继和网桥的。</p>
<p>当然啦，本人是不建议在自己正在用的VPS上搭建的，万一要是被墙了，那就麻烦了。</p>
<p>详细教程已经有人写了，戳<a target="_blank" rel="noopener" href="https://yepster.me/tor-deployment/">《关于搭建 Tor Relay 的一点胡扯——以及为什么现在 Tor Bridges 更好》</a></p>
<h2 id="中转油管视频、Git仓库等（利用七牛）"><a href="#中转油管视频、Git仓库等（利用七牛）" class="headerlink" title="中转油管视频、Git仓库等（利用七牛）"></a>中转油管视频、Git仓库等（利用七牛）</h2><p><strong>推荐海外VPS</strong></p>
<p>这里请一定要注意遵守服务器所在地的法律、主机商所属国的法律和主机商的ToS，被封不要赖我哦~~</p>
<p>首先中转就要先下载回来，这里对待种子可以使用rtorrent，直链可以使用wget，Git仓库可以使用git clone，YouTube视频可以用youtube-dl。怎么下载回来就不用我说了吧，如果这个不会，那可没办法，没办法啊</p>
<p>之后注册个七牛，去<a target="_blank" rel="noopener" href="http://developer.qiniu.com/code/v6/tool/qshell.html">开发者中心</a>自行读文档配置去吧~（或者参考我这篇<a target="_blank" rel="noopener" href="https://dmesg.app/vps-google-drive.html">《使用海外vps中转Google Drive文件》</a>） [v_tips] 友情提示： 1.我这人比较懒，所以我写了一个名为relay的脚本，给加了x权限然后丢到PATH下，之后任何目录都可以直接打relay来上传了。 2.在使用qshell的时候，有的时候上传会失败，我发现qshell是”同步”的模式，而我一般都是上传完就删除。所以我一般会选择把目录中隐藏的.qshell目录删掉再上传。 3.如果你中转一些可能被和谐的内容，那么建议你使用tar打个包，这样它的散列就会变了，机器审查是有点难啦；如果你中转的是危险的东西，那么用OpenSSL套件加密、或者是压缩工具的加密功能，这样对付人工也差不多足够啦（当然，请注意弱口令）。 4.视频、音乐、加密卷等高熵的文件，通常是很难压缩的，所以遇到视频建议打包而不是打包+压缩，使用类似</p>
<p>tar cvf </p>
<p>这样的命令而不是带j、J的选项。 [&#x2F;v_tips]</p>
<h2 id="云存储OwnCloud"><a href="#云存储OwnCloud" class="headerlink" title="云存储OwnCloud"></a>云存储OwnCloud</h2><p><strong>推荐国内服务器</strong></p>
<p>OwnCloud这东西，就像是你的私有云，再也不怕党妈妈以女神的理由封杀你网盘啦！</p>
<p>这也有人写过类似教程，在这里<a target="_blank" rel="noopener" href="https://www.logcg.com/archives/2007.html">《用 ownCloud 搭建个人私有云》</a></p>
<h2 id="搭建UDP-53的OpenVPN-x2F-SS突破Web认证"><a href="#搭建UDP-53的OpenVPN-x2F-SS突破Web认证" class="headerlink" title="搭建UDP 53的OpenVPN&#x2F;SS突破Web认证"></a>搭建UDP 53的OpenVPN&#x2F;SS突破Web认证</h2><p><strong>推荐国内服务器</strong></p>
<p>这个嘛……是真正非常有用的地方啊！我的马甲站就是这么玩的，结果导致服务器经常满载&#x2F;(ㄒoㄒ)&#x2F;~~</p>
<p>详情戳我的博文<a target="_blank" rel="noopener" href="https://dmesg.app/udp53.html">《UDP 53 免费上网经验谈》</a></p>
<p>很明显<strong>SS的性能要远远好过SoftEther只不过要开全局啦……</strong></p>
<h2 id="编译服务器"><a href="#编译服务器" class="headerlink" title="编译服务器"></a>编译服务器</h2><p><strong>推荐海外服务器</strong></p>
<p>有的时候，身处大陆的小盆友们在编译某些比较大的项目的时候，常常会被GFW折磨到疯：本身源码就挺大，各种依赖还都得下，GFW还超喜欢干扰。所以有些时候放弃编译往往不是因为CPU性能不足、硬盘太慢、内存太小而是因为网太渣……在大陆当程序员，真的都是折翼的天使啊。</p>
<p>比如说那次我想编译个服务器版本的Lantern，需要下载Lantern定制版的Go，再下载Lantern源码，编译的时候还要下载很多……所以我就稍稍利用了下aws</p>
<p><img src="/images/112516_1014_VPS1.png"></p>
<p>没骗你，不小吧！</p>
<h2 id="利用ffmpeg压制影片、转换格式等"><a href="#利用ffmpeg压制影片、转换格式等" class="headerlink" title="利用ffmpeg压制影片、转换格式等"></a>利用ffmpeg压制影片、转换格式等</h2><p><strong>国内海外均可</strong></p>
<p>对于那些经常需要转换格式的、压制影片的人来说，好像这样做会很方便。如果开个按时的高性能实例，效果应该会好很多！</p>
<p>这里如果你的服务器恰巧是Windows系统，那么人人影视曾经发过一个非常简单的压片工具，用起来很方便；至于使用Linux的嘛……<a target="_blank" rel="noopener" href="https://dmesg.app/ffmpeg.html">使用ffmpeg，可以戳我哟</a>。 [v_blue] 友情提示： 1.大部分服务商都支持自定义镜像，所以咱……可以开一台新机器，编译好ffmpeg以及上传什么的，做一个镜像。之后要用的时候，开个高性能的机器，直接选择用这个镜像安装，转换，上传，销毁机器。省钱又方便。 2.我等穷人的单核心服务器，虽说CPU性能很强，但是……我相信现在大家的电脑通常都是四核八核十六核……所以要真的比起来速度，开个多线程，服务器估计就跪了…… 3.这个最好的应用场景就是，你发现一个10G+的片源，利用服务器高带宽的特点下载回来，之后压制成2G的720P再下载……在一些限制流量、限制上网时长的地方最划算了。 [&#x2F;v_blue]</p>
<p>PS，七牛有个数据处理，用起来挺方便的，速度很快而且很便宜。</p>
<p><img src="/images/112516_1014_VPS2.png"></p>
<h2 id="搭建游戏服务器（MineCraft）"><a href="#搭建游戏服务器（MineCraft）" class="headerlink" title="搭建游戏服务器（MineCraft）"></a>搭建游戏服务器（MineCraft）</h2><p><strong>推荐国内服务器</strong></p>
<p>大部分游戏都是Windows平台下的，相应的开服端也是Windows下居多的……所以比如说开个MineCraft？或者 steam家的l4d2、cs这种？别说，我还真有一个l4d2服务器。</p>
<p>PS：游戏服务器一般对带宽的要求会比较高。</p>
<p>这个，也有人写过<a target="_blank" rel="noopener" href="https://www.logcg.com/archives/1693.html">《在 Ubuntu 中搭建 Minecraft 服务器并挂载 Mod》</a></p>
<h2 id="挖矿"><a href="#挖矿" class="headerlink" title="挖矿"></a>挖矿</h2><p>╮(╯_╰)╭</p>
<p>这个……大家伙悠着点，大部分主机商都是不允许挖矿的！而且挖矿的前途嘛……看着玩吧！</p>
<h2 id="卖虚拟主机"><a href="#卖虚拟主机" class="headerlink" title="卖虚拟主机"></a>卖虚拟主机</h2><p><strong>国内海外均可</strong></p>
<p>这是真正的赚钱之道啊，或者一个服务器跑三四个网站（还别说我的马甲站就是一个服务器跑了三个网站）。用过lnmp一键安装包的大概之道添加虚拟主机有多方便</p>
<p><img src="/images/112516_1014_VPS3.png"></p>
<h2 id="搭建自己的DNS"><a href="#搭建自己的DNS" class="headerlink" title="搭建自己的DNS"></a>搭建自己的DNS</h2><p><strong>国内海外均可。</strong></p>
<p>为了嘛，解析到正确的IP而不是总跑到阿塞拜疆啊。</p>
<p>这个，当然是要DNSCrypt啦！</p>
<p>当然，也有人写过了，我只是搬运工<a target="_blank" rel="noopener" href="https://www.logcg.com/archives/981.html">《编译安装 dnscrypt-wrapper 搭建防污染 DNS 服务器》</a></p>
<h2 id="搭建Resilio-Sync（BT-Sync）节点"><a href="#搭建Resilio-Sync（BT-Sync）节点" class="headerlink" title="搭建Resilio Sync（BT Sync）节点"></a>搭建Resilio Sync（BT Sync）节点</h2><p><strong>仅限海外</strong></p>
<p>做一个好人，提升大家的下载速度，哈哈哈。具体可以参考<a target="_blank" rel="noopener" href="https://help.getsync.com/hc/en-us/articles/204762449-Guide-to-Linux-and-Sync-peculiarities">官网文章</a></p>
<h2 id="做Git服务器"><a href="#做Git服务器" class="headerlink" title="做Git服务器"></a>做Git服务器</h2><p>有些时候，我们可能需要私有的Git仓库，这个时候<a target="_blank" rel="noopener" href="https://about.gitlab.com/installation/">GitLab CE</a>就派上用场啦，有钱的也可以玩玩<a target="_blank" rel="noopener" href="https://enterprise.github.com/home">GitHub Enterprise</a></p>
<p>我思路有限，大概就只能想到这么多比较花样的玩法了！有别的新奇玩法的，欢迎补充~~</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2016/11/25/play-vps/index/" data-id="clhp7rti2006ns2qrghkt1ln8" data-title="花样玩：把闲置的VPS用起来" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-ffmpeg/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2016/11/10/ffmpeg/index/" class="article-date">
  <time class="dt-published" datetime="2016-11-10T00:00:00.000Z" itemprop="datePublished">2016-11-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/it/">it</a>►<a class="article-category-link" href="/categories/it/linux/">linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2016/11/10/ffmpeg/index/">自行编译ffmpeg并压制带字幕的视频、一键编译non-free ffmpeg</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>[v_tips]有点不好意思啊此文无图… :shock: 还有这个字体咋样呀 :razz:  [&#x2F;v_tips]</p>
<p>[v_error]一键编译脚本在<a target="_blank" rel="noopener" href="https://dmesg.app/ffmpeg.html/3">第三页</a>！ [&#x2F;v_error] 话说很久之前，人人影视放出来了一个压片工具，总共有192M的样子，而且只能在Windows上运行。对于我等Linux党，这可怎么行呢？于是我就想到了ffmpeg这个万能的神器。当然了ffmpeg作为自由软件，你从包管理器里安装的、直接configure编译的，是不会带libx264</p>
<p>这类非自由软件，自然想要压制影片就不是那么好玩了……</p>
<p>那既然酱紫，我们就只好手动编译一个non-free的ffmpeg，然后再来使用嘛！</p>
<p>[v_act]这种压片的方法是把字幕混到视频流中，也就是说视频最终是音频流+视频流，是没有字幕流的，字幕已经是视频的一部分了。这也可以极大程度上的避免盗字幕的行为。[&#x2F;v_act] 懒虫们，假如你们真的懒得看这么长的文章，并且你确定你的发行版是比较新的发行版，那么请直接翻到本文最后看”一键式编译教程”吧！</p>
<h2 id="准备特效字体"><a href="#准备特效字体" class="headerlink" title="准备特效字体"></a>准备特效字体</h2><p>有很多字幕都是用了自定义字体，请记得给你的发行版安装对应的字体呀！桌面版直接双击安装即可。如果是服务器版，把字体复制到&#x2F;usr&#x2F;share&#x2F;fonts&#x2F;truetype和原来字体一样的位置，或者新建个winFonts目录便于区分也可以。</p>
<p>之后运行</p>
<p>sudo apt install fontconfig<br>sudo fc-cache –fv</p>
<p>运行fc-list可以看到已安装字体列表</p>
<p>查看中文字体，可以使用</p>
<p>sudo fc-list :lang&#x3D;zh</p>
<p>并且请注意编码格式的问题，Linux一般使用<strong>UTF-8</strong>而Windows则是GB2312</p>
<p> </p>
<h1 id="编译安装ffmpeg"><a href="#编译安装ffmpeg" class="headerlink" title="编译安装ffmpeg"></a>编译安装ffmpeg</h1><p>我使用的是Ubuntu，所以这里我就按照<a target="_blank" rel="noopener" href="https://trac.ffmpeg.org/wiki/CompilationGuide/Ubuntu">官网提供的教程编译</a>啦！</p>
<h2 id="安装必备依赖"><a href="#安装必备依赖" class="headerlink" title="安装必备依赖"></a>安装必备依赖</h2><p>sudo apt-get update<br>sudo apt-get -y install autoconf automake build-essential libass-dev libfreetype6-dev \<br>libsdl1.2-dev libtheora-dev libtool libva-dev libvdpau-dev libvorbis-dev libxcb1-dev libxcb-shm0-dev \<br>libxcb-xfixes0-dev pkg-config texinfo zlib1g-dev</p>
<p>[v_tips] 注意，如果是服务器版Ubuntu，可以把第二步替换成如下（你装原来的也行，反正是ffplay和X11的依赖……）</p>
<p>sudo apt-get -y install autoconf automake build-essential libass-dev libfreetype6-dev \<br>libtheora-dev libtool libvorbis-dev pkg-config texinfo zlib1g-dev</p>
<p>[&#x2F;v_tips]</p>
<p>创建一个用来下载源码的目录</p>
<p>mkdir ~&#x2F;ffmpeg_sources</p>
<h2 id="编译与安装"><a href="#编译与安装" class="headerlink" title="编译与安装"></a>编译与安装</h2><h3 id="yasm"><a href="#yasm" class="headerlink" title="yasm"></a>yasm</h3><p>如果你的包管理器里的yasm版本号&gt;&#x3D;1.2.0，那就可以用包管理器安装</p>
<p>（使用sudo apt search yasm查看版本号，就想编译的，我也没意见）</p>
<p>sudo apt-get install yasm</p>
<p>否则请编译安装</p>
<p>cd ~&#x2F;ffmpeg_sources<br>wget <a target="_blank" rel="noopener" href="http://www.tortall.net/projects/yasm/releases/yasm-1.3.0.tar.gz">http://www.tortall.net/projects/yasm/releases/yasm-1.3.0.tar.gz</a><br>tar xzvf yasm-1.3.0.tar.gz<br>cd yasm-1.3.0<br>.&#x2F;configure –prefix&#x3D;”$HOME&#x2F;ffmpeg_build” –bindir&#x3D;”$HOME&#x2F;bin”<br>make<br>make install<br>make distclean</p>
<h3 id="libx264"><a href="#libx264" class="headerlink" title="libx264"></a>libx264</h3><p>如果你的包管理器里的libx264版本号&gt;&#x3D;0.118，那就是用包管理器安装</p>
<p>sudo apt-get install libx264-dev</p>
<p>否则需要编译安装</p>
<p>cd ~&#x2F;ffmpeg_sources<br>wget <a target="_blank" rel="noopener" href="http://download.videolan.org/pub/x264/snapshots/last/_x264.tar.bz2">http://download.videolan.org/pub/x264/snapshots/last\_x264.tar.bz2</a><br>tar xjvf last_x264.tar.bz2<br>cd x264-snapshot*<br>PATH&#x3D;”$HOME&#x2F;bin:$PATH” .&#x2F;configure –prefix&#x3D;”$HOME&#x2F;ffmpeg_build” –bindir&#x3D;”$HOME&#x2F;bin” –enable-static –disable-opencl<br>PATH&#x3D;”$HOME&#x2F;bin:$PATH” make<br>make install<br>make distclean</p>
<h3 id="libx265"><a href="#libx265" class="headerlink" title="libx265"></a>libx265</h3><p>只能选择编译安装啦。</p>
<p>sudo apt-get install cmake mercurial<br>cd ~&#x2F;ffmpeg_sources<br>hg clone <a target="_blank" rel="noopener" href="https://bitbucket.org/multicoreware/x265">https://bitbucket.org/multicoreware/x265</a><br>cd ~&#x2F;ffmpeg_sources&#x2F;x265&#x2F;build&#x2F;linux<br>PATH&#x3D;”$HOME&#x2F;bin:$PATH” cmake -G “Unix Makefiles” -DCMAKE_INSTALL_PREFIX&#x3D;”$HOME&#x2F;ffmpeg_build” -DENABLE_SHARED:bool&#x3D;off ..&#x2F;..&#x2F;source<br>make<br>make install</p>
<h3 id="libfdk-aac"><a href="#libfdk-aac" class="headerlink" title="libfdk-aac"></a>libfdk-aac</h3><p>如果你的包管理器中有libfdk-aac-dev，那就可以使用包管理器安装（没有版本需求）</p>
<p>sudo apt-get install libfdk-aac-dev</p>
<p>否则需要编译安装</p>
<p>cd ~&#x2F;ffmpeg_sources<br>wget -O fdk-aac.tar.gz <a target="_blank" rel="noopener" href="https://github.com/mstorsjo/fdk-aac/tarball/master">https://github.com/mstorsjo/fdk-aac/tarball/master</a><br>tar xzvf fdk-aac.tar.gz<br>cd mstorsjo-fdk-aac*<br>autoreconf -fiv<br>.&#x2F;configure –prefix&#x3D;”$HOME&#x2F;ffmpeg_build” –disable-shared<br>make<br>make install<br>make distclean</p>
<h3 id="ibmp3lame"><a href="#ibmp3lame" class="headerlink" title="ibmp3lame"></a>ibmp3lame</h3><p>如果你的包管理器中有ibmp3lame，版本号&gt;&#x3D;3.98.3，那么你可以使用包管理器安装</p>
<p>sudo apt-get install libmp3lame-dev</p>
<p>否则需要编译安装</p>
<p>sudo apt-get install nasm<br>cd ~&#x2F;ffmpeg_sources<br>wget <a target="_blank" rel="noopener" href="http://downloads.sourceforge.net/project/lame/lame/3.99/lame-3.99.5.tar.gz">http://downloads.sourceforge.net/project/lame/lame/3.99/lame-3.99.5.tar.gz</a><br>tar xzvf lame-3.99.5.tar.gz<br>cd lame-3.99.5<br>.&#x2F;configure –prefix&#x3D;”$HOME&#x2F;ffmpeg_build” –enable-nasm –disable-shared<br>make<br>make install<br>make distclean</p>
<h3 id="libopus"><a href="#libopus" class="headerlink" title="libopus"></a>libopus</h3><p>如果你的包管理中有libopus，版本号&gt;&#x3D;1.1，那你可以使用包管理器安装</p>
<p>sudo apt-get install libopus-dev</p>
<p>否则需要编译安装。</p>
<p>cd ~&#x2F;ffmpeg_sources<br>wget <a target="_blank" rel="noopener" href="http://downloads.xiph.org/releases/opus/opus-1.1.2.tar.gz">http://downloads.xiph.org/releases/opus/opus-1.1.2.tar.gz</a><br>tar xzvf opus-1.1.2.tar.gz<br>cd opus-1.1.2<br>.&#x2F;configure –prefix&#x3D;”$HOME&#x2F;ffmpeg_build” –disable-shared<br>make<br>make install<br>make clean</p>
<h3 id="libvpx"><a href="#libvpx" class="headerlink" title="libvpx"></a>libvpx</h3><p>只能编译安装（注意，这个链接是在Google的服务器上，如果服务器在国内下载不回来，就自己翻墙下载然后上传到服务器吧）</p>
<p>cd ~&#x2F;ffmpeg_sources<br>wget <a target="_blank" rel="noopener" href="http://storage.googleapis.com/downloads.webmproject.org/releases/webm/libvpx-1.5.0.tar.bz2">http://storage.googleapis.com/downloads.webmproject.org/releases/webm/libvpx-1.5.0.tar.bz2</a><br>tar xjvf libvpx-1.5.0.tar.bz2<br>cd libvpx-1.5.0<br>PATH&#x3D;”$HOME&#x2F;bin:$PATH” .&#x2F;configure –prefix&#x3D;”$HOME&#x2F;ffmpeg_build” –disable-examples –disable-unit-tests<br>PATH&#x3D;”$HOME&#x2F;bin:$PATH” make<br>make install<br>make clean</p>
<h2 id="编译ffmpeg"><a href="#编译ffmpeg" class="headerlink" title="编译ffmpeg"></a>编译ffmpeg</h2><p>耗时可能会比较长</p>
<p>cd ~&#x2F;ffmpeg_sources<br>wget <a target="_blank" rel="noopener" href="http://ffmpeg.org/releases/ffmpeg-snapshot.tar.bz2">http://ffmpeg.org/releases/ffmpeg-snapshot.tar.bz2</a><br>tar xjvf ffmpeg-snapshot.tar.bz2<br>cd ffmpeg<br>PATH&#x3D;”$HOME&#x2F;bin:$PATH” PKG_CONFIG_PATH&#x3D;”$HOME&#x2F;ffmpeg_build&#x2F;lib&#x2F;pkgconfig” .&#x2F;configure \<br>–prefix&#x3D;”$HOME&#x2F;ffmpeg_build” \<br>–pkg-config-flags&#x3D;”–static” \<br>–extra-cflags&#x3D;”-I$HOME&#x2F;ffmpeg_build&#x2F;include” \<br>–extra-ldflags&#x3D;”-L$HOME&#x2F;ffmpeg_build&#x2F;lib” \<br>–bindir&#x3D;”$HOME&#x2F;bin” \<br>–enable-gpl \<br>–enable-libass \<br>–enable-libfdk-aac \<br>–enable-libfreetype \<br>–enable-libmp3lame \<br>–enable-libopus \<br>–enable-libtheora \<br>–enable-libvorbis \<br>–enable-libvpx \<br>–enable-libx264 \<br>–enable-libx265 \<br>–enable-nonfree<br>PATH&#x3D;”$HOME&#x2F;bin:$PATH” make<br>make install<br>make distclean<br>hash –r</p>
<p>[v_blue]注意：</p>
<p>1.如果你直接运行configure，将会是没有non-free软件的ffmpeg；官方的configure配置会在<del>下生成一个bin（编译之后安装就会在</del>&#x2F;bin下）、ffmpeg_build目录；如果不喜欢，那就照猫画虎的改掉$HOME（记得都要改哦），make install的时候就到&#x2F;bin啦！</p>
<p>2.在Ubuntu中，~&#x2F;bin默认是被包含到PATH中的，所以当你注销-登录或者</p>
<p>source ~&#x2F;.profile</p>
<p>之后可以从任何目录运行<del>&#x2F;bin中的程序的。再不济，咱把</del>&#x2F;bin里的拷贝到&#x2F;bin里总可以吧？</p>
<p>3.如果需要安装man page，请运行</p>
<p>echo “MANPATH_MAP $HOME&#x2F;bin $HOME&#x2F;ffmpeg_build&#x2F;share&#x2F;man” &gt;&gt; ~&#x2F;.manpath</p>
<p>[&#x2F;v_blue]</p>
<hr>
<p>我假设你已经编译好了ffmpeg，并且准备好了你的视频和字幕。</p>
<p>前面提过了，如果你的字幕中使用了自定义字体，请记得同时安装对应的字体！</p>
<p>并且，请注意<strong>字幕文件的编码格式</strong>，Linux通常会使用UTF-8无BOM，而Windows则是GB2312这类。为了避免出乱码，还是老老实实转换成UTF-8吧！</p>
<p>下一页我会介绍一些压片的方法，关于ffmpeg的更多方法，大家伙就自己搜索、看官方的文档、man page啦！</p>
<p>注意，压制过程中可能会出现这样的警告</p>
<p>Glyph 0x36C not found, selecting one more font for (YouYuan, 700, 0)</p>
<p>不要管他啦……只要是UTF-8编码的，会压出来的！ 该看下一页啦~~</p>
<h2 id="不改变视频、音频编码格式及参数，将字幕压制"><a href="#不改变视频、音频编码格式及参数，将字幕压制" class="headerlink" title="不改变视频、音频编码格式及参数，将字幕压制"></a>不改变视频、音频编码格式及参数，将字幕压制</h2><p>ffmpeg –i Lantern.mp4-vf “ass&#x3D;Lantern.ass” out.mp4</p>
<h2 id="使用H264（AVC）重新编码视频、不改变其他参数，不改变音频编码格式"><a href="#使用H264（AVC）重新编码视频、不改变其他参数，不改变音频编码格式" class="headerlink" title="使用H264（AVC）重新编码视频、不改变其他参数，不改变音频编码格式"></a>使用H264（AVC）重新编码视频、不改变其他参数，不改变音频编码格式</h2><p>ffmpeg -i Lantern.mp4 -vcodec libx264 -preset fast -crf 20 -vf “ass&#x3D;Lantern.ass” out.mp4</p>
<h3 id="关于preset参数："><a href="#关于preset参数：" class="headerlink" title="关于preset参数："></a>关于preset参数：</h3><p>预设是一系列参数的集合，这个集合能够在编码速度和压缩率之间做出一个权衡。一个编码速度稍慢的预设会提供更高的压缩效率（压缩效率是以文件大小来衡量的)。这就是说，假如你想得到一个指定大小的文件或者采用恒定比特率编码模式，你可以采用一个较慢的预设来获得更好的质量。同样的，对于恒定质量编码模式，你可以通过选择一个较慢的预设轻松地节省比特率。</p>
<p>如果你很有耐心，通常的建议是使用最慢的预设。目前所有的预设按照编码速度降序排列为： ultrafast, superfast, veryfast, faster, fast, medium, slow, slower, veryslow, placebo默认为medium</p>
<p>[v_blue]如果你蒙圈了，那就这么说的，ultrafast处理的最快，但是文件大；placebo处理的慢，但是文件小；建议medium或者fast就可以了……有耐心的话，veryslow也够了。[&#x2F;v_blue]</p>
<h3 id="crf-Constant-Rate-Factor"><a href="#crf-Constant-Rate-Factor" class="headerlink" title="crf(Constant Rate Factor)"></a>crf(Constant Rate Factor)</h3><p>该方法在输出文件的大小不太重要的时候，可以使整个文件达到特定的视频质量。该编码模式在单遍编码模式下提供了最大的压缩效率，每一帧可以按照要求的视频质量去获取它需要的比特数。不好的一面是，你不能获取一个特定大小的视频文件，或者说将输出位率控制在特定的大小上。</p>
<p>crf的参数值中，其中0为无损模式，23为缺省值，51可能是最差的。该数字越小，图像质量越好。从主观上讲，18~28是一个合理的范围。18往往被认为从视觉上看是无损的，它的输出视频质量和输入视频一模一样或者说相差无几。但从技术的角度来讲，它依然是有损压缩。 [v_blue]我觉得选择20就差不多啦~~[&#x2F;v_blue]</p>
<h3 id="以H-264、Lame自定义参数重新编码、压制"><a href="#以H-264、Lame自定义参数重新编码、压制" class="headerlink" title="以H.264、Lame自定义参数重新编码、压制"></a>以H.264、Lame自定义参数重新编码、压制</h3><p>ffmpeg -i Lantern.mp4 -vcodec libx264 -preset fast -crf 20 -vf “ass&#x3D;Lantern.ass” -acodec libmp3lame -ab 128k lame.mp4</p>
<p>如果想压制AAC的音频，就在最后把acodec libmp3lame改成acodec aac</p>
<p>其中-ab 128k指的是平均码率为128k</p>
<h2 id="以H-264自定义分辨率、AAC自定义参数缩放压制视频"><a href="#以H-264自定义分辨率、AAC自定义参数缩放压制视频" class="headerlink" title="以H.264自定义分辨率、AAC自定义参数缩放压制视频"></a>以H.264自定义分辨率、AAC自定义参数缩放压制视频</h2><p>ffmpeg -i Lantern.mp4 -vcodec libx264 -preset fast -crf 20 -vf “ass&#x3D;Lantern.ass,scale&#x3D;800:-1” -acodec aac -ab 128k aac.mp4</p>
<p>其中的scale&#x3D;800:-1指的是输出800:对应比例的视频。假如你要压制720P的，那就把800改成1280；假如你要1080的，那就改成1920。通常来说，分辨率高的压分辨率低的好办，低的压高的就麻烦了……</p>
<h2 id="两遍模式"><a href="#两遍模式" class="headerlink" title="两遍模式"></a>两遍模式</h2><p>如果你的目标是一个确定大小的文件而且帧与帧之间的视频质量并不重要，这个方法很适用。这通过一个例子可以得到很好地解释。你的视频有10分钟（600秒）的时长同时要求输出为50MB，因为比特率&#x3D;文件大小&#x2F;时长，</p>
<p>50MB*8192（MB转kilobits)&#x2F;600秒&#x3D;683 kbps（全局比特率）</p>
<p>683kbps-128kbps(音频比特率）&#x3D;555kbps（视频比特率）,</p>
<p>两遍编码的例子：</p>
<p>ffmpeg -y -i input -c:v libx264 -preset medium -b:v 555k -pass 1 -an -f mp4 &#x2F;dev&#x2F;null &amp;&amp;<br>ffmpeg -i input -c:v libx264 -preset medium -b:v 555k -pass 2 -c:a libfdkaac -b:a 128k mp4 output.mp4</p>
<h2 id="分割视频（拷贝视频和音频流，速度比较快）"><a href="#分割视频（拷贝视频和音频流，速度比较快）" class="headerlink" title="分割视频（拷贝视频和音频流，速度比较快）"></a>分割视频（拷贝视频和音频流，速度比较快）</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -ss 01:00:00 -i input_file_h264.mp4 -vcodec copy -acodec copy -t 00:06:00 output_file.mp4</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>我这上面这几个小标题写的乱乱糟糟的，在这里统一做一个总结吧：</p>
<h3 id="需要原封不动的把字幕压进去"><a href="#需要原封不动的把字幕压进去" class="headerlink" title="需要原封不动的把字幕压进去"></a>需要原封不动的把字幕压进去</h3><p>ffmpeg –i Lantern.mp4-vf “ass&#x3D;Lantern.ass” out.mp4</p>
<h3 id="需要快速的压制质量较好的H264视频"><a href="#需要快速的压制质量较好的H264视频" class="headerlink" title="需要快速的压制质量较好的H264视频"></a>需要快速的压制质量较好的H264视频</h3><p>ffmpeg -i Lantern.mp4 -vcodec libx264 -preset fast -crf 20 -vf “ass&#x3D;Lantern.ass” out.mp4</p>
<h3 id="需要快速压制质量较好的H264、720P视频"><a href="#需要快速压制质量较好的H264、720P视频" class="headerlink" title="需要快速压制质量较好的H264、720P视频"></a>需要快速压制质量较好的H264、720P视频</h3><p>ffmpeg -i Lantern.mp4 -vcodec libx264 -preset fast -crf 23 -vf “ass&#x3D;Lantern.ass,scale&#x3D;1280:-1” out.mp4</p>
<h3 id="需要压制超高质量的、缓慢的压制H264视频"><a href="#需要压制超高质量的、缓慢的压制H264视频" class="headerlink" title="需要压制超高质量的、缓慢的压制H264视频"></a>需要压制超高质量的、缓慢的压制H264视频</h3><p>ffmpeg -i Lantern.mp4 -vcodec libx264 -preset veryslow -crf 18 -vf “ass&#x3D;Lantern.ass” out.mp4</p>
<p>这个……crf的质量大家自己掂量着办！0最好，53最差，默认23，合理范围18~28 preset也看着办 ultrafast, superfast, veryfast, faster, fast, medium, slow, slower, veryslow, placebo 越慢，压缩率越高。</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>视频编码这是个长久的技术活啊，而且需要很多的经验！自己多编码多玩玩，自然就有懂啦！</p>
<p>下一页是给懒虫们留着的哦~~ 附录</p>
<p>给懒虫们的一键式编译脚本。我不太会写脚本，所以这个还是有很大改善空间的….目前只支持Debian系 使用方法： git clone仓库，给两个文件都加x权限，root身份运行onekey-ffmpeg.sh即可。 [gt href&#x3D;’<a target="_blank" rel="noopener" href="https://github.com/BennyThink/onekey-compile-ffmpeg'/]%E5%BC%80%E6%BA%90%E5%9C%B0%E5%9D%80%E6%88%B3%E6%88%91/[/gt/]">https://github.com/BennyThink/onekey-compile-ffmpeg&#39;\]开源地址戳我\[/gt\]</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2016/11/10/ffmpeg/index/" data-id="clhp7rtht005zs2qrbjgt43ap" data-title="自行编译ffmpeg并压制带字幕的视频、一键编译non-free ffmpeg" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-school-3/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2016/11/09/school-3/index/" class="article-date">
  <time class="dt-published" datetime="2016-11-09T00:00:00.000Z" itemprop="datePublished">2016-11-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/security/">security</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2016/11/09/school-3/index/">[学校上网系列]3. 从网盘秒传中想到的：不要想当然</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>今天恰逢美国大选，特朗普已经成为新任美国总统。所以我也来凑个热闹，当然今天我不打算谈论总统的事，今天我要继续谈论我们的学校上网系列之从网盘秒传想到的</p>
<p>鉴于360云盘宣布关门大吉，估计大家伙都转移到百度网盘了吧。提到网盘，大家可能会把他当做备份数据的、存储资料的一个地方。所以今天我也就来科普下一些和数据备份相关的概念以及如何安全、可靠的进行数据备份。嗷对了，自从百度云改版之后，下载什么东西都得用那丫的百度云管家。婶不能忍啊！ :twisted:</p>
<p>再继续之前，强烈建议阅读爱范儿上的一篇文章：<a target="_blank" rel="noopener" href="http://www.ifanr.com/653360">《国内的网盘一个个倒下，这里有一份能让你用到老的存储指南》</a></p>
<p>在说数据备份之前，我们要先学习一些基础知识：数据备份的三种方式、如何选择存储媒介、超大空间和秒传，之后我们会讨论下如何安全的使用云盘、如何干他丫的百度云管家。</p>
<h2 id="数据备份的三种方式"><a href="#数据备份的三种方式" class="headerlink" title="数据备份的三种方式"></a>数据备份的三种方式</h2><p>通常来说，最常见的数据备份方式有完整备份、增量备份、差异备份。</p>
<h3 id="完整备份"><a href="#完整备份" class="headerlink" title="完整备份"></a>完整备份</h3><p>把所有文件、文件夹或数据作一次性的复制，不考虑其中是否有任何更改、变化的备份方式就叫做完整备份。通常来说，第一次备份都会是完整备份。举个例子，我周一把整个分区&#x2F;目录的文件都以某种方式备份&#x2F;封装到某个特定的存储介质中，这就叫做完整备份。</p>
<h3 id="增量备份"><a href="#增量备份" class="headerlink" title="增量备份"></a>增量备份</h3><p>指对上一次完整备份或增量备份后更新的数据进行备份。举个例子，我周一进行了完整备份，周二进行增量备份则是这段时间内发生变化的数据作为一个”增量”和周一的备份文件放在一起，这个过程就叫做增量备份。周三继续进行增量备份是和周二进行对比，变化的数据进行备份。换句话说，增量备份是跟<strong>前一次备份</strong>对比，备份变化的。</p>
<h3 id="差异备份"><a href="#差异备份" class="headerlink" title="差异备份"></a>差异备份</h3><p>提供运行完整备份后变更的文件的备份。差异备份和增量备份非常相近。只不过差异备份永远是和完整备份的那次进行比较（在这里也就是周一的完整备份）</p>
<hr>
<p>估计大家伙此时还是懵逼的状态，依旧没搞懂增量和差异的区别……我们举个很大的例子：</p>
<p>周一进行完整备份，周二进行增量备份，周三进行增量备份，周四进行差异备份，周五进行差异备份，他们备份之后的文件名分别为file1, file2, file3, file4, file5</p>
<p>那么请继续往下看。</p>
<h2 id="三种备份方式的还原"><a href="#三种备份方式的还原" class="headerlink" title="三种备份方式的还原"></a>三种备份方式的还原</h2><h3 id="完整备份-1"><a href="#完整备份-1" class="headerlink" title="完整备份"></a>完整备份</h3><p>最简单了，直接还原file1即可。</p>
<h3 id="增量备份-1"><a href="#增量备份-1" class="headerlink" title="增量备份"></a>增量备份</h3><p>假如我要恢复到周二的状态，那么需要file1和file2这两个文件，假如需要恢复到周三的状态，那么就需要file1, file2, file3这三个文件。</p>
<h3 id="差异备份-1"><a href="#差异备份-1" class="headerlink" title="差异备份"></a>差异备份</h3><p>假如需要恢复到周四的状态，那么就需要file1, file4；假如需要恢复到周五的状态，那么就需要file1和file5（并不需要file4）</p>
<hr>
<p>看出增量备份和差异备份的区别了吗？</p>
<p>增量备份是针对<strong>上一次备份的</strong>（无论是增量还是完整），它的恢复需要<strong>每一次的增量文件和最开始的完整备份</strong>，也就是说恢复到周三的状态不能没有file2这个文件；</p>
<p>差异备份是针对<strong>完整备份的</strong>，它的恢复需要本次<strong>差异备份文件</strong>和对应的<strong>完整备份</strong>。假如我想恢复到周四，那么只需要file1和file4就够了，file2和file3都是完全无关的。</p>
<h3 id="这有什么用？和网盘有何关系？"><a href="#这有什么用？和网盘有何关系？" class="headerlink" title="这有什么用？和网盘有何关系？"></a>这有什么用？和网盘有何关系？</h3><p>当然有用了，尤其是那些喜欢备份系统分区的人们——每次都是完整备份，浪费时间、浪费空间。</p>
<p><img src="/images/110916_1153_1.png"></p>
<p>著名的备份软件True Image即提供这三种备份方式。</p>
<p>对于使用网盘的人们来说……网盘如果能够支持类似增量备份这种技术，将会大幅度减少上传时间。实际上，网盘中存在的这种技术一般被称作”<strong>差异同步</strong>“，对这个技术做的最好的应该是Dropbox。举个例子，假如你上传了一个压缩包，之后又给压缩包进行了一些修改（增加、修改、删除文件等），Dropbox会分析这个压缩包中哪里被修改了，然后只上传修改过的那些字节。这一技术有一点像rsync 。因为这技术太先进了，所以很少有网盘会用，维基百科上有个页面，有兴趣可以去<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Comparison_of_online_backup_services">查阅这里</a></p>
<h2 id="如何选择备份媒介"><a href="#如何选择备份媒介" class="headerlink" title="如何选择备份媒介"></a>如何选择备份媒介</h2><p>备份媒介，指的是你是把备份文件复制到移动硬盘上，U盘上还是上传到虚无缥缈的”云”上？</p>
<p>我们要从几个方面来考虑这个问题。</p>
<h3 id="速度"><a href="#速度" class="headerlink" title="速度"></a>速度</h3><p>毫无疑问，拷贝到移动硬盘上的速度是要<strong>远远快于</strong>上传到云端的，况且中国奉行下载很快、上传很慢的不对等”百兆光纤”这个现象要更加明显。下载也基本同理。</p>
<h3 id="保密性"><a href="#保密性" class="headerlink" title="保密性"></a>保密性</h3><p>你的数据是否是保密的呢？。如果移动硬盘被借走、偷走，那么所有数据就会被人偷窥；而上传到网盘…也可能有类似的担忧：网盘提供商偷窥（比如说美国的NSA啦，中国的金盾啦）、传输过程中被窃听（很多网盘上传下载都不是加密的）、网盘账号被盗（网盘被入侵、被搜索引擎检索）</p>
<p>在这里点名批评百度网盘，用它，<a target="_blank" rel="noopener" href="http://www.pingwest.com/pay-for-your-data-and-privacy/">那就先给你的隐私买个保险吧</a>。</p>
<h3 id="可用性"><a href="#可用性" class="headerlink" title="可用性"></a>可用性</h3><p>硬盘坏了、着火、被盗、地震，使用移动硬盘这类的可能就要遭殃了。但是除非发生极大规模的全国性灾难、云存储厂商跑路、内容被审查，云端资料大概还是比较安全的……</p>
<p>[v_blue]其实我看好BT Sync[&#x2F;v_blue]</p>
<h3 id="易用性"><a href="#易用性" class="headerlink" title="易用性"></a>易用性</h3><p>假如你想分享某个视频给朋友，U盘拷贝进去再给他可能很麻烦；但是上传到网盘再分享就很简单了。</p>
<h2 id="超大空间和秒传的秘密"><a href="#超大空间和秒传的秘密" class="headerlink" title="超大空间和秒传的秘密"></a>超大空间和秒传的秘密</h2><p>对于大多数人来说，2T的空间是一种诱惑啊。但是天真的你难道以为百度真的为你量身订造买了三块价值300元的1硬盘总计900元和其他电费、带宽费来为你服务吗？还有哎百度说的2T是2048G——1024进制，而不是硬盘厂商们喜欢的900G</p>
<p>当然不会了！ [v_tips]为什么要3x1T？不应该直接就是2T吗 RAID5啊亲，这么重要的应用场合，肯定要用到磁盘阵列的，而且RAID5应用比较广泛，速度和安全并存。 [&#x2F;v_tips]</p>
<p>事实当然不是这样了。笨理想，同样的文件服务器上肯定只有一份（逻辑上只有一份），但是从技术上他们是怎么确定同一个文件的呢？这就引入了单向散列函数的概念。</p>
<h3 id="单向散列函数"><a href="#单向散列函数" class="headerlink" title="单向散列函数"></a>单向散列函数</h3><p>英文名字是hash，原意为砸碎，这倒是很形象，也有人音译为”哈希”。单向散列函数是一种将无穷无尽的东西转换为<strong>有限长度的</strong>、<strong>尽可能不重复的、不可逆</strong>字符串的算法，这个算法叫做单向散列函数，这个字符串叫做散列值、摘要、信息摘要。说到这，有些童鞋可能会问，你把无穷的东西转换成有穷的东西，肯定会有两个东西转换之后会是相同的嘛！问得好！这种现象叫做碰撞，分为……！</p>
<p>说到这可能”散列”这个概念还是很难理解。那么指纹可以理解吗？你对一首歌求某个散列算法的散列值，就相当于把这首歌的指纹求出来了——就像你的指纹可以几乎唯一的代表你一样，这个散列值也可以几乎唯一的代表那首歌。</p>
<p>举个例子，你把00000000散列之后的摘要是abjhda62c，你把仅仅改变了一个bit的10000000散列之后，摘要就会变为fjgha267d2。输入值只变了一位，但是摘要却变得面目全非。也就是说，散列可以用来验证文件的正确性、</p>
<p>聪明的童鞋大概想到了…假如我上传了某部电影，此时服务器上海没有这个文件，于是只好乖乖的上传了。上传完之后，另一个用户再上传同一部电影的时候（或者是散列值相同的文件），服务器（或者是客户端）经过计算发现散列值相同，那也就直接给另一个用户做标记并提示”秒传”。</p>
<p>这也就是秒传的原理。 [v_blue]Windows下的HashTab用起来挺舒服的[&#x2F;v_blue]</p>
<hr>
<p>单向散列函数有哪些基本特征呢？ <strong>单向性</strong> 你能把砸碎的镜子复原吗？很难吧。单向散列函数的单向性是指的操作方向的不可逆性，在单向散列函数中是指只能从输入推导出输出，而不能从输出计算出输入。</p>
<p><strong>唯一性</strong> 散列函数的输入和输出不是唯一对应关系的（无穷怎么可能会一一对应有穷），如果两个散列值相同，两个输入值很可能是相同的，但也可能不同，这种情况称为”哈希碰撞”。碰撞分为两种，强碰撞和弱碰撞。</p>
<p><strong>弱抗碰撞性：</strong>当给定某条消息的散列值时，单向散列函数必须确保要找到和该条消息具有相同散列值的另外一条消息是非常困难的。</p>
<p><strong>强抗碰撞性：</strong>是指要找到散列值相同的两条不同的消息是非常困难的。</p>
<p>这里的碰撞可能说的有点多了……但是百度云使用的是MD5，而MD5早就被认为是不安全的散列函数了。我曾见过用工作站碰撞小黄片玩的孩子… [v_tips]PS：在对用户身份进行认证中（也就是你登录账户的时候），散列函数是起到非常关键的作用的。没有哪家系统会直接明文把用户密码存到数据库里吧，再不济也得用散列函数hash一下（然而这却无法阻挡彩虹表的脚步），比较好的做法是使用随机盐配合安全的散列函数。[&#x2F;v_tips]</p>
<h2 id="如何安全的使用云盘"><a href="#如何安全的使用云盘" class="headerlink" title="如何安全的使用云盘"></a>如何安全的使用云盘</h2><p>几个月之前，几个字幕组的成员因为<a target="_blank" rel="noopener" href="http://news.sohu.com/20160929/n469374932.shtml">上传日剧资源被日本警方逮捕</a></p>
<p>虽说字幕组本身就是游走在法律边缘的，但是我还是想说一句，字幕组挺辛苦的。那么，假如你是上面新闻里被抓的字幕组成员，假如你的网盘受到监控、传输被监听，假如给你一次重来的机会，你该怎样避免被抓到呢……？</p>
<p>再假如你不是很放心云存储厂商，你怕他们泄露隐私，但是你又不得不使用，那该怎么办呢？ [v_error]PS，这不是想要说”匿名术”，这只是想说，怎样能够在<strong>轻度危险的情况</strong>下安全的使用云盘；同时也不会涉及到那些很牛逼的破解技术，比如说”冷启动攻击”什么的。[&#x2F;v_error]</p>
<h3 id="使用VeraCrypt创建加密卷，并将加密卷上传"><a href="#使用VeraCrypt创建加密卷，并将加密卷上传" class="headerlink" title="使用VeraCrypt创建加密卷，并将加密卷上传"></a>使用VeraCrypt创建加密卷，并将加密卷上传</h3><p>创建加密卷，哪怕拿到它，没有密码也是无法解密的。在轻度危险的情况下，大概也不会有人揍你胁迫你交出密码。至于加密卷的密码，可以使用某些支持端到端加密的IM软件、或者是GPG发邮件等方法告知接收人。</p>
<p>对于那些不信任云存储厂商但又没办法的人，创建加密卷可能是非常棒的办法了——同时这时候支持差分同步就要好太多太多了。</p>
<p>使用VeraCrypt创建加密卷具体方法，可以参考我的博文<a target="_blank" rel="noopener" href="https://dmesg.app/encryption-gpg-veracrypt.html">《2016版：密码学科普，兼谈GnuPG和VeraCrypt》</a></p>
<h3 id="使用GPG创建加密文件"><a href="#使用GPG创建加密文件" class="headerlink" title="使用GPG创建加密文件"></a>使用GPG创建加密文件</h3><p>这个本质和上面是一样的，只不过非对称往往速度不占优势</p>
<h3 id="使用WinRar、7zip等开启文件名加密功能"><a href="#使用WinRar、7zip等开启文件名加密功能" class="headerlink" title="使用WinRar、7zip等开启文件名加密功能"></a>使用WinRar、7zip等开启文件名加密功能</h3><p>一定要记得开启文件名加密功能，否则，哎嘿嘿还是能看到文件名的。</p>
<p><img src="/images/110916_1153_2.png"><img src="/images/110916_1153_3.png"></p>
<h3 id="注意：不要对加密卷再次使用WinRar等工具进行压缩"><a href="#注意：不要对加密卷再次使用WinRar等工具进行压缩" class="headerlink" title="注意：不要对加密卷再次使用WinRar等工具进行压缩"></a>注意：不要对加密卷再次使用WinRar等工具进行压缩</h3><p>为啥捏？学习一点点信息论、密码学的人大概会懂，加密过的东西的熵都是很高的，是压不动的，还浪费你CPU，非得想弄成压缩包，或者是纯粹利用压缩软件的分卷压缩功能，请记得选”只存储”这个选项。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>最近心情比较浮躁，这篇文章也写得比较草率，一度都觉得想放弃了。近几天我也会尽快更新“美文推荐”的。最后，留下一句话：</p>
<blockquote>
<p>有些人总觉得，我踢球进门了，是我球技好；射偏了，那是打雷吓到了我。其实真正起决定性作用的是球技，打不打雷下不下雨只是次要因素。</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2016/11/09/school-3/index/" data-id="clhp7rtj50085s2qrcfydgzrb" data-title="[学校上网系列]3. 从网盘秒传中想到的：不要想当然" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-school-2/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2016/10/05/school-2/index/" class="article-date">
  <time class="dt-published" datetime="2016-10-05T00:00:00.000Z" itemprop="datePublished">2016-10-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/security/">security</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2016/10/05/school-2/index/">[学校上网系列]2. 从钓鱼网站中想到的：不靠谱的域名</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>[v_blue]由于本篇提到了一些HTTPS的事情，所以，插播一个特大喜讯，<a target="_blank" rel="noopener" href="http://www.solidot.org/story?sid=49821">Mozilla表态将停止信任WoSign 和StartCom签发的新证书</a>！[&#x2F;v_blue]</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/school-1.html">上一篇文章</a>谈了下开放式网络的危险性，实际上在开放式网络中很危险的地方就在<strong>以DNS劫持的方式来达到钓鱼</strong>的目的——尤其是对那些安全性意识很差的人来说。有的童鞋可能会收到”您有1000积分可兑换100元话费，请点击<a target="_blank" rel="noopener" href="http://jf.l0086.cn进行兑换" ,于是果断点击结果被骗.所以这篇文章主要就来说说钓鱼网站的那些事. ">http://jf.l0086.cn进行兑换&quot;，于是果断点击结果被骗。所以这篇文章主要就来说说钓鱼网站的那些事。</a></p>
<p>在说钓鱼网站之前，我们首先要了解一下几个非常基础的概念：<strong>IP、域名、DNS</strong>。之后我们会说说当你在浏览器地址栏输入网址并按回车的时候发生了什么。</p>
<p>[v_tips]友情提示：只想知道怎么防骗的，直接看最后的总结啦！[&#x2F;v_tips]</p>
<h2 id="IP"><a href="#IP" class="headerlink" title="IP"></a>IP</h2><p>互联网协议地址（Internet Protocol Address），缩写为IP地址（IP Address），是分配给网络上使用网际协议的设备的数字标签。常见的IP地址分为IPv4与IPv6两大类。</p>
<p>212.41.1.74就是一个合法的IPv4地址。</p>
<p>IPv4是一个32位的地址，每8位使用一个点来进行分隔，我们人类通常使用<strong>点分十进制</strong>将11111111.11111111.11111111.11111111转化为255.255.255.255，甚至是使用<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%97%A0%E7%B1%BB%E5%88%AB%E5%9F%9F%E9%97%B4%E8%B7%AF%E7%94%B1">CIDR表示法</a>来表示一个IP段。</p>
<p>IP地址就好似门牌号，对于人类来说不太好记，对于机器来说当然没问题啦！谁也不会输入220.181.112.244来访问百度吧？</p>
<p><img src="/images/100416_0523_1.png"></p>
<p>于是人类就发明了一种可以把易于记住的字符串转换成对应的IP的东西，叫做DNS</p>
<h2 id="域名"><a href="#域名" class="headerlink" title="域名"></a>域名</h2><p>所谓域名，简单理解，就是你在浏览器地址栏看到的以http:&#x2F;&#x2F;或者https:&#x2F;&#x2F;开头的一串比较好记的英文字符串（不包括http:&#x2F;&#x2F;、https:&#x2F;&#x2F;）。</p>
<p><img src="/images/100416_0523_2.png"></p>
<p>这里dmesg.app即是一个域名</p>
<p>其中最后的com被称为TLD（Top Level Domain）</p>
<p>TLD一般分为两种：</p>
<p><strong>国家和地区顶级域名</strong>（Country code top-level domain，ccTLD）：简而言之，cn就是ccTLD</p>
<p><strong>通用顶级域</strong>（Generic top-level domain，gTLD）： com就是gTLD</p>
<h2 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h2><p>域名系统（英文：Domain Name System，缩写：DNS）是因特网的一项服务。它作为将<strong>域名和IP地址相互映射</strong>的一个分布式数据库，能够使人更方便地访问互联网。</p>
<p>DNS使用<strong>TCP或者UDP的53号端口</strong>，通常人们默认都会使用UDP 53.因为UDP是无连接的协议，你敢想象下查询个域名还需要三次握手这么麻烦费时吗？</p>
<p>那么从域名到IP这个转化过程是由DNS完成的，这个过程具体是怎样的呢？我们简要的来说下。</p>
<p>[v_tips]顺便提一句，DNS查询有两种方式：<strong>递归和迭代</strong>。DNS客户端设置使用的DNS服务器一般都是递归服务器，它负责<strong>全权处理</strong>客户端的DNS查询请求，直到返回最终结果。而DNS服务器之间一般采用迭代查询方式。[&#x2F;v_tips]</p>
<blockquote>
<p>1. 在浏览器中输入网址或者点击超链接，浏览器会先提取出来域名，比如说<a target="_blank" rel="noopener" href="http://www.qq.com.浏览器首先会在自己的缓存中查找是否有该域名对应的ip地址,如果有,就先调用这个ip地址映射,完成域名解析./">www.qq.com。浏览器首先会在自己的缓存中查找是否有该域名对应的IP地址，如果有，就先调用这个IP地址映射，完成域名解析。</a></p>
<p>2. 如果浏览器缓存中没有这个域名的映射，就去查找hosts，如果有，就先调用这个IP地址映射，完成域名解析。</p>
<p>3. 如果hosts与浏览器缓存都没查到，那就要向系统设置的DNS发送查询请求（通常这个DNS是ISP提供的DNS或者是阿里DNS等公共DNS），我们暂时称这个服务器为ISP DNS。ISP DNS服务器首先检查自身缓存，如果存在记录则直接返回结果。</p>
<p>4. 如果以上操作均失败，ISP DNS会在配置文件找到13组根服务器的地址，并向根域名服务器发送查询报文query <a target="_blank" rel="noopener" href="http://www.qq.com.根域名服务器返回.com域的权威域名服务器地址,这一级首先会返回的是顶级域名的权威域名服务器./">www.qq.com。根域名服务器返回.com域的权威域名服务器地址，这一级首先会返回的是顶级域名的权威域名服务器。</a></p>
<p>5. ISP DNS服务器向.com域的权威域名服务器发送查询报文query <a target="_blank" rel="noopener" href="http://www.qq.com,得到.qq.com域的权威域名服务器地址./">www.qq.com，得到.qq.com域的权威域名服务器地址。</a></p>
<p>6.ISP DNS服务器向.qq.com域的权威域名服务器发送查询报文query <a target="_blank" rel="noopener" href="http://www.qq.com,得到主机www的a记录,存入自身缓存并返回给客户端./">www.qq.com，得到主机www的A记录，存入自身缓存并返回给客户端。</a></p>
</blockquote>
<p>如果有点懵逼的话，你就这么想，ISP DNS是个跑腿的，假如他的缓存里没有你要解析的域名，他就去找<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%A0%B9%E7%B6%B2%E5%9F%9F%E5%90%8D%E7%A8%B1%E4%BC%BA%E6%9C%8D%E5%99%A8">rootDNS</a>，rootDNS再踢皮球让他去找对应顶级域的DNS，然后再踢皮球…最终找到了真正的IP，返回并记入缓存。</p>
<p>想想如果DNS全都挂掉了，大家不仅仅要打IP地址上网了，各种商业交易也会完蛋，连微信都聊不了哎——实际情况非常糟糕，这大概就会是互联网和整个世界的末日。</p>
<h2 id="在你敲回车时，都发生了些什么"><a href="#在你敲回车时，都发生了些什么" class="headerlink" title="在你敲回车时，都发生了些什么"></a>在你敲回车时，都发生了些什么</h2><p>在了解了DNS解析的过程之后，我们来说下，当你在地址栏输入一个网址并敲回车之后，究竟发生了些什么呢。假如说，你是第一次在Chrome的地址栏中输入dmesg.app吧！我猜没有几个人会输入带http、https的吧！</p>
<blockquote>
<p>1. 首先根据输入的网址，提取出域名（在本例中，也就是dmesg.app）</p>
<p>2. 根据上面”DNS解析过程”解析出正确的IP地址。</p>
<p>3. 浏览器就会向这个 IP地 址 对应的 Web 端口（一般也就是80）发送 HTTP Get请求。</p>
</blockquote>
<p>对于一没开HTTPS的网站来说，这就是完整的过程了，只要缓存没过期，每一次都遵循这个过程。但是…对待HTTPS的网站，要额外多出来一些步骤。</p>
<blockquote>
<p>4. 服务器发送<a target="_blank" rel="noopener" href="https://dmesg.app的301重定向给浏览器,浏览器向带https的443端口发起请求,开始验证证书、密钥交换等等/">https://dmesg.app的301重定向给浏览器，浏览器向带https的443端口发起请求，开始验证证书、密钥交换等等</a></p>
<p>5. 在HTTPS建立之后，服务器会发送对应的响应报文，有些还会加上一个Strict-Transport-Security响应头。</p>
</blockquote>
<p>在我的博客中，当你第二次访问dmesg.app时，除了DNS解析过程还是一样之外，请求的时候就变得不同了….</p>
<ul>
<li>在接下来的一段时间内（我设置的是63072000秒，即两年），浏览器只要向bennythink.com或其子域名发送HTTP请求时，必须采用HTTPS来发起连接。比如，用户点击超链接或在地址栏输入 <a target="_blank" rel="noopener" href="http://dmesg.app/">http://dmesg.app/</a> ，浏览器应当自动将 http 转写成 https，然后直接向 <a target="_blank" rel="noopener" href="https://dmesg.app/">https://dmesg.app/</a> 发送请求。</li>
<li>在接下来的两年中，如果 bennythink.com 服务器发送的TLS证书无效，用户不能忽略浏览器警告继续访问网站。</li>
</ul>
<h1 id="当你遇到钓鱼网站时……"><a href="#当你遇到钓鱼网站时……" class="headerlink" title="当你遇到钓鱼网站时……"></a>当你遇到钓鱼网站时……</h1><h2 id="迷惑人的字符"><a href="#迷惑人的字符" class="headerlink" title="迷惑人的字符"></a>迷惑人的字符</h2><p>我们回到文章最开始，我列举了一个中国移动积分商城的例子，如果你瞪大眼睛瞅一瞅，你会发现是l0086而不是10086（字母L和数字1）如果l0086这个网站存在并且做的和10086一样，那么你的服务密码不就跟你说拜拜啦！</p>
<p>相应的，有几个字符在某些非等宽字体下看起来非常相似，1、I、l，0、O、o，如果骇客恰巧注册到了这样的域名——或者是开放式网络中通过DNS劫持，轻轻松松骗起人嘛。</p>
<p><img src="/images/100416_0523_3.png"></p>
<p>不同编程字体下的1Il0Oo，从左到右依次为Source Code Pro、Ubuntu Mono、Monaco、DejaVu Sans Mono</p>
<p>在word里用调成微软雅黑看看这个六个字符，几乎分不清的好嘛！Android的Droid Sans也一个样…</p>
<h2 id="不可信的域名"><a href="#不可信的域名" class="headerlink" title="不可信的域名"></a>不可信的域名</h2><p>有人可能会说，那我瞪大眼睛看清楚了网址（域名），确保是真正的网站而不是山寨的，不就行了嘛？这种想法，要分情况讨论，对应http的，其实是大错特错。原因在于，域名系统本身就是<strong>不可靠</strong>的！回想一下DNS解析的过程，好像DNS服务器都有个缓存哎 。这是为了提高查询效率的，先看看自己的缓存里有没有，没有了再往上一级去问。缓存是存在一定时间的时效性的，可能是几分钟也可能是几小时，缓存里的某条记录如果过期了，就会被删除。</p>
<p>你有没有想过，假如有人故意配置错了域名和IP的配置关系呢？假如从源头开始这个对应的映射关系就是错误的呢？假如有人抢在真正的域名服务器应答之前”抢答”了呢？（正是因为UDP协议才可以”抢答”，但是哪怕人们使用TCP的DNS，中间人也依旧可以使用RST来中断连接。可靠的办法是使用DNSCrypt加密查询请求）</p>
<p>这也就是针对DNS的攻击方法，常见的有<strong>DNS劫持</strong>和<strong>DNS污染</strong></p>
<p><strong>劫持</strong>：域名服务器上都会保存一大堆的域名记录（每条记录包含”域名”和”IP地址”）。当收到域名查询的时候，域名服务器会从这堆记录中找到对方想要的，然后回应给对方。如果域名服务器上的某条记录被<strong>人为修改</strong>了（改成错的），那么一旦要查询这条记录，得到的就是错误的结果。这种情况称之为”域名劫持”。</p>
<p>不知道有没有遇见或者听说过打开网页蹦到了什么”互联星空”，或者是下载什么软件被替换成了其他的东西，这些都属于劫持。</p>
<p><strong>污染</strong>：当你的电脑向域名服务器发送了”域名查询”的请求，然后域名服务器把回应发送给你的电脑，这之间是有一个时间差的。如果某个攻击者能够在域名服务器的”DNS应答”还没有到达你的电脑之前，先伪造一个错误的”DNS应答”发给你电脑。那么你的电脑收到的就是错误的信息，并得到一个错误的 IP地址。DNS污染还有一个还有个别名叫投毒，多形象，河流上游投诉上游以下全部中毒。就是说，污染可以扩散到下层的DNS服务器。</p>
<h2 id="值得信任的https"><a href="#值得信任的https" class="headerlink" title="值得信任的https"></a>值得信任的https</h2><p>在说废话之前，先说下结论：在<strong>理想状态下</strong>，HTTPS是可以相信的。</p>
<p>理想状态？没错理想状态，In theory, there is no difference between theory and practice. But, in practice, there is.</p>
<p>带着小锁头是指使用了HTTPS的网站，在Chrome中显示为绿色的小锁头，有些可能还会带有Certificate Transparency</p>
<p><img src="/images/100416_0523_4.png"></p>
<p>在解释这个问题之前，我们首先想一想，为什么说HTTP是不安全的？</p>
<p><strong>一是</strong>HTTP可以被嗅探、监听；<strong>二是</strong>HTTP可以被中间人劫持并且双方不会感觉到任何异常。</p>
<p>应对第一个问题，我们可以通过一种办法来使得客户端和服务器<strong>协商</strong>出来一个只有他俩知道的<strong>密钥</strong>来对通信进行加密，这样即使被窃听、被篡改也无所谓，通常我们会使用混合密码体系、Diffie-Hellman密钥交换算法来达到这个目的；</p>
<p>《你的灯亮着吗？发现问题的真正来源》里说过一句话：<strong>每一个解决方案都是下一个问题的来源</strong>。在应对”HTTP不安全”的第一个问题时，我们成功解决了被窃听、篡改的问题，但是随之而来我们引发了一个更严重的问题：被中间人劫持该怎么办？</p>
<p>再想想怎么应对中间人劫持之前，我们首先想一想问题的来源和本质：为什么我们能被悄无声息的中间人劫持？</p>
<p>想</p>
<p>几</p>
<p>分</p>
<p>钟</p>
<p>试</p>
<p>试</p>
<p> </p>
<p><strong>缺乏有效的身份认证机制</strong>是使得中间人劫持发生的根本原因。</p>
<p>为此，人们采取的方法是引入第三方认证机构构建PKI。</p>
<h2 id="https不完全可靠的原因"><a href="#https不完全可靠的原因" class="headerlink" title="https不完全可靠的原因"></a>https不完全可靠的原因</h2><h3 id="垃圾浏览器警告证书错误处理不当"><a href="#垃圾浏览器警告证书错误处理不当" class="headerlink" title="垃圾浏览器警告证书错误处理不当"></a>垃圾浏览器警告证书错误处理不当</h3><p>有些浏览器，比如说”360安全浏览器”在遇到证书错误，用户选择继续之后，地址栏竟然提示用户安全，所谓”<a target="_blank" rel="noopener" href="http://www.solidot.org/story?sid=33350">安全浏览器</a>“就是这么安全的？</p>
<p><a target="_blank" rel="noopener" href="https://twitter.com/multiple1902/status/583707734748467200">https://twitter.com/multiple1902/status/583707734748467200</a></p>
<h3 id="小白用户忽略证书警告"><a href="#小白用户忽略证书警告" class="headerlink" title="小白用户忽略证书警告"></a>小白用户忽略证书警告</h3><p>很多小白用户不知道什么是https，不晓得加了那个s意味着什么，当然也不理解证书是怎么回事了。既然可以继续，那干嘛不继续呢？于是就被中间人劫持了。</p>
<p>国家级发动的利用CA的中间人劫持（WoSign、CNNIC、12306）</p>
<p>这种事情确实发生过，<a target="_blank" rel="noopener" href="https://pao-pao.net/article/403">戳</a>、<a target="_blank" rel="noopener" href="https://zh.greatfire.org/blog/2015/mar/evidence-shows-cnnic-and-cac-behind-mitm-attacks">戳</a></p>
<p>当一个合法的CA配合GFW进行中间人劫持时，<strong>任何浏览器</strong>都不会给用户警告。当然这种事情，一旦发现，绝对妥妥的不会再有任何浏览器信任它签发的证书。</p>
<p>除了用合法的CA签发证书，某些国家也可以利用行政力量强制每台电脑安装根证书，比如说<a target="_blank" rel="noopener" href="http://www.solidot.org/story?mode=thread&sid=46384">哈萨克斯坦依法安装国家安全证书</a>，还有天朝12306的那个SRCA根证书……<strong>我向来不惮以最大的恶意来揣测党国。</strong></p>
<h3 id="CA错误签发证书、CA被黑"><a href="#CA错误签发证书、CA被黑" class="headerlink" title="CA错误签发证书、CA被黑"></a>CA错误签发证书、CA被黑</h3><p>CA的一些失误，比如说本应该<a target="_blank" rel="noopener" href="http://www.solidot.org/story?sid=49448">签发子域名、却给了裸域的泛域名证书</a>，<a target="_blank" rel="noopener" href="https://www.sslchina.com/diginotar-incident/">CA被黑导致私钥泄露</a>，同样也会危害https安全性。 </p>
<h3 id="HTTPS降级攻击"><a href="#HTTPS降级攻击" class="headerlink" title="HTTPS降级攻击"></a>HTTPS降级攻击</h3><p>在前面说”敲回车发生了什么的时候”，我们提到了这个问题。人们在浏览器输入网址时，或者是点击别的地方的超链接时，很少会有人打带着https开头的，所以通常是由服务器发送给浏览器一个301重定向到https的响应报文，浏览器再去访问这个新的url，验证证书、密钥交换。在这个重定向的过程中就出现了一个问题，服务器给浏览器的重定向响应报文必然是http的，因为此时还没有协商密钥呢——假如此时的响应报文被劫持，那重定向到什么地方都是可能的！ 原本安全的https就这样被”降级”成了不安全的http，甚至是被重定向到别的网站！随后，人们搞了个HSTS（HTTP Strict Transport Security），服务器可选加入这样子的一个响应头：</p>
<p>Strict-Transport-Security max-age&#x3D;63072000; includeSubDomains; preload</p>
<p>在63072000秒内浏览器必须使用https访问该网站，并且不允许忽略证书错误。</p>
<p>但是这个也要求你最起码成功的https访问了一次……还是没能彻底的解决问题。</p>
<p>于是Google站出来维护了一个HSTS Preload List，某个域名只要成功加入了这个Preload List，在几个月之后，这项信息就会被”硬编码”到浏览器中，浏览器就会一直对该域名使用HTTPS。麻麻再也不担心我被降级攻击了</p>
<h3 id="网站使用了不安全的cipher-suite或者协议、TLS爆出漏洞"><a href="#网站使用了不安全的cipher-suite或者协议、TLS爆出漏洞" class="headerlink" title="网站使用了不安全的cipher suite或者协议、TLS爆出漏洞"></a>网站使用了不安全的cipher suite或者协议、TLS爆出漏洞</h3><p>众所周知SSLv3、心脏流血（heartbleed）</p>
<h3 id="Mixed-Content"><a href="#Mixed-Content" class="headerlink" title="Mixed Content"></a>Mixed Content</h3><p>所谓Mixed Content是指网页是https的，但是加载了一些不安全的http的资源，比如图片、音乐、form表单甚至是js等危险资源。由于这些是非https的，所以可以被替换成其他资源，导致网页外观发生变化。当这种情况发生的时候，绿锁头就消失啦！而js等危险资源默认不会被浏览器加载。很多从http迁移到https的博主们都会苦恼于Mixed Content吧。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>好像这篇文章都在谈着阳春白雪的技术…从钓鱼网站里想到的一些问题。大概没有涉及到怎么防骗吧。那就总结下，钓鱼的主要形式：</p>
<p>中奖积分等短信、留言诱骗或是美女等…用户点击链接，跳转到钓鱼网站、或者是下载吸费应用。</p>
<p><strong>1. 注意1、I、l，0、O、o等看起来非常相近的字符；</strong> <strong>2. http开头的网址不可靠、不值得相信。</strong> <strong>3. https开头的网址，大部分情况下是可以相信的；</strong> <strong>4. Android机尽量关闭未知源，或者不随意安装apk。</strong></p>
<p>其实啊一句话，别贪小便宜呐。贪小便宜吃大亏呀~</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/school-0.html">回到本系列目录</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2016/10/05/school-2/index/" data-id="clhp7rtis0083s2qr1fej0zbd" data-title="[学校上网系列]2. 从钓鱼网站中想到的：不靠谱的域名" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-school-0/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2016/09/19/school-0/index/" class="article-date">
  <time class="dt-published" datetime="2016-09-19T00:00:00.000Z" itemprop="datePublished">2016-09-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/security/">security</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2016/09/19/school-0/index/">你在学校上网时，应该注意的安全问题：一些信息安全的常识[目录]</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2016/09/2016091911535879.jpg"><img src="/images/2016091911535879-300x178.jpg" alt="img441836789"></a></p>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>为嘛要写这么一系列文章呢？</p>
<p>其实自打<a target="_blank" rel="noopener" href="https://dmesg.app/prevent-from-network-audit.html">《如何防范网络审计》</a>一文之后，我一直想写一篇文章来全方面提高大家的网络安全意识。但是考虑到自己并不是安全圈的专家，考虑到受众范围及他们对此的感兴趣程度，就一直这么想着，没有动笔。</p>
<p>某天有个小伙伴鼓舞我去写一写，本着吃饱了撑的没事干顺便完善下知识结构、刷几个访问量的目的，就动笔写写吧….</p>
<p>我想起了高中物理老师在给我们讲量子力学的时候说过的一句话，大概意思是：世界上那么多大牛，只研究了量子力学中的一丢丢，当年我的老师给我讲了一丢丢中的一丢丢，而我大概就是对量子力学中的一丢丢的一丢丢略懂皮毛，来给你们扫个盲…</p>
<p>所以我也是来跟你们<strong>扫盲、科普</strong>的。当然”信息安全”这四个字包含的范围太宽泛，所以我主要来说网络安全的事。更具体一些，用一句话来说明这篇文章是干嘛的：</p>
<blockquote>
<p>你在学校上网时，应该注意的安全问题：一些信息安全的常识</p>
</blockquote>
<p>本文预计会比较长，所以会分系列。</p>
<h2 id="本系列旨在"><a href="#本系列旨在" class="headerlink" title="本系列旨在"></a>本系列旨在</h2><ul>
<li>提高知识水平；</li>
<li>提高网络安全意识，防止被骗；</li>
<li>保护隐私；</li>
<li>提高个人权利意识。</li>
</ul>
<h2 id="本系列目录"><a href="#本系列目录" class="headerlink" title="本系列目录"></a>本系列目录</h2><ol>
<li><a target="_blank" rel="noopener" href="https://dmesg.app/school-1.html">从开放式网络中想到的：无处不在的危险</a></li>
<li><a target="_blank" rel="noopener" href="https://dmesg.app/school-2.html">从钓鱼网站中想到的：不靠谱的域名</a></li>
<li><a target="_blank" rel="noopener" href="https://dmesg.app/school-3.html">从网盘秒传中想到的：不要想当然</a></li>
<li><a target="_blank" rel="noopener" href="https://dmesg.app/prevent-from-network-audit.html">从网络审计中想到的：老大哥在看着你</a></li>
<li><a target="_blank" rel="noopener" href="https://dmesg.app/school-5.html">从设置密码中想到的：糟糕的密码</a></li>
<li><a target="_blank" rel="noopener" href="https://dmesg.app/school-6.html">从下载软件中想到的：你下载的软件安全吗？</a></li>
</ol>
<h2 id="有一个小问题…"><a href="#有一个小问题…" class="headerlink" title="有一个小问题…"></a>有一个小问题…</h2><p>唔…我是不是该使用markdown了？一天天总是二次排版，word一次cms里一次&#x2F;(ㄒoㄒ)&#x2F;~~可惜WordPress只能通过插件支持markdown</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2016/09/19/school-0/index/" data-id="clhp7rtiq007zs2qr9ys41rmg" data-title="你在学校上网时，应该注意的安全问题：一些信息安全的常识[目录]" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-school-1/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2016/09/19/school-1/index/" class="article-date">
  <time class="dt-published" datetime="2016-09-19T00:00:00.000Z" itemprop="datePublished">2016-09-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/security/">security</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2016/09/19/school-1/index/">[学校上网系列]1. 从开放式网络中想到的：无处不在的危险</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p> </p>
<p>在一切的嘟囔之前，让我先说一句，<strong>【</strong>直接使用<strong>】</strong>任何<strong>开放式网络</strong>都是十分危险的！开放式网络<strong>主要</strong>指的是学校、机场、咖啡厅等公共场合的开放Wi-Fi以及有线网络。公司的网络同样也不值得相信。所有不可控的网络都应该被划分到”开放式网络”中。</p>
<p>在开放式网络中，中间人劫持是极有可能存在的。一点技术含量都没有，一部root的Android手机就足够了。</p>
<h2 id="序"><a href="#序" class="headerlink" title="序"></a>序</h2><p>话说六七年前呐，人们上网，还是通过插着网线的台式机；随后的2011、2012智能设备的兴起，越来越多的人开始使用可以连接到Wi-Fi的智能手机，越来越多的家庭开始有了”无线路由器”。</p>
<p>到现在，2016年，Wi-Fi已经遍地可见了——肯德基、必胜客、公园游乐场等餐饮娱乐场所，银行、学校、医院、火车站、机场等服务场所。</p>
<p>在空中飞着的无线电波啊，是不是给人一种飘渺虚无的没有安全感的感觉？其实有线网络也没安全到哪里去。</p>
<p>在兴致勃勃的连接上公共Wi-Fi时，你是否想过一个很严肃的问题：你的通信，是安全的吗？”安全”这二字虽然简单，但是却意味着四件事情：我的通信内容无法被第三者看到（隐私性）、我的通信即使被第三者看到也无法被解密（保密性）、我的通信发送给了正确的接受者（通信正确性、真实性）、我的通信内容没有被篡改（内容正确性、完整性）。</p>
<h2 id="什么是”开放式网络”"><a href="#什么是”开放式网络”" class="headerlink" title="什么是”开放式网络”"></a>什么是”开放式网络”</h2><p>提到”开放式网络”，很多人可能就想到那些公共场合的无密码的Wi-Fi，其实这样的想法是<strong>不准确的、错误的</strong>。在进一步说明什么是”开放式网络”之前，我们先想一想自己新安装的Windows第一次联网的时候的情景：</p>
<p><img src="/images/091916_1138_1.png"></p>
<p>Windows将网络分为<strong>专用网络</strong>和<strong>公用网络</strong>，在此我同样建议这样分类，但是很明显工作网络也是很难信任的（参见<a target="_blank" rel="noopener" href="https://dmesg.app/prevent-from-network-audit.html">《如何防范网络审计》</a>）。所以，靠谱的分类是这样子滴：</p>
<p><strong>开放网络：</strong>公共场合的Wi-Fi（无论是否有密码保护）、工作网络、学校网络</p>
<p><strong>专用网络：</strong>家庭网络</p>
<p>开放网络<strong>包括但不限制于</strong>公共场合的Wi-Fi、公司网络、学校网络以及所有被你认定为<strong>不信任</strong>的网络。</p>
<p>在此我们将网络分成两部分，一部分是”外部网络”，你不可以控制的那部分网络；一部分称为”内部网络”，你的路由器的那个网段对你来说就属于内部网络，你可能有权控制、也可能只是众多客户之一。</p>
<p>一句话总结，<strong>所有不可控的网络</strong>都应该被划分到”开放式网络”中。</p>
<p> </p>
<p>[v_blue]</p>
<p>小提示：Wi-Fi和WLAN的区别</p>
<p>WLAN是Wireless LAN的缩写，即无线局域网；而Wi-Fi是Wireless Fidelity，意为”无线保真”，是指能将电脑、手机等以无线方式互联的技术。Wi-Fi是WLAN的一个”子集”[&#x2F;v_blue]</p>
<h2 id="为什么”开放式网络”很危险"><a href="#为什么”开放式网络”很危险" class="headerlink" title="为什么”开放式网络”很危险"></a>为什么”开放式网络”很危险</h2><p>在”开放式网络中”，我们的定义是：我们无法信任处于同一网络的其他设备。在继续讨论为何”开放式网络”危险之前，我们先想想小时候的一个游戏。</p>
<p>20岁以上的小盆友可能小时候玩过”土电话”，就像下图所示一样。</p>
<p><img src="/images/091916_1138_2.jpg"></p>
<p>一个发送端，一个接收端，通过一条线路”链接”到一起，这就是最简单的通信模式。下面我对这个图稍作改动</p>
<p><img src="/images/091916_1138_3.jpg"></p>
<p>假设一个不怀好意的”滑稽”在双方不知情的情况接入通信链路，那么他就<strong>极有可能</strong>监听到这两者的通信内容。</p>
<p>在真实的网络中，直接通过一条线连接并通信的情况是很罕见的，通常一条通信线路都需要很多设备来”中转”。</p>
<p>如果在你的这个通信线路中同样存在一个不怀好意的”设备”记录你的通信，而且这个设备不是网关，这就叫”旁路”——而且通常是你无法察觉的。或者我们称之为”嗅探”更容易理解。这个现象其实很常见的，在《网络审计》中我们会重提这个问题。</p>
<p>在开放式网络中，<strong>任何人</strong>都可以接入这个网络，并且一般来说，任何一个设备均可以通过”<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/ARP%E6%AC%BA%E9%A8%99">ARP欺骗</a>“来<strong>阻断</strong>数据包、<strong>中转</strong>数据包甚至是<strong>篡改</strong>数据包——这也就是说，开放式网络中，你看到的大部分东西，都不一定是它本来的面貌。其中”中转数据包”便是攻击者加载客户和网关之间充当“翻译”，具体模式大概如下：</p>
<p>1. 对目标主机A进行ARP欺骗，声称自己是网关；</p>
<p>2. 转发目标主机A的数据到网关，维持目标主机A的外出数据；</p>
<p>3. 对网关进行ARP欺骗，声称自己是目标主机A；</p>
<p>4. 转发网关的数据到目标主机A，维持目标主机A的接收数据；</p>
<p>5. 监听劫持或者修改目标主机A的进入和外出数据，从而实现攻击。</p>
<p>这种攻击也就是<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB">MITM</a>（Man In the Middle attack，中间人攻击）的一种实施模式，在目标主机A和网关之间充当中间人，同理，攻击者也同样可以在目标主机A和目标主机B之间充当中间人。攻击者可以选择默默的监听，也可以选择篡改数据，甚至是丢弃数据来达到阻止通信的目的。</p>
<p>中间人攻击之所以能成功，是因为通信双方<strong>缺乏有效的身份认证机制</strong>。</p>
<p>盗用随想的一张图：</p>
<p><img src="/images/091916_1138_4.png"></p>
<p>需要注意的是，ARP欺骗只是中间人攻击的一种模式而已，在内网中存在中间人攻击，在外部网络也同样存在中间人攻击，由政府、黑客操纵发动的中间人攻击也不是没有。</p>
<p>在开放式网络中，大部分情况下接入者是有能力进行ARP欺骗的，而凑巧的是互联网发展之初很多应用层协议都是【<strong>明文</strong>】传输的——你的通信内容已经不再具有隐私性。</p>
<h2 id="你还能信任开放式网络吗？"><a href="#你还能信任开放式网络吗？" class="headerlink" title="你还能信任开放式网络吗？"></a>你还能信任开放式网络吗？</h2><p>不信，那就让我攻击一次来给你看。在淘宝、QQ邮箱登录还不是HTTPS的年代，我就干过这样的事情，真的一点技术含量都没有，只需要耐心而已。</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2016/09/091916_1138_5.png"><img src="/images/091916_1138_5.png" alt="091916_1138_5.png"></a></p>
<p>这是我在自己的网络中使用ARP欺骗进行MITM之后的结果，捕捉到了一些提交的表单中的账号密码。</p>
<p>由于cain内置的表单内容不够多，所以没能看到一部分明文登录表单，可以通过wireshark自己查看下登录表单名，再添加到cain中。</p>
<h2 id="在”开放式网络”之中的危险因素分析和应对措施"><a href="#在”开放式网络”之中的危险因素分析和应对措施" class="headerlink" title="在”开放式网络”之中的危险因素分析和应对措施"></a>在”开放式网络”之中的危险因素分析和应对措施</h2><h3 id="危险的原因"><a href="#危险的原因" class="headerlink" title="危险的原因"></a>危险的原因</h3><p>互联网的发展，大概可以这样说：设计者们把互联网设计成了一个漏水的瓶子，后人们就负责堵住漏水的洞。</p>
<p>在想要在网络中保证安全之前， 我们首先要理解为什么会不安全（如果你实在懒得看，就跳过这一部分吧）</p>
<ul>
<li><strong>隐私性</strong></li>
</ul>
<p>我的通信内容无法被第三者窃取。当第三者窃取的时候，我会注意到。</p>
<ul>
<li><strong>保密性</strong></li>
</ul>
<p>我的通信即使被第三者看到也无法被解密，这也就等同于”我的通信内容无法被第三者看到”。</p>
<ul>
<li><strong>通信正确性、真实性</strong></li>
</ul>
<p>我的通信发送给了正确的接受者，而不是冒充的”中间人”，想要保证这一点，我们需要一种有效的身份认证机制。</p>
<ul>
<li><strong>内容正确性、完整性</strong></li>
</ul>
<p>我的通信内容没有被篡改，我能够识别篡改。举个例子，你怎么知道你看的网页和我的服务器想要发送给你的网页是一样的？</p>
<h3 id="如何应对这四个危险因素"><a href="#如何应对这四个危险因素" class="headerlink" title="如何应对这四个危险因素"></a>如何应对这四个危险因素</h3><ul>
<li><strong>保证隐私性</strong></li>
</ul>
<p>想要单纯的保证通信的隐私性，很抱歉这是不可能的。在现有的网络之中，任何中间设备都有可能记录下你的通信内容。</p>
<ul>
<li><strong>保证保密性</strong></li>
</ul>
<p>值得庆幸的是，随着现代密码学的发展，这一点已经成为可能。使用一种安全的加密算法来加密通信内容。然而如何配送加密密钥又成了一个问题，幸好人们发明了一些行之有效的密钥交换算法。</p>
<ul>
<li><strong>保证通信正确性、真实性</strong></li>
</ul>
<p>我们需要一种身份认证机制，通常都是<strong>客户认证服务器的身份</strong>（双向认证的情况也有，比如说4G网络的双向鉴权）。我们可以让服务器颁发证书&#x2F;指纹给客户，以后每次连接的时候客户都会验证证书&#x2F;指纹，之后如果有人进行中间人劫持，证书&#x2F;指纹是必然要变化的。SSH便是采取这种模式的（然而SSH的第一次连接是无法避免中间人劫持的）。这一点往往也是SSL&#x2F;TLS设计中最困难的、理论与实际差距最大的一部分，通常我们会引入第三方认证机构，并对认证机构分层级管理——所谓PKI体系</p>
<ul>
<li><strong>保证内容正确性、完整性</strong></li>
</ul>
<p>单向散列函数似乎是个很好的选择——哪怕原始信息发生1 bit的变化，散列结果都会变得完全不同。</p>
<p>单向散列函数是个啥捏？下一个系列见</p>
<h1 id="说了这么堆废话，那么我们该如何保证在”开放式网络”中的安全性呢？"><a href="#说了这么堆废话，那么我们该如何保证在”开放式网络”中的安全性呢？" class="headerlink" title="说了这么堆废话，那么我们该如何保证在”开放式网络”中的安全性呢？"></a>说了这么堆废话，那么我们该如何保证在”开放式网络”中的安全性呢？</h1><h2 id="解决方案一：选择加密的网络协议"><a href="#解决方案一：选择加密的网络协议" class="headerlink" title="解决方案一：选择加密的网络协议"></a>解决方案一：选择加密的网络协议</h2><p>显而易见的是，在开放式网络之中，选择完善的<strong>加密通信协议</strong>，比如说HTTPS, SSH而不是HTTP, telnet。于是问题来了，国内很多门户网站、社交网站都没有采取全站HTTPS，包括新浪、搜狐、贴吧、微博……嗷呜满脸悲伤，本以为找到了个解决方案呢，是不？哎，<strong>每一个解决方案都是下一个问题的来源</strong>。那我们就想办法解决下一个问题吧。 [v_error]警告： 通常来说，一般人针对HTTPS进行的MITM会导致浏览器警告错误的证书。无论何时，看到“证书错误”的警告，一定不要盲目点继续。12306那个SB当我没说[&#x2F;v_error]</p>
<h2 id="解决方案二：将非加密协议承载在加密隧道协议之上"><a href="#解决方案二：将非加密协议承载在加密隧道协议之上" class="headerlink" title="解决方案二：将非加密协议承载在加密隧道协议之上"></a>解决方案二：将非加密协议承载在加密隧道协议之上</h2><p>以HTTP为例，HTTP是一个典型的应用层协议，它的运作需要传输层的TCP、网络层的IP等等的配合。如果我们给HTTP的下层协议”打个补丁”使其增加安全性，那么我们的目的不就达到了吗？是啊……SSL&#x2F;TLS就是酱紫的，但是为了避免篇幅太长，SSL&#x2F;TLS我们要留到以后再说。</p>
<h3 id="1-使用加密的VPN协议"><a href="#1-使用加密的VPN协议" class="headerlink" title="1. 使用加密的VPN协议"></a>1. 使用加密的VPN协议</h3><p>这标题看起来很难懂是不是，但是如果我说”挂个<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E8%99%9B%E6%93%AC%E7%A7%81%E4%BA%BA%E7%B6%B2%E8%B7%AF">VPN</a>“是不是就秒懂了？不要提到VPN就想到翻墙哦。</p>
<p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E8%99%9B%E6%93%AC%E7%A7%81%E4%BA%BA%E7%B6%B2%E8%B7%AF">VPN</a>全称是Virtual Private Network，虚拟专用网。这东西，最开始呐，有一群懒虫们想在家里访问公司的内部网络。扯一条专线过去吧，太费钱了，不如发明一种协议虚拟个”隧道”？没错这就是VPN的最初思想。通常VPN是加密的，它利用已加密的通道协议（Tunneling Protocol）来达到保密、发送端认证、消息准确性等私人消息安全效果。这种技术可以<strong>利用不安全的网络来发送可靠、安全的消息</strong>。</p>
<p>当你成功连接VPN时，VPN程序会修改系统的路由表，使得所有数据，无论是你聊的QQ还是看的视频或是刷的微博都从加密的隧道转发出去（OpenVPN则将数据从虚拟的TAP网卡发送、接收），也就是所谓的”全局”。在这里”所有”画了删除线，比如说WebRTC就会直接无视路由表。</p>
<p>VPN根据不同的协议，可以有很多分类，常见的有PPTP、L2TP、OpenVPN、SSTP等</p>
<p>其中PPTP已经不再安全（使用iOS的用户应该记得那个警告吧）</p>
<p>L2TP是未加密的，通常搭配IPSec、IKE2等来达到加密、认证的目的。</p>
<p>OpenVPN使用OpenSSL库来加密数据与控制信息，而且对服务器也有证书认证、并且是跨平台的。</p>
<h3 id="2-使用加密的SOCKS5协议"><a href="#2-使用加密的SOCKS5协议" class="headerlink" title="2. 使用加密的SOCKS5协议"></a>2. 使用加密的SOCKS5协议</h3><p>在这里比较有名的恐怕是Clowwindy的shadowsocks了吧——shadowsocks是一款安全的加密的SOCKS5代理、附带有流量混淆功能。然而SOCKS5却不够”全局”，有些软件无法设置代理，有些设置了代理，其自带的自动更新也常常会绕过代理。包括可恶的Flash都会无视代理设置。</p>
<h2 id="关于HTTP与HTTPS"><a href="#关于HTTP与HTTPS" class="headerlink" title="关于HTTP与HTTPS"></a>关于HTTP与HTTPS</h2><p>HTTP发明于上个世纪的八十年代，那个时候互联网先驱们们还没有想到如此复杂、险象环生的网络。随着网络的不断发展，HTTP也从1.0变成了广泛应用的1.1，最终2015年发布了全新的<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/HTTP/2">HTTP&#x2F;2</a>（这么前卫的我当然启用了HTTP&#x2F;2的支持，只要你使用Google Chrome、Mozilla Firefox、Microsoft Edge或Opera中任意一款即可，一部分套牌浏览器的内核也应该高于支持HTTP&#x2F;2的<a target="_blank" rel="noopener" href="http://blog.chromium.org/2016/02/transitioning-from-spdy-to-http2.html">Chromium版本号</a>）</p>
<p>然而尽管到了HTTP&#x2F;2，可是HTTP&#x2F;2依旧没有强制加密连接。</p>
<p>随着斯诺登把NSA大规模监听计划<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E7%A8%9C%E9%8F%A1%E8%A8%88%E7%95%AB">棱镜</a>曝光之后，人们越来越关注隐私，越来越反对政府对个人权利的<strong>肆意侵犯</strong>（但是有很多天朝人民却在跪着，还想让别人也都跟着一起跪着）；各大公司纷纷加强安全基础设施，开启透明度报告并启用全站HTTPS——在HTTPS这事上大概只有Google做的最激进了，不仅改变了搜索引擎的算法提升了HTTPS网站的权重，甚至打算在Chrome 56中正式将HTTP页面标记为不安全。</p>
<p>在HTTP的时代，任何网页都可能不是你想看的真正的网页，任何内容都可能是被篡改过的，你输入的任何信息都可能被第三方窃取，一切隐私都是不可能的！</p>
<h2 id="为什么我们要启用全站HTTPS"><a href="#为什么我们要启用全站HTTPS" class="headerlink" title="为什么我们要启用全站HTTPS"></a>为什么我们要启用全站HTTPS</h2><p>尽管HTTPS会对性能造成一定程度的影响，但是随着HTTP&#x2F;2的逐渐普及、HTTPS性能调优和人们对隐私关注的提高，HTTPS不应该只是为了保护用户的账号密码，用户所浏览的任何网页都应该得到加密。</p>
<p>同时，不是全站HTTPS也存在一些缺点，比如说cookie泄露、跳转时降级攻击。</p>
<p>早就应该到了全站HTTPS的时代了！HTTP已死！纸都别烧了。</p>
<h2 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h2><p>在开放式网络中啊，要么搜索下周杰伦多少岁（一些无关紧要的事情），要么挂上一个VPN来保证通信安全！个人信息是可以拿来交易的，知道嘛。</p>
<p>在写目录的时候，我把一些密码学的概念、HTTPS&#x2F;SSL&#x2F;TLS放到了这一部分，但是写着写着就发现这会使篇幅严重加长并且和题目《从开放式网络中想到的》毫无关系。所以只好以后再单独写一篇HTTPS&#x2F;SSL&#x2F;TLS了（如果我能写好的话）。</p>
<p>感谢那些鼓励我写此系列文章的朋友们！</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/school-0.html">回到本系列目录</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2016/09/19/school-1/index/" data-id="clhp7rtir0081s2qr2yt7gujd" data-title="[学校上网系列]1. 从开放式网络中想到的：无处不在的危险" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/16/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="page-number" href="/page/16/">16</a><span class="page-number current">17</span><a class="page-number" href="/page/18/">18</a><a class="page-number" href="/page/19/">19</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/18/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/azure/">azure</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/china/">china</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/china/justsay/">justsay</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/cloudflare/">cloudflare</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/gfw/">gfw</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/">it</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/it/justsay/">justsay</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/security/">security</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/share/">share</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/">justsay</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/gfw/">gfw</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/linux/security/">security</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/website/">website</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/program/">program</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/program/share/">share</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/security/">security</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/security/justsay/">justsay</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/security/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/share/">share</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/website/">website</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/website/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/what/">what</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/what/gfw/">gfw</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/ubuntu/" style="font-size: 10px;">ubuntu</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/10/">October 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">September 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">August 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">July 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">April 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">March 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">February 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/10/06/aca-vm-scale/index/">Azure Container Apps 连接到虚拟机并配置CPU自动缩放</a>
          </li>
        
          <li>
            <a href="/2024/09/28/worker-image-metadata/index/">使用 Cloudflare Worker获取图片元数据</a>
          </li>
        
          <li>
            <a href="/2024/09/27/workers-function/index/">将 Cloudflare Workers 迁移到 Azure Function</a>
          </li>
        
          <li>
            <a href="/2024/09/21/one-api-clickhouse/index/">one-api/new-api性能优化：使用 ClickHouse 作为日志系统</a>
          </li>
        
          <li>
            <a href="/2024/08/03/stripe-fraud/index/">Stripe 如何安全收款并避免盗刷与测卡</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 Benny小土豆<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>