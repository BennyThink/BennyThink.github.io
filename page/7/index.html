<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>土豆不好吃</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="土豆不好吃">
<meta property="og:url" content="http://example.com/page/7/index.html">
<meta property="og:site_name" content="土豆不好吃">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Benny小土豆">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="土豆不好吃" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">土豆不好吃</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-docker-scale/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/02/10/docker-scale/index/" class="article-date">
  <time class="dt-published" datetime="2021-02-10T00:00:00.000Z" itemprop="datePublished">2021-02-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/website/">website</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/02/10/docker-scale/index/">使用docker scale时遇到的一点小问题</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>今天在使用<code>docker-compose</code>时，突然发现有一个command叫做<code>scale</code>，感觉有点像kubernetes的replica，于是试了一下</p>
<p>-&gt; # docker-compose scale yyets-web&#x3D;5<br>WARNING: The scale command is deprecated. Use the up command with the –scale flag instead.<br>Starting websiterunner_yyets-web_1 … done<br>Creating websiterunner_yyets-web_2 … done<br>Creating websiterunner_yyets-web_3 … done<br>Creating websiterunner_yyets-web_4 … done<br>Creating websiterunner_yyets-web_5 … done</p>
<p>果真是这个样子的，那么从其他容器访问这个container，用的是什么负载均衡算法呢？猜测应该是最简单也是最常见的round robin吧？在nginx里<code>ping</code>和<code>curl</code>试了一下，果真是的，每次解析的IP地址都会变化：</p>
<p><img src="/images/2021021017463110.jpeg"></p>
<p>然后看了一下log，发现请求全部落在了1上，而没有平均到其他4个container</p>
<p><img src="/images/2021021017463387.jpeg"></p>
<p>但是我如果在nginx里<code>curl</code>，却可以看到请求是均匀分布在5个container里的。</p>
<p><img src="/images/2021021017463847.jpeg" alt="图像"></p>
<p>什么鬼嘛，怎么会这样，从外部过来的请求不过是经过了nginx proxy_pass，这和我在nginx container里直接<code>curl</code>有什么差别嘛。</p>
<p>后来吃饭的时候想到，难道是因为，我是后scale的，而nginx是早就启动的，所以nginx启动时把配置文件中的域名解析到了一个固定的IP。而我在container中<code>curl</code>每次都是重新解析的，所以每次解析的结果都是round robin的</p>
<p>于是重启了一下nginx</p>
<p>docker-compose restart nginx</p>
<p><img src="/images/2021021017464153.jpeg" alt="图像"></p>
<p>看起来破案了，请求均匀分布到了5个container中。 [v_blue]<a target="_blank" rel="noopener" href="https://twitter.com/dev_techmoe/status/1359372686598766592?s=20">感谢techmoe指出</a>，其实应该不是固定的，文档说nginx默认的resolver是遵循DNS record的TTL值的，对nginx进程reload应该就可以刷新缓存，让nginx重新解析。 [&#x2F;v_blue] 那么问题来了，在单机上scale，是否有必要？</p>
<p>从我个人的角度来讲，意义似乎不太大。我觉得，如果单个容器（进程）存在性能瓶颈，比如说单进程&#x2F;单线程，只能用一个CPU宿主机有恰巧是多核心，多个进程可以明显提升性能，那么scale一下还是可以的。举个例子，万一我傻了吧唧的这么写的代码：</p>
<p>class ResourceHandler(BaseHandler):<br>    executor &#x3D; ThreadPoolExecutor(5)</p>
<pre><code>@run\_on\_executor()....
</code></pre>
<p>那么scale一下，还是有很大希望的。</p>
<p>不过我当然没这么傻，所以这里scale对我可能用处不太大。</p>
<p>当然了，还是用kubernetes最爽:-)可惜俺并不会也没那么多机器去搞:-(</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/02/10/docker-scale/index/" data-id="clhp7rtf8001qs2qrh4iib315" data-title="使用docker scale时遇到的一点小问题" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-container-no-network/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/26/container-no-network/index/" class="article-date">
  <time class="dt-published" datetime="2021-01-26T00:00:00.000Z" itemprop="datePublished">2021-01-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/program/">program</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/01/26/container-no-network/index/">什么鬼啊，我的容器怎么无法访问外网了</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>大概几个星期前，在把<a target="_blank" rel="noopener" href="https://t.me/yyets_bot">YYeTs Bot</a>迁移到香港时，发现在容器里竟然无法访问外部网络。</p>
<p>由于之前看到有报道称香港的某些ISP对某域名进行了污染，因此此时就立刻想到了，是不是aws的上游也对 api.telegram.org 进行了污染？</p>
<p>容器里没法<code>curl</code>。<code>apk update</code>了一下，发现竟然无法update，难道是alpine挂了吗？Ubuntu也是，这俩一起炸？概率太低了吧。新加坡的那台机器也是同样的问题，但是日本就没问题。同样都在亚洲，大家有什么差别吗？难道是整个东南亚的海底光缆全炸了？可是没见到有人说东南亚的机房炸了啊，况且就算炸了，那也应该会找别的路由出去啊，就算丢包也不会直接炸光啊。</p>
<p><img src="/images/2021012415374384.jpeg"></p>
<p>就算你是柯蒂斯·李梅，手里有着一百架B-2轰炸机，也不能炸的这么彻底啊。</p>
<p>试了一下，宿主机能够访问啊，那就是没问题的。一定是某些配置不对。重新安装了docker engine，结果也还一样，香港和新加坡的机器就是不好用，但是日本可用。</p>
<hr>
<p>搜了一下，可能是没开<code>ipv4.forward</code>?但是我一般是开启这个的呀，而且我开了啊……</p>
<p>后来在网上翻到这样一篇文章，<a target="_blank" rel="noopener" href="https://pytimer.github.io/2019/11/docker%E5%AE%B9%E5%99%A8%E6%97%A0%E6%B3%95%E8%BF%9E%E6%8E%A5%E5%A4%96%E9%83%A8%E7%BD%91%E7%BB%9C%E5%8E%9F%E5%9B%A0%E6%8E%92%E6%9F%A5/">《Docker容器无法连接外部网络原因排查》</a>，了解到bridge网络docker是通过iptables转发流量的。</p>
<p>此时，我突然意识到，我的这两台服务器似乎都设置了大量的本地端口转发，恰巧也覆盖了80和443这两个端口……把这个规则删掉，重启docker engine。好的，村通网了。</p>
<p>罪魁祸首的这条命令</p>
<p>iptables -t nat -A PREROUTING -p tcp –dport 23:1000 -j REDIRECT –to-ports 16698</p>
<p>事实证明，是我的想象力太丰富了。来一拳就好了。</p>
<p><img src="/images/2021012415374219.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/26/container-no-network/index/" data-id="clhp7rtex001as2qr7bzu7of0" data-title="什么鬼啊，我的容器怎么无法访问外网了" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-no-yyets/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/24/no-yyets/index/" class="article-date">
  <time class="dt-published" datetime="2021-01-24T00:00:00.000Z" itemprop="datePublished">2021-01-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/share/">share</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/01/24/no-yyets/index/">没了人人影视，我们该怎么办？</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="太长不看版："><a href="#太长不看版：" class="headerlink" title="太长不看版："></a>太长不看版：</h1><p>我把资源都爬下来了。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://t.me/yyets_bot">Telegram Bot</a></li>
<li><a target="_blank" rel="noopener" href="https://yyets.dmesg.app/">资源分享搜索</a></li>
</ul>
<hr>
<p>2021年1月4日，人人影视发布公告称“正在清理内容，所有客户端均无法正常使用”。</p>
<p><img src="/images/202101241458034.png"></p>
<p>过了段时间，网友们发现，本来在资源页面中可以跳转到的分享页面，基本上全部消失了。</p>
<p>不过好在人人影视的分享API还是能够正常使用的，因此<a target="_blank" rel="noopener" href="https://t.me/yyets_bot">我的 bot</a>也还正常。</p>
<p>[v_error] 2021年2月4日：你们都知道了。 [&#x2F;v_error]</p>
<h2 id="归档人人影视"><a href="#归档人人影视" class="headerlink" title="归档人人影视"></a>归档人人影视</h2><p>为了避免出现问题，我便想把整个人人影视的资源都归档出来。简单的观察了一下人人影视的资源格式，如这个URL：<code>http://www.rrys2020.com/resource/40000</code></p>
<p>其实就可以发现，只要resource后的数字从1开始不停地遍历，就可以获取到全部资源了。你看，这就是不使用UUID的结果，被我这种磨人的小妖精发现了吧！</p>
<p>[v_blue]（关于使用UUID还是自增主键，可以看看这篇<a target="_blank" rel="noopener" href="https://nova.moe/laravel-use-uuid-as-primary-key-with-custom-authentication-fields/">《Laravel 使用 UUID 作为用户表主键并使用自定义用户表字段》</a>） [&#x2F;v_blue]</p>
<p>那么现在就很简单了，从1开始遍历，遍历到最新的剧集的ID为止，通过分享API拿到数据，然后存储到数据库里。为了避免出现rate limit，加上随机休眠；为了加快遍历速度，还要考虑并发。这两者看起来是矛盾的组合，也确实挺难调和的。同时为了让界面更友好，使用一个简单的进度条来告知进度。</p>
<p>真的是非常简单的，有兴趣的可以参考这里的源代码</p>
<p>[gt href&#x3D;’<a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/YYeTsBot/tree/master/BagAndDrag'/]%E5%BC%80%E6%BA%90%E5%9C%B0%E5%9D%80/[/gt/]">https://github.com/tgbot-collection/YYeTsBot/tree/master/BagAndDrag&#39;\]开源地址\[/gt\]</a></p>
<p>ping了一下，人人影视的主站和分享站API都在香港阿里云上，那么用香港的aws去跑是最好的。最终我把这些资源都跑了下来，存到了MySQL中并发布了出去，然后推特发了出去。</p>
<p><a target="_blank" rel="noopener" href="https://twitter.com/BennyThinks/status/1348614240098086913?s=20">https://twitter.com/BennyThinks/status/1348614240098086913?s=20</a></p>
<p>这么一发布，没想到竟然让我的channel订阅者人数加一个0，Twitter follower翻倍。真是受宠若惊😂。</p>
<p>[v_tips]一点点小发现：人人影视第一部翻译的剧集，是《越狱》。ID是10004 [&#x2F;v_tips]</p>
<h2 id="被机器人轰炸是一种怎样的感觉？"><a href="#被机器人轰炸是一种怎样的感觉？" class="headerlink" title="被机器人轰炸是一种怎样的感觉？"></a>被机器人轰炸是一种怎样的感觉？</h2><p>突然一下子多了这么like，bot的使用量也开始飙升。</p>
<p>最开始为了方便修复bug，我设置了一个“向开发者提交错误信息”的功能，大概是这样子的：</p>
<p><img src="/images/2021012414580636.png"></p>
<p><strong>点一点按钮谁不会嘛，点一点又不会消耗很多精力，作为一个资深的伸手党，这一切不符合预期的结果肯定不是我的错，那我就点一下就好了，一下不好用，那么我就点两下三下。反正既不吃亏也不上当。</strong></p>
<p>也许有一些人是这样想的吧！</p>
<p>结果这次就开始不停地收到各种报错信息，都有什么样子的呢？</p>
<ul>
<li>喜洋洋与灰太狼</li>
<li>战狼，流浪地球</li>
<li>权利的游戏</li>
<li>各种莫名其妙的我也不记得是什么了</li>
<li>ahsjhsads然后瞬间block bot的</li>
</ul>
<p>etc…</p>
<p>第三种打了错别字的还可以理解，剩下的是在难为我胖虎吗？😡🤬</p>
<p>原有的设计是，出现错误报告的时候，我需要登录到vps上，使用一个messenger.py 来回复，但是这样就很麻烦，不仅要ssh还要去container里，而且需要在电脑旁。后来我<a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/YYeTsBot/commit/605086c909d3180e13b10f618cc7043fd2f95922">优化了一下</a>，直接在Telegram里就可以回复，我看到的大概是这样的：</p>
<p><img src="/images/2021012414580984.png"></p>
<p>可是有些用户依旧在汇报这种根本就是无法处理的问题，有的甚至还点两次，非常无奈的我就……我让你点两次试试看！😠</p>
<p><img src="/images/2021012414581266.png"></p>
<p>甚至最后我还开发了<a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/YYeTsBot/commit/3a852eacba56dfc667236ee235ffef98298f77c0">一键生气和一键回怼</a>功能</p>
<p><img src="/images/2021012414581525.png"></p>
<p>然而并无卵用，该点的还是会点……😂这么不相信我的代码质量吗？😱本来还想，要不我弄个黑名单的功能，想了想还是算了，直接<a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/YYeTsBot/commit/dbcf4819dbac7300848be940f386f5e8fda91522">默认关闭了这项功能</a>就可以了。</p>
<p>在这件事情中，我学习到了，总是有一部分人是不会认真读说明的。🤣</p>
<p>气鼓鼓🤨</p>
<p><img src="/images/2021012414581872.png"></p>
<h2 id="人人影视网站间歇性访问问题"><a href="#人人影视网站间歇性访问问题" class="headerlink" title="人人影视网站间歇性访问问题"></a>人人影视网站间歇性访问问题</h2><p>为了方便部署，我的所有Bot是使用<a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/BotsRunner">docker-compose</a>启动的，丢在了一台英国的大鸡鸡上。毕竟Bot API Endpoint在荷兰，英国访问过去会比较快。再加上这是大鸡鸡，内存和CPU资源都很充足的。</p>
<p>某天（1月17日），突然发现bot的回应很慢，然后发现是<a target="_blank" rel="noopener" href="https://t.me/mikuri520/682">从英国访问人人影视有点艰难</a>，经常出现connection reset等情况。</p>
<p>看了一下香港和新加坡还是比较稳定的，于是就一个rsync把YYeTs bot迁移到了新加坡。</p>
<p>同时，为了避免某天人人影视真的炸掉，我开发了一个<a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/YYeTsBot/commit/e5ceaa19deef7549899d42f6f3c442e91e8a4b3b">Offline模式</a>（😂被我rebase了之后，时间好像不对了），使用环境变量来控制是否启用。最终数据来源就是上面归档的那些数据。</p>
<p>那么数据存在哪里呢？老早之前就听Nova大佬说<a target="_blank" rel="noopener" href="https://nova.moe/first-touch-with-cf-workers/">Cloudflare worker怎么怎么香</a>。于是我便很<a target="_blank" rel="noopener" href="https://t.me/mikuri520/693">暴力的撸</a>了一个非常原始的页面，有多原始呢？</p>
<p><img src="/images/2021012414581926.jpeg"></p>
<p>直接返回json可还行😂</p>
<p><img src="/images/202101241458206.png"></p>
<p>此时，人人影视专用链接 <code>yyets://</code> 还是能够在客户端里下载的，速度还不错的说。</p>
<p>しかし，此时我还不知道，我用<code>wrangler bulk:put</code>的数据其实是不全的……因为<code>wrangler bulk</code>虽然有10000个kv的限制，但是Cloudflare对于免费用户，每天还是只有1000的限制的。所以其实我以为两天能够导入完整的17517条数据，其实只有2000🤦‍♀️</p>
<h2 id="人人影视网站无法访问"><a href="#人人影视网站无法访问" class="headerlink" title="人人影视网站无法访问"></a>人人影视网站无法访问</h2><p>随后，我又添加了<a target="_blank" rel="noopener" href="https://www.zimuxia.cn/">FIX字幕侠</a>的支持。在搞它的过程中，发现这家伙竟然是拿WordPress搞的！那有WordPress的Public API，还爬个毛线啊，直接把整个<code>wp.posts</code>端回来了……🤔</p>
<p><img src="/images/2021012414582138.png"></p>
<p>しかし。。。好吧，通过插件把Public API禁用了，并且这个插件还有Bug😂。不过这下子也发现了用的是 <a target="_blank" rel="noopener" href="https://lnmp.org/">LNMP一键安装</a>啊。那就只好搞常规的爬虫+Redis了。</p>
<p>搞完FIX的第二天，突然发现<a target="_blank" rel="noopener" href="https://t.me/mikuri520/691">人人影视无法访问了</a>。主站无法访问，分享站的API也挂掉了。当然，服务器还在，还能ping通。那就只好切换到fix啦！</p>
<p><img src="/images/2021012414582245.jpeg"></p>
<p>再后来，我用了很多时间去优化，甚至搞出来了优先级搜索，FIX找不到，再去人人影视搜索。甚至还可以指定字幕组搜索。比如说这样：</p>
<p><img src="/images/2021012414582413.png"></p>
<p>有时发现Bot没有回复，但是进程也没有退出，就是纯粹的卡死了。是由于任务太多，访问网站又很慢，然后pyTelegramBotAPI的线程池满了吗？也许以后可以考虑把爬虫这部分功能集成到celery中。</p>
<p>当下，喜欢简单暴力的我我又用Client API写了一个health check🤦‍♀️</p>
<h2 id="更友好的Worker-Website"><a href="#更友好的Worker-Website" class="headerlink" title="更友好的Worker Website"></a>更友好的Worker Website</h2><p>在人人影视挂掉的当天，我发现了其实人人影视只是部分URL是挂掉的，某些资源还是可以很容易的get回来的。got002.com 也是同理，只是API坏掉了，页面资源还在。</p>
<p>于是我就发挥了我的小偷技能，把这些资源都搞了回来，然后一顿操作猛如虎，把这个仿真的人人影视分享站搞到了Cloudflare Worker上。</p>
<p><img src="/images/2021012414582733.png"></p>
<blockquote>
<p><strong>Dr. Brand:</strong> Lazarus came back from the dead.</p>
<p><strong>Cooper:</strong> Sure, but he had to die in the first place.</p>
</blockquote>
<p> </p>
<p><a target="_blank" rel="noopener" href="https://t.me/mikuri520/694">这个Worker也不再简陋了</a>。甚至还有一个更酷的搜索页面和更短的域名<a target="_blank" rel="noopener" href="https://yyets.dmesg.app/">https://yyets.dmesg.app/</a> ：</p>
<p><img src="/images/202101241458298.png"></p>
<p>我甚至还无聊到加上了资源分享页面访问量的统计😂这个代码写得超烂的，啊！</p>
<p>别说，这个Worker的访问量还真是挺多的。放心，够用的！</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2021/01/2021012415125085.png"><img src="/images/2021012415125085.png"></a></p>
<p>最近24小时有62.9K的访问量，反正比我博客都多出来好几个0就是了。哦对，这个数据是完整的，因为我有钞能力呀！🦸‍♀️</p>
<p><img src="/images/2021012414583184.png"></p>
<h2 id="那么现在该怎么办"><a href="#那么现在该怎么办" class="headerlink" title="那么现在该怎么办"></a>那么现在该怎么办</h2><p>通过切换到FIX、使用YYeTsOffline作为fallback，糊了一个Worker Website，目前是差不多够用的。</p>
<p>那么以后该怎么办，难道我们真的只能告别人人影视了吗？</p>
<p>由于我现在已经不是人人影视字幕组的成员了，以下内容也只是推测。我本人还是持比较乐观的态度的。</p>
<h3 id="人人影视只是部分页面坏掉了"><a href="#人人影视只是部分页面坏掉了" class="headerlink" title="人人影视只是部分页面坏掉了"></a>人人影视只是部分页面坏掉了</h3><p>这一点我在上面提到了，实测起来只是部分页面“故意坏掉”了，有一些页面还是有一定概率可以返回的，比如说</p>
<ul>
<li>部分资源页面，如 <a target="_blank" rel="noopener" href="http://www.rrys2020.com/resource/41579">http://www.rrys2020.com/resource/41579</a></li>
<li>播出表 <a target="_blank" rel="noopener" href="http://www.rrys2020.com/tv/schedule">http://www.rrys2020.com/tv/schedule</a></li>
<li>排榜榜 <a target="_blank" rel="noopener" href="http://www.rrys2020.com/html/top/week.html">http://www.rrys2020.com/html/top/week.html</a></li>
<li>公告 <a target="_blank" rel="noopener" href="http://www.rrys2020.com/Announcement">http://www.rrys2020.com/Announcement</a></li>
<li>字幕分享 <a target="_blank" rel="noopener" href="http://www.rrys2020.com/subtitle/66221">http://www.rrys2020.com/subtitle/66221</a></li>
<li>收藏 <a target="_blank" rel="noopener" href="http://www.rrys2020.com/user/fav">http://www.rrys2020.com/user/fav</a> 甚至在收藏里还能看到下载地址！</li>
</ul>
<p>你看下面这个图，还能签到呢</p>
<p><img src="/images/2021012414583230.png"></p>
<p>2021年1月30日更新：网站已经ping不通了</p>
<p>Obrien-hk:~ # ping got002.com                                                                                                12:23.35 Sat Jan 30 2021 &gt;&gt;&gt;<br>PING got002.com (47.52.153.161) 56(84) bytes of data.<br>^C<br>— got002.com ping statistics —<br>17 packets transmitted, 0 received, 100% packet loss, time 16389ms</p>
<p>ps1_fortune:2: command not found: fortune<br>Obrien-hk:~ # ping <a target="_blank" rel="noopener" href="http://www.rrys2020.com/">www.rrys2020.com</a>                                                                                          12:23.54 Sat Jan 30 2021 &gt;&gt;&gt;<br>PING <a target="_blank" rel="noopener" href="http://www.rrys2020.com/">www.rrys2020.com</a> (47.52.174.174) 56(84) bytes of data.<br>^C<br>— <a target="_blank" rel="noopener" href="http://www.rrys2020.com/">www.rrys2020.com</a> ping statistics —<br>22 packets transmitted, 0 received, 100% packet loss, time 21482ms</p>
<p>ps1_fortune:2: command not found: fortune</p>
<h3 id="人人影视还在正常翻译新剧吗？"><a href="#人人影视还在正常翻译新剧吗？" class="headerlink" title="人人影视还在正常翻译新剧吗？"></a>人人影视还在正常翻译新剧吗？</h3><p>既然某些页面是坏掉的，那么是不是针对不同等级的用户使用了不同的策略？或者说有另外一个“马甲站”在发布新的资源？毕竟，服务器ping起来没问题，那么看起来就是应用端有一些限制了吧？</p>
<p>我个人看来，还在翻译的，但有没有压制，就不知道了……并且，人人影视客户端已经无法下载 yyets的专用链接了。可能是“tracker”关掉了吧？</p>
<p><img src="/images/2021012414583317.png"></p>
<h2 id="不如这么办……"><a href="#不如这么办……" class="headerlink" title="不如这么办……"></a>不如这么办……</h2><p>尽管我归档了人人影视的资源，但是还是缺少了新鲜的血液。</p>
<h3 id="使用外挂字幕"><a href="#使用外挂字幕" class="headerlink" title="使用外挂字幕"></a>使用外挂字幕</h3><p>目前来看，人人影视依旧还在翻译，字幕也上传到了subhd。那么可以自己下载片源然后外挂字幕了。当然，如果看日剧的话，追新番也还是好着的，这点就很让人开心了。</p>
<h3 id="使用FIX"><a href="#使用FIX" class="headerlink" title="使用FIX"></a>使用FIX</h3><p>FIX的翻译质量也还不错的，作为替代选择很不错哦。</p>
<h3 id="使用bot、Worker"><a href="#使用bot、Worker" class="headerlink" title="使用bot、Worker"></a>使用bot、Worker</h3><p>worker只包含了归档的资源，bot会优先搜索FIX，然后如果没有搜索到才会去搜索Worker。看起来也还是不错的呢。</p>
<h2 id="汇总"><a href="#汇总" class="headerlink" title="汇总"></a>汇总</h2><ul>
<li>❌ 人人影视主站 <a target="_blank" rel="noopener" href="http://www.rrys2020.com/">http://www.rrys2020.com/</a></li>
<li>❌人人影视资源列表 <a target="_blank" rel="noopener" href="http://www.rrys2020.com/resourcelist">http://www.rrys2020.com/resourcelist</a></li>
<li>❌ 人人影视字幕列表 <a target="_blank" rel="noopener" href="http://www.rrys2020.com/subtitle">http://www.rrys2020.com/subtitle</a></li>
<li>✅ 磁力站（很慢） <a target="_blank" rel="noopener" href="http://www.mag234.com/home.html">http://www.mag234.com/home.html</a></li>
<li>✅ 追新番 <a target="_blank" rel="noopener" href="http://www.zhuixinfan.com/main.php">http://www.zhuixinfan.com/main.php</a></li>
<li>✅ YYeTs资源归档 <a target="_blank" rel="noopener" href="https://yyets.dmesg.app/">https://yyets.dmesg.app/</a></li>
<li>✅ YYeTs Bot <a target="_blank" rel="noopener" href="http://t.me/yyets_bot">http://t.me/yyets_bot</a></li>
<li>✅ FIX 字幕侠 <a target="_blank" rel="noopener" href="https://www.zimuxia.cn/">https://www.zimuxia.cn/</a></li>
</ul>
<h2 id="开源项目"><a href="#开源项目" class="headerlink" title="开源项目"></a>开源项目</h2><p>由于个人的精力总是有限的，有兴趣的小伙伴可以帮忙开发维护 YYeTs Bot，地址在这里。如果有帮助到你的话，点个star🌟就可以了。如果想要donate😂那……难度可能有点高，但也不是不可能，看下<a target="_blank" rel="noopener" href="https://dmesg.app/donate">导航栏的支持我</a>？</p>
<p>本项目目前需要……</p>
<ul>
<li>整理FIX资源 <code>BagAndDrag</code></li>
<li>添加其他字幕组支持 <code>yyets/fansub.py</code></li>
<li>测试用例 <code>tests/*.py</code></li>
<li>Cloudflare Worker优化 <code>worker/worker-site</code></li>
</ul>
<p>开发的话，其实蛮简单的，比如说对于添加其他字幕组的支持，只需要继承BaseFansub，类名写好，实现search_preview和search_result，然后在FANSUB_ORDER里添加你的类名，就可以了。是否要实现缓存，这都是看你个人情况的……</p>
<p>[gt href&#x3D;’<a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/YYeTsBot'/]%E5%BC%80%E6%BA%90%E5%9C%B0%E5%9D%80/[/gt/]">https://github.com/tgbot-collection/YYeTsBot&#39;\]开源地址\[/gt\]</a></p>
<p> </p>
<p><strong>哦对了，公共资源请不要滥用。比如说爬虫啊什么的，说得像你能爬下来一样🙄️</strong></p>
<h2 id="一点点感慨"><a href="#一点点感慨" class="headerlink" title="一点点感慨"></a>一点点感慨</h2><p>以下内容<a target="_blank" rel="noopener" href="https://t.me/mikuri520/711">发布于我的Channel：</a></p>
<blockquote>
<p>想起来一件趣事。之前看过一部电影《我是传奇》 I Am Legend。</p>
<p>这部电影有两个结局，一个是男主活下来，人类与“僵尸”共存，一个是男主牺牲找到解药，人类幸存。</p>
<p>几年前，和前女友异地感情不顺利的时候，每天在想办法找话题和她聊天保持亲密关系，于是就和她讨论起这个电影，问她更喜欢哪一个结局。</p>
<p>我说，我更喜欢男主牺牲拯救人类的结局。我更喜欢这个结局，不是因为这样会让男主看起来很伟大，是拯救了人类的英雄。</p>
<p>而是我认为第二个结局“僵尸”们看起来是不具备进行高级生产的能力的，尽管从电影中可以看到“僵尸”是有一些感情和智力的，但是我认为这个水平依旧无法达到现代人类所能达到的生产能力水平。</p>
<p>举个例子，人类能够使用自然资源制造出砖块，然后堆砌出墙壁，最终建造房子；然而对于“僵尸”们而言，他们并不具备这种能力，尽管他们的力气很大，但是力气大并不能创造出来力气更大的机器呀。所以从人类发展的角度来讲，我还是更喜欢人类幸存的结局。</p>
<p>她似乎很赞同我的观点。这么多年过去了，也不知道她过得还好不好。前几天还梦到了她🙁</p>
<p>今天提到这里，是因为男主牺牲的结局里，最后一句台词是这样的：</p>
<p><strong>We are his legacy. This is his Legend.</strong></p>
<p>就像我爬下来的数据一样，这些，是人人影视的遗产。这些，是人人影视的传奇。</p>
</blockquote>
<hr>
<p>最萌不过三岛花😘</p>
<p><img src="/images/2021012414583596.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/24/no-yyets/index/" data-id="clhp7rthv0065s2qr4v8jdjku" data-title="没了人人影视，我们该怎么办？" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-nigeru-sp/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/01/04/nigeru-sp/index/" class="article-date">
  <time class="dt-published" datetime="2021-01-04T00:00:00.000Z" itemprop="datePublished">2021-01-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/justsay/">justsay</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/01/04/nigeru-sp/index/">《逃避可耻却有用》新春SP</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>前几天《逃避可耻却有用》的新春SP终于放送了。全片长2小时，主要讲了二人事实婚姻之后的生娃的事情。</p>
<p>2小时的影片里塞进去了很多内容，如性别平等、夫妻同姓、女性职场、育儿假，LGBT等等，当然也少不了狗粮。遗憾的是上述普世价值观只是蜻蜓点水的提了一下，并没有进行深刻的探讨。</p>
<p>想起来也是啊，SP中所表现的上述内容真的只是浅尝辄止，随便哪一个都可以讨论出一集的时长，如果这样拍下去这个SP可能就要从早看到晚，哦不可以拍Season 2了。</p>
<p>不过我觉得能够提出问题就很不错了，提出问题，让人们意识到这个问题是切实存在的，然后寻找问题的解决答案而不是解决提出问题的人。这样才可以促进社会进步。</p>
<h2 id="夫妻同姓"><a href="#夫妻同姓" class="headerlink" title="夫妻同姓"></a>夫妻同姓</h2><p>像一些欧美国家一样，日本现在也有改夫姓的传统。这一切要从明治维新时说起。</p>
<p>最开始，大部分日本人都是没有姓氏的。19世纪中期，明治维新之后，日本政府立志改革，要建设文明开化的现代国家。后来强制规定必须有姓氏，否则会罚款。于是传说，天皇下令必须取姓的时候，在田里种地的人，那就叫田中了；家里在山脚下，那就叫山下了；家里有个大松树，那就叫松下好了。</p>
<p>之后，19世纪末，日本政府在1898年颁布的《户籍法》中规定，“每户都要有固定姓氏，子承父姓，妻从夫姓；分家后仍用原姓，不得任意更改”。二战后的新《民事法》，虽然规定夫妻双方可以根据婚前所定，或随夫姓、或随妻姓，但大多数日本女子婚后仍随夫姓；如果女子婚后不改夫姓，会在亲子关系、财产继承等很多方面遇到麻烦。</p>
<p><img src="/images/2021010417110946.jpeg"></p>
<p>大大方方的一户两姓</p>
<p>平匡和实栗之前是“事实婚姻”，并没有入籍，因此也不用考虑这些问题，但是在有了孩子之后，就要去考虑了，要不然没法入籍。</p>
<p>在这个问题上，夫妻二人考虑的事情是“怎样做是对彼此最有利的”，考虑到改姓之后对工作和生活有怎样的影响，而不是一味的循规蹈矩。对于平匡和实栗而言，所谓“男权”、“女权”是不存在的，他们所追求的是尊重每一个个体，尊重每一个人的想法与努力，并相应的给予肯定与鼓励。</p>
<p>实栗认为，自己有哥哥，平匡是独生子，并且平匡是靠技术吃饭的改了姓不太好。因此决定跟夫姓</p>
<p><img src="/images/2021010417111257.jpeg"></p>
<h2 id="后盾？"><a href="#后盾？" class="headerlink" title="后盾？"></a>后盾？</h2><p>在办完入籍手续之后，平匡对实栗说“我会努力做好你的后盾，有什么事尽管和我说”。</p>
<p>个人感觉，如果一个男人能够这样说，那么其实也算很温暖的了吧，如果能过做到那就更好了，足够被称作暖男了，总好过撒手不管的那种。</p>
<p>可是我们的喜欢耍小聪明的实栗可不是这样想的。实栗有点小生气，说：</p>
<p>帮忙？我们不是一起做父母吗？我也是第一次做妈妈什么都不懂，你怎么能让我自己一个人学习，然后对你发号施令呢？</p>
<p>实际上，女性在生育过程中所承担的责任是往往要大于男性的，也会承担更多的负担，无论是产前还是产后，无论是生理上还是心理上。</p>
<p>人们往往认为，如果男性能够做一些事情，就已经很好了，而女性做得再多都会被认为是理所当然的。这真的是有点失衡了。</p>
<p>想想，职场女性是怎样兼顾家庭与工作的呢？也许《坡道上的家》是一种答案。</p>
<p>“我们要一起学习，一起做父母，所谓夫妻不就应该是这样吗？”。夫妻两人相互扶持，一起经营家庭，各顶半边天。养孩子，要两口子和社会一起出力。</p>
<p><img src="/images/2021010417111516.jpeg"></p>
<h2 id="职场"><a href="#职场" class="headerlink" title="职场"></a>职场</h2><h3 id="这个team-leader怎么回事"><a href="#这个team-leader怎么回事" class="headerlink" title="这个team leader怎么回事"></a>这个team leader怎么回事</h3><p>“听说你老婆很年轻。下次我也要找个年轻的，没有劣化，水嫩嫩的那种。”</p>
<p>面对这样的话，平匡一脸不解地硬是憝了回去。😂虽说没有半泽那么狠，但是还是很勇敢的。</p>
<h3 id="产假"><a href="#产假" class="headerlink" title="产假"></a>产假</h3><p>“都已经令和时代了，为什么生孩子还要排队啊，为什么公司不会增派人手啊。”</p>
<p>“产假吗？那森山不在的时候，他的工作谁来做啊”</p>
<p>“你要休一个月产假？男的休产假也帮不上忙”</p>
<h3 id="不能请假这件事情"><a href="#不能请假这件事情" class="headerlink" title="不能请假这件事情"></a>不能请假这件事情</h3><p>本来就不对劲！</p>
<p><img src="/images/2021010417111838.jpeg"></p>
<h2 id="孕后反应"><a href="#孕后反应" class="headerlink" title="孕后反应"></a>孕后反应</h2><p>实栗因为严重的孕后反应，没法工作，也没法做家务，也没法陪ゆりちゃん去医院，甚至连快递都做不到。因此实栗成为了著名的诗人</p>
<p>就算脚抽筋周围也无人，作者津崎实栗</p>
<p><img src="/images/2021010417111998.jpeg"></p>
<p>就算尿失禁周围也无人😂</p>
<p><img src="/images/2021010417112158.jpeg"></p>
<p>在新年之夜，二人甚至因为一点小问题吵架了🤯</p>
<h2 id="我好辛苦啊"><a href="#我好辛苦啊" class="headerlink" title="我好辛苦啊"></a>我好辛苦啊</h2><p>因为没办法做家务，实栗叫了家政，尽管新年夜要加钱……</p>
<p>“生完孩子以后，我们还会遇到很多问题，到时候借助周围的力量一起去克服，好吗”，实栗在说完这句话的时候，平匡就背过去抹眼泪了。😭我也在抹眼泪啊😭</p>
<p><img src="/images/2021010417112256.jpeg"></p>
<p>“你很辛苦吧，你肯定很辛苦，一个人负责家务活，还要努力工作。觉得辛苦的时候就说出来吧。”</p>
<p><img src="/images/2021010417112475.jpeg"></p>
<p>这种，“男人一定要坚强”想法是否真的站得住脚？</p>
<p>男人一定要坚强，不可以哭，也不懂得如何倾诉，不能像女人一样闲聊吐槽，这可能是社会施加的诅咒吧。</p>
<p>尽管人们往往这样认为，但是实栗从来不认为平匡迁就自己，努力工作，还要做家务是理所当然的。觉得辛苦的时候就倾诉吧，无论男人还是女人。</p>
<p><img src="/images/2021010417112617.jpeg"></p>
<p>つらい。😭</p>
<h2 id="孩子的名字"><a href="#孩子的名字" class="headerlink" title="孩子的名字"></a>孩子的名字</h2><p>孩子的名字是父母给予的第一份礼物。</p>
<p>要不起个男女通用的名字吧，以后也许会在成长过程中改变性别。</p>
<p><img src="/images/2021010417112731.jpeg"></p>
<h2 id="新冠肺炎"><a href="#新冠肺炎" class="headerlink" title="新冠肺炎"></a>新冠肺炎</h2><p>新冠肺炎爆发之后，夫妻俩决定让实栗回娘家，尽可能降低接触到病毒的几率。在分离之前，二人本想拥抱，但是看了看孩子，还是没有拥抱。</p>
<p><img src="/images/2021010417112927.png"></p>
<p>疫情爆发之后，平匡在网上看到人们猜疑，诋毁，攻击对方，不禁问自己：人类居然能够愚蠢到这种境界吗，我也会这样吗？</p>
<p><img src="/images/2021010417113356.jpeg"></p>
<p>在过去的2020年，我也目睹过很多类似的事情：网络暴力，身份信息被出道，被人说“千里投毒”等等，这些事情，就是我所亲身经历的。人类居然能愚蠢到这种境界吗？</p>
<p>有这样一个场景记得很清楚：</p>
<p>政府宣布了紧急状态，娘家网络通讯设备坏掉了，平匡买好了想要送到娘家，路上看到了带孩子遛弯的实栗，然后一直看着他们的身影没敢打招呼，有一点“大禹治水三过家门而不入”的感觉。此时此刻的他非常理性，知道自己只是个快递员，不能做别的事情。平匡悄悄地把东西放到娘家门口，然后走了。</p>
<p><img src="/images/2021010417113474.jpeg"></p>
<p>实栗发现后，跑出去找平匡，最终在桥上，隔着很远，认出了对方。😭😭</p>
<p>生きていれば　また会える。</p>
<p><img src="/images/2021010417113461.jpeg"></p>
<p>这个桥可以步行吗？</p>
<h2 id="一些有趣的地方"><a href="#一些有趣的地方" class="headerlink" title="一些有趣的地方"></a>一些有趣的地方</h2><h3 id="我平匡家有娇妻，才不要程序员鼓励师咧"><a href="#我平匡家有娇妻，才不要程序员鼓励师咧" class="headerlink" title="我平匡家有娇妻，才不要程序员鼓励师咧"></a>我平匡家有娇妻，才不要程序员鼓励师咧</h3><p><img src="/images/2021010417113672.jpeg"></p>
<h3 id="葡萄柚果冻哪里有卖的啊？"><a href="#葡萄柚果冻哪里有卖的啊？" class="headerlink" title="葡萄柚果冻哪里有卖的啊？"></a>葡萄柚果冻哪里有卖的啊？</h3><p>喂你别走啊！好不容易买回来，实栗已经睡了，哎……</p>
<p><img src="/images/2021010417113751.jpeg"></p>
<h3 id="下次见面时再追求我一次？"><a href="#下次见面时再追求我一次？" class="headerlink" title="下次见面时再追求我一次？"></a>下次见面时再追求我一次？</h3><p>这狗粮真是太甜了吧！</p>
<p><img src="/images/2021010417113812.jpeg"></p>
<h3 id="新的恋ダンス"><a href="#新的恋ダンス" class="headerlink" title="新的恋ダンス"></a>新的恋ダンス</h3><p>太萌了太萌了高萌预警，我老婆披着麻袋都那么好看啊！</p>
<p><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=C0p5Q5qFTss%EF%BC%88YouTube%E7%9A%84%E5%B7%B2%E7%BB%8F%E8%A2%ABDMCA%E4%BA%86%F0%9F%98%82%EF%BC%89">https://www.youtube.com/watch?v=C0p5Q5qFTss（YouTube的已经被DMCA了😂）</a></p>
<p> </p>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>无论是选择结婚生子，还是一个人活下去，都没有关系。</p>
<p>看完觉得好感动的，也感到了更独孤、更空虚，仿佛2021年已经过完了一样。世界上怎么会有人能这么可爱，我实在太喜欢Gakki 了，在可爱面前无条件投降。想娶回家天天摸头😘😘😘</p>
<p>这一对夫妇好幸福啊，他们一起努力，以经营公司的方式来经营家庭，从不认为对方所作所为是理所当然的，尊重理解对方的选择与想法，及时肯定对方的努力。</p>
<p>平匡和实栗完全就是我所想要的样子。希望源さん在生活中也是这样一个温柔的人呢。</p>
<p><img src="/images/2021010417114041.jpeg"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/01/04/nigeru-sp/index/" data-id="clhp7rthr005rs2qr8oftgixx" data-title="《逃避可耻却有用》新春SP" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2020-conclusion/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/31/2020-conclusion/index/" class="article-date">
  <time class="dt-published" datetime="2020-12-31T00:00:00.000Z" itemprop="datePublished">2020-12-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/justsay/">justsay</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/31/2020-conclusion/index/">2020年终总结</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>2020年快结束了。这一年对于我来说，是“改变之年”。离开了熟悉的故乡，离开了家人，换了一份新的工作，认识了屈指可数的新朋友，学习了一些有趣的新知识。与此同时，新冠肺炎依旧在肆虐，慢慢已经养成了出门不用化妆反正也是戴口罩没人看得见的习惯。</p>
<h2 id="2020年的改变"><a href="#2020年的改变" class="headerlink" title="2020年的改变"></a>2020年的改变</h2><p>一直以来，我都是非常抗拒改变的人，因为我的内心很胆小怯懦，很不喜欢和人面对面的打交道。如果能够得过且过的、健康的、有质量的活下去，那么也就可以这样继续了。</p>
<p>也正是因为如此，自打毕业开始我便留在了故乡，未曾想过什么太大的改变。</p>
<p>直到今年，因为想要“right the wrong”以及 Nova的怂恿，来到了上海。</p>
<p>在解决了安身之处之后，生活也就开始变得稳定了，工作，解决问题（不可以解决提出问题的人哦，这样就是食人族了），周末。然后就变得和以往一样。工作很棒，生活还和以前一样，只不过有了更多的独处时间。</p>
<p>在生活中，我猜，我之所以抗拒改变，一个原因是心理舒适区，另外一个原因是对未知的恐慌。因为改变会带来变化，如果变化所带来的收益远远小于解决变化所消耗的精力，那么就显得有些得不偿失了。</p>
<p>在生活上，对待改变的态度可能就这样，我自己也没有做出什么太大的努力。怎么也都是宅着，无外乎置换一些生活用品，养成一些新的习惯，除此之外最大的也就是搬家了。</p>
<p>在技术上，我倒是在努力鞭策自己做出改变，毕竟这个改变不需要付出太多体力，只需要坐着思考实践就可以了。我觉得2020年最大的变化就是，我把我的大部分的服务都是用docker跑起来了。</p>
<p>各位读者们现在在读的本文，所有由我运行的Telegram Bot，以及其他的几个站点，目前都是使用docker的。迁移的过程比较麻烦，花费了几天的时间，甚至还宣布失败了一次，不过最终还是成功完美迁移，对于以后维护上的便利性还是非常有帮助的。我认为这次改变是非常值得的。</p>
<p><img src="/images/2020122913534578.png"></p>
<p>另外，值得一提的是，2020年，我总计发布了13篇博文（不算本文），还好没有给被打脸的机会，值得窃喜。</p>
<h2 id="2021年的展望"><a href="#2021年的展望" class="headerlink" title="2021年的展望"></a>2021年的展望</h2><p>2021年，我应该更多思考一下人生的问题吧：我究竟想要什么？我究竟要不要烂在这里？做一个“精致的利己主义者”吗？</p>
<p>  [video play&#x3D;’0’]<a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2020/12/2020122914045013.mp4/[/video/]">https://dmesg.app/wp-content/uploads/2020/12/2020122914045013.mp4\[/video\]</a></p>
<p>我想要的东西，是否值得我去做出更大的改变，去面对从未有过的未知？我该如何下定决心，我该如何清楚认识到我究竟想要什么？</p>
<p>2021年，大体上还是希望希望世界和平，无灾无难，我老婆更美吧！🥺ぴえん</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/12/31/2020-conclusion/index/" data-id="clhp7rtdh0000s2qr42o1dj7q" data-title="2020年终总结" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-tgbot2/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/12/25/tgbot2/index/" class="article-date">
  <time class="dt-published" datetime="2020-12-25T00:00:00.000Z" itemprop="datePublished">2020-12-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/program/">program</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/12/25/tgbot2/index/">[Telegram bot系列]2: 回顾与Media Group、媒体文件、Next Step、部署维护</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>三年前，我开始了写这一系列，没想到过了3年，竟然也没几个人去看！连个捧场的都没有</p>
<p>这三年，Telegram也迎来了一些更新，这篇文章当然不会挨个介绍每一个新特性以及相关的用法了，我只会把自己开发过程中提到的地方记录一下。官方文档写的挺清楚了，基本上每一点都介绍的很详细😂</p>
<p>前两篇</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/tgbot0.html">[Telegram bot 系列]0：用 Python 写一个 Telegram Bot 简单的回话 bot</a></p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/tgbot1.html">[Telegram bot 系列]1：requests 库、Inline Keyboard、Reply Keyboard 与其他细节</a></p>
<h2 id="回顾：如何开发一个Telegram-Bot"><a href="#回顾：如何开发一个Telegram-Bot" class="headerlink" title="回顾：如何开发一个Telegram Bot"></a>回顾：如何开发一个Telegram Bot</h2><h3 id="开发语言"><a href="#开发语言" class="headerlink" title="开发语言"></a>开发语言</h3><p>爱用啥用啥，Python、Go等都没问题的，甚至直接curl都是可以的。毕竟Restful，怎么都可以。</p>
<h3 id="开发方式"><a href="#开发方式" class="headerlink" title="开发方式"></a>开发方式</h3><p>想要开发Telegram Bot，从途径上来说有两种方法。</p>
<p>第一种方法是使用Bot API，REST接口，入口在荷兰，使用起来比较容易。</p>
<p>第二种方法是使用MTProto协议，这个会比较困难，需要有一定的异步编程基础。著名的<a target="_blank" rel="noopener" href="https://github.com/LonamiWebs/Telethon">telethon</a>就是干这个的。</p>
<p>大部分情况下使用第一种就足够满足需求了，本系列也会一直以第一种方法为主。</p>
<h3 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h3><p>对于Bot而言，最重要的事情就是“事件”，比如说当用户发送一个纯文本的消息，那么对于Bot来说就是一种类型的事件；当用户发送了一个图片，这又是另外一种事件；用户编辑了消息，删除了消息，也同样对应不同的事件。甚至，当用户点击InlineKeyBoardButton，这也是一种特殊事件。</p>
<p>因此，开发一个bot，也就是根据传入的事件不同来进行各种操作，然后给用户反括，比如回复消息，发送文件，整体的流程差不多就是这样的。</p>
<p>Telegram Bot事件类型挺多的，大概一共有这些类型：</p>
<p>&#x2F;&#x2F; Handler: func(*Message)<br>OnText &#x3D; “\atext”<br>OnPhoto &#x3D; “\aphoto”<br>OnAudio &#x3D; “\aaudio”<br>OnAnimation &#x3D; “\aanimation”<br>OnDocument &#x3D; “\adocument”<br>OnSticker &#x3D; “\asticker”<br>OnVideo &#x3D; “\avideo”<br>OnVoice &#x3D; “\avoice”<br>OnVideoNote &#x3D; “\avideo_note”<br>OnContact &#x3D; “\acontact”<br>OnLocation &#x3D; “\alocation”<br>OnVenue &#x3D; “\avenue”<br>OnEdited &#x3D; “\aedited”<br>OnPinned &#x3D; “\apinned”<br>OnChannelPost &#x3D; “\achan_post”<br>OnEditedChannelPost &#x3D; “\achan_edited_post”<br>OnDice &#x3D; “\adice”<br>OnInvoice &#x3D; “\ainvoice”<br>OnPayment &#x3D; “\apayment”</p>
<p>&#x2F;&#x2F; Will fire when bot is added to a group.<br>OnAddedToGroup &#x3D; “\aadded_to_group”</p>
<p>&#x2F;&#x2F; Group events:<br>OnUserJoined &#x3D; “\auser_joined”<br>OnUserLeft &#x3D; “\auser_left”<br>OnNewGroupTitle &#x3D; “\anew_chat_title”<br>OnNewGroupPhoto &#x3D; “\anew_chat_photo”<br>OnGroupPhotoDeleted &#x3D; “\achat_photo_del”</p>
<p>&#x2F;&#x2F; Migration happens when group switches to<br>&#x2F;&#x2F; a supergroup. You might want to update<br>&#x2F;&#x2F; your internal references to this chat<br>&#x2F;&#x2F; upon switching as its ID will change.<br>&#x2F;&#x2F;<br>&#x2F;&#x2F; Handler: func(from, to int64)<br>OnMigration &#x3D; “\amigration”</p>
<p>&#x2F;&#x2F; Will fire on callback requests.<br>&#x2F;&#x2F;<br>&#x2F;&#x2F; Handler: func(*Callback)<br>OnCallback &#x3D; “\acallback”</p>
<p>&#x2F;&#x2F; Will fire on incoming inline queries.<br>&#x2F;&#x2F;<br>&#x2F;&#x2F; Handler: func(*Query)<br>OnQuery &#x3D; “\aquery”</p>
<p>&#x2F;&#x2F; Will fire on chosen inline results.<br>&#x2F;&#x2F;<br>&#x2F;&#x2F; Handler: func(*ChosenInlineResult)<br>OnChosenInlineResult &#x3D; “\achosen_inline_result”</p>
<p>&#x2F;&#x2F; Will fire on ShippingQuery.<br>&#x2F;&#x2F;<br>&#x2F;&#x2F; Handler: func(*ShippingQuery)<br>OnShipping &#x3D; “\ashipping_query”</p>
<p>&#x2F;&#x2F; Will fire on PreCheckoutQuery.<br>&#x2F;&#x2F;<br>&#x2F;&#x2F; Handler: func(*PreCheckoutQuery)<br>OnCheckout &#x3D; “\apre_checkout_query”</p>
<p>&#x2F;&#x2F; Will fire on Poll.<br>&#x2F;&#x2F;<br>&#x2F;&#x2F; Handler: func(*Poll)<br>OnPoll &#x3D; “\apoll”</p>
<p>&#x2F;&#x2F; Will fire on PollAnswer.<br>&#x2F;&#x2F;<br>&#x2F;&#x2F; Handler: func(*PollAnswer)<br>OnPollAnswer &#x3D; “\apoll_answer”</p>
<p>看到名字就知道是什么意思，就不说了。</p>
<h3 id="运行方式"><a href="#运行方式" class="headerlink" title="运行方式"></a>运行方式</h3><p>要么使用polling方式，定期轮询API Server，要么设置webhook，发生事件时Telegram会向设置的地址发送POST请求，请求的BODY里会有对应的数据结构。</p>
<h2 id="Media-Group"><a href="#Media-Group" class="headerlink" title="Media Group"></a>Media Group</h2><p>Telegram目前已经支持将图片、文件、视频等作为一组发送，比如说我发送了3张照片为一组，在这种情况下，Bot 所收到的事件就是三个onPhoto，然后这三个事件有一个共同的字段<code>media_group_id</code>，至于<code>caption</code>落在第几个事件里？不知道，遍历完就知道了。</p>
<p>划重点：这三个事件几乎是同时到达的。所以有些需求，比如说提取出这组照片里的file_id和caption，最简单的办法就是共享一个全局的字典，以<code>user_id</code>和<code>media_group_id</code>作为key，那么这个时候就要考虑用锁的机制来让这三个事件变成串行的。一个例子<a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/TeleTweet/blob/master/teletweet/bot.py#L125">可以看这里</a></p>
<h2 id="下载媒体文件"><a href="#下载媒体文件" class="headerlink" title="下载媒体文件"></a>下载媒体文件</h2><p>对于Telegram而言，无论是文件，还是图片、视频，都有一个<code>file_id</code>用于唯一代表这个文件。当然，每个类型会有一些细微的不同，比如视频文件会包含分辨率，图片会有预览图，文件会有mime-type。</p>
<p>想要下载文件，可以分为三步</p>
<ol>
<li>拿到对应的对象，比如说想要下载图片，那么就是<code>message.photo</code>，想要下载视频，那么就是<code>message.video</code></li>
<li>拿到file_id，参考下对应的数据结构，拿到对应的<code>file_id</code>，比如说<code>message.video.file_id</code></li>
<li>进行下载，保存到本地</li>
</ol>
<p>具体可以参考如下代码，用其他语言也差不多，套路都是一样的：</p>
<p>def download_file_from_id(file_id):<br>    file_info &#x3D; bot.get_file(file_id)<br>    content &#x3D; bot.download_file(file_info.file_path)</p>
<pre><code>temp = tempfile.NamedTemporaryFile(delete=False)
temp.write(content)
return temp
</code></pre>
<p>def get_file_id(message) -&gt; str:<br>    if message.photo:<br>        object_type &#x3D; “photo”<br>    elif message.video:<br>        object_type &#x3D; “video”<br>    elif message.document:<br>        object_type &#x3D; “document”<br>    else:<br>        object_type &#x3D; “”</p>
<pre><code>try:
    file\_id = getattr(message, object\_type)\[-1\].file\_id
except Exception:
    file\_id = getattr(message, object\_type).file\_id
return file\_id
</code></pre>
<p>需要注意一点，<code>message.photo</code>的结果是一个list，第一个元素是预览图，最后一个元素是正常大小（720P）的图片</p>
<p>另外更需要注意的一点：Telegram对于Bot可以上传、下载的文件、图片等大小有限制，具体可以查文档找找，所以如果用户发送了一个2G的文件，bot这边很有可能是无法下载的……但是Bot可以转发啊！要处理这种情况，只能用client api了，bot收到这种类型的文件，转发给一个正常用户，正常用户处理完，将结果发给bot，bot再转发给初始用户。</p>
<p>这种曲线救国的方式，如果确保整个链条是完整的，可以<a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/NCMBot">参考NCMBot的代码</a>。一定要引起注意的是，有些用户的隐私设置中不允许任何人查看转发信息，因此不可以依赖forwarded_message这个字段！bot一定要想办法自己记录下来某条消息（文件）的对应的初始用户是谁。</p>
<h2 id="Next-Step"><a href="#Next-Step" class="headerlink" title="Next Step"></a>Next Step</h2><p>有些时候，我们可能需要一个wizard性质的一步一步的向导，简单的话，类似下图这种效果：</p>
<p><img src="/images/2020122516061518.png"></p>
<p><img src="/images/2020122516061860.png"></p>
<p>BotFather也是这样设计的。</p>
<p>这个时候就需要一种“Next Step”的概念，要一步一步来才可以。如果使用pytelegrambotapi的话，那么就很简单了，直接使用<code>bot.register_next_step_handler</code>就可以了。示例代码如下：</p>
<p>@bot.message_handler(commands&#x3D;[‘sign_in’])<br>def sign_in_handler(message):<br>    bot.send_message(message.chat.id, “next step”, parse_mode&#x3D;’markdown’)<br>    bot.register_next_step_handler(message, next_step_add_auth)</p>
<p>def next_step_add_auth(message):<br>    bot.send_chat_action(message.chat.id, ‘typing’)<br>    bot.send_message(message.chat.id, “this step”, parse_mode&#x3D;’markdown’)</p>
<p>如果wrapper不支持next step，那就只能自己设计一个状态机了。需要设计一个临时的数据结构，至少要表明用户的下一步操作应该是什么，然后拦截对应的事件，做dispatch。</p>
<p>具体<a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/KeepMeBot/blob/93244cdae53a77a3232ece9e4e5e053418d386ac/handler.go#L63">可以看这里</a>，太长了就不贴了</p>
<h2 id="部署维护"><a href="#部署维护" class="headerlink" title="部署维护"></a>部署维护</h2><p>之前开发的bot，每次上线都要写一个systemd service文件，然后<code>systemctl daemon-reload</code>，很麻烦，迁移到其他机器也很麻烦。后来渐渐开始用docker，就很方便了。直接把一堆bot都丢到一个<code>docker-compose.yml</code>中，一个<code>up</code>就可以了。迁移服务器时只要rsync走，重新up就可以。具体可以看<a target="_blank" rel="noopener" href="https://dmesg.app/dev-deploy-bot.html">《我是如何优雅的开发、部署并管理多个 Telegram Bot 的》</a></p>
<h3 id="Dockerfile与docker-image"><a href="#Dockerfile与docker-image" class="headerlink" title="Dockerfile与docker image"></a>Dockerfile与docker image</h3><p>之前，不知道在哪看到的文章，说docker image的layer有限制，不能超过127层(还是多少层的)，层越少越好。因此很多人可能都有一个疯狂一行式的习惯，把所有操作全都一个RUN解决了，不停的用&amp;&amp;和\。</p>
<p>一个非常典型的例子大概如下：</p>
<p>FROM python:alpine</p>
<p>RUN apk update \<br>&amp;&amp; apk add git ffmpeg flac –no-cache \<br>&amp;&amp; git clone <a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/ExpressBot">https://github.com/tgbot-collection/ExpressBot</a> \<br>&amp;&amp; pip3 install –no-cache-dir -r &#x2F;ExpressBot&#x2F;requirements.txt</p>
<p>WORKDIR &#x2F;ExpressBot</p>
<p>CMD [“python3”, “expressbot&#x2F;main.py”]</p>
<p>现在想想，这™️的是谁说的，出来让我暴打一顿，可真是害人不浅呐！</p>
<p>现在docker engine的layer是否有层数限制我不了解，但是层越少越好，这点要怎么理解？</p>
<p>比如说，有人看到官网文档<a target="_blank" rel="noopener" href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices">Best practices for writing Dockerfiles</a>里这么说的：</p>
<blockquote>
<p><strong>Minimize</strong> the number of layers</p>
<p>In older versions of Docker, it was <strong>important</strong> that you minimized the number卧槽这™️什么玩意这也太长了吧看不下去了啊，能不能来个中文，啊好困。行吧，反正有一个minimize，还说 important，那直接无条件一层达人不就得了。</p>
</blockquote>
<p>愚以为，宫中之事 技术学习中是非常忌讳这种囫囵吞枣的阅读方式的。</p>
<h3 id="如何正确的使用RUN"><a href="#如何正确的使用RUN" class="headerlink" title="如何正确的使用RUN"></a>如何正确的使用RUN</h3><p>为什么要存在layer，一个最直观的原因就是，大家可以共用同样的layer，这样pull起来也快很多啊。另外还有一个原因就是，如果某一个layer已经有了，那么在build image的时候，直接拿来用不就好了？毕竟安装东西很慢啊，有些可能还是要去编译的，就更慢了。</p>
<p>写Dockerfile不要怕多创建layer，不要总是一层达人（这里使用了夸张的修辞手法，<code>FROM</code>也是要一层的，这里指的是一个<code>RUN</code>指令）</p>
<p>怎么来了解这个事情呢？</p>
<p>首先要知道，docker只有<code>RUN</code>、<code>COPY</code>、<code>ADD</code>这三个命令会创建新的layer。</p>
<p>其次，以Python为例，一个Python程序的运行环境大概可以这样划分：</p>
<ol>
<li>基础的操作系统</li>
<li>某版本的Python解释器及对应的一些系统级使用apt安装的库，比如gcc，git，各种lib比如说libssl</li>
<li>对应的Python第三方库，比如说flask，requests</li>
<li>代码</li>
</ol>
<p>那么具体分析一下，就可以发现，1和2是基本不会变的，3变的概率比较大，但是不会很频繁，4是经常变化的。那么我们的Dockerfile就应该同样保证1和2作为一层，3作为1层，4作为一层。</p>
<p>其次要知道，docker在build的时候，默认会使用缓存的，但是需要注意的是，如果低层的缓存失效了，那么后面的全部都要重新跑。</p>
<p>也就是说，在上面的例子中，如果我只改代码，那么对应的是4，那么123都会使用缓存，4重新跑一次。但是如果我修改了2，那么234都要重新跑，即使我没有修改3和4。哦对了，2020年了，没有人会傻到用文件的访问时间、修改时间来判断你有没有改这个文件。docker使用的是checksum(SHA256)啦。</p>
<p>总结一下，应该把<strong>同样变化频率的命令放在一起作为一条RUN</strong>，然后把<strong>不常变化的放在上面，经常变化的放在下面</strong>，这样才是最优解。</p>
<p>那么对应如上Dockerfile，就可以这样优化一下：</p>
<p>FROM python:alpine</p>
<h1 id="安装个啥git，docker-build的时候context是干啥的？dockerhub在build的时候第一件事情就是clone你的repo"><a href="#安装个啥git，docker-build的时候context是干啥的？dockerhub在build的时候第一件事情就是clone你的repo" class="headerlink" title="安装个啥git，docker build的时候context是干啥的？dockerhub在build的时候第一件事情就是clone你的repo"></a>安装个啥git，docker build的时候context是干啥的？dockerhub在build的时候第一件事情就是clone你的repo</h1><p>RUN apk update &amp;&amp; apk add –no-cache ffmpeg flac # 加上–no-cache</p>
<h1 id="拷贝我们的requirements-txt到临时目录，如果是go，可以拷贝go-mod"><a href="#拷贝我们的requirements-txt到临时目录，如果是go，可以拷贝go-mod" class="headerlink" title="拷贝我们的requirements.txt到临时目录，如果是go，可以拷贝go.mod"></a>拷贝我们的requirements.txt到临时目录，如果是go，可以拷贝go.mod</h1><p>COPY requirements.txt &#x2F;tmp&#x2F;requirements.txt</p>
<h1 id="安装-Python的库，然后删掉它，如果是go，可以用go-mod-download"><a href="#安装-Python的库，然后删掉它，如果是go，可以用go-mod-download" class="headerlink" title="安装 Python的库，然后删掉它，如果是go，可以用go mod download"></a>安装 Python的库，然后删掉它，如果是go，可以用go mod download</h1><h1 id="如果要安装的东西很少，连requirements-txt也没有，那么直接pip-install-a-b-c-d也可以"><a href="#如果要安装的东西很少，连requirements-txt也没有，那么直接pip-install-a-b-c-d也可以" class="headerlink" title="如果要安装的东西很少，连requirements.txt也没有，那么直接pip install a b c d也可以"></a>如果要安装的东西很少，连requirements.txt也没有，那么直接pip install a b c d也可以</h1><p>RUN pip install –no-cache-dir -r &#x2F;tmp&#x2F;requirements.txt &amp;&amp; rm &#x2F;tmp&#x2F;requirements.txt</p>
<h1 id="把当前目录拷贝到容器里的-x2F-ExpressBot-隐藏目录如-git-也会被拷贝"><a href="#把当前目录拷贝到容器里的-x2F-ExpressBot-隐藏目录如-git-也会被拷贝" class="headerlink" title="把当前目录拷贝到容器里的&#x2F;ExpressBot 隐藏目录如.git 也会被拷贝"></a>把当前目录拷贝到容器里的&#x2F;ExpressBot 隐藏目录如.git 也会被拷贝</h1><p>COPY . &#x2F;ExpressBot</p>
<p>WORKDIR &#x2F;ExpressBot</p>
<p>CMD [“python3”, “expressbot&#x2F;main.py”]</p>
<p>这样就可以用到cache啦</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2020/12/2020122516243648.jpeg"><img src="/images/2020122516243648.jpeg"></a></p>
<p>具体改进都写到了注释里了。需要注意的是，<code>.git</code>也会被拷贝，对于一个有很多commit的项目来说……还是整个<code>.dockerignore</code>吧！</p>
<p>这样一波操作下来，确实是多了几层，但是下次我改代码，docker hub就不用全部重新跑了，一个简单的COPY就完事。</p>
<p>呃，当然，build rule也要开启build caching哦</p>
<p><img src="/images/2020122516062048.png"></p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p><a target="_blank" rel="noopener" href="https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#minimize-the-number-of-layers">Best practices for writing Dockerfiles</a></p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>祝大家圣诞快乐🎅希望你的圣诞老人没有在打电动</p>
<p><a target="_blank" rel="noopener" href="https://twitter.com/xbox/status/1342213462521380864?s=21">https://twitter.com/xbox/status/1342213462521380864?s=21</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/12/25/tgbot2/index/" data-id="clhp7rtm5009qs2qrbn1ydxkk" data-title="[Telegram bot系列]2: 回顾与Media Group、媒体文件、Next Step、部署维护" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-dev-deploy-bot/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/10/30/dev-deploy-bot/index/" class="article-date">
  <time class="dt-published" datetime="2020-10-30T00:00:00.000Z" itemprop="datePublished">2020-10-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/program/">program</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/10/30/dev-deploy-bot/index/">我是如何优雅的开发、部署并管理多个Telegram Bot的？</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><strong>并不优雅</strong></p>
<p>大家都知道，最近我一直痴迷于开发各种并无卵用的Telegram Bot。那么这一过程，就包含了开发、部署和管理这三个过程，本文就简单的说下这段时间的经验之谈吧</p>
<h2 id="开发-Telegram-Bot"><a href="#开发-Telegram-Bot" class="headerlink" title="开发 Telegram Bot"></a>开发 Telegram Bot</h2><blockquote>
<p>神说：要有这个bot，于是就有了这个bot</p>
</blockquote>
<p>开发bot，最重要的一点就是进行技术选型。“技术选型”看起来很玄乎，其实就是为了实现这个bot，我们要选用什么语言，使用什么库等等。</p>
<p>当然一切都要从需求出发，从我的角度而言，首选语言是Go——因为静态类型，静态编译之后很适合放到Docker Image里，并且只要凭借想象力编程就基本没问题了；如果Go无法达到我的预期，那就只好选Python了；如果连Python也做不好，那这个bot就可以丢掉了。</p>
<p>当然，在最终选定时，需要根据需求进行一些基础的调研，拿<a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/TeleTweet">TeleTweet</a>为例，基础阶段它的需求有这些：</p>
<ul>
<li>能够把Telegram消息发送到Twitter</li>
<li>支持图片tweet</li>
</ul>
<p>对于Go&#x2F;Python与其生态的对比</p>
<p>Go：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/tucnak/telebot">Telebot</a> 纯Go实现的支持Bot API的库，维护很积极，文档也比较丰富</li>
<li><a target="_blank" rel="noopener" href="https://github.com/Arman92/go-tdlib">go-tdlib</a> Telegram官方tdlib的json bindings，文档几乎为0，同时需要先编译tdlib</li>
<li><a target="_blank" rel="noopener" href="https://github.com/dghubble/go-twitter">go-twitter</a> 功能尚可，文档缺失，并且不支持UploadMedia</li>
</ul>
<p>Python：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/eternnoir/pyTelegramBotAPI">pytelegrambotapi</a> 非常知名的Bot API wrapper，文档丰富，维护积极</li>
<li><a target="_blank" rel="noopener" href="https://github.com/LonamiWebs/Telethon">Telethon</a> 使用纯Python实现的MTProto，注释即文档，维护积极，支持bot和client</li>
<li><a target="_blank" rel="noopener" href="https://github.com/bear/python-twitter">python-twitter</a> 还能凑合用的一个Twitter API wrapper，该有的功能都有，支持UploadMedia</li>
</ul>
<p>那么对于<a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/TeleTweet">TeleTweet</a>而言，选择Python就是更明智的选择；对于<a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/NCMBot">NCMBot</a>，由于需要使用Client API，因此选用Python+Telethon也是比较优雅的选择；对于<a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/archiver">Archiver</a>，没有太多特殊的地方，用Go就可以了。</p>
<h2 id="部署Telegram-Bot"><a href="#部署Telegram-Bot" class="headerlink" title="部署Telegram Bot"></a>部署Telegram Bot</h2><p>开发完成之后，bot是总要部署到某台服务器上的。由于我自己有很多bot，因此根据情况不同我把他们划分成了两类：</p>
<h3 id="Legacy-Bot"><a href="#Legacy-Bot" class="headerlink" title="Legacy Bot"></a>Legacy Bot</h3><p>一些历史遗留下来的bot，基本没有继续的开发计划，处于即将被Archive的状态，有些甚至连说明都没有，完全是拿来自用?所以就丢着呗！</p>
<h3 id="Modern-Bot"><a href="#Modern-Bot" class="headerlink" title="Modern Bot"></a>Modern Bot</h3><p>最近一段时间开发的bot，有持续的维护计划，运行稳定，表现良好。</p>
<p>对于第一类bot，我选择让它们留在一台新加坡的机器上，原来是怎么跑的就怎么跑，一点都不动；</p>
<p>对于第二类bot，我把它们全部放到了一台日本的机器上。</p>
<p>对于第二类bot，如何运行它们又成为了一个问题。</p>
<p>好吧，现在这些bot，只要还能说话的，我都给丢到一台英国的大鸡鸡上了。</p>
<h3 id="systemd-service"><a href="#systemd-service" class="headerlink" title="systemd service"></a>systemd service</h3><p>使用Python开发的bot，那么就是老生常谈的_virtualenv+systemd_，实际操作下来有些繁琐，尤其是配置systemd总是有一些蜜汁情况，比如说环境变量啦，比如说用户啦；使用Go开发的bot，那么也就不外乎是clone下来源代码，然后<code>go build .</code> ，然后继续配置systemd。这样的话当bot一旦多起来，甚至以后要换服务器，那么就会更麻烦，所有上述操作都要全部重新再来一遍，非常痛苦?</p>
<h3 id="docker-docker-compose"><a href="#docker-docker-compose" class="headerlink" title="docker + docker-compose"></a>docker + docker-compose</h3><p>那么如果用docker去分发部署是不是就很方便了？毕竟第二类bot都是有<code>Dockerfile</code>的。</p>
<p>没错的，就是这样——使用<code>Dockerfile</code>构建出docker image，直接docker run就可以了。</p>
<p>更进一步，我可以把这堆bot都丢到<code>docker-compose</code>中，一个<code>docker-compose up -d</code>就可以了。</p>
<p>当然，构建docker image时，是有很多技巧的，这个就以后再说了。</p>
<h2 id="管理、维护bot"><a href="#管理、维护bot" class="headerlink" title="管理、维护bot"></a>管理、维护bot</h2><h3 id="使用Makefile"><a href="#使用Makefile" class="headerlink" title="使用Makefile"></a>使用Makefile</h3><p>开发工作总是要不断迭代的，那么如果添加了新功能，，我该如何更新服务器上bot呢？</p>
<p>有些bot，我创建了一个<code>Makefile</code>，里面是这么写的：</p>
<p>default:<br>    @echo “Updating codes…”<br>    git pull<br>    @echo “Restarting service…”<br>    systemctl daemon-reload<br>    systemctl restart TeleTweet<br>    @echo “You’re good to go.”<br>    systemctl status TeleTweet</p>
<p>很简单，很黄很暴力是不是，只要ssh到服务上，跳到对应的目录，一个<code>make</code>然后就可以关窗放狗咬人走人了。</p>
<p>对于使用Go的bot，也不过是<code>go build .</code> 之类的，比如<a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/DailyGakki">DailyGakki</a>是这样写的：</p>
<p>default:<br>    git pull<br>    @echo “Installing dependencies…”<br>    @go get -u github.com&#x2F;go-bindata&#x2F;go-bindata&#x2F;…<br>    @echo “Build static files…”<br>    make asset<br>    @echo “Build current platform executable…”<br>    go build -o DailyGakki .</p>
<p>asset:<br>    @~&#x2F;go&#x2F;bin&#x2F;go-bindata -o assets.go images&#x2F;…</p>
<p>反正也是本机使用，没必要用<code>CGO_ENABLED=0</code>以及额外配置<code>ldflags</code></p>
<p>如果想要查看Bot的运行状态呢？那么只能<code>systemctl status daily-gakki</code>这样啦！</p>
<p><img src="/images/2020102917340981.png"></p>
<h3 id="使用docker-docker-compose"><a href="#使用docker-docker-compose" class="headerlink" title="使用docker+docker-compose"></a>使用docker+docker-compose</h3><p>如果使用docker的话，那么一切问题就简单了。push完代码之后，等待docker hub build成功之后，ssh到服务器上：</p>
<p>docker pull xxx<br>docker restart container_name</p>
<p>使用docker-compose也就不过pull了之后</p>
<p>docker-compose up -d service_name</p>
<p>查看状态？</p>
<p>docker-compose ps</p>
<p><img src="/images/2020102917341023.png"></p>
<p>或者</p>
<p>docker stats</p>
<p><img src="/images/2020102917341268.png"></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>由此可见，在整个bot瞎搞的过程中，使用docker来进行分发部署管理还是非常方便的。当数量多起来，要比传统的systemd、supervisor之类的方便得多。</p>
<p>当然docker也有缺点，比如磁盘空间比较宝贵的盆友们，有些时候docker image就可能没那么理想，毕竟有些image只能包含rootfs。提到这点，如果是Python开发的bot，做一个通用的image，包含了这些bot所有需要使用的library也不是不可以的。</p>
<p>另外一个难点，docker容易新手劝退，比如说volumes有时比较有趣，一个不小心就很容易写错，然后就gg啦😂</p>
<p>不过，如果能够用Go开发，那么docker image甚至可以使用<a target="_blank" rel="noopener" href="https://docs.docker.com/develop/develop-images/multistage-build/">multi-stage build</a>的手段。像下面这样：</p>
<p><img src="/images/2020102917341448.png"></p>
<p>一眼就能看出来哪些是用Go写的了吧！非常exciting。</p>
<p>更进一步，我甚至准备了一个<a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/BotsRunner">Repository</a>，专门用来存放这些bot的<code>docker-compose.yml</code>。</p>
<p>哪怕哪天换机器了，我也只需要把这个目录拷贝走，然后一个<code>docker-compose up -d</code>就可以继续装死了。</p>
<hr>
<p>好的，以上就是我要说的全部内容，有关于我究竟开发了哪些bot，可以看这篇文章<a target="_blank" rel="noopener" href="https://dmesg.app/telegram-bot-collections.html">《有趣的 Telegram Bot》</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/10/30/dev-deploy-bot/index/" data-id="clhp7rtf9001vs2qr2byb78o9" data-title="我是如何优雅的开发、部署并管理多个Telegram Bot的？" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-telegram-bot-collections/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/10/25/telegram-bot-collections/index/" class="article-date">
  <time class="dt-published" datetime="2020-10-25T00:00:00.000Z" itemprop="datePublished">2020-10-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/program/">program</a>►<a class="article-category-link" href="/categories/program/share/">share</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/10/25/telegram-bot-collections/index/">有趣的Telegram Bot</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>最近一段时间，我一直在痴迷与鼓捣Telegram Bot?再算上之前的几个bot，那么就来水一下吧！</p>
<h2 id="ServerSan"><a href="#ServerSan" class="headerlink" title="ServerSan"></a>ServerSan</h2><p>这曾经是一个用来监测服务器状态的bot，可以获取OS的基础信息等等。?现在已经凉了，本王已经弃坑了。能不能用嘛？?运气好的话也许能吧……要不我这图是怎么来的？</p>
<p><img src="/images/2020102514041886.jpeg"></p>
<p><img src="/images/2020102514041910.jpeg"></p>
<p>GitHub: <a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/ServerSan">https://github.com/tgbot-collection/ServerSan</a></p>
<h2 id="wp-comments-tgbot"><a href="#wp-comments-tgbot" class="headerlink" title="wp-comments-tgbot"></a>wp-comments-tgbot</h2><p>这个是为了方便回复WordPress评论而搞的bot。别看很久不更新了，但是依旧能用的哦！</p>
<p>别说，这东西我用的真很开心，已经很久不进WordPress的后台了?</p>
<p><img src="/images/2020102514042311.jpeg"></p>
<p><img src="/images/2020102514042485.png"></p>
<p>GitHub: <a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/wp-comments-tgbot">https://github.com/tgbot-collection/wp-comments-tgbot</a></p>
<p>介绍： <a target="_blank" rel="noopener" href="https://dmesg.app/wp-tgbot.html">《使用 Telegram Bot 接受和回复 WordPress 评论》</a></p>
<h2 id="KeepMeBot"><a href="#KeepMeBot" class="headerlink" title="KeepMeBot"></a>KeepMeBot</h2><p><a target="_blank" rel="noopener" href="https://t.me/KeepMeRunBot">https://t.me/KeepMeRunBot</a></p>
<p>在Docker Hub宣布将清理不活跃镜像之后，就搞出来了这个东西。目前来说，emmm，能用！仅此而已</p>
<p>用起来很简单，添加就是了！</p>
<p><img src="/images/20201025140426100.png" alt="KeepMeBot 保活机器人"></p>
<p>当然了你能够看到添加记录</p>
<p><img src="/images/202010251404282.png" alt="KeepMeBot 保活机器人"></p>
<p>甚至，为此我还有个域名……??‍♀️</p>
<p>GitHub: <a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/KeepMeBot">https://github.com/tgbot-collection/KeepMeBot</a></p>
<p>介绍： <a target="_blank" rel="noopener" href="https://dmesg.app/keepmebot.html">《KeepMeBot 保活机器人》</a></p>
<h2 id="DailyGakki"><a href="#DailyGakki" class="headerlink" title="DailyGakki"></a>DailyGakki</h2><p><a target="_blank" rel="noopener" href="https://t.me/my_gakki_bot">https://t.me/my_gakki_bot</a></p>
<p>? 每日分享最可爱的Gakki</p>
<p>这么可爱的老婆，难道你不想每天都看到吗？那么既然如此，不如就快来使用这个Bot吧！</p>
<p>怎么样，喜欢今日份的老婆吗？</p>
<p><img src="/images/2020102514043052.png"></p>
<p>不仅可以手动呼叫你的老婆，还能够定时推送哦！</p>
<p><img src="/images/2020102514043719.png"></p>
<p>GitHub: <a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/DailyGakki">https://github.com/tgbot-collection/DailyGakki</a></p>
<h2 id="TeleTweet"><a href="#TeleTweet" class="headerlink" title="TeleTweet"></a>TeleTweet</h2><p><a target="_blank" rel="noopener" href="https://t.me/tele_tweetbot">https://t.me/tele_tweetbot</a></p>
<p>某一天，我在用着电脑，突然想发这样一条推文：</p>
<p><img src="/images/2020102514044149.png"></p>
<p>那么该怎么办呢？打开Chrome，打开Twitter网页版，粘贴图片，输入文字，回车。</p>
<p>如果能直接在某个应用之内一气呵成那该多少？没问题啊！</p>
<p><img src="/images/2020102514045095.png"></p>
<p>这不就有了嘛！</p>
<p>当然了，目前这个机器人还非常简陋，只能简单的发个推，就算带图，也只能带一个图。Telegram的这个Photo Group的机制呀，啧啧啧?</p>
<p>这个bot使用oauth的方式登录，需要你去推特授权一下，然后它会把oauth token以AES-128-CBC的形式加密保存。当然了，由于Python的特性，只要能拿到运行bot的机器上的代码，就能够看到AES Key，这我也暂时没啥好的办法?</p>
<p>因为毕竟代码是开源的，即使用Go把bot这部分重写了，也是能够看到加密的逻辑的。哪怕是单独把加密这部分重写，只发布二进制，那么能够看到源代码也照样能做replay attack?所以暂时我也没啥好想法。</p>
<p>所以，目前，只能无条件的选择相信我了?</p>
<p>GitHub: <a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/TeleTweet">https://github.com/tgbot-collection/TeleTweet</a></p>
<h3 id="一点小感想"><a href="#一点小感想" class="headerlink" title="一点小感想"></a>一点小感想</h3><p>之前在Twitter上<a target="_blank" rel="noopener" href="https://twitter.com/BennyThinks/status/1318485657342312448?s=20">发起了一个投票</a>，这个bot究竟应该用什么语言来写呢？</p>
<p>最终大家一致认为应该用Go，结果我却<a target="_blank" rel="noopener" href="https://twitter.com/BennyThinks/status/1319279572622323715?s=20">逆天行事选择了Python</a>。一个比较重要的原因是go似乎没有比较好的twitter api wrapper?</p>
<p><img src="/images/2020102514045470.png"></p>
<p>但是从个人的角度来说，我还是更倾向于静态类型的Go的。动态语言嘛，确实上手快，大部分情况下开发也快，但是有的时候它.不出来啊?它类型七十二变啊?‍♀️</p>
<p>但是静态语言这点就很好了，我可以凭借着想象力就把代码写出来?而且如果做成docker image，来一波multi-stage build那就更刺激了。看，那些image很小的，就是go写的?，有些甚至直接是scratch来的，image里就是一个孤独的二进制文件?</p>
<p><img src="/images/2020102514045587.png"></p>
<h2 id="NCMBot"><a href="#NCMBot" class="headerlink" title="NCMBot"></a>NCMBot</h2><p><a target="_blank" rel="noopener" href="https://t.me/netease_ncm_bot">https://t.me/netease_ncm_bot</a></p>
<p>都知道，网易云音乐很早之前就开始用一种名为NCM格式的DRM文件?一旦你会员过期了，你就听不了了。那怎么行，要转换成flac或者mp3之类的才可以嘛。</p>
<p>不慌，问题不大！给bot发你的ncm就可以了！</p>
<p><img src="/images/2020102514045736.png"></p>
<p>但是有一个小问题哦，Telegram Bot仅支持下载20M、发送50M的文件，所以后续打算找方法绕过去这个限制，?使用client API啦！</p>
<p>哦对了，以后也许会考虑增加QQ音乐的QCM（是这个？）的支持，甚至你发一个YouTube&#x2F;PornHub链接，也会把下载完成的文件发给你?</p>
<p>GitHub: <a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/NCMBot">https://github.com/tgbot-collection/NCMBot</a></p>
<h2 id="ExpressBot"><a href="#ExpressBot" class="headerlink" title="ExpressBot"></a>ExpressBot</h2><p><a target="_blank" rel="noopener" href="https://t.me/bennyblog_bot">https://t.me/bennyblog_bot</a></p>
<p>啊?这个bot就很有历史渊源了。这是我还是实习生的时候开发的用来查快递、聊天的bot，甚至还能查看美剧电影下载地址。</p>
<p>但是后来快递接口炸了，聊天接口也炸了，也没有兴趣维护下去了?‍♀️</p>
<p>所以就给archive了</p>
<p><img src="/images/2020102514045879.jpeg"></p>
<p><img src="/images/2020102514045959.jpeg"></p>
<p>这个bot估计是没什么用了，?希望能够找到接盘侠，只要更新下快递的接口就可以了</p>
<p>GitHub: <a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/ExpressBot">https://github.com/tgbot-collection/ExpressBot</a></p>
<p>介绍：<a target="_blank" rel="noopener" href="https://dmesg.app/expressbot.html">《ExpressBot：一个可以帮你查快递、追踪快递状态、还能陪聊的Telegram bot》</a></p>
<h2 id="YYeTs-Bot"><a href="#YYeTs-Bot" class="headerlink" title="YYeTs Bot"></a>YYeTs Bot</h2><p><a target="_blank" rel="noopener" href="https://t.me/yyets_bot">https://t.me/yyets_bot</a></p>
<p>这个也是一个稍微有些历史的bot，近期重构了一下，选择了模拟登录+爬虫的方式，这样获取到的资源就会更加精准了</p>
<p><img src="/images/2020102514050032.jpeg" alt="人人影视资源搜索机器人"></p>
<p><img src="/images/2020102514050310.png"></p>
<p>GitHub: <a target="_blank" rel="noopener" href="https://github.com/tgbot-collection/YYeTsBot">https://github.com/tgbot-collection/YYeTsBot</a></p>
<p>介绍：<a target="_blank" rel="noopener" href="https://dmesg.app/yyets-bot.html">《人人影视资源搜索机器人》</a></p>
<h2 id="Wayback-Machine-Bot"><a href="#Wayback-Machine-Bot" class="headerlink" title="Wayback Machine Bot"></a>Wayback Machine Bot</h2><p><a target="_blank" rel="noopener" href="https://t.me/wayback_machine_bot">https://t.me/wayback_machine_bot</a></p>
<p>Internet Archive是什么大家都知道吧。平时遇到什么文章，可以随时丢给机器人，机器人就会帮你去存档。反抗审查的一种手段。</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2020/10/2020102722575411.jpeg"><img src="/images/2020102722575411.jpeg"></a></p>
<h2 id><a href="#" class="headerlink" title="??"></a>??</h2><p>好的，那么今天就先分享这些，本王先告辞了！?</p>
<p>[gt href&#x3D;’<a target="_blank" rel="noopener" href="https://github.com/tgbot-collection'/]%E5%BC%80%E6%BA%90%E5%9C%B0%E5%9D%80/[/gt/]">https://github.com/tgbot-collection&#39;\]开源地址\[/gt\]</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/10/25/telegram-bot-collections/index/" data-id="clhp7rtl7009gs2qr97l68sc2" data-title="有趣的Telegram Bot" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-why-grafana-nginx/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/09/17/why-grafana-nginx/index/" class="article-date">
  <time class="dt-published" datetime="2020-09-17T00:00:00.000Z" itemprop="datePublished">2020-09-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/website/">website</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/09/17/why-grafana-nginx/index/">为什么我的grafana无法用nginx反代呢？</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>如果你想用nginx反代grafana，那么很有可能参考了官网文档[Run Grafana behind a reverse proxy](<a target="_blank" rel="noopener" href="https://grafana.com/tutorials/run-grafana-behind-a-proxy/">https://grafana.com/tutorials/run-grafana-behind-a-proxy/</a>“ \l “1)，看了一眼，非常简单，不就是改几个参数，加个location嘛！</p>
<p>“小case”，你对自己说到，十分钟解决。</p>
<p>那么在参考结束之后，你很有可能遇到这个错误。</p>
<p><img src="/images/2020091718212349.png" alt="If you&#39;re seeing this Grafana has failed to load its application files · Issue #24841 · rancher/rancher · GitHub"></p>
<p> </p>
<p>随即你进行了搜索，问题还挺多，中文的英文的，然后自己不停地尝试，grafana和nginx的配置都快改花了，发现还是不行。于是两个小时过去了。这究竟是为什么呢？</p>
<p>作为一名有灵性的工程师，当你看到如图所示的画面时，应该会想到哪些事情呢？</p>
<ol>
<li>这个橙色的文字，绝对不是Nginx的，看起来更像是grafana的，那么也就是说请求转发给了grafana</li>
<li>既然如此，那么看下控制台吧！</li>
</ol>
<p><img src="/images/202009171821245.png"></p>
<p>哟呵，怎么都是404呢，难道是由于一些路径的原因，导致proxy_pass的时候出错了？</p>
<p>于是你又一顿查，<code>proxy_set_header</code>等全都加上了，路径结尾带不带<code>/</code>也都排列组合了一圈，发现还是不行！?</p>
<p>作为一名有灵性的工程师，此时自然就要想，难道是grafana有bug？把<code>router_logging</code>打开……此时你突然看到，这个文件名好奇怪啊，这么长。难道文件真的不存在吗？</p>
<p><img src="/images/2020091718212625.png"></p>
<p>内心无比刺痛，什么？！另一边的你，甚至拿出来了curl</p>
<p>~$ curl -L <a target="_blank" rel="noopener" href="https://dmesg.app/grafana/public/build/app.4141596c10e564d57dfb.js">https://dmesg.app/grafana/public/build/app.4141596c10e564d57dfb.js</a></p>
<html>
<head><title>404 Not Found</title></head>
<body>
<center><h1>404 Not Found</h1></center>
<hr><center>nginx</center>
</body>
</html>

<p>~$ curl -L <a target="_blank" rel="noopener" href="https://dmesg.app/grafana/public/build/1.txt">https://dmesg.app/grafana/public/build/1.txt</a><br>hello!</p>
<p>???</p>
<p>那zip文件呢？</p>
<p>$ curl -L <a target="_blank" rel="noopener" href="https://dmesg.app/grafana/public/build/1.zip">https://dmesg.app/grafana/public/build/1.zip</a><br>a zip(not really)</p>
<p>那js呢？</p>
<p>~$ curl -L <a target="_blank" rel="noopener" href="https://dmesg.app/grafana/public/build/1.js">https://dmesg.app/grafana/public/build/1.js</a></p>
<html>
<head><title>404 Not Found</title></head>
<body>
<center><h1>404 Not Found</h1></center>
<hr><center>nginx</center>
</body>
</html>
~$

<p>????</p>
<p>突然，你看到了一处这样的配置：</p>
<p>location ~ .*\.(js|css|woff)?$ {<br>    expires 30d;<br>}</p>
<p>这段的意思是，正则匹配，结尾是js、css和woff，expire设置成30天。于是你在脑海里迅速过了一遍nginx的location匹配优先级，好像似乎是正则比路径匹配的优先级要高。</p>
<p>于是你以迅雷不及掩耳盗铃之速把原先的配置</p>
<p>location &#x2F;grafana&#x2F; {<br>    proxy_pass <a target="_blank" rel="noopener" href="http://localhost:3000/">http://localhost:3000</a>;<br>}</p>
<p>中的第一个<code>/</code>改成了<code>~</code>，也就是</p>
<p>location ~&#x2F;grafana&#x2F; {<br>    proxy_pass <a target="_blank" rel="noopener" href="http://localhost:3000/">http://localhost:3000</a>;<br>}</p>
<p>然后restart或reload nginx，刷新页面，好了！此刻看看时间，天啊，三个小时过去了，快一点了……</p>
<p>也就是说，一个<code>~</code>价值三小时，如果按照时薪来算，这一笔，很值钱啊！</p>
<h2 id="点评"><a href="#点评" class="headerlink" title="点评"></a>点评</h2><p>其实以上就是我昨晚的完整经过，一开始的时候，大部分时间完全就是在“瞎?找死?”，当然网上提到的方案都是没用的，毕竟没有找到问题的根本原因。所以如果早点通过橙色的字体发现问题出在js 404，那么问题就应该会更快解决了。</p>
<p>哎呀年轻人?‍♀️还是要学会通过现象看本质的，不要瞎猫碰上死耗子呀！</p>
<p><a target="_blank" rel="noopener" href="https://twitter.com/BennyThinks/status/1306272740639350785?s=20">解释一下</a>：如果你的nginx开启了css、js的cache，想在sub directory下反代grafana，那么按照官网的文档去做失败的概率是非常高的。</p>
<p>原因非常简单：js和css都404了。因为正则匹配的优先级高于path匹配，所以全被cache的location截胡了。解决方案也很简单，把grafana那段的<code>/</code>换成<code>~</code>，当然 <code>~/grafana/</code>和<code>~ grafana/</code>都是无所谓的啦，正则嘛！还不放心的话，再放到location开头。</p>
<p>当然了，需要注意的是，不仅仅是子目录时会发生这种情况，子域名时，只要设置了这种cache规则，那么就一定会出错的。</p>
<p>配置cache的人还不少，已经给官方发了PR，希望他们能及早修复吧。</p>
<h2 id="完整配置和解释"><a href="#完整配置和解释" class="headerlink" title="完整配置和解释"></a>完整配置和解释</h2><h3 id="grafana"><a href="#grafana" class="headerlink" title="grafana"></a>grafana</h3><p># 只让grafana监听127，反代没必要监听0.0.0.0<br>http_addr &#x3D;127.0.0.1</p>
<h1 id="域名，都懂"><a href="#域名，都懂" class="headerlink" title="域名，都懂"></a>域名，都懂</h1><p>domain &#x3D; dmesg.app</p>
<h1 id="Grafana内部的一些url（比如警告的url）都是根据这个来的，其实可以看出来这里其实是格式化字符串，domain就是上面的那个"><a href="#Grafana内部的一些url（比如警告的url）都是根据这个来的，其实可以看出来这里其实是格式化字符串，domain就是上面的那个" class="headerlink" title="Grafana内部的一些url（比如警告的url）都是根据这个来的，其实可以看出来这里其实是格式化字符串，domain就是上面的那个"></a>Grafana内部的一些url（比如警告的url）都是根据这个来的，其实可以看出来这里其实是格式化字符串，domain就是上面的那个</h1><p>root_url&#x3D; https:&#x2F;&#x2F;%(domain)s&#x2F;grafana&#x2F;</p>
<h1 id="子目录就要true"><a href="#子目录就要true" class="headerlink" title="子目录就要true"></a>子目录就要true</h1><p>serve_from_sub_path &#x3D; true</p>
<h3 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h3><p># ~表示正则匹配，区分大小写<br>location ~grafana&#x2F; {<br>    proxy_pass <a target="_blank" rel="noopener" href="http://localhost:3000/">http://localhost:3000</a>;<br>}</p>
<p>location ~ .*\.(js|css|woff)?$ {<br>    expires 30d;<br>}</p>
<p>参考资料</p>
<p>Nginx location priority <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/5238377/nginx-location-priority">https://stackoverflow.com/questions/5238377/nginx-location-priority</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/09/17/why-grafana-nginx/index/" data-id="clhp7rtnc00b7s2qr7qf34ow8" data-title="为什么我的grafana无法用nginx反代呢？" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-keepmebot/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/08/27/keepmebot/index/" class="article-date">
  <time class="dt-published" datetime="2020-08-27T00:00:00.000Z" itemprop="datePublished">2020-08-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/program/">program</a>►<a class="article-category-link" href="/categories/program/share/">share</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/08/27/keepmebot/index/">KeepMeBot 保活机器人</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>前段时间，从<a target="_blank" rel="noopener" href="https://t.me/outvivid/2342">Outvivid的频道</a>得知，docker hub宣布他们要准备开始删除长期inactive的镜像了。</p>
<blockquote>
<p>Docker Hub 更新 TOS 及 retention policy。</p>
<p>&gt; If an image has not either been pulled or pushed in the amount of time specified in your subscription plan, the image will be tagged “inactive.” Any images that are tagged as “inactive” will be scheduled for deletion. &gt; Free plans will have a 6 month image retention limit</p>
<p>[暂译] 自 2020 年 11 月 1 日起，Docker Hub 的免费用户镜像将只保留 6 个月。6 个月后，在一定时间内活跃度过低的镜像将被删除。</p>
<p>src: <a target="_blank" rel="noopener" href="https://www.docker.com/legal/docker-terms-service">https://www.docker.com/legal/docker-terms-service</a> src: <a target="_blank" rel="noopener" href="https://www.docker.com/pricing/retentionfaq">https://www.docker.com/pricing/retentionfaq</a></p>
</blockquote>
<p>具体的条款<a target="_blank" rel="noopener" href="https://www.docker.com/pricing/resource-consumption-updates">可以看这里</a></p>
<p>这可给我吓坏了?</p>
<p><img src="/images/2020082716404989.jpeg"></p>
<p>我可以不用，但是你不能没有——雷总听着都无奈啊</p>
<p>本萌新变灵机一动……便注册了KeepMe.Run，然后就有了KeepMeBot，也就是让你的服务一直存活下去的服务，同样还是Telegram Bot</p>
<p>机器人链接：</p>
<p><a target="_blank" rel="noopener" href="https://t.me/KeepMeRunBot">https://t.me/KeepMeRunBot</a></p>
<p>功能很简单，就是……</p>
<p>由于资源有限，目前限制了每个用户、每个服务最高只能添加5个。可喜可贺的是，硬编码限制的哦?</p>
<h2 id="添加服务"><a href="#添加服务" class="headerlink" title="添加服务"></a>添加服务</h2><p><img src="/images/2020082716405291.png"></p>
<h2 id="列出已有服务"><a href="#列出已有服务" class="headerlink" title="列出已有服务"></a>列出已有服务</h2><p><img src="/images/2020082716405589.png"></p>
<h2 id="执行历史记录"><a href="#执行历史记录" class="headerlink" title="执行历史记录"></a>执行历史记录</h2><p>还没有?</p>
<h2 id="部署手册"><a href="#部署手册" class="headerlink" title="部署手册"></a>部署手册</h2><p>当然了，这个机器人是开源的，甚至还有一个docker image?。</p>
<p>运行的话，建议使用docker，毕竟是要执行不知道从哪里来的命令，万一被RCE了那不就惨了</p>
<p>所以其实只要clone这个仓库，然后配置一下，然后<code>docker-compose up -d</code>就可以了</p>
<p>git clone <a target="_blank" rel="noopener" href="https://github.com/BennyThink/KeepMeBot">https://github.com/BennyThink/KeepMeBot</a> &amp;&amp; cd KeepMeBot</p>
<h1 id="你也可以在这里加入其他go原生支持的环境变量，比如http-proxy啥的"><a href="#你也可以在这里加入其他go原生支持的环境变量，比如http-proxy啥的" class="headerlink" title="你也可以在这里加入其他go原生支持的环境变量，比如http_proxy啥的"></a>你也可以在这里加入其他go原生支持的环境变量，比如http_proxy啥的</h1><p>echo TOKEN&#x3D;”12345:ddd”&gt; config.env</p>
<h1 id="创建一个数据库，方便compose做映射。总不能down了之后你的数据都没了吧"><a href="#创建一个数据库，方便compose做映射。总不能down了之后你的数据都没了吧" class="headerlink" title="创建一个数据库，方便compose做映射。总不能down了之后你的数据都没了吧"></a>创建一个数据库，方便compose做映射。总不能down了之后你的数据都没了吧</h1><p>touch keep.db<br>docker-compose up -d</p>
<p>这样就可以了，甚至连systemd之类的都不用搞?不过要记得提前装好docker和docker-compose</p>
<p>胆子大的，直接<code>go run</code>或者<code>go build</code>，需要1.11版本之后的go，如果不是1.14+的话，要记得开启go module的支持哦?</p>
<p>TOKEN&#x3D;123456 go run . # &lt;—这里有个点，绿色的，你看到了吗?</p>
<h2 id="那么问题来了……"><a href="#那么问题来了……" class="headerlink" title="那么问题来了……"></a>那么问题来了……</h2><p>能用Docker Hub的人，难道还不会crontab嘛?且听我慢慢道来后续计划……</p>
<h2 id="后续计划"><a href="#后续计划" class="headerlink" title="后续计划"></a>后续计划</h2><h3 id="网站呢？"><a href="#网站呢？" class="headerlink" title="网站呢？"></a>网站呢？</h3><p>既然有bot，也有域名，那么网站也是必然要有的?必定是很厉害的那种大佬才能够做出来的?‍♂️ @realn0vad3v</p>
<h3 id="更多的服务"><a href="#更多的服务" class="headerlink" title="更多的服务"></a>更多的服务</h3><p>这个bot目前只支持Docker Hub，后续可能还可以添加更多的支持服务?这样就可以让大家在一个平台完成全部的保活服务?甚至还能够使用Telegram Login?</p>
<h3 id="你这辣鸡代码"><a href="#你这辣鸡代码" class="headerlink" title="你这辣鸡代码"></a>你这辣鸡代码</h3><p>啊测试用例也没写，TravisCI也没弄?，代码很辣鸡，一堆功能都没有，还可能会被RCE?one man好难啊?</p>
<p>谁能帮帮我啊???</p>
<h2 id="Docker-Hub也不容易啊"><a href="#Docker-Hub也不容易啊" class="headerlink" title="Docker Hub也不容易啊"></a>Docker Hub也不容易啊</h2><p>As the world’s largest repository of container images, Docker Hub stores more than 15PB of data. Docker’s internal analytics tools have shown that of the 15PB of images stored in Docker Hub, over 10PB of these images have not been accessed for more than 6 months. Digging a little deeper, we found that over 4.5PB of these inactive images are associated with free accounts.</p>
<h2 id="其他事请……"><a href="#其他事请……" class="headerlink" title="其他事请……"></a>其他事请……</h2><p>啊建站5周年了，今年已经写了9篇，?再接再厉啊！</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/08/27/keepmebot/index/" data-id="clhp7rth1004cs2qrdxyfay5z" data-title="KeepMeBot 保活机器人" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/6/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/8/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/azure/">azure</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/china/">china</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/china/justsay/">justsay</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/cloudflare/">cloudflare</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/gfw/">gfw</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/">it</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/it/justsay/">justsay</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/security/">security</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/share/">share</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/">justsay</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/gfw/">gfw</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/linux/security/">security</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/website/">website</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/program/">program</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/program/share/">share</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/security/">security</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/security/justsay/">justsay</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/security/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/share/">share</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/website/">website</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/website/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/what/">what</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/what/gfw/">gfw</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/ubuntu/" style="font-size: 10px;">ubuntu</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">September 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">August 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">July 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">April 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">March 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">February 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/09/28/worker-image-metadata/index/">使用 Cloudflare Worker获取图片元数据</a>
          </li>
        
          <li>
            <a href="/2024/09/27/workers-function/index/">将 Cloudflare Workers 迁移到 Azure Function</a>
          </li>
        
          <li>
            <a href="/2024/09/21/one-api-clickhouse/index/">one-api/new-api性能优化：使用 ClickHouse 作为日志系统</a>
          </li>
        
          <li>
            <a href="/2024/08/03/stripe-fraud/index/">Stripe 如何安全收款并避免盗刷与测卡</a>
          </li>
        
          <li>
            <a href="/2024/07/27/hide-in-cf/index/">隐藏于 Cloudflare 的全球网络之中</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 Benny小土豆<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>