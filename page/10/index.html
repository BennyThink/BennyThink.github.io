<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>土豆不好吃</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="土豆不好吃">
<meta property="og:url" content="http://example.com/page/10/index.html">
<meta property="og:site_name" content="土豆不好吃">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Benny小土豆">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="土豆不好吃" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">土豆不好吃</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-rhce-value/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/06/20/rhce-value/index/" class="article-date">
  <time class="dt-published" datetime="2019-06-20T00:00:00.000Z" itemprop="datePublished">2019-06-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/justsay/">justsay</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/06/20/rhce-value/index/">RHCE证书含金量高吗</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>小葵花妈妈课堂开课啦！</p>
<p>经过一小段时间的艰苦奋斗，俺终于拿下了RHCE&amp;RHCSA认证。那么，这东西有什么用呢？</p>
<p><img src="/images/2019062013564551.jpeg"></p>
<h2 id="太长不看版"><a href="#太长不看版" class="headerlink" title="太长不看版"></a>太长不看版</h2><p>含金量没有想象中的那么高，是一块敲门砖，写在简历上会比较出彩，能够证明在考试这段时间比较努力。其余的估计没有什么了。</p>
<p>Okay, let’s track this from the beginning</p>
<h2 id="RHCSA-amp-RHCE课程"><a href="#RHCSA-amp-RHCE课程" class="headerlink" title="RHCSA&amp;RHCE课程"></a>RHCSA&amp;RHCE课程</h2><p>首先，红帽认证是不接受个人考试报名的，所以一般要考的话都要找培训机构报名。</p>
<p>按照我这里的安排，RHCSA上了6天，RHCE上了8天，考试前有考前辅导。</p>
<p>(′д｀ )…彡…彡 不过，俺比较喜欢逃课，所以这14天的课估计也就上了5天吧。</p>
<p>至于RHCSA&amp;RHCE培训+报名一共需要多少钱，这俺就不清楚了……</p>
<h2 id="考试题目"><a href="#考试题目" class="headerlink" title="考试题目"></a>考试题目</h2><p>基本上网上一搜，能看到的题目都差不多是真题。考试满分300，拿到210（70%）就算通过。</p>
<p>RHCSA涉及到配置用户账户、配置文件目录权限、LDAP、逻辑卷、Autofs等非常基础的内容；</p>
<p>RHCE主要就是各种服务的配置，包括NFS、Samba、Apache、MariaDB、iSCSI，以及链路聚合、端口转发什么的。</p>
<p>总体考试难度不大，考前稍微认真的多练习练习，高分通过还是可以保证的，零基础都能通过的那种哦。作为多年Linux老司机的我，自然是驾轻就熟了ε&#x3D;ε&#x3D;ε&#x3D;┏(゜ロ゜;)┛</p>
<p>我相信在座的各位，稍微准备一下，应该问题不大。</p>
<h2 id="证书的含金量"><a href="#证书的含金量" class="headerlink" title="证书的含金量"></a>证书的含金量</h2><p>可能由于博主比较年轻（因此还是萌新），据称早期RHCE证书的含金量还是比较高的。但是就现在这个情况来说，我感觉RHCE证书的含金量不算太高。</p>
<p>实际上，在RHCE&amp;RHCSA考试中遇到的内容都是比较局限的。由于应试的因素，考前往往是有题库的，题库是基本固定不变的，因此解决方案也是固定的，这也就导致造成了考前只需要努力按照题库练习，考试就基本会通过的局面。</p>
<p>而在真正应用Linux时，所遇到的问题往往是花样比较多，而且没有固定套路的。举个例子，通过了RHCE认证的你，如果遇到下列问题，会怎样解决呢？</p>
<ul>
<li>在物理机上安装某个发行版</li>
<li>在物理机上安装Windows+Linux双系统，甚至是三系统</li>
<li>查看当前的出网、入网速度</li>
<li>查看每日、每周的网卡流量信息</li>
<li>查看本机的硬件信息，如CPU、RAM、硬盘等</li>
<li>grub rescue修复，修改grub配置</li>
<li>性能优化，内核参数微调</li>
<li>持久运行一个程序（关了终端不会退出）</li>
<li>搭建一个网站，申请SSL证书……</li>
<li>配置一个用户，只可以用过密钥登录，可以sudo</li>
<li>配置目录与文件权限</li>
<li>备份数据到其他服务器，备份到Google Drive，S3等</li>
<li>扫描一下指定网段有哪些存活的主机</li>
<li>判断某服务器是否可达</li>
<li>搭个代理，包括OpenVPN，L2TP，Shadowsocks等</li>
<li>SSH打洞做跳板</li>
<li>安装Google Chrome</li>
<li>安装或配置中文输入法</li>
<li>根据PID得知这个进程所对应的文件的路径、进程所访问的文件</li>
<li>配置EPEL源</li>
<li>command systemctl not found，怎么管理各种服务</li>
<li>想换个shell，怎么换</li>
</ul>
<h2 id="考试与实际的差别"><a href="#考试与实际的差别" class="headerlink" title="考试与实际的差别"></a>考试与实际的差别</h2><p>在RCHSA的试题中，有一道题大概是这样的：</p>
<p>一个名为 sysadms 的组</p>
<p>一个名为 natasha 的用户，其属于 sysadms ，这个组是该用户的从属组</p>
<p>一个名为 harry 的用户，属于 sysadms ，这个组是该用户的从属组</p>
<p>一个名为 sarah 的用户，其在系统中没有可交互的 shell，并且该用户不是 sysadms 组的成员</p>
<p>大家都知道，这基本上就是送分题</p>
<p>groupadd sysadms<br>useradd natasha –G sysadms</p>
<p>基本上这样就够了。但是在实际中，组与用户的关系，如何巧妙的利用文件和目录的组权限，估计很大程度上都会一脸茫然了吧？毕竟对于考试来说，只需要根据题库练习好了，基本上就是依样画葫芦。至于为什么要这样做，往往是不明不白的。</p>
<p>再看RHCE的一道题，配置SSH访问。也是接近送分题。</p>
<p>很幸运的是，考试时使用的RHEL是默认开启sshd服务的。但是有些情况下（比如桌面版，嵌入式版），那么默认可能是没装ssh服务的。怎么装怎么启动？sshd和ssh有什么区别？</p>
<p>再比如，Linux发行版众多，每个发行版之间可能会有比较大的差距。比如最重要的包管理器，Debian系的dpkg&#x2F;apt和RHEL系的rpm&#x2F;yum；RHEL系一般会带SELinux，但Debian系往往默认都不带SELinux；RHEL系一般使用firewalld，而Debian系使用ufw。</p>
<p>如果只是专注于考试的话，那么会不会出现换个发行版就不会用了的情况呢？</p>
<h2 id="评分脚本"><a href="#评分脚本" class="headerlink" title="评分脚本"></a>评分脚本</h2><p>像红帽这种纯操作的考试，实际上还有一个很严肃的问题就是如何进行评分？毫无疑问的是RedHat肯定是使用了脚本去搜集、评分，但是脚本究竟是如何处理的那估计就是商业机密了——是只看过程，还是只看结果，还是二者都看？对于同一个问题，如禁止某个域访问，往往有很多解决方式，究竟该如何验证才能保证不错判也不漏判呢？</p>
<h2 id="RHCE证书有用吗"><a href="#RHCE证书有用吗" class="headerlink" title="RHCE证书有用吗"></a>RHCE证书有用吗</h2><p>从求职面试的角度来看，简历上如果有证书认证，是比较能抓人眼球的，可以认为是敲门砖；但是实际应用时，考试中的那些操作往往都是无法应用的。当然了，如果面试的是运维、运维开发相关的岗位，那么红帽认证的重要性会提高一点。</p>
<p>即考下来了RHCE，但是在实际生活与工作中却并没有应用，那么实际上这个证书就无法证明任何价值，分分钟被问懵，考下来RHCE并不证明你具备实践能力，</p>
<p>就好比一年前我考的CCNA一样，你现在问我生成树协议的具体原理、OSPF的原理，我都说不明白呢。</p>
<p>对于在职的运维工程师来说，除了可能涨工资评职称之外，对于技术水平的提高几乎没有什么用处；对于有意转运维相关的岗位，写在简历上还是能有点高亮的。</p>
<p>与语言等级考试（四六级、日语二级等）不同的是，语言等级考试往往需要比较长时间的准备，即使是在应试体制下，也或多或少会沉淀出一点真才实学。</p>
<p>对于我来说，没啥用，但是你懂的，除了在简历中写上通过了RHCE考试，让面试官眼前一亮（仅限三年）</p>
<h2 id="Linux究竟该怎么学"><a href="#Linux究竟该怎么学" class="headerlink" title="Linux究竟该怎么学"></a>Linux究竟该怎么学</h2><p>Linux就该这么学</p>
<p>以我个人的经验来说说，最适合初学者的书籍一定是鸟哥的《鸟哥的Linux私房菜》之《基础学习篇》+《服务器架设篇》，书有点厚，现在应该是出到了第四版。鸟哥的风格比较幽默，很容易理解各种基础概念。</p>
<p>另外有一本《Linux命令行与shell脚本编程大全》也是非常不错的学习资料。</p>
<p>至于选择什么发行版，萝卜青菜各有所爱嘛。万一不喜欢，也可以这样：</p>
<p><img src="/images/2019062013564998.png"></p>
<p>来源 <a target="_blank" rel="noopener" href="https://twitter.com/crsm855/status/1139791312843001857?s=19">crsm855</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/06/20/rhce-value/index/" data-id="clhp7rtik007ns2qre6mgh9l3" data-title="RHCE证书含金量高吗" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-git-pi/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/04/27/git-pi/index/" class="article-date">
  <time class="dt-published" datetime="2019-04-27T00:00:00.000Z" itemprop="datePublished">2019-04-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/website/">website</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/04/27/git-pi/index/">在树莓派上搭建一个git服务器</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>树莓派虽说小，但是性能……也差啊！</p>
<p>开源的git实现有很多，gitlab community算是一种，但是对硬件要求有点高，这里我使用了<a target="_blank" rel="noopener" href="https://nova.moe/">nova</a>推荐的<a target="_blank" rel="noopener" href="https://gogs.io/">g</a><a target="_blank" rel="noopener" href="https://gogs.io/">ogs</a>，gogs是用golang写的，足够轻量级，足够让我瞎玩……</p>
<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><p>一只不可以吃的树莓派</p>
<p>数据库：MySQL&gt;&#x3D;5.7，PosgreSQL、MSSQL、TiDB</p>
<p>由于我选择了MySQL，而Raspbian的源里似乎只有5.5的，所以只能自己编译一个5.7的啦……耗时N小时……当然啦有预编译好的deb，当然啦非得用5.5也是没关系的！</p>
<h2 id="下载配置gogs"><a href="#下载配置gogs" class="headerlink" title="下载配置gogs"></a>下载配置gogs</h2><p># 创建一个git用户，专门用于运行该服务<br>useradd git -s &#x2F;bin&#x2F;bash -m -d &#x2F;home&#x2F;GitServer</p>
<h1 id="为了方便管理，切换到该目录"><a href="#为了方便管理，切换到该目录" class="headerlink" title="为了方便管理，切换到该目录"></a>为了方便管理，切换到该目录</h1><p>cd &#x2F;home&#x2F;GitServer</p>
<h1 id="切换到该用户"><a href="#切换到该用户" class="headerlink" title="切换到该用户"></a>切换到该用户</h1><p>su git</p>
<h1 id="下载二进制并解压缩"><a href="#下载二进制并解压缩" class="headerlink" title="下载二进制并解压缩"></a>下载二进制并解压缩</h1><p>wget –c <a target="_blank" rel="noopener" href="https://dl.gogs.io/0.11.86/gogs/_0.11.86/_raspi2/_armv6.zip">https://dl.gogs.io/0.11.86/gogs\_0.11.86\_raspi2\_armv6.zip</a><br>unzip gogs_0.11.86_raspi2_armv6.zip<br>cd gogs</p>
<h1 id="运行服务"><a href="#运行服务" class="headerlink" title="运行服务"></a>运行服务</h1><p>.&#x2F;gogs web</p>
<p>打开浏览器，http:&#x2F;&#x2F;树莓派IP:3000，会进入如下页面</p>
<p><img src="/images/2019042713050674.png"></p>
<p>此时如果你使用的是MySQL5.7以下版本，创建一个字符集是utf-8的数据库</p>
<p>CREATE DATABASE gogs DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci</p>
<p>5.7及以上直接创建就好了</p>
<p>其中域名和应用url两项需要填写你的域名（或者是树莓派IP）</p>
<p><img src="/images/2019042713050763.png"></p>
<p>之后第一个注册的用户会是管理员用户。管你是screen还是nohup还是supervisor的。</p>
<h2 id="监听本机"><a href="#监听本机" class="headerlink" title="监听本机"></a>监听本机</h2><p>vim &#x2F;home&#x2F;GitServer&#x2F;gogs&#x2F;custom&#x2F;conf&#x2F;app.ini</p>
<p>在<code>HTTP_PORT</code>下添加一行</p>
<p>HTTP_ADDR&#x3D;127.0.0.1</p>
<h2 id="Nginx-反代配置"><a href="#Nginx-反代配置" class="headerlink" title="Nginx 反代配置"></a>Nginx 反代配置</h2><p>对应的server段添加如下信息就可以了</p>
<p>location &#x2F; {<br>proxy_pass <a target="_blank" rel="noopener" href="http://127.0.0.1:3000/">http://127.0.0.1:3000</a>; # 对应服务<br>}</p>
<p>完整配置文件<a target="_blank" rel="noopener" href="https://github.com/BennyThink/tools/blob/master/TLS/gitconfig.nginx">戳这里</a></p>
<h2 id="systemd配置"><a href="#systemd配置" class="headerlink" title="systemd配置"></a>systemd配置</h2><p>接上，我们需要更改git用户的shell</p>
<p>usermod git -s &#x2F;usr&#x2F;sbin&#x2F;nologin</p>
<p>之后交给systemd启动就好了</p>
<p>[Unit]<br>Description&#x3D;Benny’s Personal Git Server<br>After&#x3D;syslog.target<br>After&#x3D;network.target</p>
<p>[Service]<br>Type&#x3D;simple<br>User&#x3D;git<br>Group&#x3D;git<br>WorkingDirectory&#x3D;&#x2F;home&#x2F;benny&#x2F;GitServer&#x2F;gogs<br>ExecStart&#x3D;&#x2F;home&#x2F;benny&#x2F;GitServer&#x2F;gogs&#x2F;gogs web<br>Restart&#x3D;on-failure<br>Environment&#x3D;USER&#x3D;git HOME&#x3D;&#x2F;home&#x2F;benny&#x2F;GitServer</p>
<p>ProtectSystem&#x3D;full<br>PrivateDevices&#x3D;yes<br>PrivateTmp&#x3D;yes<br>NoNewPrivileges&#x3D;true</p>
<p>[Install]<br>WantedBy&#x3D;multi-user.target</p>
<p><img src="/images/2019042713050811.png"></p>
<p>Yeah~~</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://github.com/gogs/gogs/blob/master/scripts/systemd/gogs.service">https://github.com/gogs/gogs/blob/master/scripts/systemd/gogs.service</a></p>
<p><a target="_blank" rel="noopener" href="https://gogs.io/docs/intro/faqs">https://gogs.io/docs/intro/faqs</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/04/27/git-pi/index/" data-id="clhp7rtgd0034s2qr02dgahza" data-title="在树莓派上搭建一个git服务器" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-list-dict-performance/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/04/13/list-dict-performance/index/" class="article-date">
  <time class="dt-published" datetime="2019-04-13T00:00:00.000Z" itemprop="datePublished">2019-04-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/program/">program</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/04/13/list-dict-performance/index/">列表与字典的查找、Cython在Windows下的使用</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>昨天在工作时遇到一个小问题，同事的某API返回太慢了，我帮他优化下。简单的探究了下需求，发现了一点得优化的地方。</p>
<h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>需求很简单，就是对数据结构进行初步的整理。a.json内容大致如下：</p>
<p><img src="/images/2019041306310451.png"></p>
<p>b.json内容大致如下（大概16M的一个大文件）：</p>
<p><img src="/images/2019041306310575.png"></p>
<p>想要的结果如下：</p>
<p><img src="/images/2019041306310511.png"></p>
<p>就是把sent_id和received_id的值去b.json里查找对应的itemid，然后在原始的a.json的结构中增加一项data列，记录b中的值。</p>
<p>在开始鼓捣之前，我们需要先了解下，在Python中，列表是一种非常重要的数据结构，特性有点像数据结构中的链表。列表结构简单，容易扩展，但是却有一个比较致命的弱点——查找元素比较慢。完全就是看命的操作，查找的元素是第一个还好，万一是最后一个，那就要全部遍历完才知道是否有对应的元素。</p>
<p>还有另外一种同样重要的数据结构，被称作字典。字典的特点就是查找很快，很快很快的那种。</p>
<h2 id="原始实现"><a href="#原始实现" class="headerlink" title="原始实现"></a>原始实现</h2><p>实现起来其实很容易，就是循环判断嘛，按照常规的思路，可能会这样实现：</p>
<p>for item_dict in a_list:<br>    re_data &#x3D; []<br>    se_data &#x3D; []<br>    for value_dict in b_list:<br>        if item_dict.get(‘received_id’) &#x3D;&#x3D; value_dict[‘itemid’]:<br>            re_data.append(value_dict)<br>        elif item_dict.get(‘sent_id’) &#x3D;&#x3D; value_dict[‘itemid’]:<br>            se_data.append(value_dict)</p>
<h2 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h2><p>老夫掐指一算，看出来几个这段代码中制约性能的因素：</p>
<ol>
<li>双循环增加时间复杂度</li>
<li>b_list非常大，查找它恐怕不会是比较理想的解决方案。再加上它外面还有个循环，简直就是雪上加霜了</li>
</ol>
<p>由于b.json是个大列表，列表里还有字典，因此不仅导致多了一层循环，还增大了列表不适合查找的特性。因此正确的解决思路是，将b.json的格式转换成字典，key对应item_id，值是一个列表，列表中的每个元素为字典。</p>
<p>由于我们并不预先知道字典的key是什么，因此只能动态的创建字典，使得它的值为空列表，然后追加数据。</p>
<p>完成这个操作大概有三个方法：</p>
<h3 id="方法1：跑两个循环"><a href="#方法1：跑两个循环" class="headerlink" title="方法1：跑两个循环"></a>方法1：跑两个循环</h3><p>result &#x3D; {}<br>for item in item_list:<br>    result[item[‘itemid’]] &#x3D; []<br>for item in item_list:<br>    result[item[‘itemid’]].append(item)</p>
<p>思路很简单，时间复杂度也是线性的，可以接受</p>
<h3 id="方法2：使用defaultDict"><a href="#方法2：使用defaultDict" class="headerlink" title="方法2：使用defaultDict"></a>方法2：使用defaultDict</h3><p>我们使用defaultDict定义字典，这样当访问不存在的key时返回列表，直接append就可以了。当然了要从collections里import这个好东西</p>
<p>from collections import defaultdict</p>
<p>d &#x3D; defaultdict(list)<br>for item in item_list:<br>    d[item[‘itemid’]].append(item)</p>
<h3 id="方法3：利用setdefault"><a href="#方法3：利用setdefault" class="headerlink" title="方法3：利用setdefault"></a>方法3：利用setdefault</h3><p>利用字典的setdefault方法，如果key不存在，我们可以让他返回个空列表，然后append呗~</p>
<p>result &#x3D; {}<br>for item in item_list:<br>    result.setdefault(item[‘itemid’], []).append(item)</p>
<p>这三者性能上，肯定是方法1稍微差一点啦，至于2和3，2比3稍好一点的。</p>
<p>这样的字典创造出来之后，后面的事情就很好处理了</p>
<p>for item in a_list:<br>    item.setdefault(“data”, []).extend(d.get(item.get(‘received_id’), []))<br>    item.setdefault(“data”, []).extend(d.get(item.get(‘sent_id’), []))</p>
<p>由于a.json的数据不纯，有些元素没有received_id，因此只能用get方法了。要不用[]直接取数据速度应该会再快点的。</p>
<p>优化结构之前：</p>
<p><img src="/images/2019041306310625-1.png"></p>
<p>优化之后：</p>
<p><img src="/images/2019041306310781.png"></p>
<p>大概提升了30倍吧。</p>
<h2 id="还需要更快？"><a href="#还需要更快？" class="headerlink" title="还需要更快？"></a>还需要更快？</h2><p>这个时候除了换个解释器（如PyPy），提升配置，其实还有一个办法！那就是Cython。如果你用的是Anaconda或者是Linux，那就好办多了，那可真是太幸福了。但是Windows……</p>
<h3 id="安装编译环境"><a href="#安装编译环境" class="headerlink" title="安装编译环境"></a>安装编译环境</h3><p>要么就用mingw，要么就用visual c++ build tools，以后者为例……</p>
<p>根据你的Python 版本选择不同的build tools版本，</p>
<p>Python 3.6 对应 VS2015</p>
<p>Python 3.7 对应 VS2017</p>
<p>我就直接安装Visual Studio Build Tools 2017</p>
<p>安装时选择如下组件就可以了</p>
<ol>
<li>Visual C++ Build tools core features.</li>
<li>VC++ 2017 v141 toolset (x86,x64)</li>
<li>Visual C++ 2017 Redistributable Update</li>
<li>Windows 10 SDK (10.0.16299.0) for Desktop C++</li>
</ol>
<p><img src="/images/2019041306310851.png"></p>
<h3 id="安装Cython"><a href="#安装Cython" class="headerlink" title="安装Cython"></a>安装Cython</h3><p><code>pip install cython</code></p>
<p>然后新建一个pyx文件，写代码……</p>
<p>再新建一个setup.py</p>
<p>from distutils.core import setup<br>from Cython.Build import cythonize<br>setup(<br>name&#x3D;’Hello pyx’,<br>ext_modules&#x3D;cythonize(‘hello.pyx’)<br>)</p>
<p>然后运行 <code>python setup.py build</code></p>
<p>之后把build&#x2F;lib下的那个pyd（Linux为so）拷贝走，就可以import了……</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://matthew-brett.github.io/pydagogue/python_msvc.html">https://matthew-brett.github.io/pydagogue/python_msvc.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/freeweb/p/6548208.html">https://www.cnblogs.com/freeweb/p/6548208.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/04/13/list-dict-performance/index/" data-id="clhp7rthh004qs2qr5e3ve4ty" data-title="列表与字典的查找、Cython在Windows下的使用" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-pixel3/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/03/03/pixel3/index/" class="article-date">
  <time class="dt-published" datetime="2019-03-03T00:00:00.000Z" itemprop="datePublished">2019-03-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/share/">share</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/03/03/pixel3/index/">Google Pixel3 体验报告</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p> </p>
<p>几天前的周三下单了一台Pixel 3，昨天终于收到了，简单的说下个人的使用体验。</p>
<h2 id="拆箱"><a href="#拆箱" class="headerlink" title="拆箱"></a>拆箱</h2><p>  <img src="/images/20190303053424100.jpeg"> <img src="/images/2019030305342716.jpeg"> <img src="/images/2019030305342956.jpeg"></p>
<p>非常粉又怎么样！</p>
<p>美国人民很幸福啊，只要$599！</p>
<h2 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h2><p>Google Photos赠送原生画质无限存储空间，2022年1月31日结束</p>
<p>Android 9.0 很新颖，有些新功能很实用</p>
<p>GBoard的语音输入准确度很高，英文和中文都能够识别</p>
<p>手机屏幕朝下即进入勿扰模式</p>
<p>捏手机进入个啥模式来着？</p>
<p>手指滑动指纹识别查看通知（我手小，滑不动）</p>
<p>据说相机很好，然而处女拍还没被我霍霍呢。</p>
<p>后盖手感不错</p>
<p>支持无线充电，不过貌似只有Pixel Stand充电速度才比较快？</p>
<p>Android Message可以在电脑上发短信，我感受到了话费的流逝</p>
<p>屏占比蛮高的，5.5寸的屏幕，手机整体比我原来的<a target="_blank" rel="noopener" href="https://www.htc.com/cn/smartphones/htc-one-a9/">htc A9w</a>还小</p>
<p>原生有密码填充了，用上LastPass之后体验和iOS非常接近了</p>
<p>emoji很多，最新的都能看见，妈妈再也不怕看到××了。</p>
<h2 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h2><p>没有呼吸灯，好不适应，我之前用的四个手机都是带呼吸灯的。不过似乎Always on display能一定程度上替代……但是费电啊。</p>
<p>后置指纹有点不适应，按不准，从兜里拿出来经常分不清上下</p>
<p>有时可能有bug，比如Play Store不下载，重启就好了</p>
<p>暂不支持中国移动的VoLTE，也就是说接电话的时候会断网，据说这个要中国移动去提交才可以，或者root了自己改</p>
<h2 id="一些疑问和其他事情"><a href="#一些疑问和其他事情" class="headerlink" title="一些疑问和其他事情"></a>一些疑问和其他事情</h2><p>用原装的充电器充电有时就很慢，只好用上了X1C的电源适配器</p>
<p>一晚上LastPass竟然吃了接近50%的电，这是为什么？就这一次，之后发现都好了。</p>
<p>关于续航，充满电我到家还有60%，平时上班大概就是刷个推听个歌聊天，还是不错的。</p>
<p>由于你懂的原因，连上WiFi会提示你没有网络，所以需要adb来这么一波</p>
<p>adb shell settings put global captive_portal_https_url <a target="_blank" rel="noopener" href="https://www.google.cn/generate/_204">https://www.google.cn/generate\_204</a></p>
<p>连上WiFi了，手机信号也带x，开流量才会消失，这……</p>
<p>这耳机我带起来怎么那么不适应呢，是我耳朵眼太小了吗？<strong>卖了卖了，有想要的联系我！</strong></p>
<p>Design by Google. Assemble in China?</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>可以可以，用个三年试试，下部手机准备买Pixel 7</p>
<p><img src="/images/2019030305343146.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/03/03/pixel3/index/" data-id="clhp7rti1006js2qrdym8em0v" data-title="Google Pixel3 体验报告" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-cloudlare-real-ip/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/02/03/cloudlare-real-ip/index/" class="article-date">
  <time class="dt-published" datetime="2019-02-03T00:00:00.000Z" itemprop="datePublished">2019-02-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/cloudflare/">cloudflare</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/02/03/cloudlare-real-ip/index/">使用Cloudflare时如何获取访客的真实IP？</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>前段时间搭建了一个<a target="_blank" rel="noopener" href="https://gakki.photos/">图床站</a>，然后很自然的套上了一层Cloudflare。但是几天前突然发现大量垃圾评论，想要有针对性的处理一下。于是问题来了，获取不到访客的真实IP，只能看到Cloudflare的IP，想要对IP进行封杀似乎有些问题。</p>
<p>经过十分钟的探索，我总结出来以下几种办法</p>
<h2 id="通过X-Forwarded-For-或-CF-Connecting-IP-标头"><a href="#通过X-Forwarded-For-或-CF-Connecting-IP-标头" class="headerlink" title="通过X-Forwarded-For 或 CF-Connecting-IP 标头"></a>通过X-Forwarded-For 或 CF-Connecting-IP 标头</h2><p>Cloudflare会按照行业标准把访问者的真实IP包含在这两个访问头中。那么我们就可以通过提取这个内容来获取到真实IP，不过这个头是<strong>可以伪造的</strong>，所以实际上还需要进行进一步的处理。</p>
<p>用PHP的话，以下两者之一就可以获取到真实IP：</p>
<p>$_SERVER[“HTTP_CF_CONNECTING_IP”]<br>$_SERVER[“HTTP_X_FORWARDED_FOR”]</p>
<p>简单的判断一下是这样的：</p>
<p>user_ip &#x3D; (isset($_SERVER[“HTTP_CF_CONNECTING_IP”])$_SERVER[“HTTP_CF_CONNECTING_IP”]:$_SERVER[‘REMOTE_ADDR’]);</p>
<p>但是这样其实有些不方便，需要我们手动改代码，在使用某些开源程序时对应的位置可能不太好找。</p>
<p>多说一句：</p>
<p>有些时候我们的应用可能是由Nginx反代的，这个时候Nginx会记录访客的IP，但是我们的应用记录的只可能是127.0.0.1，这个时候应用想获取到真实IP该怎么办呢？Nginx中可以这样配置：</p>
<p>proxy_set_header X-Real-IP $remote_addr;<br>proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</p>
<p>我们用<code>x-real-ip</code>就能拿到用户的IP啦，<code>x-forwarded-for</code>能看到每层连接的IP（自然也包括真实IP了）</p>
<h2 id="使用一些插件"><a href="#使用一些插件" class="headerlink" title="使用一些插件"></a>使用一些插件</h2><p>对于类似WordPress这类成熟的CMS，有些插件可以提供类似的功能，比如说<a target="_blank" rel="noopener" href="https://wordpress.org/plugins/real-ip-and-geo-for-cloudflare/">https://wordpress.org/plugins/real-ip-and-geo-for-cloudflare/</a></p>
<p>这个可以搜索下看看，同样也需要注意，headers是可以被伪造的</p>
<h2 id="通过Nginx-http-realip-module"><a href="#通过Nginx-http-realip-module" class="headerlink" title="通过Nginx http_realip_module"></a>通过Nginx http_realip_module</h2><p>gx_http_realip_module默认是不被编译的，所以我们需要重新编译Nginx。</p>
<p>参考这篇<a target="_blank" rel="noopener" href="https://dmesg.app/tls1_3.html">《为 Nginx 开启 tls 1.3 支持，顺便编译 openssl1.1.1a》</a>，编译参数增加一个<code>--with-http_realip_module</code></p>
<p>之后创建一个配置文件<code>cloudflare.conf</code>，IP地址来源于Cloudflare官网</p>
<p>set_real_ip_from 103.21.244.0&#x2F;22;<br>set_real_ip_from 103.22.200.0&#x2F;22;<br>set_real_ip_from 103.31.4.0&#x2F;22;<br>set_real_ip_from 104.16.0.0&#x2F;12;<br>set_real_ip_from 108.162.192.0&#x2F;18;<br>set_real_ip_from 131.0.72.0&#x2F;22;<br>set_real_ip_from 141.101.64.0&#x2F;18;<br>set_real_ip_from 162.158.0.0&#x2F;15;<br>set_real_ip_from 172.64.0.0&#x2F;13;<br>set_real_ip_from 173.245.48.0&#x2F;20;<br>set_real_ip_from 188.114.96.0&#x2F;20;<br>set_real_ip_from 190.93.240.0&#x2F;20;<br>set_real_ip_from 197.234.240.0&#x2F;22;<br>set_real_ip_from 198.41.128.0&#x2F;17;<br>set_real_ip_from 2400:cb00::&#x2F;32;<br>set_real_ip_from 2405:b500::&#x2F;32;<br>set_real_ip_from 2606:4700::&#x2F;32;<br>set_real_ip_from 2803:f800::&#x2F;32;<br>set_real_ip_from 2c0f:f248::&#x2F;32;<br>set_real_ip_from 2a06:98c0::&#x2F;29;</p>
<h1 id="use-any-of-the-following-two"><a href="#use-any-of-the-following-two" class="headerlink" title="use any of the following two"></a>use any of the following two</h1><p>real_ip_header CF-Connecting-IP;<br>#real_ip_header X-Forwarded-For;</p>
<p>然后在对应站点的配置文件中，或者是<code>nginx.conf</code>中添加一行<code>include cloudflare.conf;</code>即可。</p>
<p>这样Web应用就会获取到正确的IP了，日志里的记录也是正确的IP</p>
<p><img src="/images/2019020303365555.png"></p>
<p>这样看谁不爽就添加到黑名单好了。</p>
<h2 id="如何伪造X-Forwarded-For等请求头"><a href="#如何伪造X-Forwarded-For等请求头" class="headerlink" title="如何伪造X-Forwarded-For等请求头"></a>如何伪造X-Forwarded-For等请求头</h2><p>用curl的话可以这样：</p>
<p>curl <a href="http://example.com/">http://example.com</a> -H ‘X-Forwarded-For: 1.1.1.1’ -H ‘X-Real-IP: 2.2.2.2’</p>
<p>或者Postman中设置Headers也一样。</p>
<p>需要注意的是：</p>
<ol>
<li>如果由Nginx直连的应用，那么<code>REMOTE_ADDR</code>一定是真实IP，要不怎么进行TCP握手呢</li>
<li>如果由Nginx反代，那么需要我们配置合理的<code>proxy_set_header</code>设置请求头，此时<code>REMOTE_ADDR</code>会变成Nginx所属的那台服务器的IP</li>
<li>由于请求头是可以伪造的、不可控的，所以用<code>X-Forwarded-For</code>时总得校验下是不是IP吧，要不可能会出现注入，跨站等安全风险。</li>
</ol>
<p>参考资料</p>
<p><a target="_blank" rel="noopener" href="https://support.cloudflare.com/hc/zh-cn/articles/200170706-%E4%BD%BF%E7%94%A8-Nginx-%E6%97%B6%E5%A6%82%E4%BD%95%E6%81%A2%E5%A4%8D%E5%8E%9F%E5%A7%8B%E8%AE%BF%E9%97%AE%E8%80%85%E7%9A%84-IP-">https://support.cloudflare.com/hc/zh-cn/articles/200170706-%E4%BD%BF%E7%94%A8-Nginx-%E6%97%B6%E5%A6%82%E4%BD%95%E6%81%A2%E5%A4%8D%E5%8E%9F%E5%A7%8B%E8%AE%BF%E9%97%AE%E8%80%85%E7%9A%84-IP-</a></p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/14985518/cloudflare-and-logging-visitor-ip-addresses-via-in-php">https://stackoverflow.com/questions/14985518/cloudflare-and-logging-visitor-ip-addresses-via-in-php</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/02/03/cloudlare-real-ip/index/" data-id="clhp7rtev0016s2qr6zrr2w6n" data-title="使用Cloudflare时如何获取访客的真实IP？" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-cmcc-ipv6/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/01/04/cmcc-ipv6/index/" class="article-date">
  <time class="dt-published" datetime="2019-01-04T00:00:00.000Z" itemprop="datePublished">2019-01-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/it/">it</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/01/04/cmcc-ipv6/index/">中国移动IPv6使用体验报告</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>经过N多年的期待，终于等到了IPv6，本文就来简单的介绍下中国移动的IPv6体验。当然辣，要先说说IPv6怎么配置。</p>
<p>假定你是三大运营商的固网宽带，那么ISP很有可能已经提供了IPv6了。我目前使用的是FTTH，所以实际上是有一个移动光猫的。</p>
<p>就如把大象放到冰箱里，想要使用IPv6我们也要经过如下几步：确保软硬件支持IPv6，破解光猫，配置光猫或者路由器，测试和验证。</p>
<h2 id="确保软硬件支持IPv6"><a href="#确保软硬件支持IPv6" class="headerlink" title="确保软硬件支持IPv6"></a>确保软硬件支持IPv6</h2><p>我想只要你的设备不是太老，那么基本上对于IPv6的支持都是没太大的问题的。软件上，Windows XP都支持IPv6呢；硬件上，估计也都没太大问题吧~不支持就扔掉好惹&#x3D;￣ω￣&#x3D;</p>
<h2 id="破解光猫"><a href="#破解光猫" class="headerlink" title="破解光猫"></a>破解光猫</h2><p>“破解”这两个字，说的好像很高大上似的，其实只是拿到光猫的超级管理员密码啦。</p>
<p>像我的这个光猫，GS3101 吉比特无光源光纤接入用户端设备，自带2.4GHz的无线，登录长这样：</p>
<p><img src="/images/2019010414523316.png"></p>
<p>我的这个超管账号为CMCCAdmin，密码为aDm8H%MdA，其他光猫可以自己搜索下试试看，不行就致电要密码。</p>
<h2 id="确定拨号模式"><a href="#确定拨号模式" class="headerlink" title="确定拨号模式"></a>确定拨号模式</h2><p>对于某些家里有矿家里有路由器（尤其是刷了第三方固件的那种）的用户，可能不太喜欢用光猫拨号，多一层NAT呢是不。当然啦，没有路由器那就只好用这只?啦。以下介绍使用路由器拨号的方法，如果是使用光猫拨号，那么直接忽略这一部分就好啦。</p>
<h2 id="使用路由器拨号"><a href="#使用路由器拨号" class="headerlink" title="使用路由器拨号"></a>使用路由器拨号</h2><h3 id="光猫改桥接"><a href="#光猫改桥接" class="headerlink" title="光猫改桥接"></a>光猫改桥接</h3><p>首先，需要用网线把路由器的WAN和光猫的LAN连接起来。尽管咱不是千兆光纤，弄个超五类和G口连总是不过分的。需要注意的是，有些光猫是无法通过无线访问web界面的，这个时候就要插网线啦。</p>
<p>然后，需要知道超管密码和自己的宽带账号的用户名和密码。打电话，短信，APP之类查看。假如都没有呢？作为一名优秀的全沾工程师，当然要有灵性啦！</p>
<p><img src="/images/201901041452341.png"></p>
<p>还是没有看见怎么办啊！把type&#x3D;password改成text？</p>
<p>然后选择互联网连接，把模式改成桥接，协议版本改成IPv4&#x2F;IPv6双栈。</p>
<p><img src="/images/2019010414523667.png"></p>
<h3 id="路由器拨号设置"><a href="#路由器拨号设置" class="headerlink" title="路由器拨号设置"></a>路由器拨号设置</h3><p>这里里padavan为例，进入WAN的设置，选择PPPoE，然后确定路由器基本上就能拨号成功了。</p>
<p><img src="/images/2019010414523717.png"></p>
<h2 id="IPv6-IP分配设置"><a href="#IPv6-IP分配设置" class="headerlink" title="IPv6 IP分配设置"></a>IPv6 IP分配设置</h2><p>IPv6地址当然也是要分配的，目前存在两种分配手段，一种被称作Stateless，另一种就是Stateful啦。</p>
<p>所谓statelss，就是无状态了，设备通过“无状态地址自动配置”（SLAAC）获取IPv6地址。地址会自动由路由器给出的前缀推算出，不需要其他配置，也不需要DHCP客户端。当然了，这个过程中是需要一些算法的，比如通过MAC地址算出来IPv6的除了前缀的剩下部分，如果IP重复了通过某算法重新选择一个。</p>
<p>不过在SLAAC的过程中，是很容易通过IPv6算出来用户的MAC地址的，这样对于隐私而言很不好，所以IETF搞了一个“IPv6隐私扩展”标准(RFC 4941)。使用这个隐私扩展，操作系统会从原本的IPv6地址计算生成一个“临时地址”。在连接远程服务器时，系统会优先选择这个地址以隐藏原来的地址。</p>
<p><img src="/images/2019010414523840.png"></p>
<p>Windows 10中的临时IPv6.启用了隐私扩展，与外界连接的时候会优先使用这个IP</p>
<p>另外一种分配IP的方式，stateful，也就是有状态的，需要一个中心化的服务器来管理分配IP，类似IPv4时的DHCP。DHCPv6是一个用来配置工作在IPv6网络上的IPv6主机所需的IP地址、IP前缀和&#x2F;或其他配置的网络协议。</p>
<p>那么究竟该怎样选择呢？实际上，这俩协议也可以一起开启，互不干扰的。简单的说，DHCP倾向于被用在需要集中管理主机的站点，而无状态自动配置不需要任何集中管理，因此后者更多地被用在典型家庭网络这样的场景下。</p>
<p>需要注意的是，原生Android至今不支持DHCPv6，也就是说，如果Android设备需要v6的IP地址，那么就要支持SLAAC，或者root了之后进行一些处理。</p>
<p>在padavan中，设置IPv6分配模式也很简单，在外部网络（WAN）-IPv6设置中，如下图所示即可，红框内可以选择IP分配方法。</p>
<p><img src="/images/2019010414523994.png"></p>
<p>如果你是用光猫分配IPv6的话，那么在网络-LAN侧地址分配进行相似配置就可以了，要注意，网络配置中需要启用IPv4&amp;IPv6双栈哦（上面改桥接那块），否则这里是没用的：</p>
<p><img src="/images/2019010414524175.png"></p>
<p>使能？使能什么？(￣_￣|||)</p>
<h2 id="IPv6-ping测试"><a href="#IPv6-ping测试" class="headerlink" title="IPv6 ping测试"></a>IPv6 ping测试</h2><p>目前，ping能够正常拿到响应，但是被ping却看不到了ICMPv6的响应，不晓得为什么。也许是我配置错误，也许是ISP原因？也就是说这个IPv6目前是不能拿来当公网IP使唤的……</p>
<p>2019年1月10日更新：现在拿到的IPv6已经能从外面ping通了，国内国外都可以。但是从国外SSH似乎不太可以，国内ssh暂时没测试。</p>
<p>2月10日更新：</p>
<p>目前能互相ping通。之前无法ssh是因为路由器的ip6tables的input是drop，设置成允许就可以了。不过当然这样也要小心内网的智能设备被暴力破解等。命令如下：</p>
<p>ip6tables -F<br>ip6tables -X<br>ip6tables -P INPUT ACCEPT<br>ip6tables -P OUTPUT ACCEPT<br>ip6tables -P FORWARD ACCEPT</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2019/01/2019011013492650.jpg"><img src="/images/2019011013492650.jpg"></a></p>
<h3 id="ping国内"><a href="#ping国内" class="headerlink" title="ping国内"></a>ping国内</h3><p><img src="/images/2019010414524232.png"></p>
<p>至于大家都很关注的ipv6.google.com，当然是你懂的啦！</p>
<p><img src="/images/2019010414524389.png"></p>
<p>看样子是成功DNS污染了，但是如果设置正确的hosts……啊(#`O′)IPv4时这样干说不定还是好用的吧？</p>
<p><img src="/images/2019010414524510.png"></p>
<h3 id="ping国外"><a href="#ping国外" class="headerlink" title="ping国外"></a>ping国外</h3><h4 id="vultr日本"><a href="#vultr日本" class="headerlink" title="vultr日本"></a>vultr日本</h4><p><img src="/images/2019010414524762.png"></p>
<p>我记得以前IPv4路由是直接过去的，看来今晚也绕路了？反正IPv6是绕路的</p>
<p>[v_error] 提到这里饶不饶路，我突然想说下，ping越低越好吗？对于某些人、或者是某些特殊类型的应用（如游戏）来说在某些情况下可能会是这样的。</p>
<p>但是从路由的角度来说，RIP认为跳数越低的越好；EIGRP考虑了链路的带宽、延迟、可靠性、负载，使用这四个因素和设定的K值计算之后作为度量值；OSPF则是考虑了管理距离和度量值。 你说呢？? [&#x2F;v_error]</p>
<h4 id="vultr洛杉矶"><a href="#vultr洛杉矶" class="headerlink" title="vultr洛杉矶"></a>vultr洛杉矶</h4><p><img src="/images/2019010414524877.png"></p>
<p>正常水平</p>
<h2 id="IPv6访问测试"><a href="#IPv6访问测试" class="headerlink" title="IPv6访问测试"></a>IPv6访问测试</h2><p>得益于我这个牛逼哄哄的Windows 10（可能有anyconnect或者HyperV作祟），说不定过了多长时间IPv6的IP就没了，或者有IP但是提示没有No network access禁用网卡再启用可能就好了，同样的树莓派和android就没这个问题，这……</p>
<h3 id="test-ipv6-com"><a href="#test-ipv6-com" class="headerlink" title="test-ipv6.com"></a>test-ipv6.com</h3><p><img src="/images/2019010414524943.png"></p>
<p>我可真勇敢?(￢︿̫̿￢☆)只是你没检测出来我的v4好不好嘛。</p>
<p>访问百度没啥问题，只不过不会手动跳https</p>
<p><img src="/images/2019010414525018.png"></p>
<p>其他的IPv6网站，反正还活着的好像都没啥问题。</p>
<h2 id="IPv6其他测试：Xbox网络测试"><a href="#IPv6其他测试：Xbox网络测试" class="headerlink" title="IPv6其他测试：Xbox网络测试"></a>IPv6其他测试：Xbox网络测试</h2><p>NAT全通有木有很羡慕（巨硬：我出bug也不是一天两天了）</p>
<p><img src="/images/2019010414525924.png"></p>
<h2 id="中国移动IPv6总结"><a href="#中国移动IPv6总结" class="headerlink" title="中国移动IPv6总结"></a>中国移动IPv6总结</h2><p>目前就以上的简单测试结果总体来看，移动固网宽带还是一定程度上部署了IPv6的，只不过设备拿到的地址从外面是ping不通的，从国外也无法建立TCP连接，国内估计也不能通TCP（没有服务器给我玩啊?）。</p>
<p>至于IPv6访问国外其他地区是否绕路，这还是得自己追踪路由。反正vultr的$2.5的IPv6 Only似乎是可以一定程度上简单使用的。</p>
<p>太长不看总结：有点鸡肋。</p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>东北大学：我错了，别这么玩我了。我不想被RST</p>
<p>啪打飞。https还配置错了，叫我说什么好。</p>
<p><img src="/images/2019010414530113.png"></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://wiki.archlinux.org/index.php/IPv6_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">https://wiki.archlinux.org/index.php/IPv6_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)</a></p>
<p><a target="_blank" rel="noopener" href="https://networkengineering.stackexchange.com/questions/47829/dhcpv6-stateful-vs-stateless-what-is-difference-between-it">https://networkengineering.stackexchange.com/questions/47829/dhcpv6-stateful-vs-stateless-what-is-difference-between-it</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/01/04/cmcc-ipv6/index/" data-id="clhp7rtex001ds2qr3y4cgxdx" data-title="中国移动IPv6使用体验报告" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-keep-abp-on/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/12/31/keep-abp-on/index/" class="article-date">
  <time class="dt-published" datetime="2018-12-31T00:00:00.000Z" itemprop="datePublished">2018-12-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/share/">share</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/12/31/keep-abp-on/index/">Keep APB on：别碰我的广告屏蔽器</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>前几天，在偶然浏览某知名博主的博客时，偶然发现开着ABP竟然无法加载博文正文了，取而代之的是一个大大的div告诉我需要关闭广告屏蔽器然后刷新页面。哦这怎么行？弹个小窗，某个div提示我们加到白名单里这是可以考虑的，直接不显示文章？作为一名优秀的全沾工程师，肯定是受不了这种事情的。</p>
<p>于是<a target="_blank" rel="noopener" href="https://github.com/BennyThink/KeepABPOn">KeepAPBon</a>这个项目因此而生。一句话概括：</p>
<p>网站永远不应该强迫用户去关闭广告屏蔽器，除非用户想主动关闭。</p>
<p>[gt href&#x3D;’<a target="_blank" rel="noopener" href="https://github.com/BennyThink/KeepABPOn'/]%E5%BC%80%E6%BA%90%E5%9C%B0%E5%9D%80/[/gt/]">https://github.com/BennyThink/KeepABPOn&#39;\]开源地址\[/gt\]</a></p>
<h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><p>安装TamperMonkey扩展，然后搜索KAO，安装你所需要反制的网站的脚本即可。</p>
<p>目前此项目还处于测试阶段，日后可能会把所有反制措施都集中到一个脚本中。</p>
<h2 id="处理标准"><a href="#处理标准" class="headerlink" title="处理标准"></a>处理标准</h2><p>所有会影响页面显示、影响阅读体验的“反广告屏蔽器”类网站都会被处理，视频分享类网站排除在外。其他情况的广告不会被处理。</p>
<p>欢迎提交PR、issue，包括但不限于网站提供、反制措施。</p>
<h2 id="目前被反制的网站"><a href="#目前被反制的网站" class="headerlink" title="目前被反制的网站"></a>目前被反制的网站</h2><h3 id="KAO-1-ruanyifeng"><a href="#KAO-1-ruanyifeng" class="headerlink" title="KAO#1:ruanyifeng"></a><a target="_blank" rel="noopener" href="https://greasyfork.org/zh-CN/scripts/376131-kao-1-ruanyifeng">KAO#1:ruanyifeng</a></h3><p>浏览阮一峰博客时，不必关闭广告屏蔽器。</p>
<h2 id="一些观点"><a href="#一些观点" class="headerlink" title="一些观点"></a>一些观点</h2><h3 id="我不讨厌的广告"><a href="#我不讨厌的广告" class="headerlink" title="我不讨厌的广告"></a>我不讨厌的广告</h3><p>在合理展示的情况下，它们为网站所有者创造了收入，为潜在的受众提升了品牌的知名度。可接受的广告，既不会令人烦恼，也不会干扰正在查看的内容</p>
<p>可不，你看我很喜欢吃的明治就是广告看来的？有广告很正常，我也一直开着ABP里的可接受广告。甚至看到有些博客提示请加入白名单，我还会手动加进去。</p>
<h3 id="我讨厌的广告"><a href="#我讨厌的广告" class="headerlink" title="我讨厌的广告"></a>我讨厌的广告</h3><p>从我的个人角度来看，有两种广告是我讨厌的：</p>
<ol>
<li>铺天盖地、眼花缭乱，一页屏幕半页都是广告，影响浏览体验。</li>
<li>不关ABP，就不给看。看都不给看，还体验个屁啊</li>
</ol>
<h3 id="为什么？"><a href="#为什么？" class="headerlink" title="为什么？"></a>为什么？</h3><p>多少年以来，我一直坚定地认为，互联网的精神是自由与传播。</p>
<p>我非常憎恨阻止知识传播的行为，这也是我如此憎恨GFW的众多原因之一。</p>
<p>也许你并不同意我的看法。那很正常。我们有不同的成长环境，接受了不同的教育，形成了不同的观念与想法。我们各自都有不同的想法，那是很正常的事情了。你一句我一句的讨论，找出论据支撑自己的观点，用事实来说明观点，可能经过这样一次讨论，我们对彼此的理解会更加深一点，或者是学习了解到了一些自己的思维体系中原本并不存在的一些观点。所谓思维的碰撞嘛，本应该就是这样美好的设想的。</p>
<p> </p>
<h2 id="其他参考"><a href="#其他参考" class="headerlink" title="其他参考"></a>其他参考</h2><p><a target="_blank" rel="noopener" href="https://reek.github.io/anti-adblock-killer/#">Anti-Adblock Killer</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/12/31/keep-abp-on/index/" data-id="clhp7rtgz004as2qr8ai9375g" data-title="Keep APB on：别碰我的广告屏蔽器" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-tls1_3/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/12/07/tls1_3/index/" class="article-date">
  <time class="dt-published" datetime="2018-12-07T00:00:00.000Z" itemprop="datePublished">2018-12-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/website/">website</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/12/07/tls1_3/index/">为Nginx开启tls 1.3支持，顺便编译openssl1.1.1a</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>8月份的时候，TLS1.3正式发布了（<a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc8446">RFC 8446</a>），9月份的时候，支持TLS 1.3的Openssl 1.1.1正式发布了。对于我这种喜欢追新的人来说，终于可以升级了……（噢现在是12月哦……）其实……这就是个备忘录。</p>
<h2 id="启用TLS-1-3的要求"><a href="#启用TLS-1-3的要求" class="headerlink" title="启用TLS 1.3的要求"></a>启用TLS 1.3的要求</h2><p>需要重新编译Nginx，加入<code>enable-tls1_3</code>参数，需要浏览器也支持TLS 1.3，如果你使用最新版本的Chrome&amp;Firefox，那么就可以。哦对了，<strong>不需要重新编译openssl哦</strong>。</p>
<p>下表是目前的几个发行版对openssl版本的支持，虽说和本文内容干毫无关系，仅供观赏。</p>
<table><tbody><tr><td><span style="font-size: 12pt;">Ubuntu 18.04</span></td><td><span style="font-size: 12pt;">Openssl 1.1.0g</span></td></tr><tr><td><span style="font-size: 12pt;">Ubuntu 18.10</span></td><td><span style="font-size: 12pt;">Openssl 1.1.1</span></td></tr><tr><td><span style="font-size: 12pt;">Debian sid</span></td><td><span style="font-size: 12pt;">Openssl 1.1.1a</span></td></tr><tr><td><span style="font-size: 12pt;">Debian 9 Stretch</span></td><td><span style="font-size: 12pt;">Openssl 1.1.0j</span></td></tr><tr><td><span style="font-size: 12pt;">CentOS 7</span></td><td><span style="font-size: 12pt;">Openssl 1.0.2k</span></td></tr></tbody></table>

<h2 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h2><p>sudo apt-get install build-essential libpcre3 libpcre3-dev zlib1g-dev unzip git</p>
<h2 id="获取必要组件"><a href="#获取必要组件" class="headerlink" title="获取必要组件"></a>获取必要组件</h2><h3 id="openssl-1-1-1a"><a href="#openssl-1-1-1a" class="headerlink" title="openssl 1.1.1a"></a>openssl 1.1.1a</h3><p>wget <a target="_blank" rel="noopener" href="https://www.openssl.org/source/openssl-1.1.1a.tar.gz">https://www.openssl.org/source/openssl-1.1.1a.tar.gz</a><br>tar xf openssl-1.1.1a.tar.gz &amp;&amp; rm openssl-1.1.1a.tar.gz</p>
<h3 id="Nginx-1-15-7"><a href="#Nginx-1-15-7" class="headerlink" title="Nginx 1.15.7"></a>Nginx 1.15.7</h3><p>wget <a target="_blank" rel="noopener" href="https://nginx.org/download/nginx-1.15.7.tar.gz">https://nginx.org/download/nginx-1.15.7.tar.gz</a><br>tar xf nginx-1.15.7.tar.gz &amp;&amp; rm nginx-1.15.7.tar.gz<br>cd nginx-1.15.7</p>
<h2 id="编译Nginx"><a href="#编译Nginx" class="headerlink" title="编译Nginx"></a>编译Nginx</h2><p>.&#x2F;configure –user&#x3D;www –group&#x3D;www –prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;nginx –with-openssl&#x3D;..&#x2F;openssl-1.1.1a –with-openssl-opt&#x3D;’enable-tls1_3’ –with-http_v2_module –with-http_ssl_module –with-http_gzip_static_module –with-http_stub_status_module –with-http_sub_module –with-stream –with-stream_ssl_module</p>
<p>配置完成之后</p>
<p>make<br>make install</p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>在你的站点的配置文件中，如下配置即可：</p>
<p>ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3;</p>
<p>ssl_ciphers ‘TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA’;</p>
<h2 id="检测与验证"><a href="#检测与验证" class="headerlink" title="检测与验证"></a>检测与验证</h2><h3 id="浏览器"><a href="#浏览器" class="headerlink" title="浏览器"></a>浏览器</h3><p>升级Chrome吧，默认就应该支持了。直接浏览器访问，开F12在security中即可看到。</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2018/12/2018120701580146.jpg"><img src="/images/2018120701580146.jpg"></a></p>
<h3 id="ssllabs"><a href="#ssllabs" class="headerlink" title="ssllabs"></a>ssllabs</h3><p><a target="_blank" rel="noopener" href="https://www.ssllabs.com/ssltest/">https://www.ssllabs.com/ssltest/</a></p>
<h3 id="testssl"><a href="#testssl" class="headerlink" title="testssl"></a>testssl</h3><p>需要1.1.1或更高版本的openssl</p>
<p>.&#x2F;testssl –p –P <a target="_blank" rel="noopener" href="http://www.example.com/">www.example.com</a></p>
<h3 id="Openssl"><a href="#Openssl" class="headerlink" title="Openssl"></a>Openssl</h3><p>注意，同样需要openssl版本为1.1.1或更高</p>
<p>openssl s_client -connect <a target="_blank" rel="noopener" href="http://www.example.com:443/">www.example.com:443</a> -tls1_3</p>
<h2 id="编译openssl-1-1-1"><a href="#编译openssl-1-1-1" class="headerlink" title="编译openssl 1.1.1"></a>编译openssl 1.1.1</h2><h3 id="安装依赖-1"><a href="#安装依赖-1" class="headerlink" title="安装依赖"></a>安装依赖</h3><p>sudo apt update<br>sudo apt install build-essential checkinstall zlib1g-dev -y</p>
<h3 id="下载并解压缩源代码"><a href="#下载并解压缩源代码" class="headerlink" title="下载并解压缩源代码"></a>下载并解压缩源代码</h3><p>wget <a target="_blank" rel="noopener" href="https://www.openssl.org/source/openssl-1.1.1a.tar.gz">https://www.openssl.org/source/openssl-1.1.1a.tar.gz</a><br>tar xf openssl-1.1.1a.tar.gz &amp;&amp; rm openssl-1.1.1a.tar.gz<br>cd openssl-1.1.1a</p>
<h3 id="配置、编译与安装"><a href="#配置、编译与安装" class="headerlink" title="配置、编译与安装"></a>配置、编译与安装</h3><p>.&#x2F;config –prefix&#x3D;&#x2F;usr&#x2F;local&#x2F;ssl –openssldir&#x3D;&#x2F;usr&#x2F;local&#x2F;ssl shared zlib<br>make &amp;&amp; make test<br>make install</p>
<p>关于prefix和openssldir这俩参数</p>
<p><code>prefix</code>和<code>openssldir</code>用于控制openssl安装路径。</p>
<p><strong>1.0.2及之前的版本</strong></p>
<p>一般来说不用指定<code>prefix</code>，如果<code>prefix</code>没指定，那么就会使用<code>openssldir</code></p>
<p>如果未指定<code>openssldir</code>，那么<code>openssldir</code>的默认路径为<code>/usr/local/ssl</code></p>
<p><strong>1.1.0 及之后版本</strong></p>
<p>我们改啦！应该同时指定<code>prefix</code> 和 <code>openssldir</code></p>
<p>简单的办法就是同时指定为<code>/usr/local/ssl</code></p>
<h3 id="更新动态库"><a href="#更新动态库" class="headerlink" title="更新动态库"></a>更新动态库</h3><p>cd &#x2F;etc&#x2F;ld.so.conf.d&#x2F;</p>
<h1 id="创建新文件"><a href="#创建新文件" class="headerlink" title="创建新文件"></a>创建新文件</h1><p>vim openssl-1.1.1a.conf</p>
<h1 id="粘贴如下内容并保存退出"><a href="#粘贴如下内容并保存退出" class="headerlink" title="粘贴如下内容并保存退出"></a>粘贴如下内容并保存退出</h1><p>&#x2F;usr&#x2F;local&#x2F;ssl&#x2F;lib</p>
<h1 id="重新加载动态库"><a href="#重新加载动态库" class="headerlink" title="重新加载动态库"></a>重新加载动态库</h1><p>ldconfig –v</p>
<h3 id="删除（备份）旧的openssl"><a href="#删除（备份）旧的openssl" class="headerlink" title="删除（备份）旧的openssl"></a>删除（备份）旧的openssl</h3><p>mv &#x2F;usr&#x2F;bin&#x2F;c_rehash &#x2F;usr&#x2F;bin&#x2F;c_rehash.BEKUP<br>mv &#x2F;usr&#x2F;bin&#x2F;openssl &#x2F;usr&#x2F;bin&#x2F;openssl.BEKUP</p>
<h3 id="把新的加入PATH"><a href="#把新的加入PATH" class="headerlink" title="把新的加入PATH"></a>把新的加入PATH</h3><p>类似如下语句，或者做软链接</p>
<p>PATH&#x3D;”&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin:&#x2F;sbin:&#x2F;bin:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;local&#x2F;games:&#x2F;usr&#x2F;local&#x2F;ssl&#x2F;bin”</p>
<p>参考</p>
<p><a target="_blank" rel="noopener" href="https://www.howtoforge.com/tutorial/how-to-install-openssl-from-source-on-linux/">https://www.howtoforge.com/tutorial/how-to-install-openssl-from-source-on-linux/</a></p>
<p><a target="_blank" rel="noopener" href="https://wiki.openssl.org/index.php/Compilation_and_Installation#PREFIX_and_OPENSSLDIR">https://wiki.openssl.org/index.php/Compilation_and_Installation#PREFIX_and_OPENSSLDIR</a></p>
<p><a target="_blank" rel="noopener" href="https://imququ.com/post/enable-tls-1-3.html">https://imququ.com/post/enable-tls-1-3.html</a></p>
<p><a target="_blank" rel="noopener" href="https://halfrost.com/tls1-3_start/">https://halfrost.com/tls1-3_start&#x2F;</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/12/07/tls1_3/index/" data-id="clhp7rtmc00a2s2qr9bju6zj3" data-title="为Nginx开启tls 1.3支持，顺便编译openssl1.1.1a" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-one-million-data/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/11/28/one-million-data/index/" class="article-date">
  <time class="dt-published" datetime="2018-11-28T00:00:00.000Z" itemprop="datePublished">2018-11-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/program/">program</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/11/28/one-million-data/index/">假如给我一百万（的数据）</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>很长时间之前我写过一篇<a target="_blank" rel="noopener" href="https://dmesg.app/mysql-es-mongo.html">《使用</a> <a target="_blank" rel="noopener" href="https://dmesg.app/mysql-es-mongo.html">Python 将海量 MySQL 数据导入 Elastic Search&#x2F;MongoDB</a><a target="_blank" rel="noopener" href="https://dmesg.app/mysql-es-mongo.html">》</a>，主要就说了如何把大量MySQL数据写入键值对数据库。</p>
<p>现在回过头看来这篇文章还是很有参考价值的。</p>
<p>有的时候我们会遇到相反的需求，比如说把对应的键值对数据库（或者说是json文件）导入（列数据类型相符）的MySQL表中。通常来说这不是个啥大问题，根据json提取出列，生成SQL语句就可以了。也就这么几行，然后execute加参数就可以了：</p>
<p>placeholders &#x3D; ‘, ‘.join([‘%s’] * len(raw_dict))<br>columns &#x3D; ‘, ‘.join(raw_dict.keys())<br>insert_sql &#x3D; “INSERT INTO %s ( %s ) VALUES ( %s )” % (insert_table, columns, placeholders)</p>
<p>当然了你要是想直接生成能用的sql语句那我也没意见（并抛出一个?的表情）</p>
<p>大量插入数据的时候咋整呢？</p>
<h1 id="首先我们……"><a href="#首先我们……" class="headerlink" title="首先我们……"></a>首先我们……</h1><p>首先我们要知道，性能是由多方面因素决定的，比如说代码效率质量、Python性能、服务器性能（包含MySQL版本，编译优化，宿主机IO&#x2F;CPU&#x2F;RAM等）、表结构的设计、网络速度等，咱要找到短板才可以。为了找到短板，需要使用控制变量法，但是有些变量不可控，那就很不好办了……</p>
<p>然后我需要送上MySQL官方文档两篇，说的非常详细了，我简单总结下</p>
<p>Optimizing INSERT Statements: <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/insert-optimization.html">https://dev.mysql.com/doc/refman/8.0/en/insert-optimization.html</a></p>
<p>Bulk Data Loading for InnoDB Tables: <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/optimizing-innodb-bulk-data-loading.html">https://dev.mysql.com/doc/refman/8.0/en/optimizing-innodb-bulk-data-loading.html</a></p>
<h2 id="优化INSERT语句"><a href="#优化INSERT语句" class="headerlink" title="优化INSERT语句"></a>优化INSERT语句</h2><p>插入时间由以下因素决定，数字代表权重</p>
<ul>
<li>Connecting: (3)</li>
<li>Sending query to server: (2)</li>
<li>Parsing query: (2)</li>
<li>Inserting row: (1 × size of row)</li>
<li>Inserting indexes: (1 × number of indexes)</li>
<li>Closing: (1)</li>
</ul>
<p>可以使用以下方式加速插入：</p>
<ul>
<li>如果从同一个客户端同时插入，使用多值的INSERT语句一次性插入多行，这比使用单行的INSERT语句要快得多。如果要将数据添加到非空表中，则可以调整该 <code>bulk_insert_buffer_size</code> 变量以使数据插入速度更快。</li>
<li>从文本文件加载表格时，请使用 <code>LOAD DATA INFILE</code>。这通常比使用INSERT语句快20倍</li>
<li>利用列具有默认值的事实。只有当要插入的值不同于默认值时才显式插入值。这减少了MySQL必须执行的解析并提高了插入速度。</li>
</ul>
<h2 id="InnoDB表的批量数据加载"><a href="#InnoDB表的批量数据加载" class="headerlink" title="InnoDB表的批量数据加载"></a>InnoDB表的批量数据加载</h2><h3 id="关闭自动提交"><a href="#关闭自动提交" class="headerlink" title="关闭自动提交"></a>关闭自动提交</h3><p>关闭自动提交，因为它为每个操作执行日志刷新。</p>
<p>实际上默认情况下pymysql帮我们做了，<code>set autocommit=0</code></p>
<h3 id="关闭唯一性校验"><a href="#关闭唯一性校验" class="headerlink" title="关闭唯一性校验"></a>关闭唯一性校验</h3><p>set unique checks &#x3D; 0</p>
<p>对于大表而言这会节约很多磁盘IO，不过要确保数据没有重复记录。</p>
<h3 id="关闭外键校验"><a href="#关闭外键校验" class="headerlink" title="关闭外键校验"></a>关闭外键校验</h3><p>SET foreign_key_checks&#x3D;0;</p>
<h3 id="多值INSERT"><a href="#多值INSERT" class="headerlink" title="多值INSERT"></a>多值INSERT</h3><p>使用多值INSERT 来减少客户端与服务器之间的通信开销</p>
<p>INSERT INTO yourtable VALUES (1,2), (5,5), …;</p>
<p>需要注意的是，MyISAM用这招也管用。</p>
<p><strong>这一点是我们本文讨论的重点内容。</strong></p>
<h3 id="自增列的处理"><a href="#自增列的处理" class="headerlink" title="自增列的处理"></a>自增列的处理</h3><p>当对具有自动增量列的表进行批量插入时，请将其设置 <code>innodb_autoinc_lock_mode</code>为2而不是默认值1</p>
<h3 id="主键排序"><a href="#主键排序" class="headerlink" title="主键排序"></a>主键排序</h3><p>InnoDB表是按照主键顺序排列的，所以将数据顺序按照主键顺序排列好，可以提高导入效率</p>
<h1 id="Python性能"><a href="#Python性能" class="headerlink" title="Python性能"></a>Python性能</h1><p>这可能是PHP被黑的最惨的一次。</p>
<p>如果单纯的比较执行性能的话，Python是肯定比不过静态语言的。不过我早就过了单纯的年龄，我很邪恶的。由于这是Python自身的短板，咱也不太好做点什么有实质性的工作，也许仅限于把解释器换成PyPy，编译Python时带上<code>enable-optimizations</code>，把性能关键的模块用C&#x2F;C++写一遍然后胶水糊上。</p>
<p>但可是啊可但是啊，代码执行时绝大部分的时间都消耗在了网络IO、磁盘IO，在语言本身上的劣势并不是那么明显。当然了非得说语言本身，那动态语言运行时要解释，要运行时检查……</p>
<h1 id="代码效率质量"><a href="#代码效率质量" class="headerlink" title="代码效率质量"></a>代码效率质量</h1><p>实际上老实说，这部分才是最关键的。一个足够Pythonic的代码看起来是很舒服的嗯……</p>
<h2 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h2><h3 id="查询时SQL注入的预防"><a href="#查询时SQL注入的预防" class="headerlink" title="查询时SQL注入的预防"></a>查询时SQL注入的预防</h3><p>在有些情况下（比如说登录的时候）我们需要进行where限制条件查询，此时如果使用拼接SQL语句的方式，那么被注入几乎就是肯定的了。</p>
<p>比如某些新手在登录的查询语句可能会构造如下语句：</p>
<p>SELECT * FROM account WHERE username&#x3D;’benny’ AND password&#x3D;’123456’</p>
<p>其中benny和123456是由用户输入的变量，通过判断结果集是否为空来判断是否登录成功。乍一看似乎没啥问题，但是……问题太多了。</p>
<ol>
<li>无验证登录</li>
</ol>
<p>恶意用户只需要把用户名输入为<code>&#39; or 1=1; --</code> ，SQL语句就会变成这样：</p>
<p>SELECT * FROM account WHERE username&#x3D;’’ or 1&#x3D;1; – ‘ AND password&#x3D;’123456’</p>
<p>这是一条带不带WHERE都一样的语句，只要表中有数据那么结果集就一定为真，自然也就绕过登录了。</p>
<ol>
<li>各种注入</li>
</ol>
<p>通过构造各种各样的奇葩的SQL语句，可以摸索出来表的结构，甚至是某些关键库（比如mysql这个库）的数据，比如说<a target="_blank" rel="noopener" href="https://chybeta.github.io/2017/07/21/MySql%E6%B3%A8%E5%85%A5%E5%A4%87%E5%BF%98%E5%BD%95/">这篇</a>。</p>
<ol>
<li>密码存储问题</li>
</ol>
<p>即使注入不是问题，从系统设计的角度来讲这种设计也是错误的。</p>
<p>明文密码，无论从传输角度还是从数据库角度来讲都是不合理的。即使是使用安全的散列函数、HMAC也是错误的。</p>
<p>正确的姿势是用参数化查询查询出密码，使用PBKDF的方法进行等时间比较。</p>
<p>（如何存储用户密码是一门艺术，以后也许单独开一篇完整介绍吧）</p>
<h3 id="dictCursor"><a href="#dictCursor" class="headerlink" title="dictCursor"></a>dictCursor</h3><p>有些时候我们可能需要查询出来的结果是一定类型的，默认情况下pymysq使用的cursor会查询出来<code>[(),()]</code>这种格式的数据，如果我们需要字典样式的数据，那么就要在构造con连接对象的时候指定游标，语法大致如下：</p>
<p>con &#x3D; pymysql.connect(host&#x3D;’localhost’, user&#x3D;’user’, password&#x3D;’passwd’,<br>db&#x3D;’db’, charset&#x3D;’utf8mb4’, cursorclass&#x3D;pymysql.cursors.DictCursor)</p>
<p>这样就不用再从information_schema里乱查一通了。</p>
<h3 id="fetch方式"><a href="#fetch方式" class="headerlink" title="fetch方式"></a>fetch方式</h3><p>cur在获取数据时，有<code>fetchall()</code>、<code>fetchone()</code>、<code>fetchmany()</code>三种方法。细节已经<a target="_blank" rel="noopener" href="https://dmesg.app/mysql-es-mongo.html">在这里说了</a>，所以就暂且不提。</p>
<h2 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h2><h3 id="插入时SQL注入的预防"><a href="#插入时SQL注入的预防" class="headerlink" title="插入时SQL注入的预防"></a>插入时SQL注入的预防</h3><p>插入数据时也同样需要防范SQL注入，所以应该使用参数化查询。下面会详细说明</p>
<h3 id="cur-execute-与参数"><a href="#cur-execute-与参数" class="headerlink" title="cur.execute()与参数"></a>cur.execute()与参数</h3><p>首先看一眼原型：<code>def execute(self, query, args=None)</code></p>
<p>第一个参数query代表要执行的SQL语句，第二个args代表可选的查询参数，类型可为tuple, list or dict</p>
<p>也就是说，我们应该这样执行execute：</p>
<ol>
<li><code>cur.execute(&#39;select version()&#39;)</code> 不需要任何参数，直接一整条SQL语句。</li>
<li><code>cur.execute(&#39;INSERT INTO sometable VALUES (%s,%s)&#39;, (1, 4))</code> 参数化查询，%s是占位符，不需要考虑字段类型。无脑%s没事的，这不是Python的字符串%格式化风格语法。</li>
</ol>
<p>根据<a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-0249/">PEP 249</a>，clientlibrary.paramstyle可以看到占位符风格，比如说自带的sqlite3的占位符就是?，pymysql是pyformat，更多详细信息可以<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/7929364/python-best-practice-and-securest-to-connect-to-mysql-and-execute-queries">看看这里</a></p>
<p>比较不推荐的执行查询的方式</p>
<p>sql &#x3D; ‘insert into sometable values(‘<br>sql &#x3D; sql + “‘“ + var1 + “‘,’” + var2 + “‘,’” + var3 + “‘,” + str(1984) + “)”</p>
<p>以及任何花样循环拼接的方式，看着那些单引号双引号我都头疼，就算USE somedb这种没办法搞参数化查询，那咱用%s、format、f-string拼字符串可读性也比这种+的好。况且+要开辟新的内存空间，会更慢了。</p>
<p>提示：mysql connector的cursor支持multiLine模式，也就是说可以通过分号执行多条SQL语句。不过，pymysql不支持哟。</p>
<h3 id="cur-executemany-参数"><a href="#cur-executemany-参数" class="headerlink" title="cur.executemany()参数"></a>cur.executemany()参数</h3><p>以为会execute参数化查询就够了吗？才不是呢，远远还不够。有些时候我们需要大量插入（或是replace）。按照一般的脑回路：</p>
<p>sql &#x3D; “INSERT INTO sometable VALUES (%s,%s,%s)”<br>for item in data:<br>    cur.execute(sql, item)</p>
<p>还是先来看下executemany的原型：<code>executemany(self, query, args)</code></p>
<p>第一个参数query还是带有占位符的SQL语句，第二个参数args一般来说是双层嵌套的参数。例子如下：</p>
<p>sql &#x3D; ‘INSERT INTO SOMETABLE VALUES (%s,%s,%s)’<br>data &#x3D; [[1, 2, 3], [4, 5, 6], [7, 8, 9]]<br>cur.executemany(sql, data)</p>
<p>核心关键就在这里，executemany会通过多值的INSERT提升性能，其他情况下就和循环调用execute一样了</p>
<p>有些小盆友可能想问，为啥executemany能够提高性能呢？因为executemany生成的是类似<code>INSERT INTO sometable VALUES(1,2,3),(4,5,6)</code>这种语句啊，肯定要比一条一条INSERT要快很多了。不过为什么说“肯定”呢？想当然是很正常的，有理有据的想当然才是可以的（…( ＿ ＿)ノ｜继续看就知道为什么了）。</p>
<p>注意，由于单条SQL语句的长度有限制，这里可能需要看情况分割一下：</p>
<p>for i in range(0, len(data), SIZE):<br>    part &#x3D; data[i:i + SIZE]<br>    # do something here, such as executemany</p>
<p>相信我，只要插入数据量足够大，executemany就能够成为性能提升的最关键的一点。</p>
<p>哦对了，executemany配合参数化查询已经很好用了，还是别多值INSERT，虽说也能提高效率……</p>
<p>以下测试有一点需要注意，不同的表结构、字段类型所得到的二者比值未必相同，但总体情况毫无疑问是executemany胜出。</p>
<p>下面是我的测试，测试脚本可以从如下地址获取： [gt href&#x3D;’<a target="_blank" rel="noopener" href="https://github.com/BennyThink/tools/tree/master/one/_million'/]%E5%BC%80%E6%BA%90%E5%9C%B0%E5%9D%80/[/gt/]">https://github.com/BennyThink/tools/tree/master/one\_million&#39;\]开源地址\[/gt\]</a></p>
<table><tbody><tr><td colspan="3"><span style="font-size: 12pt;">简单表的性能benchmark</span></td></tr><tr><td>插入条数</td><td><span style="font-size: 12pt;">execute</span></td><td><span style="font-size: 12pt;">executemany</span></td></tr><tr><td><span style="font-size: 12pt;">1000</span></td><td><span style="font-size: 12pt;">0.35</span></td><td><span style="font-size: 12pt;">0.02</span></td></tr><tr><td><span style="font-size: 12pt;">5000</span></td><td><span style="font-size: 12pt;">0.84</span></td><td><span style="font-size: 12pt;">0.06</span></td></tr><tr><td><span style="font-size: 12pt;">10000</span></td><td><span style="font-size: 12pt;">4.16</span></td><td><span style="font-size: 12pt;">0.34</span></td></tr><tr><td><span style="font-size: 12pt;">20000</span></td><td><span style="font-size: 12pt;">4.87</span></td><td><span style="font-size: 12pt;">0.39</span></td></tr><tr><td><span style="font-size: 12pt;">50000</span></td><td><span style="font-size: 12pt;">19.43</span></td><td><span style="font-size: 12pt;">0.93</span></td></tr><tr><td><span style="font-size: 12pt;">100000</span></td><td><span style="font-size: 12pt;">40.84</span></td><td><span style="font-size: 12pt;">3.18</span></td></tr><tr><td><span style="font-size: 12pt;">500000</span></td><td><span style="font-size: 12pt;">165.72</span></td><td><span style="font-size: 12pt;">9.76</span></td></tr><tr><td><span style="font-size: 12pt;">1000000</span></td><td><span style="font-size: 12pt;">369.46</span></td><td><span style="font-size: 12pt;">29.43</span></td></tr></tbody></table>

<p><img src="/images/2018112701530413.png"></p>
<p>看一下这个折线图更直观的感受下吧，平均来说executemany要比execute快上至少10倍。</p>
<h3 id="其他不太好玩方式"><a href="#其他不太好玩方式" class="headerlink" title="其他不太好玩方式"></a>其他不太好玩方式</h3><p><strong>关于事务与commit</strong></p>
<p>不要尝试花样commit，比如说一条一条插，每插入1000条commit一次；插一条commit一次。这比画蛇添足还过分，这就是自讨苦吃啊。一起commit就得了。（如果数据可能会插入失败，那么一定要用try…except…finally控制好异常确保无误）</p>
<p><strong>并发INSERT</strong></p>
<p>在使用InnoDB情况下，由于InnoDB有事务，插入时有排他锁，表的结构可能不同，可能有主键外键唯一约束，可能有自增非空限制，数据库版本&#x2F;配置可能不同，一些库的限制，GIL锁等等，这个变量就有点太大了有点难控制……这个我真的没办法拿数据说话。</p>
<h3 id="其他小的代码因素"><a href="#其他小的代码因素" class="headerlink" title="其他小的代码因素"></a>其他小的代码因素</h3><p>除了execute&#x2F;executemany这个最大的性能因素之外，还有一些在某些情况下Python层面的对性能提升未必很明显的处理方式:</p>
<ol>
<li>拼接字符串：尽量选择f-string、%、format或join，+是最慢的，<a target="_blank" rel="noopener" href="https://realpython.com/python-f-strings/#speed">f-string是最快的</a>。</li>
<li>Python 2需要特别注意一些方面，比如range和xrange，True和1等</li>
</ol>
<h1 id="其他因素"><a href="#其他因素" class="headerlink" title="其他因素"></a>其他因素</h1><h2 id="服务器性能"><a href="#服务器性能" class="headerlink" title="服务器性能"></a>服务器性能</h2><p>包含MySQL版本，编译优化，宿主机IO&#x2F;CPU&#x2F;RAM等。这一点就很难展开说了，说不定某个版本的MySQL在某个平台上通过某个编译优化参数性能就提升了20%呢。哦对了，Python开启<code>--enable-optimizations</code>时据说性能会提升10%-20%呢。</p>
<h2 id="网络速度"><a href="#网络速度" class="headerlink" title="网络速度"></a>网络速度</h2><p>如果是远程连接到数据库的话，那么减少连接次数、减少数据量是更加的选择，此时就更应该选择批量的executemany而不是execute了。因为多次execute会嗷嗷的增加上传和下载的流量，而executemany不会增加下载的流量，就连上传流量的增加也不那么可怕哟。</p>
<p>还好都是一个TCP连接里走的，要不就更惨不忍睹了。</p>
<p>不信我抓包给你看~</p>
<h3 id="单个execute"><a href="#单个execute" class="headerlink" title="单个execute"></a>单个execute</h3><p><img src="/images/20181127015305100.png"></p>
<p>一共这么几个请求，一个autocommit&#x3D;0，一个commit，三个查询。</p>
<p><img src="/images/2018112701530643.png"></p>
<p>协议统计告诉我们，我发送了682字节，接受了628字节。</p>
<p>下面我们来看下executemany</p>
<h3 id="executemany"><a href="#executemany" class="headerlink" title="executemany"></a>executemany</h3><p><img src="/images/2018112701530642.png"></p>
<p>从图中我们可以看到，一个autocommit&#x3D;0，一个commit，外加一次查询。</p>
<p><img src="/images/2018112701530789.png"></p>
<p>协议统计告诉我们，发送了514字节，接收了537字节。</p>
<p>假如我把数据量从3改成1000，那么……</p>
<p><img src="/images/2018112701530770.png"></p>
<p>单次execute发送94K接受65K</p>
<p><img src="/images/2018112701530850.png"></p>
<p>Executemany发送10K接受542字节</p>
<h3 id="网速影响总结"><a href="#网速影响总结" class="headerlink" title="网速影响总结"></a>网速影响总结</h3><p>综上，在数量级为1000的情况下，execute总流量是159K，executemany是10.53K，差了接近15倍。那么在低网速、大数据的情况下谁的优势更明显就不言而喻了。</p>
<p>那么问题来了，假如单独executemany的时候差了十倍，流量又差了十倍，那是不是一共就差了100倍了？</p>
<p>(　o&#x3D;^•ェ•)o　┏━┓（你看桌子都翻了，所以呢）不可以这么计算的，大部分情况下网速对性能的影响并不是那么明显，当网速足够慢、数据足够大时，这个影响就会被放大；反之这个影响可以忽略不计。所以正确计算是要加权重的，然而这个权重是几乎无法得到的ε&#x3D;ε&#x3D;ε&#x3D;┏(゜ロ゜;)┛</p>
<p>所以，如果在远程连接数据库的情况下执行查询，那么数据量大的时候，因为单次execute导致了网络传输量的急剧上升，execute的负面效应会被一定程度的放大。</p>
<h2 id="最终的总结"><a href="#最终的总结" class="headerlink" title="最终的总结"></a>最终的总结</h2><ol>
<li>官方文档是第二好的参考来源，那么第一好的参考来源是什么？源代码啦；</li>
<li>当遇到问题的时候，想当然是很正常的，但是更重要的是通过分析实验与数据了解并证实猜想；</li>
<li>某些因素可能会互相影响。像本例execute的副作用之一就是会增加网络流量，所以execute才是根源，网速只是伴随的副作用而已，不可因果倒置；</li>
<li>某些性能因素是很难控制的，比如服务器CPU&#x2F;RAM&#x2F;IO，Python解释器性能，MySQL版本&#x2F;编译选项&#x2F;配置&#x2F;集群，甚至是操作系统、内核的差距。这种因素的变量几乎很难控制，那么就不要考虑了，等某因素成为关键点的时候再去分析；</li>
<li>我有代码洁癖；</li>
<li>这可能是一个火苗</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/11/28/one-million-data/index/" data-id="clhp7rthw0069s2qr5c1z6h42" data-title="假如给我一百万（的数据）" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-confess-for-what/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/11/03/confess-for-what/index/" class="article-date">
  <time class="dt-published" datetime="2018-11-03T00:00:00.000Z" itemprop="datePublished">2018-11-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/justsay/">justsay</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/11/03/confess-for-what/index/">面壁思过...？</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>晚上女神突然来找我，我很开心。我知道这段时间她一定会比较频繁的找我，所以也并没有感到有什么意外。本来以为是因为毕设的原因来找我帮忙，没想到是想去Quora让我帮忙搜几个问题(去给留学生的作业什么的)。不过你懂的，我们的GFW是多么伟大啊。</p>
<p>后来这么一说，事情就简单了，我直接找几篇发给她参考下，也省得帮她配置shadowsocks什么的，尽管我十分愿意，毕竟，这也是为了<a target="_blank" rel="noopener" href="https://program-think.blogspot.com/2009/10/use-people-war-to-anti-gfw.html">让GFW陷入人民战争的汪洋大海</a>而做的微不足道的努力吧。话说回来，问题也很简单：为什么最近几年人们都选择移民美国，美国应该紧缩还是宽松移民政策？</p>
<p>这是个很好的问题啊，很值得讨论。我就顺便说了一句，我无时无刻不在想着逃走。我以前从来不会跟人说我的任何倾向和想法，因为我觉得就某人说的一样：我关注的都是大家不关注的。大家关注的我都没有精力去关注。</p>
<p>之所以敢和她这么说一句，可能是因为我认为她最近这一两年的经历与思想转变更像是<a target="_blank" rel="noopener" href="https://program-think.blogspot.com/2014/02/brainwash-and-idiot.html">“觉醒”的人</a>吧。我还跟人吹嘘过说我认识这种“异类觉醒”的人呢。呃似乎我这么说人家不太好吧。</p>
<p>也许她是受到了我当初无心插柳送给她的《1984》的影响吧，也许是那一年遇到了各种奇怪的社会现象吧。总之这种“觉醒”的人越来越多总是好的，虽说从觉醒程度上来讲可能并不足够深、并不理想。</p>
<p>但是想都没想到，我竟然被她狠狠的训了、或者说是凶了一次。感觉平时那么温文儒雅的她好像是第一次用这么大的声音、这么强烈的语气、加重了的力度的词语跟我说话……我记得她的声音分明是很甜美很温柔的那种圆滚滚的可爱的样子的啊……</p>
<p>大概就是说作为华人会被歧视，只看到了白板上一个黑点，只想追求自己的所谓的什么什么的。说实话我觉得这些观点都是没什么的，是的<strong>我不同意你的观点，但是我却愿意捍卫你说这些话的权利</strong>。即使我们的思想截然相反，但是思想一旦发生碰撞，就会溅出曼妙的火花。而这种思维火花往往对彼此的发展有积极性作用的。</p>
<p>只是很平静的说出这些其实也没什么，心情好的话，也许就可以你一句我一句的讨论，找出论据支撑自己的观点，用事实来说明观点，也许在这种事情里并没有绝对的对错（可能这样说也不对，但是至少我很清楚，我不会一定要像古美门那样不择手段的不留余地，毕竟跟我对话的人可是女神），可能经过这样一次讨论，我们对彼此的理解会更加深一点，或者是学习了解到了一些自己的思维体系中原本并不存在的一些观点。<strong>所谓思维的碰撞嘛，本应该就是这样美好的设想的</strong>。</p>
<p>唯一不同的是，她并不是心态平和的说出了这些，而是以着一种盛气凌人的、怒发冲冠的非常强烈的训斥般的语气说出了这些，如果是一些逻辑严谨的证明也就算了，但是给我的感觉却是分分钟走下滑坡。</p>
<p>上次有人用这种居高临下盛气凌人的语气跟我说话，还是8月中旬看电影时发生的小意外。不过好歹我和他也不认识，打不打招呼能咋样，又不给我发钱，并不在乎。可是今晚……想一想，是不是我太脆弱了，是不是我太过于看重别人对我的看法了，是不是我太玻璃心了。一定是这样的吧。为什么要轻易相信别人，为什么要轻易的把自己的内心、把自己的想法告诉别人呢？</p>
<p>我一句话都没敢反驳，甚至都不敢接茬。我立刻怂了，一丁点观点都不敢表达，一丁点事实都不敢描述。我立刻很委婉纠结的试探着问下不会是生气了吧……当然了这么问当然是无用功了。</p>
<p>得了，先别想这些，怀着忐忑不安的心情，我还是尽全力认真完成她拜托我的事情吧。我才不在乎别人是怎么拜托她的，也不在乎她能拿到什么好处。我所在乎的就是她来找我，她需要我帮忙我这一个环节，在那一瞬间我知道我是被人需要的，还是被女神需要的，所以自然要尽全力的认真的做好交代给我的事情，这样下次她才会更愿意来拜托我。至于其他的环节，其实我并不是很在乎的。</p>
<p>然后就到了现在。我本来只是想写几个字平静下自己的内心，却开始发现自己的情绪变得越来越不稳定、越来越激动。</p>
<p>莫非我这是PTSD了？所以我才这样敏感……说出去会被嫌弃笑话的吧。不过也没关系啊，我的心理太阴暗了，我一点都不积极，我总是看不到阳光的那一面，我总是倾向于选择自我毁灭，偶尔还会有着自暴自弃的想法。谁能喜欢这样性情多变的人就怪了。所以我不值得被爱啊，这些全都是我自己作死的后果。</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2018/11/2018110316142082.jpg"><img src="/images/2018110316142082.jpg"></a> 和你一起面壁思过好了。</p>
<p>也许吧，我再也不是那个你们认识的我了。终有一天我们之间的关系会逐渐切断，终有一天我们会把对方从彼此的记忆中清除。我一直认为自己是一个很绝情的人，所以这些对我来说是都是可以接受的。只是你现在还需要我，那就让我心甘情愿的完成为数不多的几次收官之作吧。</p>
<p>最后，还是想起了一句话：</p>
<blockquote>
<p>宪法原则中最重要的是“自由思想的原则”——不是确保我们喜欢的思想的自由，而是确保我们所憎恨的思想的自由</p>
<p>if there is any principle of the Constitution that more imperatively calls for attachment than any other it is the principle of free thought—not free thought for those who agree with us but freedom for the thought that we hate.</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/11/03/confess-for-what/index/" data-id="clhp7rtf5001gs2qr3eps78rt" data-title="面壁思过...？" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/9/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/page/11/">11</a><a class="page-number" href="/page/12/">12</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/11/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/azure/">azure</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/china/">china</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/china/justsay/">justsay</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/cloudflare/">cloudflare</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/gfw/">gfw</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/">it</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/it/justsay/">justsay</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/security/">security</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/share/">share</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/">justsay</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/gfw/">gfw</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/linux/security/">security</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/website/">website</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/program/">program</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/program/share/">share</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/security/">security</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/security/justsay/">justsay</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/security/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/share/">share</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/website/">website</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/website/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/what/">what</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/what/gfw/">gfw</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/ubuntu/" style="font-size: 10px;">ubuntu</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/10/">October 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">September 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">August 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">July 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">April 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">March 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">February 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/10/06/aca-vm-scale/index/">Azure Container Apps 连接到虚拟机并配置CPU自动缩放</a>
          </li>
        
          <li>
            <a href="/2024/09/28/worker-image-metadata/index/">使用 Cloudflare Worker获取图片元数据</a>
          </li>
        
          <li>
            <a href="/2024/09/27/workers-function/index/">将 Cloudflare Workers 迁移到 Azure Function</a>
          </li>
        
          <li>
            <a href="/2024/09/21/one-api-clickhouse/index/">one-api/new-api性能优化：使用 ClickHouse 作为日志系统</a>
          </li>
        
          <li>
            <a href="/2024/08/03/stripe-fraud/index/">Stripe 如何安全收款并避免盗刷与测卡</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 Benny小土豆<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>