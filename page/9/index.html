<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>土豆不好吃</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="土豆不好吃">
<meta property="og:url" content="http://example.com/page/9/index.html">
<meta property="og:site_name" content="土豆不好吃">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Benny小土豆">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="土豆不好吃" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">土豆不好吃</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-akira/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/12/15/akira/index/" class="article-date">
  <time class="dt-published" datetime="2019-12-15T00:00:00.000Z" itemprop="datePublished">2019-12-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/justsay/">justsay</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/12/15/akira/index/">深海晶好难啊</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>有一句话一定要小点声说?，新垣结衣是我老婆。</p>
<p>一年前，我刚刚参加工作，正好碰到ガッキー老婆主役的《无法成为野兽的我们》，于是便去追了。</p>
<p>直到剧终，我都没怎么理解这部剧究竟在讲什么。阿晶怎么就和京谷分手了，恒星怎么就身败名裂了，我老婆怎么就跟了松田龙平。野木阿姨是不是有点玩脱了。</p>
<p>好吧，我要承认，可能是当初看剧不认真，总是一边玩手机一边看，哎。老婆对不起你，我下次再也不敢玩手机了。</p>
<hr>
<p>一年后的今天，在一个非常阳光明媚的、难得的风平浪静的闲暇的周末下午，我从移动硬盘里找到了这部剧，重新看了起来。</p>
<p>深海晶真的好难啊。生活真的好难啊。阿晶如果能再强势一点就好了。强势一点，把朱里撵走；强势一点，怕他什么99老娘就是要辞职。</p>
<p>阿晶工作能力这么强，公关、接待、写PPT、演示业务，一个人干三四个人的活，带薪假还要被人吵醒工作，不明不白的做了很多本来应该工作职责以外的事情。社长像精神病一样大吼大叫，分不清工作任务。此时应该呼叫一下程序员津崎平匡：指示非常明确。</p>
<p>竟然还要为人擦屁股而土下座，甚至在之后还要被职务骚扰。我的刀已经拔出来了。</p>
<p><img src="/images/2019121513315242.png" alt="《我们无法成为野兽》这部剧火到爆"></p>
<p>周一零点，哦不是周二，地铁站的末班电车，被人撞翻的手机，如果跳下去了一切就都解决了吧。四杯啤酒都无法排遣的艰难。</p>
<p>一切都是生活所迫啊，另一边的根元恒星也被人抓着把柄。恒星说阿晶的笑容恶心，是假笑。是恒星的冷嘲热讽使得深海晶脱下了只会逃避、不会拒绝、只会忍让、总是以虚假的笑容面对一切的面具。</p>
<p>也许，只有到了一定年纪，有了一定的经历，才能体会到吧。</p>
<hr>
<p>日本人这一两年就是不想上班呢……</p>
<p>从《无法成为野兽里的》到《凪的新生活》中就是不想上班的黑木华；</p>
<p>《我要准时下班》里准时下班的东山结衣（吉高由里子）；</p>
<p>《我的事说来话长》家里蹲，话多喜欢和秘书姐姐对着干的生田斗真；</p>
<p>就算上班，《这个不可以报销》里的多部未华子也会让你的报销很痛苦的哦；</p>
<p>那还是不上班了，但是《坡道上的家》带孩子也是很困难的哦！</p>
<hr>
<p>你看，就是要这样贴近生活嘛。</p>
<p>工作一年半之后，再次看这部剧，莫名的觉得感同身受，真的好难啊。我也好难啊。什么时候能够像野兽一样自由自在就好了。????</p>
<p>哦对了，这位冈持三郎，有没有觉得有些好似戏外的我们呢？</p>
<p><img src="/images/2019121513320032.jpeg" alt="https://pic.pimg.tw/ricgrady/1540040590-2364988629_l.jpg"></p>
<p><img src="/images/2019121513320775.jpeg" alt="https://pic.pimg.tw/ricgrady/1540040592-1740601626_l.jpg"></p>
<hr>
<p>不说了，我爱老婆。老婆爱我。</p>
<blockquote>
<p>在这一点上我不接受一切异议和反驳。</p>
</blockquote>
<p><img src="/images/2019121513321127.jpeg" alt="https://2.bp.blogspot.com/-HAbvKir5GTY/WGXhP-Q62zI/AAAAAAAABig/DtBLL9pkEUgAPEsDKs2xEdzZpbj7kgaiACLcB/s1600/snapshot20161230122157.jpg"></p>
<p>我要去赚钱养老婆啦。じゃあね。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/12/15/akira/index/" data-id="clhp7rtds0003s2qr484jemdg" data-title="深海晶好难啊" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-esxi-tutorial/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/11/16/esxi-tutorial/index/" class="article-date">
  <time class="dt-published" datetime="2019-11-16T00:00:00.000Z" itemprop="datePublished">2019-11-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/it/">it</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/11/16/esxi-tutorial/index/">ESXi入门指南</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="什么是ESXi"><a href="#什么是ESXi" class="headerlink" title="什么是ESXi"></a>什么是ESXi</h2><blockquote>
<p>VMware ESXi是由VMware开发的用于部署和服务虚拟计算机的企业级1类管理程序。作为Type-1虚拟机管理程序，ESXi不是操作系统上安装的软件应用程序；相反，它包括并集成了重要的OS组件，例如内核。在4.1版之后，VMware将ESX重命名为ESXi。</p>
</blockquote>
<p>摘自维基百科英文版翻译</p>
<p>简单的说，ESXi就是一个虚拟机。但是与VMware Workstation、VirtualBox等工具却又有些不同。更具体的说，VMware Workstation等工具是运行在操作系统之上的一个软件，如果没有对应的操作系统（Windows、macOS、Linux）等，它自身是无法运行的，操作系统不让它做的事情它也做不了，这种虚拟机我们一般叫“Type 2”虚拟机。</p>
<p>既然有Type 2，那也是有Type 1的，所谓Type 1虚拟机，就是它本身就是一个操作系统，直接运行在裸机上。ESXi就属于这种。</p>
<p> </p>
<p>“人傻钱多戴，美帝良心想”</p>
<p>提到戴尔，我相信绝大部分人的印象都是这家伙不是卖笔记本、卖显示器，还卖服务器的吗？</p>
<p>哦好吧，其实<strong>VMware是DELL的子公司</strong>。是这样的，VMware被EMC收购了，DELL又把EMC收购了。</p>
<h2 id="ESXi硬件要求"><a href="#ESXi硬件要求" class="headerlink" title="ESXi硬件要求"></a>ESXi硬件要求</h2><p>ESXi的硬件要求很低，总结来说大概如下：</p>
<ul>
<li>至少双核CPU</li>
<li>至少4G内存</li>
<li>以太网控制器</li>
</ul>
<p>除此之外，最好再支持硬件虚拟化Intel VT-x 或 AMD RVI</p>
<p>具体详细硬件配置可以查看官网的文档 <a target="_blank" rel="noopener" href="https://docs.vmware.com/cn/VMware-vSphere/6.5/com.vmware.vsphere.install.doc/GUID-DEB8086A-306B-4239-BF76-E354679202FC.html">ESXi硬件要求</a></p>
<p>相信大家的配置绝对足够跑ESXi了，不过有几点需要注意的地方</p>
<ul>
<li>ESXi本身不支持无线网卡，但是我们可以把无线网卡直通给虚拟机</li>
<li>“不支持”Realtek 螃蟹?️网卡，VMware因为商业化原因移除了对Realtek的支持，但是可以找办法添加回去的</li>
</ul>
<h2 id="使用什么设备运行ESXi"><a href="#使用什么设备运行ESXi" class="headerlink" title="使用什么设备运行ESXi"></a>使用什么设备运行ESXi</h2><p>很简单，用旧的笔记本，各种服务器……好吧，对于个人使用来说，服务器还是算了，那个耗电和噪音受不了的。</p>
<p>对于个人使用来说， 淘汰的笔记本（配置足够的话）、各种迷你主机是比较好的选择。</p>
<p>比如说<a target="_blank" rel="noopener" href="https://www.intel.cn/content/www/cn/zh/products/boards-kits/nuc.html">Intel NUC</a>就是很不错的选择，但是NUC价格又有些贵；所以最终我选择的是占美主机，便宜省电呀……如下图所示</p>
<p><img src="/images/2019111607252622.jpeg" alt="https://gd2.alicdn.com/imgextra/i2/186209729/O1CN01MJP69n2LjvsAbH8Re_!!186209729.jpg"></p>
<p>只不过这个无线网卡，被我拆了卖咸鱼了。</p>
<p>由于NUC这类都是不带内存硬盘的，所以咱要自己买。推荐的话，既然都跑虚拟机了，起步16G为佳。存储的话，自然是M2 NVME或者mSATA的固态了。SATA接口建议还是别插固态，SATA接口留给普通的机械硬盘，做备份存储之类的用途。土豪直接上1T的固态那就不算啦！</p>
<p><img src="/images/2019111607252949.png"></p>
<p>这个功耗很低吧，一个月下来也就是三四块钱的电费</p>
<h2 id="ESXi安装镜像调整（打补丁）"><a href="#ESXi安装镜像调整（打补丁）" class="headerlink" title="ESXi安装镜像调整（打补丁）"></a>ESXi安装镜像调整（打补丁）</h2><h3 id="判断网卡类型"><a href="#判断网卡类型" class="headerlink" title="判断网卡类型"></a>判断网卡类型</h3><p>前面说过，ESXi不支持?️网卡（有好些网卡都是不支持的，所以可以参考上面的硬件要求链接），所以这里需要先判断下自己的机器上什么网卡？如果是螃蟹卡的话，那么需要对安装镜像进行调整。具体判断方法，拆开看芯片，看产品介绍，Live CD下lspci什么的都可以</p>
<h3 id="下载ESXi镜像"><a href="#下载ESXi镜像" class="headerlink" title="下载ESXi镜像"></a>下载ESXi镜像</h3><p>ESXi介绍页面</p>
<p><a target="_blank" rel="noopener" href="https://www.vmware.com/products/vsphere.html">https://www.VMware.com/products/vsphere.html</a></p>
<p>ESXi下载</p>
<p><a target="_blank" rel="noopener" href="https://my.vmware.com/en/web/vmware/info/slug/datacenter_cloud_infrastructure/vmware_vsphere/6_7">https://my.VMware.com/en/web/VMware/info/slug/datacenter_cloud_infrastructure&#x2F;VMware_vsphere&#x2F;6_7</a></p>
<p>我们就点击页面上的 VMware vSphere Hypervisor (ESXi) 6.7U3 下载就可以了。</p>
<p>镜像有两种类型</p>
<p><img src="/images/2019111607252958.png"></p>
<p>第一种的ISO，直接能启动；第二种下载回来说一个zip包，我们可以用它来打补丁。如果你是?️卡，那就选第二种吧</p>
<h3 id="ESXi打补丁"><a href="#ESXi打补丁" class="headerlink" title="ESXi打补丁"></a>ESXi打补丁</h3><p>这个网上文章真的是太多了，基本上就是用ESXi-customer-PS之类的把网卡驱动添加进去</p>
<p>ESXi-customer-ps官网</p>
<p><a target="_blank" rel="noopener" href="https://www.v-front.de/p/esxi-customizer-ps.html">https://www.v-front.de/p/ESXi-customizer-ps.html</a></p>
<p>需要先安装powercli，下载页面</p>
<p><a target="_blank" rel="noopener" href="https://code.vmware.com/web/tool/11.2.0/vmware-powercli">https://code.VMware.com/web/tool/11.2.0/VMware-powercli</a></p>
<p>网卡补丁，根据自己的型号下载offline-bundle，避免网络问题</p>
<p><a target="_blank" rel="noopener" href="https://vibsdepot.v-front.de/wiki/index.php/List_of_currently_available_ESXi_packages">https://vibsdepot.v-front.de/wiki/index.php/List_of_currently_available_ESXi_packages</a></p>
<p>如何打补丁可以自己搜索下，我这里贴上来两篇</p>
<p><a target="_blank" rel="noopener" href="https://www.smbinn.com/vmnetwork.html">https://www.smbinn.com/vmnetwork.html</a></p>
<p><a target="_blank" rel="noopener" href="https://rexzhang.com/post/cf06a796-44d5-11e4-9bb5-f23c9150b910">https://rexzhang.com/post/cf06a796-44d5-11e4-9bb5-f23c9150b910</a></p>
<p>简单描述是这样的，打开powershell，切换到对应的目录</p>
<p># 取消可能的系统限制<br>Set-ExecutionPolicy -ExecutionPolicy RemoteSigned<br>Set-ExecutionPolicy Unrestricted</p>
<h1 id="离线打补丁-official-zip是ESXi的offline-bundle，drivers目录包含了vib文件的目录"><a href="#离线打补丁-official-zip是ESXi的offline-bundle，drivers目录包含了vib文件的目录" class="headerlink" title="离线打补丁  official.zip是ESXi的offline bundle，drivers目录包含了vib文件的目录"></a>离线打补丁  official.zip是ESXi的offline bundle，drivers目录包含了vib文件的目录</h1><p>.\ESXi-Customizer-PS-v2.6.0.ps1 -izip .\official.zip -pkgDir C:\Users\abc\Dropbox\ESXi\drivers</p>
<h1 id="在线打补丁，依赖比较好的网络环境"><a href="#在线打补丁，依赖比较好的网络环境" class="headerlink" title="在线打补丁，依赖比较好的网络环境"></a>在线打补丁，依赖比较好的网络环境</h1><p>.\ESXi-Customizer-PS-v2.6.0.ps1 -v67 -vft -load net55-r8168</p>
<h3 id="支持Realtek-8168-x2F-8111-x2F-8411-x2F-8118的成品"><a href="#支持Realtek-8168-x2F-8111-x2F-8411-x2F-8118的成品" class="headerlink" title="支持Realtek 8168&#x2F;8111&#x2F;8411&#x2F;8118的成品"></a>支持Realtek 8168&#x2F;8111&#x2F;8411&#x2F;8118的成品</h3><p>如果你的网卡也是Realtek 8168&#x2F;8111&#x2F;8411&#x2F;8118的话，并且信任我，可以考虑用我的现成的，<a target="_blank" rel="noopener" href="https://www.dropbox.com/s/aly7y4nrhjdpdmr/ESXi-6.7.0-20190802001-standard-customized.iso?dl=0">戳这里去dropbox</a></p>
<h2 id="ESXi安装"><a href="#ESXi安装" class="headerlink" title="ESXi安装"></a>ESXi安装</h2><p>把iso写到U盘中，比如说使用rufus这种，然后启动插U盘启动电脑，哦对了还要有个显示器和HDMI……</p>
<p>安装过程很简单，接受，输入密码，下一步，下一步……</p>
<p> </p>
<p>小提示：没有显示器怎么办？</p>
<p>靠着虚拟机、网卡指示灯、硬盘灯摸索着来吧。</p>
<p>哦当然了，ESXi要插网线直接连到网络设备（如路由器）的，要不玩什么呀！</p>
<h2 id="ESXi管理"><a href="#ESXi管理" class="headerlink" title="ESXi管理"></a>ESXi管理</h2><p>ESXi安装完成之后，想办法获取到它的IP地址，直接浏览器访问就可以了。</p>
<h3 id="使用ESXi网页端管理虚拟机"><a href="#使用ESXi网页端管理虚拟机" class="headerlink" title="使用ESXi网页端管理虚拟机"></a>使用ESXi网页端管理虚拟机</h3><p>界面很简洁，看着就会用</p>
<p><img src="/images/2019111607253217.png"></p>
<h3 id="使用VMware-Workstation管理虚拟机"><a href="#使用VMware-Workstation管理虚拟机" class="headerlink" title="使用VMware Workstation管理虚拟机"></a>使用VMware Workstation管理虚拟机</h3><p>如果你的电脑上装有VMware Workstation的话，文件-连接到服务器，输入IP用户名（root）、密码也是可以进行简单的管理的</p>
<h3 id="进一步的管理：Vcenter"><a href="#进一步的管理：Vcenter" class="headerlink" title="进一步的管理：Vcenter"></a>进一步的管理：Vcenter</h3><p>ESXi本身的管理功能比较基础，甚至连克隆、迁移等功能都没有。为了做到这点，可以开个虚拟机安装vcenter。</p>
<p>什么是注册虚拟机</p>
<h2 id="ESXi创建虚拟机方法"><a href="#ESXi创建虚拟机方法" class="headerlink" title="ESXi创建虚拟机方法"></a>ESXi创建虚拟机方法</h2><p>ESXi的使用非常简单，只要是用过虚拟机的人应该就是十分清楚的，傻瓜化操作</p>
<h3 id="直接创建虚拟机"><a href="#直接创建虚拟机" class="headerlink" title="直接创建虚拟机"></a>直接创建虚拟机</h3><p><img src="/images/2019111607253436.png"></p>
<h3 id="从ovf部署虚拟机"><a href="#从ovf部署虚拟机" class="headerlink" title="从ovf部署虚拟机"></a>从ovf部署虚拟机</h3><p>从VMware Workstation和virtualbox导出的文件都可以导入进来的</p>
<p><img src="/images/2019111607253765.png"></p>
<h3 id="注册虚拟机"><a href="#注册虚拟机" class="headerlink" title="注册虚拟机"></a>注册虚拟机</h3><p>假如已经有了虚拟机的vmdk文件，并且这个文件在datastore中，那么我们可以直接注册虚拟机的。方法太简单了，不说了。</p>
<h3 id="使用cloud-image"><a href="#使用cloud-image" class="headerlink" title="使用cloud image"></a>使用cloud image</h3><p>作为非常爱惜硬盘的我，如果从Ubuntu Server安装一个服务器版Ubuntu的话，不仅浪费时间，需要手工干预安装，而且还很占用硬盘。所以ubuntu官方维护了一个云镜像，其中包含各种环境使用的镜像，可以直接导入。</p>
<p>下面这个链接是每日构建的，点进去选一个日期，下载对应的ovf&#x2F;ova文件就可以了</p>
<p><a target="_blank" rel="noopener" href="https://cloud-images.ubuntu.com/bionic/">https://cloud-images.ubuntu.com/bionic/</a></p>
<p>这个链接是发布版的，同样下载ovf&#x2F;ova文件</p>
<p><a target="_blank" rel="noopener" href="https://cloud-images.ubuntu.com/releases/">https://cloud-images.ubuntu.com/releases/</a></p>
<p><img src="/images/201911160725385.png"></p>
<p>下载回来直接导入就可以了</p>
<p>但是这个cloud image的root密码是什么呀！别怕，随机密码。开机按shift进grub，选择recovery mode破个密码就好了。然后再parted或者fdisk弄下分区，完美。Cloud image安装完占用硬盘不到1G哦～</p>
<h2 id="ESXi-虚拟机设置"><a href="#ESXi-虚拟机设置" class="headerlink" title="ESXi 虚拟机设置"></a>ESXi 虚拟机设置</h2><h3 id="CPU资源限制"><a href="#CPU资源限制" class="headerlink" title="CPU资源限制"></a>CPU资源限制</h3><p>如下图所示，我们可以为此虚拟机预留一定的CPU资源、限制CPU资源（虚拟机不会使用超过这个频率的CPU）、份额，以及常见的硬件虚拟化、性能计数器等。</p>
<p><img src="/images/2019111607253924.png"></p>
<p>份额这个概念比较特殊，详细解释如下：</p>
<blockquote>
<p>份额指定虚拟机（或资源池）的相对重要性。如果某个虚拟机的资源份额是另一个虚拟机的两倍，则在这两个虚拟机争用资源时，第一个虚拟机有权消耗两倍于第二个虚拟机的资源。</p>
<p>份额通常指定为高、正常或低，这些值将分别按 4:2:1 的比例指定份额值。还可以选择自定义为各虚拟机分配特定的份额值（表示比例权重）。</p>
</blockquote>
<p>举个例子，</p>
<blockquote>
<p>一台聚合 CPU 容量为 8 GHz 的主机上运行着两个受 CPU 约束的虚拟机。它们的 CPU 份额设置为正常，因此各得 4GHz。</p>
<p>现在打开了第三个受 CPU 约束的虚拟机的电源。它的 CPU 份额设置为高，这意味着它拥有的份额值应该是设置为正常的虚拟机的两倍。新的虚拟机获得 4GHz，其他两个虚拟机各自仅获得 2GHz。如果用户为第三个虚拟机指定的自定义份额值为 2000，也会出现相同的结果。</p>
</blockquote>
<h3 id="内存资源限制"><a href="#内存资源限制" class="headerlink" title="内存资源限制"></a>内存资源限制</h3><p>与CPU资源限制类似，内存也是可以进行限制的，道理类似</p>
<p><img src="/images/2019111607254012.png"></p>
<h3 id="硬盘资源限制"><a href="#硬盘资源限制" class="headerlink" title="硬盘资源限制"></a>硬盘资源限制</h3><p>同理，可以限制硬盘写入，所以知道怎么做<strong>石头盘</strong>了吧！</p>
<p><img src="/images/2019111607254134.png"></p>
<h3 id="添加其他设备"><a href="#添加其他设备" class="headerlink" title="添加其他设备"></a>添加其他设备</h3><p>前面提过，ESXi不支持无线网卡，但是我们可以把无线网卡直接分配给虚拟机，那么就要用到网卡直通。具体方法就是编辑虚拟机设置，添加其他设备-PCI设备&#x2F;USB设备</p>
<p><img src="/images/2019111607254256.png"></p>
<h3 id="虚拟机引导选项"><a href="#虚拟机引导选项" class="headerlink" title="虚拟机引导选项"></a>虚拟机引导选项</h3><p>和VMware Workstation的设置基本差不多，一看就懂</p>
<p><img src="/images/2019111607254455.png"></p>
<h2 id="ESXi-控制台连接"><a href="#ESXi-控制台连接" class="headerlink" title="ESXi 控制台连接"></a>ESXi 控制台连接</h2><p>我们可以直接通过网页端访问控制台端口，也可以通过下载VMware Remote Console，或是VMware Workstation访问。</p>
<h2 id="数据存储管理"><a href="#数据存储管理" class="headerlink" title="数据存储管理"></a>数据存储管理</h2><p>要装虚拟机，自然就要用ISO镜像，那ISO镜像自然就要上传到ESXi中……具体就是使用数据存储功能。</p>
<p>左侧导航栏直接点进去存储</p>
<p><img src="/images/2019111607254569.png"></p>
<h3 id="数据存储管理器"><a href="#数据存储管理器" class="headerlink" title="数据存储管理器"></a>数据存储管理器</h3><p>点击数据存储管理器，太简明易懂了……上传就是了。</p>
<p><img src="/images/2019111607254683.png"></p>
<h3 id="添加存储"><a href="#添加存储" class="headerlink" title="添加存储"></a>添加存储</h3><p>ESXi默认会识别接驳的硬盘等设备，但是我们也可以添加网络存储，比如NFS，点击新建数据存储，选择NFS</p>
<p><img src="/images/201911160725471.png"></p>
<p>相应的添加就好了</p>
<h2 id="ESXi网络设置之物理网卡"><a href="#ESXi网络设置之物理网卡" class="headerlink" title="ESXi网络设置之物理网卡"></a>ESXi网络设置之物理网卡</h2><p>熟悉VMware Workstation可能知道，VMware Workstation的网络可以分为桥接、NAT、host only等，那么ESXi呢……对不起，ESXi天生桥接。</p>
<p>在ESXi的网络设置中……</p>
<p>物理网卡的概念很好理解，就是真实接线的网卡，ESXi本身是支持多网卡的，利用多网卡可以玩出很多花样，比如软路由……</p>
<p><img src="/images/2019111607254984.png"></p>
<h2 id="ESXi网络设置之虚拟交换机"><a href="#ESXi网络设置之虚拟交换机" class="headerlink" title="ESXi网络设置之虚拟交换机"></a>ESXi网络设置之虚拟交换机</h2><p>交换机这个概念，对于不是搞网络的人来说，可能很生疏。路由器、交换机、集线器这三者究竟有啥区别啊？这不是本文讨论的重点。</p>
<p>ESXi中的虚拟机交换机的概念很简单，简单的说就是连到虚拟机的那个“设备”，由ESXi的内核提供，只有二层桥接的功能，不像真实的交换机，又能配ACL又能配这配那的。比如我们看下下面的这个图</p>
<p><img src="/images/2019111607255041.png"></p>
<p>这么多台虚拟机都“连接”到了这一虚拟交换机上，然后这个虚拟交换机用两条真实的网线连接到了我的路由器上。</p>
<p>虚拟交换机有啥意义呢？比如我有两块物理网卡，一块是192.168.1.0&#x2F;24，另一块是192.168.2.0&#x2F;24，那么我们就可以通过添加两个vSwitch，然后不同的虚拟机就可以属于不同的网段啦。</p>
<h3 id="添加vSwitch"><a href="#添加vSwitch" class="headerlink" title="添加vSwitch"></a>添加vSwitch</h3><p>虚拟交换机这东西，由于是内核虚拟的，自然也可以自己添加。方法也很简单，直接点击添加，起个名字，选择绑定到哪块物理网卡，确定就可以了。如下图所示</p>
<p><img src="/images/2019111607255231.png"></p>
<p>当然了需要注意的是，一块网卡一旦属于某个虚拟交换机，那它就不能属于其他的虚拟交换机了。</p>
<h3 id="虚拟交换机、添加上行链路"><a href="#虚拟交换机、添加上行链路" class="headerlink" title="虚拟交换机、添加上行链路"></a>虚拟交换机、添加上行链路</h3><p>俗话说，狡兔三窟。一个虚拟交换机，如果增加网线作为备份线路，那也是有备无患的。</p>
<p>所以编辑vSwitch，添加另外一条上行链路作为冗余。这样当你拔掉一条网线，虚拟机们还能无缝切换（真的是无缝，可能连TCP丢包都没有），一点不受影响。</p>
<p>添加方法很简单，直接编辑，添加另一条物理链路就好了</p>
<p>另外，假如你的ESXi不接网线，那么属于同一个vSwitch之间的虚拟机还是能通信的，而且是万兆网卡哦！只是流量不能往外走，要不怎么叫上行链路呢。</p>
<h2 id="虚拟交换机-网卡绑定"><a href="#虚拟交换机-网卡绑定" class="headerlink" title="虚拟交换机 网卡绑定"></a>虚拟交换机 网卡绑定</h2><p>所谓网卡绑定，就是当你为一个虚拟交换机添加多条上行链路的时候，想让ESXi怎么调度啊？类似链路聚合，你是想round-robin，还是active backup，还是load balance呢？网卡绑定就是干这个事情的。</p>
<p><img src="/images/2019111607255418.png"></p>
<p>ESXi的这四种模式，对应的意义如下：</p>
<ul>
<li>基于源端口 ID 的路由（默认）：则根据流量进入虚拟交换机的虚拟端口选择上行链接。</li>
</ul>
<p>基于 IP 哈希的路由：根据每个数据包的源和目标 IP 地址的 Hash 选择上行链接。对于非 IP 数据包，会使用位于这些偏移上的任何内容计算 Hash。</p>
<ul>
<li>基于源 MAC 哈希的路由：根据源以太网的 Hash 选择上行链接。</li>
<li>使用明确故障切换顺序：始终使用“活动适配器”列表中位于最前列的符合故障切换检测标准的上行链路。（本图就是vmnic0）</li>
</ul>
<h3 id="虚拟交换机-流量调整"><a href="#虚拟交换机-流量调整" class="headerlink" title="虚拟交换机 流量调整"></a>虚拟交换机 流量调整</h3><p>买VPS的时候……你这个口不是独享的！好吧，ESXi也能针对虚拟交换机进行流量限制，如下图所示</p>
<p><img src="/images/2019111607255593.png"></p>
<h2 id="ESXi-网络设置-端口组"><a href="#ESXi-网络设置-端口组" class="headerlink" title="ESXi 网络设置 端口组"></a>ESXi 网络设置 端口组</h2><p>实际上呢，虚拟机并不是直接连到vSwitch的。虚拟机上直接连接到端口组上的。不同的虚拟机可以属于不同的端口组。</p>
<p>端口组与虚拟机网络设置</p>
<p><img src="/images/201911160725566.png"></p>
<p>添加端口组</p>
<p><img src="/images/2019111607255657.png"></p>
<h2 id="ESXi-VMkernel网卡"><a href="#ESXi-VMkernel网卡" class="headerlink" title="ESXi VMkernel网卡"></a>ESXi VMkernel网卡</h2><p>ESXi本身是通过网络管理的，那么自然也要有一个对应的“网卡”，这里就是vmk网卡。可以把它理解成一个特殊的端口组，主要就是提供管理相关的访问。</p>
<p><img src="/images/2019111607255838.png"></p>
<p>有的时候，我们可能希望，所有虚拟机使用某一段的IP，但是管理使用另一段IP，这里就可以通过添加VMKernel网卡做到。</p>
<p><img src="/images/2019111607255920.png"></p>
<p>比如我们希望ESXi的管理IP能够有多个，做个备份，那么添加vmkernel也能做到</p>
<p>添加之后的结果</p>
<p><img src="/images/2019111607260117.png"></p>
<p>此时Vmkernel的拓扑</p>
<p><img src="/images/2019111607260113.png"></p>
<h2 id="我的ESXi玩法"><a href="#我的ESXi玩法" class="headerlink" title="我的ESXi玩法"></a>我的ESXi玩法</h2><ul>
<li>kali，还有一个XP，用途你懂的；</li>
<li>Windows 7，用于下载电影电视剧什么的；</li>
<li>Ubuntu Desktop，装了点GUI应用，开了samba服务，默认启动到multi-user。上面的Windows 7下载的文件直接存到了这里，然后电视iPad等直接就能看了；</li>
<li>csr1000v，模拟Cisco IOS网络设备，其实并无卵用，放着吃灰的。</li>
<li>TimeMachine，从Cloud Image导入的，用于macOS的时间机器备份，做了LVM，啥都不怕。</li>
<li>Ubuntu Minimal，从Cloud Image导入的，我也不知道干啥的</li>
<li>Tiny Core，不知道干啥的，玩的吧。</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>ESXi真是太强大了，开虚拟机随便玩，部分硬件可以直通到虚拟机中；甚至可以给ESXi主机开ssh，然后可以执行一些ssh命令，甚至可以运行Python，吼。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/11/16/esxi-tutorial/index/" data-id="clhp7rths005vs2qrc9339pvl" data-title="ESXi入门指南" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-first-mbp/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/11/08/first-mbp/index/" class="article-date">
  <time class="dt-published" datetime="2019-11-08T00:00:00.000Z" itemprop="datePublished">2019-11-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/justsay/">justsay</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/11/08/first-mbp/index/">还是早日享乐吧——年轻人的第一台MacBook</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>小时候的梦想是能有一个游戏机，能够开心的玩魂斗罗，大概就像下图这种。</p>
<p><img src="https://pbs.twimg.com/media/EIfnoJdUcAEEL4i?format=png&name=360x360" alt="图像"></p>
<p><a target="_blank" rel="noopener" href="https://twitter.com/BennyThinks/status/1191175312043720709?s=20">两年前我实现了这个梦想，买了个Xbox</a>。</p>
<p>上大学的时候呢，希望自己能够有个MacBook……</p>
<p>但是MacBook很贵呀，那时我又没有收入，学费还那么贵，不能花父母的钱呀。</p>
<h2 id="为什么呢？"><a href="#为什么呢？" class="headerlink" title="为什么呢？"></a>为什么呢？</h2><p>工作之后，开始有了收入，周末还会出去做兼职，开始渐渐有了一些积蓄。对于现在的我来说，买房？首付的一半都还没攒到，连个厕所都买不起。我是小有成就，我是有点积蓄，但是这有什么用。</p>
<p>生于穷人家的孩子总是在体验同龄人都在毕业游而我却要<a target="_blank" rel="noopener" href="https://twitter.com/BennyThinks/status/1011895319100051456?s=20">为生活而奔波的落差感</a>。</p>
<p>与其这么辛苦，不如早日享受。无论我再怎么勤俭节约，努力工作赚外快，我也买不起房。</p>
<p>全款是别想了，贷款还需要家里的大力支持。但是我既不想贷款，又不想要家里的钱。</p>
<p>我不想牺牲快乐和自由去换一套房。</p>
<p>原本生活中的必需品，此时却变成奢侈品。</p>
<p>反正既然也买不起房，那就不如享受，人生就是这样，在自己的承受范围内，买一些自己喜欢的东西。</p>
<h2 id="怎么买？"><a href="#怎么买？" class="headerlink" title="怎么买？"></a>怎么买？</h2><p>考虑再三，甚至都做了Excel分析哪家卖的便宜，我得出了以下几个结论</p>
<ul>
<li>闲鱼二手不太靠谱，这么贵重的东西，买二手怕是后患无穷吧</li>
<li>13.3寸的MacBook Pro，京东上只有8G内存版的，15.5寸的才有16G</li>
<li>区域版本，国行12967 CNY，港版12073 CNY，日版11789（税前） 12970（税后），美版11864 CNY，台版12785 CNY，</li>
<li>国行教育，12021 CNY</li>
</ul>
<p>所以这么一看，如果能国行教育优惠，其实是非常划算的。日版退税要求短期出入日本的，那只能麻烦出差的同事了，还要等……</p>
<p>那教育优惠，我又不是学生……但是我认识好多学弟学妹们，这真太简单啦！</p>
<h2 id="开箱"><a href="#开箱" class="headerlink" title="开箱?"></a>开箱?</h2><p>周一买，周三审核通过，周五EMS竟然就给送到了，不错不错。</p>
<p>从快递上看，是从成都发货的，我原以为是北京或者上海呢。</p>
<p>送过来的时候，一个纸箱子，拆开就是MacBook的包装啦！</p>
<p><img src="/images/201911081507474.png"></p>
<p>拆开之后，emmm这个包装还很小的嘛，比ThinkPad X1 Carbon的包装小多了</p>
<p><img src="/images/2019110815075314.jpeg"></p>
<p>拆箱～～</p>
<p><img src="/images/201911081507561.jpeg"></p>
<p>开机设置网络</p>
<p><img src="/images/2019110815080168.png"></p>
<h2 id="第N件事……"><a href="#第N件事……" class="headerlink" title="第N件事……"></a>第N件事……</h2><p>第一件事情，毫无疑问，当然是进行科学上网啦！shadowsocks-ng你懂的！</p>
<p>第二件事情，那就是登录一些账号啦，Google GitHub什么的；</p>
<p>第三件事情，把Python和PyCharm、golang、GoLand什么的都请回来，然后把字号调大点；</p>
<p>第四件事情，你看哦！</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2019/11/2019110815131870.png"><img src="/images/2019110815131870.png"></a></p>
<p>第五件事情，ohmyzsh，然后就是配置下iTerm2、用上zsh以及ohmyzsh，咦；</p>
<p>第六件事情，dropbox、telegram等等一大堆工具；</p>
<p>第七件事情，改个壁纸啦～吼吼吼</p>
<h2 id="总体感受"><a href="#总体感受" class="headerlink" title="总体感受"></a>总体感受</h2><p>真好看啊！真是太好看了！</p>
<p>新的键盘有点不适应，目前看来可能得花一段时间去习惯了。</p>
<p>操作系统有些不熟悉，好些快捷键都记不住，目前处于广场舞老大妈的电脑水平。</p>
<p>这个快捷键和手势有点多，对于我这种只有三天记忆的高级的鱼来说，好难啊?</p>
<p>回到家竟然自动连接上了家里的Wi-Fi，看来是因为iPad所以自来熟了嘛！</p>
<p>Touch Bar有点意思呀，有的时候还是挺方便的，比如点确定的时候，再比如：</p>
<p><img src="/images/2019110815081593.jpeg"></p>
<p>Apple ?标志不亮，这个有点不开心。</p>
<p>原彩显示这个功能有点懵哦，总感觉开了它之后，我的屏幕一片黄。</p>
<p>什么，竟然没有电源按钮。好吧，开盖就开机……呃？是不是有这种情况，我在屏幕和键盘之间夹了一张纸，想要拿出来看?</p>
<p>用力按压触摸板好像有个什么功能哎，还没有学会。</p>
<h2 id="与ThinkPad-X1-Carbon的对比"><a href="#与ThinkPad-X1-Carbon的对比" class="headerlink" title="与ThinkPad X1 Carbon的对比"></a>与ThinkPad X1 Carbon的对比</h2><p>明显能感受出来比X1要沉一些，因为是金属的外壳吧，密度要比X1 Carbon的碳纤维低一些?哎呀终于知道为什么叫Carbon了，原来是因为外壳的碳哦！（据说X1的这个碳纤维还是高科技的？）</p>
<p>屏幕不能180度平躺，这是一个遗憾。</p>
<p>显示效果比X1细腻太多啦，因为屏幕尺寸小、分辨率更高，因此像素密度也更高了。</p>
<p>既然分辨率这么高，那字自然也是小一点咯！由于俺眼神不太好，所以开了第二大的缩放，吼吼吼。</p>
<p>我有点困了，以后再说吧?</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/11/08/first-mbp/index/" data-id="clhp7rtht005xs2qrdu3ke1fa" data-title="还是早日享乐吧——年轻人的第一台MacBook" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-trojan/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/10/02/trojan/index/" class="article-date">
  <time class="dt-published" datetime="2019-10-02T00:00:00.000Z" itemprop="datePublished">2019-10-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/gfw/">gfw</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/10/02/trojan/index/">使用trojan翻越长城的进阶使用方法</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>今天偶然看到了另外一个梯子<a target="_blank" rel="noopener" href="https://github.com/trojan-gfw/trojan">trojan</a>，大致看了下，感觉这东西还是蛮有意思的嘛，思路和其他工具不太一样：把流量放到Application Data里，然后伪装成正常的HTTPS通信，甚至还有一个完全真正的TLS握手。从结果上看起来，有点像Shadowsocks&#x2F;ShadowsocksR的obfs之类的功能，只不过这个从网络层上看就像真正的HTTPS一样。</p>
<p>由于这是一个比较新的项目，所以相关的基础设施还不如shadowsocks那么完善，比如缺少或不完善的移动平台客户端等等~不过这都不是事，相信社区的力量ﾚ(ﾟ∀ﾟ;)ﾍ&#x3D;3&#x3D;3&#x3D;3</p>
<p>配置也很容易，大概可以分为6步</p>
<ul>
<li>准备服务器</li>
<li>准备http服务</li>
<li>弄个域名</li>
<li>搞个证书</li>
<li>写配置，调试，运行</li>
<li>客户端配置、测试</li>
<li>进阶配置</li>
</ul>
<p>[v_blue]想要快速开始？<a target="_blank" rel="noopener" href="https://github.com/trojan-gfw/trojan/wiki/Binary-&-Package-Distributions">戳我</a></p>
<p>@<a target="_blank" rel="noopener" href="https://blog.horo.moe/">ホロちゃん</a>[&#x2F;v_blue]</p>
<h2 id="准备服务器"><a href="#准备服务器" class="headerlink" title="准备服务器"></a>准备服务器</h2><h3 id="VPS"><a href="#VPS" class="headerlink" title="VPS"></a>VPS</h3><p>首先，咱需要准备一个VPS，KVM之类的完全虚拟化的最好，OpenVZ也行。</p>
<p>我就用前段时间免费薅的Oracle Cloud Korea为例了，延迟真是非常理想的，也基本没丢包。</p>
<p><img src="/images/2019100206341267.png"></p>
<p>其他的厂商，可以试试</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.vultr.com/?ref=7771693-4F">Vultr</a>：注册送$50，一个月用完，最低$3.5&#x2F;月，但是据说现在有时会开出来不能用的IP</li>
<li><a target="_blank" rel="noopener" href="https://www.linode.com/?r=c2f16f9ad7b8b9fe0bb5c70de03bca0bbde134ca">Linode</a>：老牌厂商了，$5</li>
<li><a target="_blank" rel="noopener" href="https://www.conoha.jp/referral/?token=dyhzf0fk27vw8znAqdIq2gtp9Ab3JOGctRgrzhrOY.q2MfYpgyY-WHJ">Conoha</a>：日本的主机商，900日元&#x2F;月，据说ToS有点严格，但是我跑梯子、rtorrent、ffmpeg都没被封过，吼吼</li>
<li><a target="_blank" rel="noopener" href="https://m.do.co/c/efaeb1b7c950">DigitalOcean</a>：和Vultr一样也是送$50一个月用完</li>
<li><a target="_blank" rel="noopener" href="https://billing.virmach.com/aff.php?aff=8589">VirMach</a>：被称作低价屠夫，特别便宜的年付VPS，比如有时促销会有年付$7的KVM机器，新用户貌似还能折扣，不过他家换IP就要交钱，这点就比较坑了</li>
</ul>
<h3 id="防火墙"><a href="#防火墙" class="headerlink" title="防火墙"></a>防火墙</h3><p>装好系统，ssh连接上，记得把防火墙什么的都搞定了，需要注意，不仅要关注系统自身的防火墙，也要注意下厂商的“安全组”这类东西。</p>
<p>清除iptables的规则，可以参考如下命令：</p>
<p>sudo iptables -P INPUT ACCEPT<br>sudo iptables -P FORWARD ACCEPT<br>sudo iptables -P OUTPUT ACCEPT<br>sudo iptables -t nat -F<br>sudo iptables -t mangle -F<br>sudo iptables -F<br>sudo iptables -X</p>
<p>如有必要，可以安装iptables-save等工具持久化</p>
<h2 id="准备http服务"><a href="#准备http服务" class="headerlink" title="准备http服务"></a>准备http服务</h2><p>官方文档建议配置一个http服务器，所以咱就简单的弄下吧，Debian系为例，使用root权限执行如下命令：</p>
<p>apt install nginx</p>
<p>CentOS可以用yum安装</p>
<p>yum install nginx</p>
<p>此时访问<a target="_blank" rel="noopener" href="http://ip/">http://ip</a> 应该能看到默认的欢迎页面了。</p>
<h2 id="弄个域名"><a href="#弄个域名" class="headerlink" title="弄个域名"></a>弄个域名</h2><p>域名的话，什么域名都无所谓的，可以自己注册个免费的cf什么的域名，也可以注册个正经的域名，假如不想花钱，那用DDNS也可以，比如<a target="_blank" rel="noopener" href="https://www.dynu.com/zh-CN/">dynu</a>提供免费的二级域名。</p>
<p>域名搞到手之后，做个A记录的解析到服务器IP</p>
<h2 id="搞个证书"><a href="#搞个证书" class="headerlink" title="搞个证书"></a>搞个证书</h2><p>有两种方式，一种是申请一个真正的证书，另外一种是用openssl生成一个自签名证书。官方建议使用真正的证书。</p>
<h3 id="申请证书"><a href="#申请证书" class="headerlink" title="申请证书"></a>申请证书</h3><p>直接使用Let’s Encrypt就可以了，可以参考如下命令</p>
<p>certbot certonly</p>
<p>然后一步一步按照说明做</p>
<p>详细信息可以参考如下两篇</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/letsencrypt-nginx-subdomain.html">https://dmesg.app/letsencrypt-nginx-subdomain.html</a></p>
<p><a target="_blank" rel="noopener" href="https://letsencrypt.org/zh-cn/getting-started/">https://letsencrypt.org/zh-cn/getting-started/</a></p>
<h3 id="自签名证书"><a href="#自签名证书" class="headerlink" title="自签名证书"></a>自签名证书</h3><p>openssl req -newkey rsa:2048 -nodes -keyout key.pem -x509 -days 3650 -out certificate.pem</p>
<h2 id="服务端配置，调试，运行"><a href="#服务端配置，调试，运行" class="headerlink" title="服务端配置，调试，运行"></a>服务端配置，调试，运行</h2><p>直接从GitHub Release下载二进制文件</p>
<p>wget <a target="_blank" rel="noopener" href="https://github.com/trojan-gfw/trojan/releases/download/v1.13.0/trojan-1.13.0-linux-amd64.tar.xz">https://github.com/trojan-gfw/trojan/releases/download/v1.13.0/trojan-1.13.0-linux-amd64.tar.xz</a><br>tar xf trojan-1.13.0-linux-amd64.tar.xz<br>cd trojan</p>
<p>examples目录中有一个<code>server.json-example</code>，我们直接把他拷贝到上层目录</p>
<p>cp exmaples&#x2F;server.json-example config.json</p>
<p>配置文件的内容很简单，基本上只需要修改password字段和ssl字段就可以了</p>
<p><img src="/images/2019100206341356.png"></p>
<p>运行</p>
<p>.&#x2F;trojan</p>
<p>基本上没报错，在运行了就可以~</p>
<h2 id="客户端配置运行"><a href="#客户端配置运行" class="headerlink" title="客户端配置运行"></a>客户端配置运行</h2><p>这里以PC为例，Android&#x2F;iOS可以找找相应的工具</p>
<p>同样从GitHub Release下载对应的文件，解压缩，把<code>client.json-example</code>拷贝出来</p>
<p>我们只需要关注<code>local_port、remote_addr、remote_port、password</code>和<code>ssl</code>的几个字段</p>
<ul>
<li><code>local_port</code> 本地监听的端口，我这里设置为了11080，避免和本机的Shadowsocks冲突</li>
<li><code>remote_addr</code>：申请的域名</li>
<li><code>remote_port</code>：上面服务端配置的端口，一般来说就是443</li>
<li><code>password</code>：密码，要与服务端配置的密码列表中的一个相符</li>
<li>ssl：如果你使用的是自签名证书，那么<code>verify</code>要写false，假如common name也是瞎写的，那么<code>verify_hostname</code>也要写false；假如用的是真证书，那么就都true就可以了</li>
</ul>
<p><img src="/images/2019100206341423.png"></p>
<p>然后<code>./trojan</code>运行就可以了，此时trojan会监听指定的端口，socks5，本例为11080</p>
<p>然后打开你的proxyswitchy omega，这么配置下就可以了</p>
<p><img src="/images/2019100206341518.png"></p>
<p>更进一步，可以用proxy switchy omega的自动切换模式+GFWList</p>
<p>如果在Windows上运行提示缺少VCRUNTIME等，请安装相应的VC运行库，可以参考文末链接</p>
<h2 id="测速"><a href="#测速" class="headerlink" title="测速"></a>测速</h2><p>都在服务端开启了BBR的情况下进行的测试</p>
<h3 id="使用Shadowsocks"><a href="#使用Shadowsocks" class="headerlink" title="使用Shadowsocks"></a>使用Shadowsocks</h3><p><img src="/images/201910020634178.png"></p>
<h3 id="trojan"><a href="#trojan" class="headerlink" title="trojan"></a>trojan</h3><p><img src="/images/2019100206341889.png"></p>
<p>速度还是很理想的，就是不知道稳不稳了。</p>
<h2 id="进阶配置"><a href="#进阶配置" class="headerlink" title="进阶配置"></a>进阶配置</h2><h3 id="使用BBR"><a href="#使用BBR" class="headerlink" title="使用BBR"></a>使用BBR</h3><p>偷懒，<a target="_blank" rel="noopener" href="https://teddysun.com/489.html">直接用秋水逸冰的吧</a></p>
<p>wget –no-check-certificate <a target="_blank" rel="noopener" href="https://github.com/teddysun/across/raw/master/bbr.sh">https://github.com/teddysun/across/raw/master/bbr.sh</a> &amp;&amp; chmod +x bbr.sh &amp;&amp; .&#x2F;bbr.sh</p>
<h3 id="开启TFO（TCP-Fast-Open）"><a href="#开启TFO（TCP-Fast-Open）" class="headerlink" title="开启TFO（TCP Fast Open）"></a>开启TFO（TCP Fast Open）</h3><p>sysctl -w net.ipv4.tcp_fastopen&#x3D;3<br>sysctl -p &#x2F;etc&#x2F;sysctl.conf<br>cat &#x2F;proc&#x2F;sys&#x2F;net&#x2F;ipv4&#x2F;tcp_fastopen</p>
<p>结果为3就对了</p>
<p>然后服务端和客户端的<code>tcp.fast_open</code>都改成true</p>
<p><img src="/images/2019100206342045.png"></p>
<h3 id="配置systemd"><a href="#配置systemd" class="headerlink" title="配置systemd"></a>配置systemd</h3><p>创建文件，<code>/etc/systemd/system/trojan.service</code>或者<code>/lib/system/system/trojan.service</code></p>
<p>[Unit]<br>Description&#x3D;Trojan<br>After&#x3D;network.target network-online.target nss-lookup.target</p>
<p>[Service]<br>Restart&#x3D;on-failure<br>Type&#x3D;simple<br>ExecStart&#x3D;&#x2F;path&#x2F;to&#x2F;trojan config.json</p>
<p>[Install]<br>WantedBy&#x3D;multi-user.target</p>
<p>自启</p>
<p>systemctl daemon-reload</p>
<p>systemctl enable trojan<br>systemctl start trojan<br>systemctl status trojan</p>
<h3 id="使用非root、non-login-shell运行"><a href="#使用非root、non-login-shell运行" class="headerlink" title="使用非root、non-login shell运行"></a>使用非root、non-login shell运行</h3><h4 id="新增用户"><a href="#新增用户" class="headerlink" title="新增用户"></a>新增用户</h4><p>useradd –s &#x2F;usr&#x2F;sbin&#x2F;nologin trojan</p>
<h1 id="改权限"><a href="#改权限" class="headerlink" title="改权限"></a>改权限</h1><p>chown -R trojan:trojan &#x2F;path&#x2F;to&#x2F;trojan</p>
<h4 id="授予监听标准端口权限"><a href="#授予监听标准端口权限" class="headerlink" title="授予监听标准端口权限"></a>授予监听标准端口权限</h4><p>由于1024以下端口默认只能由root监听，所以要让非root用户监听，大概有以下几个方法：</p>
<ul>
<li>suid：<code>chmod u+x /opt/trojan/trojan</code></li>
<li>iptables转发，确保开启转发<code>net.ipv4.ip_forward=1</code>，然后<code>iptables -t nat -A PREROUTING -p tcp --dport 443 -j DNAT --to:4433</code></li>
<li>CAP_NET_BIND_SERVICE <code>setcap cap_net_bind_service=+eip /opt/trojan/trojan</code></li>
</ul>
<h4 id="system微调"><a href="#system微调" class="headerlink" title="system微调"></a>system微调</h4><p>[Unit]<br>Description&#x3D;Trojan<br>After&#x3D;network.target network-online.target nss-lookup.target</p>
<p>[Service]<br>User&#x3D;trojan<br>Group&#x3D;trojan<br>Restart&#x3D;on-failure<br>Type&#x3D;simple<br>ExecStart&#x3D;&#x2F;path&#x2F;to&#x2F;trojan</p>
<p>[Install]<br>WantedBy&#x3D;multi-user.target</p>
<h3 id="使用HTTP-x2F-2"><a href="#使用HTTP-x2F-2" class="headerlink" title="使用HTTP&#x2F;2"></a>使用HTTP&#x2F;2</h3><p>服务端alpn中加入h2，如下图所示</p>
<p><img src="/images/2019100206342076.png"></p>
<p>当然客户端也要确保有这个h2哦~</p>
<h3 id="TLS-1-3"><a href="#TLS-1-3" class="headerlink" title="TLS 1.3"></a>TLS 1.3</h3><p>已经支持啦，当然了，要你的openssl版本在1.1.1以上哦。对啦，cipher suite要改下，比如说</p>
<p>TLS13-AES-256-GCM-SHA384:TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-128-GCM-SHA256:TLS13-AES-128-CCM-8-SHA256:TLS13-AES-128-CCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256</p>
<h3 id="使用数据库做验证"><a href="#使用数据库做验证" class="headerlink" title="使用数据库做验证"></a>使用数据库做验证</h3><p>更高级的配置，比如流量控制等，可以通过MySQL实现</p>
<p>在服务端配置最后的mysql字段，确保用户名密码正确，本机装好了MySQL</p>
<p><img src="/images/2019100206342119.png"></p>
<p>然后进入mysqlcli，创建数据库、创建表、插入用户</p>
<p># 创建数据库<br>create database trojan;<br>use trojan;</p>
<h1 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h1><p>CREATE TABLE users (<br>id INT UNSIGNED NOT NULL AUTO_INCREMENT,<br>username VARCHAR(64) NOT NULL,<br>password CHAR(56) NOT NULL,<br>quota BIGINT NOT NULL DEFAULT 0,<br>download BIGINT UNSIGNED NOT NULL DEFAULT 0,<br>upload BIGINT UNSIGNED NOT NULL DEFAULT 0,<br>PRIMARY KEY (id),<br>INDEX (password)</p>
<p>);</p>
<h1 id="创建用户"><a href="#创建用户" class="headerlink" title="创建用户"></a>创建用户</h1><p>INSERT INTO users VALUES(NULL,’benny’,’Fire’,1024,100,50);</p>
<p>trojan会先查询配置文件中的password字段，然后查询数据库中的字段。之后会去计算50+100&lt;100（上传+下载是否小于限额），小于的话，允许链接。</p>
<p>上述SQL语句中，1024如果是负数，意味着不限额。</p>
<p>quota、download、upload单位都是字节</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>项目主页<a target="_blank" rel="noopener" href="https://github.com/trojan-gfw/trojan">https://github.com/trojan-gfw/trojan</a></p>
<p>teddysun一键bbr脚本 <a target="_blank" rel="noopener" href="https://teddysun.com/489.html">https://teddysun.com/489.html</a></p>
<p>dynuddns <a target="_blank" rel="noopener" href="https://www.dynu.com/">https://www.dynu.com</a></p>
<p>nginx与trojan <a target="_blank" rel="noopener" href="https://github.com/trojan-gfw/trojan/issues/67">https://github.com/trojan-gfw/trojan/issues/67</a></p>
<p>设计讨论 <a target="_blank" rel="noopener" href="https://github.com/trojan-gfw/trojan/issues/14">https://github.com/trojan-gfw/trojan/issues/14</a></p>
<p>VC运行库<a target="_blank" rel="noopener" href="https://aka.ms/vs/16/release/VC_redist.x64.exe">https://aka.ms/vs/16/release/VC_redist.x64.exe</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/RPCS3/rpcs3/issues/6646">https://github.com/RPCS3/rpcs3/issues/6646</a></p>
<p>配置文件详解<a target="_blank" rel="noopener" href="https://trojan-gfw.github.io/trojan/config">https://trojan-gfw.github.io/trojan/config</a></p>
<p>android客户端 <a target="_blank" rel="noopener" href="https://github.com/trojan-gfw/igniter">https://github.com/trojan-gfw/igniter</a></p>
<p>iOS：shadowrocket的test flight版</p>
<p>SSL证书配置：<a target="_blank" rel="noopener" href="https://dmesg.app/letsencrypt-nginx-subdomain.html">https://dmesg.app/letsencrypt-nginx-subdomain.html</a>  <a target="_blank" rel="noopener" href="https://letsencrypt.org/zh-cn/getting-started/">https://letsencrypt.org/zh-cn/getting-started/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/10/02/trojan/index/" data-id="clhp7rtmg00a6s2qr1jcohrfh" data-title="使用trojan翻越长城的进阶使用方法" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-yyets-bot/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/08/16/yyets-bot/index/" class="article-date">
  <time class="dt-published" datetime="2019-08-16T00:00:00.000Z" itemprop="datePublished">2019-08-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/share/">share</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/08/16/yyets-bot/index/">人人影视资源搜索机器人</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>弄了个人人影视资源机器人，???</p>
<h2 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h2><p><img src="/images/2019081602101377.jpeg"> <img src="/images/2019081602101378.jpeg"></p>
<h2 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h2><p>直接爬虫+解析oabt005.com 的资源搜索页面，就是这么简单</p>
<h2 id="二次开发"><a href="#二次开发" class="headerlink" title="二次开发"></a>二次开发</h2><p><code>html_request.py</code>返回网页源代码，<code>html_parser.py</code>返回解析之后的结构化数据，列表+字典</p>
<h2 id="源代码"><a href="#源代码" class="headerlink" title="源代码"></a>源代码</h2><p>[gt href&#x3D;’<a target="_blank" rel="noopener" href="https://github.com/BennyThink/YYeTsBot'/]%E5%BC%80%E6%BA%90%E5%9C%B0%E5%9D%80/[/gt/]">https://github.com/BennyThink/YYeTsBot&#39;\]开源地址\[/gt\]</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/08/16/yyets-bot/index/" data-id="clhp7rtnv00bws2qrgutz5b2n" data-title="人人影视资源搜索机器人" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-xiaoice/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/08/11/xiaoice/index/" class="article-date">
  <time class="dt-published" datetime="2019-08-11T00:00:00.000Z" itemprop="datePublished">2019-08-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/program/">program</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/08/11/xiaoice/index/">真正唯一可用的微软小冰API - realXiaoice</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>在聊天机器人中，微软小冰可以说是比较有特色的了。然而不友好的一点是微软小冰并没有开放给公众的API。上网搜一搜，也并没没有真正好用的API！所以本萌新只好自己动手，丰衣足食了。</p>
<p>（可惜图灵机器人要咱上传手持身份证的照片，(╯‵□′)╯︵┻━┻）</p>
<p>想和小冰聊天，只能看看与小冰合作的第三方平台了。</p>
<p><img src="/images/2019081112582530.png"></p>
<p>乍一看平台挺多，但是其实没有几个是提供了简单易用的SDK能够让我接管聊天这件事情的……哪像telegram那样嘛！！</p>
<p>本API呢……是从新浪微博入手的……</p>
<h2 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h2><p><img src="/images/2019081112582628.png" alt="https://github.com/BennyThink/realXiaoice/raw/master/assets/183303.png"></p>
<p>将<a target="_blank" rel="noopener" href="https://dmesg.app/expressbot.html">ExpressBot</a>与小冰结</p>
<p><img src="/images/2019081112582788.jpeg" alt="74964.jpg"></p>
<h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><ul>
<li>可用，2019年唯一真正可用的API</li>
<li>异步非阻塞：尽管如此，还是需要一两秒给小冰那边的~</li>
<li>可维护：咱是要维护这个的……</li>
</ul>
<p>先来简单的介绍下使用方法吧！</p>
<h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><h3 id="支持GET、POST方法，也可以POST-JSON"><a href="#支持GET、POST方法，也可以POST-JSON" class="headerlink" title="支持GET、POST方法，也可以POST JSON"></a>支持GET、POST方法，也可以POST JSON</h3><p>GET <a target="_blank" rel="noopener" href="http://127.0.0.1:6789/chat?text=hello">http://127.0.0.1:6789/chat?text=hello</a></p>
<h3 id="假如一切正常，HTTP-200"><a href="#假如一切正常，HTTP-200" class="headerlink" title="假如一切正常，HTTP 200"></a>假如一切正常，HTTP 200</h3><p>{<br>“text”: “想我干嘛”,<br>“debug”: “”<br>}</p>
<h3 id="假如客户端有错，HTTP-400"><a href="#假如客户端有错，HTTP-400" class="headerlink" title="假如客户端有错，HTTP 400"></a>假如客户端有错，HTTP 400</h3><p>{<br>“text”: “”,<br>“debug”: “client wrong reason”<br>}</p>
<h3 id="假如服务端有错，HTTP-500"><a href="#假如服务端有错，HTTP-500" class="headerlink" title="假如服务端有错，HTTP 500"></a>假如服务端有错，HTTP 500</h3><p>{<br>“text”: “”,<br>“debug”: “server wrong reason”<br>}</p>
<h2 id="部署方法"><a href="#部署方法" class="headerlink" title="部署方法"></a>部署方法</h2><p>其实部署本程序很简单的啦！以下步骤，如果理想的话，只需要十年再来一次哦~</p>
<h3 id="1-领养小冰"><a href="#1-领养小冰" class="headerlink" title="1. 领养小冰"></a>1. 领养小冰</h3><p>注册一个新浪微博账号，领养小冰，确保与小冰的私信是正常的</p>
<h3 id="2-登录微博账号"><a href="#2-登录微博账号" class="headerlink" title="2. 登录微博账号"></a>2. 登录微博账号</h3><p>使用Chrome或者Firefox，建议开启隐身模式，打开 <a target="_blank" rel="noopener" href="https://m.weibo.cn,/">https://m.weibo.cn，</a> 登录你的微博账号</p>
<h3 id="3-获取headers"><a href="#3-获取headers" class="headerlink" title="3. 获取headers"></a>3. 获取headers</h3><p>打开和小冰的私信页面，按F12打开控制台，切换到Network，并选中XHR，然后和小冰说句话，点开名为send的请求</p>
<p>复制全部Request Headers中<strong>除了Content-Length以外所有行</strong>，粘贴到headers.txt中</p>
<p><img src="/images/2019081112582868.png" alt="https://github.com/BennyThink/realXiaoice/raw/master/assets/182123.png"></p>
<h3 id="4-安装Python-3与依赖"><a href="#4-安装Python-3与依赖" class="headerlink" title="4. 安装Python 3与依赖"></a>4. 安装Python 3与依赖</h3><p>安装适合自己平台的Python，然后</p>
<p>pip install tornado requests</p>
<h3 id="5-运行"><a href="#5-运行" class="headerlink" title="5. 运行"></a>5. 运行</h3><p>python ice_server.py</p>
<h3 id="6-systemd单元文件"><a href="#6-systemd单元文件" class="headerlink" title="6. systemd单元文件"></a>6. systemd单元文件</h3><p>可能需要给<code>headers.txt</code>设置足够的权限</p>
<p>[Unit]<br>Description&#x3D;xiaoice API by Benny<br>After&#x3D;network.target network-online.target nss-lookup.target</p>
<p>[Service]<br>User&#x3D;nobody<br>Restart&#x3D;on-failure<br>Type&#x3D;simple<br>WorkingDirectory&#x3D;&#x2F;path&#x2F;to&#x2F;realXiaoice<br>ExecStart&#x3D;&#x2F;usr&#x2F;bin&#x2F;python3 &#x2F;path&#x2F;to&#x2F;realXiaoice&#x2F;ice_server.py</p>
<p>[Install]<br>WantedBy&#x3D;multi-user.target</p>
<h2 id="其他使用细节"><a href="#其他使用细节" class="headerlink" title="其他使用细节"></a>其他使用细节</h2><h2 id="自定义监听端口"><a href="#自定义监听端口" class="headerlink" title="自定义监听端口"></a>自定义监听端口</h2><p>python ice_server.py –p&#x3D;41123</p>
<h2 id="自定义监听地址"><a href="#自定义监听地址" class="headerlink" title="自定义监听地址"></a>自定义监听地址</h2><p>python ice_server.py –h&#x3D;0.0.0.0</p>
<h2 id="目前计划"><a href="#目前计划" class="headerlink" title="目前计划"></a>目前计划</h2><ul>
<li>只允许特定IP访问API</li>
<li>对小冰的回复增加图片支持</li>
</ul>
<h2 id="开源地址"><a href="#开源地址" class="headerlink" title="开源地址"></a>开源地址</h2><p><a target="_blank" rel="noopener" href="https://github.com/BennyThink/realXiaoice">https://github.com/BennyThink/realXiaoice</a></p>
<p>[gt href&#x3D;’<a target="_blank" rel="noopener" href="https://github.com/BennyThink/realXiaoice'/]%E6%88%B3~/[/gt/]">https://github.com/BennyThink/realXiaoice&#39;\]戳~\[/gt\]</a></p>
<p> </p>
<h2 id="我想要个现成的！"><a href="#我想要个现成的！" class="headerlink" title="我想要个现成的！"></a>我想要个现成的！</h2><p>那么……可以使用智障版呀！</p>
<p>  curl “<a target="_blank" rel="noopener" href="http://39.106.197.205:16789/chat?text=hey">http://39.106.197.205:16789/chat?text=hey</a>“</p>
<h2 id="人工智障聊天机器人"><a href="#人工智障聊天机器人" class="headerlink" title="人工智障聊天机器人"></a>人工智障聊天机器人</h2><p>另外，弄了一个机器学习的人工智障聊天机器人，可以<a target="_blank" rel="noopener" href="https://drive.google.com/open?id=1bdEdLni8X5cz5iTPnJd3t6-2aQ5pmonV">到这里下载</a></p>
<p>使用起来很简单，<code>pip3 install -r requirements.txt</code>, 分别运行<code>interact_mmi.py</code>和<code>silly_ice.py</code>就可以了</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/08/11/xiaoice/index/" data-id="clhp7rtnp00bqs2qr5twhcwk0" data-title="真正唯一可用的微软小冰API - realXiaoice" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-vbox-ping/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/08/09/vbox-ping/index/" class="article-date">
  <time class="dt-published" datetime="2019-08-09T00:00:00.000Z" itemprop="datePublished">2019-08-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/it/">it</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/08/09/vbox-ping/index/">VirtualBox上的虚拟机无法被ping</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>前段时间在Ubuntu上装了VirtualBox，VirtualBox里装了个Windows，桥接了无线网卡。</p>
<p>然后发现我的电脑总是无故无法访问虚拟机。于是用电脑去ping，竟然不通；但是宿主机和路由器去ping都是通的。</p>
<p>怀疑是防火墙的原因，于是我把电脑和虚拟机的防火墙全关了，还是不通。然后我虚拟机ping我电脑，第一个包丢了，然后通，我电脑也几乎立刻显示通，然后通一小会之后随着虚拟机ping结束，我电脑不通了。</p>
<p>但是我用国外&#x2F;国内的的IPv6服务器去ping虚拟机的v6 ，竟然通！但是本机同网络的其他非宿主机、路由器，怎么ping都不通……</p>
<p>感觉这就像是虚拟机用ping打开一个时光隧道，然后瞬间通了几个包。</p>
<p>有时也偶尔存在通的情况，但是过一会一定就会不通了的。</p>
<hr>
<p>大致情况如下视频，上面的那俩是宿主机和路由器，始终能通，左下角是虚拟机，右下角是树莓派</p>
<p> </p>
<p><a target="_blank" rel="noopener" href="https://youtu.be/aFI1d89RQO0">https://youtu.be/aFI1d89RQO0</a></p>
<hr>
<p>已经尝试的排查法：</p>
<ul>
<li>VirtualBox开混杂模式，没有效果</li>
<li>Windows的VMWare桥接，直接就是通的</li>
<li>macOS&#x2F;Windows的VirtualBox桥接，直接就是通的</li>
<li>宿主机和虚拟机都没开任何防火墙</li>
</ul>
<hr>
<p><a target="_blank" rel="noopener" href="https://twitter.com/BennyThinks/status/1155492458915983361?s=20">https://twitter.com/BennyThinks/status/1155492458915983361?s=20</a></p>
<p>有人知道为什么咩？宿主机的无线网卡是BCM43455，难道是VirtualBox不太兼容这个网卡？</p>
<p> </p>
<p> </p>
<p> </p>
<p> </p>
<p>问题解决了，确实是网卡兼容性问题，换个网卡就好了????</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/08/09/vbox-ping/index/" data-id="clhp7rtmw00ars2qraypwf32a" data-title="VirtualBox上的虚拟机无法被ping" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-grafana-influxdb-telegraf/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/07/07/grafana-influxdb-telegraf/index/" class="article-date">
  <time class="dt-published" datetime="2019-07-07T00:00:00.000Z" itemprop="datePublished">2019-07-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/linux/">linux</a>►<a class="article-category-link" href="/categories/linux/website/">website</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/07/07/grafana-influxdb-telegraf/index/">使用grafana+influxdb+telegraf安全的搭建一个监控平台</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>作为一只有很多服务器的萌新，实时掌握服务器的状态是非常必须的。</p>
<p>前段时间，由于<a target="_blank" rel="noopener" href="https://nodequery.com/">NodeQuery</a>出问题了，于是就想着换一个监控平台。当然在移除nq-agent的时候<a target="_blank" rel="noopener" href="https://dmesg.app/rm-etc.html">就手抖给&#x2F;etc删除了</a>。</p>
<p>那么今天就来记录一下如何搭建一个中心化的监控平台。</p>
<h2 id="一些概念的明确"><a href="#一些概念的明确" class="headerlink" title="一些概念的明确"></a>一些概念的明确</h2><p>既然要监控服务器，那么必然要有一个程序运行在服务器上，这个我们一般称作agent，在我们这里就是telegraf；另外一个负责解析，存储，展示数据的，在我们这里就是InfluxDB存储，grafana展示解析数据。</p>
<p>如果使用zabbix的话，那么zabbix-agent就充当了采集器，zabbix-server和zabbix-frontend就充当了解析展示数据的。（zabbix太丑了，模板不会配……）</p>
<h2 id="架构的设计"><a href="#架构的设计" class="headerlink" title="架构的设计"></a>架构的设计</h2><p>由于需要监控多台服务器，那么架构的设计也是一个问题，对于需要跨公网而不是全内网的情况来说，有这样两种思路：</p>
<ul>
<li>被动模式：采集器收集数据，发送给server，这种架构要求server必须有公网IP</li>
<li>主动模式：采集器只是运行，由server主动访问采集器获得数据，这就需要所有的agent必须有公网IP</li>
</ul>
<p>对于被动模式，使用Telegraf+InfluxDB+Grafana是比较好的选择，只需要将InfluxDB部署在具有公网IP的服务器上就可以了，其他服务器是否具有公网IP并不重要。</p>
<p>对于主动模式，使用node exporter+Prometheus+Grafana是比较合适的。</p>
<p>对于两种都想要的呢！zabbix啊，主动被动都支持，就是有点丑(′д｀ )…彡…彡</p>
<p>所以总体的架构就是：</p>
<p>Telegraf –&gt; InfluxDB &lt;–&gt; Grafana</p>
<h2 id="安全性的考虑"><a href="#安全性的考虑" class="headerlink" title="安全性的考虑"></a>安全性的考虑</h2><p>由于数据需要跨公网传输，那么安全性上的考虑就是必不可少的了。那么这个问题怎么解决呢？</p>
<h3 id="加密，认证，授权"><a href="#加密，认证，授权" class="headerlink" title="加密，认证，授权"></a>加密，认证，授权</h3><p>在我们这种情景下，与InfluxDB之间的通信至少也要实现加密、认证的。</p>
<p>加密意味着与InfluxDB之间的通信是安全的，其他人无法解密，<strong>这一点在跨公网传输的时候是必不可少的</strong>；</p>
<p>认证意味着只有特定身份的用户才可以访问数据，比如输入了正确的用户名和密码才可以访问；</p>
<p>授权意味着，你这个用户可以干什么事情，是只能查询还是什么都能干。</p>
<p>为了实现加密，我们可以使用TLS那一套，这一点就很好理解了，TLS就是天生干这事的嘛。</p>
<p>为了实现认证与授权，我们可以使用HTTP Basic Auth，创建一套用户名密码。</p>
<h3 id="防火墙的保护"><a href="#防火墙的保护" class="headerlink" title="防火墙的保护"></a>防火墙的保护</h3><p>除了以上操作之外，使用防火墙限制访问数据库的源IP也是一种补充方法。当然了加密是必不可少的。除此之外，还有一些方法，比如TLS客户端证书等等。</p>
<h3 id="大内网"><a href="#大内网" class="headerlink" title="大内网"></a>大内网</h3><p>有些时候配置上面这些太麻烦了，那么还有一个思路就是组建大内网！可以考虑用WireGuard、OpenVPN甚至是SSH隧道试试看。</p>
<p>不过也有缺点，一是如果服务器是海外的，那么由于GFW的存在，可能有点不太友好；二是可能不太好配，尤其是OpenVPN，一不小心就全局了。</p>
<h2 id="部署与配置"><a href="#部署与配置" class="headerlink" title="部署与配置"></a>部署与配置</h2><p>下面就简单说说如何安全的配置这么一套平台</p>
<h2 id="InfluxDB"><a href="#InfluxDB" class="headerlink" title="InfluxDB"></a>InfluxDB</h2><p><a target="_blank" rel="noopener" href="https://portal.influxdata.com/downloads/">https://portal.influxdata.com/downloads/</a></p>
<p>从页面上选择适合你的操作系统的版本，对于我使用的Ubuntu来说，使用这个就可以了</p>
<p>wget <a target="_blank" rel="noopener" href="https://dl.influxdata.com/influxdb/releases/influxdb/_1.7.7/_amd64.deb">https://dl.influxdata.com/influxdb/releases/influxdb\_1.7.7\_amd64.deb</a><br>sudo dpkg -i influxdb_1.7.7_amd64.deb</p>
<h3 id="配置SSL"><a href="#配置SSL" class="headerlink" title="配置SSL"></a>配置SSL</h3><p>这一步我们可以使用openssl自签名的证书，也可以使用Let’s Encrypt申请一个真正的证书（这就需要弄个域名啦）</p>
<p>以自签名证书来说</p>
<p>sudo openssl req -x509 -nodes -newkey rsa:2048 -keyout &#x2F;etc&#x2F;ssl&#x2F;influxdb-selfsigned.key -out &#x2F;etc&#x2F;ssl&#x2F;influxdb-selfsigned.crt -days 3650<br>chown influxdb:influxdb &#x2F;etc&#x2F;ssl&#x2F;influxdb-selfsigned.*</p>
<p>修改配置文件 <code>/etc/influxdb/influxdb.conf</code>，需要更改三处</p>
<p>https-enabled &#x3D; true</p>
<p>https-certificate &#x3D; “&#x2F;etc&#x2F;ssl&#x2F;influxdb-selfsigned.crt”<br>https-private-key &#x3D; “&#x2F;etc&#x2F;ssl&#x2F;influxdb-selfsigned.key”</p>
<p>如果使用Let’s Encrypt的话，<code>https-certificate</code>改为<code>fullchain.pem</code>的路径，<code>https-private-key</code>改为<code>privkey.key</code>的路径，注意下权限就可以了。</p>
<p>然后重启</p>
<p>sudo systemctl restart influxdb</p>
<p>验证</p>
<p>influx -ssl -unsafeSsl -host &lt;domain_name&gt;.com</p>
<h3 id="配置认证与授权"><a href="#配置认证与授权" class="headerlink" title="配置认证与授权"></a>配置认证与授权</h3><p>创建一个管理员用户</p>
<p>使用上述<code>influx -ssl -unsafeSsl -host &lt;domain_name&gt;.com</code>登录到服务器</p>
<p>CREATE USER paul WITH PASSWORD ‘timeseries4days’ WITH ALL PRIVILEGES</p>
<p>开启认证</p>
<p>修改配置文件<code>/etc/influxdb/influxdb.conf</code></p>
<p>auth-enabled &#x3D; true</p>
<p>重启进程</p>
<p>sudo systemctl restart influxdb</p>
<p>此时再使用<code>influx -ssl -unsafeSsl -host &lt;domain_name&gt;.com</code>登录到服务器，<code>show databases</code>就会报错，只有auth之后才可以</p>
<h2 id="Telegraf"><a href="#Telegraf" class="headerlink" title="Telegraf"></a>Telegraf</h2><p><a target="_blank" rel="noopener" href="https://github.com/influxdata/telegraf/releases">https://github.com/influxdata/telegraf/releases</a></p>
<p><a target="_blank" rel="noopener" href="https://portal.influxdata.com/downloads/">https://portal.influxdata.com/downloads/</a></p>
<p>从以上网址下载对应你的操作系统版本的Telegraf，然后安装（armhf对应树莓派）</p>
<h3 id="配置数据库服务器"><a href="#配置数据库服务器" class="headerlink" title="配置数据库服务器"></a>配置数据库服务器</h3><p>编辑<code>/etc/telegraf/telegraf.conf</code>，找到urls&#x3D;…，改成https就好了</p>
<p>urls &#x3D; [“https:&#x2F;&#x2F;&lt;domain_name&gt;.com:8086”]<br>database &#x3D; “telegraf”</p>
<p>需要注意的是，如果使用的是自签名证书，那么<code>insecure_skip_verify = true</code>也要配置</p>
<h3 id="配置认证"><a href="#配置认证" class="headerlink" title="配置认证"></a>配置认证</h3><p>编辑<code>/etc/telegraf/telegraf.conf</code></p>
<p>根据上面配置的进行适当更改</p>
<p>timeout &#x3D; “5s”</p>
<p>username &#x3D; “telegraf” #?<br>password &#x3D; “metricsmetricsmetricsmetrics” #?</p>
<h3 id="配置采集内容"><a href="#配置采集内容" class="headerlink" title="配置采集内容"></a>配置采集内容</h3><p>把这些追加到telegraf.conf末尾就可以了</p>
<p>[[inputs.cpu]]<br>percpu &#x3D; true<br>totalcpu &#x3D; true<br>collect_cpu_time &#x3D; false<br>report_active &#x3D; false<br>[[inputs.disk]]<br>ignore_fs &#x3D; [“tmpfs”, “devtmpfs”, “devfs”]<br>[[inputs.io]]<br>[[inputs.mem]]<br>[[inputs.net]]<br>[[inputs.system]]<br>[[inputs.swap]]<br>[[inputs.netstat]]<br>[[inputs.processes]]<br>[[inputs.kernel]]</p>
<h2 id="Grafana"><a href="#Grafana" class="headerlink" title="Grafana"></a>Grafana</h2><p><a target="_blank" rel="noopener" href="https://grafana.com/grafana/download">https://grafana.com/grafana/download</a></p>
<p>同样下载安装适合自己平台的程序</p>
<p>然后<a target="_blank" rel="noopener" href="http://ip:3000/">http://ip:3000</a></p>
<p>默认的用户名密码是admin、admin</p>
<p>Add datasource选择influxdb，按照如下图所示配置</p>
<p><img src="/images/2019070704385117.png"></p>
<h3 id="导入dashboard"><a href="#导入dashboard" class="headerlink" title="导入dashboard"></a>导入dashboard</h3><p>导入这个dashboard</p>
<p><a target="_blank" rel="noopener" href="https://grafana.com/dashboards/5955">https://grafana.com/dashboards/5955</a></p>
<p><img src="/images/2019070704385269.png"></p>
<p>之后保存就可以看到结果啦！</p>
<p><img src="/images/2019070704385387.png"></p>
<h2 id="其他优化"><a href="#其他优化" class="headerlink" title="其他优化"></a>其他优化</h2><h3 id="配置防火墙"><a href="#配置防火墙" class="headerlink" title="配置防火墙"></a>配置防火墙</h3><p>只允许某个IP访问8086</p>
<p>ufw allow from xx.xx.xx.xx to any port 8086</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://docs.influxdata.com/influxdb/v1.7/administration/https_setup/">https://docs.influxdata.com/influxdb/v1.7/administration/https_setup&#x2F;</a></p>
<p><a target="_blank" rel="noopener" href="https://docs.influxdata.com/influxdb/v1.7/administration/authentication_and_authorization/">https://docs.influxdata.com/influxdb/v1.7/administration/authentication_and_authorization&#x2F;</a></p>
<p><a target="_blank" rel="noopener" href="https://grafana.com/dashboards/5955">https://grafana.com/dashboards/5955</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/dfd329d30891">https://www.jianshu.com/p/dfd329d30891</a></p>
<p><a target="_blank" rel="noopener" href="https://grafana.com/docs/installation/behind_proxy/">https://grafana.com/docs/installation/behind_proxy&#x2F;</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/07/07/grafana-influxdb-telegraf/index/" data-id="clhp7rtgg003bs2qrelrad0no" data-title="使用grafana+influxdb+telegraf安全的搭建一个监控平台" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-rm-etc/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/06/27/rm-etc/index/" class="article-date">
  <time class="dt-published" datetime="2019-06-27T00:00:00.000Z" itemprop="datePublished">2019-06-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/linux/">linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/06/27/rm-etc/index/">手一抖，我删除了etc目录</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>我死了之后 会变成那些星星吗？ 你想变成星星吗？ 想啊，因为我的家人都在那里 这样啊 真想变成美丽的星星 想变成星星的话…必须先好好地活着才行啊 什么是「活着」？ 活着，就是怀抱希望的意思 希望？ 人若是失去了希望 就无法活下去 如果连希望本身都消失了呢？ 希望不会消失的 是人们变得看不见希望而已</p>
</blockquote>
<p>不干了，我开除了黑心公司。不好意思，走错片场了。我不是不干了，我没有开除了黑心公司。我是手一抖，删除了<code>/etc</code>目录……</p>
<h2 id="嗯？？"><a href="#嗯？？" class="headerlink" title="嗯？？"></a>嗯？？</h2><p>作为一名Linux老司机，我经常自吹自擂拥有n年Linux使用经验，root敢死队从未翻车过。实际上，除了n年前凌晨三四点重装服务器时忘记备份数据库之外，我还真没翻车过。</p>
<p>然而这次，小手一抖……</p>
<p>事情是这样的，nodequery挂了，我寻思着换一个监控服务，那就要先把原来的监控脚本删掉，可是我这么懒，又删除用户删除crontab删除文件的，我就直接<a target="_blank" rel="noopener" href="https://www.moerats.com/archives/568/">在网上找了下</a>删除的命令：</p>
<p>root@abcdef:~# rm -R &#x2F; etc &#x2F; nodequery &amp;&amp;（crontab -u nodequery -l | grep -v“&#x2F;etc&#x2F;nodequery&#x2F;nq-agent.sh”）| crontab -u nodequery  - &amp;&amp;  userdel nodequery</p>
<p>rm: it is dangerous to operate recursively on ‘&#x2F;‘<br>rm: use –no-preserve-root to override this failsafe<br>rm: cannot remove ‘etc’: No such file or directory<br>rm: it is dangerous to operate recursively on ‘&#x2F;‘<br>rm: use –no-preserve-root to override this failsafe<br>rm: cannot remove ‘nodequery’: No such file or directory</p>
<p>我这一看，报错了，哎哟啊前面怎么有个空格呢，啊这样</p>
<p>root@abcdef:~# rm -R &#x2F;etc&#x2F; nodequery &amp;&amp;（crontab -u nodequery -l | grep -v“&#x2F;etc&#x2F;nodequery&#x2F;nq-agent.sh”）| crontab -u nodequery - &amp;&amp; userdel nodequery</p>
<p>rm: cannot remove ‘nodequery’: No such file or directory</p>
<p>好像没问题了，确认一下crontab已经没了吧！</p>
<p>root@abcdef:~# crontab -l</p>
<p>crontab: your UID isn’t in the passwd file.<br>bailing out.</p>
<p>哎哟我去？我的UID不在passwd里？什么，卧槽卧槽卧槽……</p>
<p>事情就是这么个事情，经过就是这么个经过，<code>/etc</code>目录被我干掉了！(╯‵□′)╯︵┻━┻</p>
<h2 id="没了-x2F-etc会怎样"><a href="#没了-x2F-etc会怎样" class="headerlink" title="没了&#x2F;etc会怎样"></a>没了&#x2F;etc会怎样</h2><p>首先系统的各种配置是没了，ssh肯定也登不上去，因为sshd要检查<code>/etc/ssh/sshd_config</code>的配置的。别想了，VNC也不好用。此时这台服务器就像是行尸走肉一样……</p>
<p>但是好消息是，Nginx，PHP和MySQL还是运行着的，虽说Let’s Encrypt证书也丢了，但是Nginx还缓存着，所以网站其实还活着。</p>
<p>还有一个更好的消息，当前的shell还在！这个shell是我唯一的机会！别断网别断网就好……</p>
<h2 id="备份、转移"><a href="#备份、转移" class="headerlink" title="备份、转移"></a>备份、转移</h2><p>这台服务器的用途比较单一，更可怕的是，<strong>主人还不是我</strong>，天啊我也会做出传说中删库跑路的事情吗！</p>
<p>冷静了几秒钟之后，趁着没断网赶紧打包备份网站文件，导出数据库，大不了重装。</p>
<p>文件打包完了，scp发给我的另一个服务器吧</p>
<p>root@abcdef:~# scp 062WARNING:root:could not open file ‘&#x2F;etc&#x2F;apt&#x2F;sources.list’</p>
<p>Command ‘awk’ not found, but can be installed with:<br>apt install gawk (You will have to enable component called ‘main’)<br>apt install mawk (You will have to enable component called ‘main’)<br>apt install original-awk (You will have to enable component called ‘universe’)<br>7.tgz ^C</p>
<p>唉？？bash completion也挂了？那我不补全了可以吧</p>
<p>root@abcdef:~# scp 0627.tgz <a href="mailto:&#114;&#x6f;&#111;&#x74;&#x40;&#97;&#x63;&#x76;&#100;&#x61;&#x2e;&#x6d;&#x65;">&#114;&#x6f;&#111;&#x74;&#x40;&#97;&#x63;&#x76;&#100;&#x61;&#x2e;&#x6d;&#x65;</a>:&#x2F;root</p>
<p>unknown user 0</p>
<p>啊对啊，因为sshd凉了，所以依赖于ssh的一些命令，比如scp也凉了……那我SFTP往回下载文件也不行啊……</p>
<p>啊那我cp到webroot下，另一台服务器赶紧wget，然后删除webroot下的文件……</p>
<h2 id="死马当活马医"><a href="#死马当活马医" class="headerlink" title="死马当活马医"></a>死马当活马医</h2><p>数据备份好了，那么现在该思考怎么恢复了，不能一辈子不重启，自己也没法ssh啊……赶紧登录下阿里云看看有没有快照——没有哦。</p>
<p>重装系统？那太麻烦了。本着死马当活马医的思想，试试移花接木吧——我把另一台配置基本一样的服务器的配置拷贝过来看看ssh能不能活。</p>
<p>于是另一台服务器上</p>
<p>tar jcpf etc.tgz &#x2F;etc</p>
<p>一定要记得带p参数，这样才会保持权限。scp不管用，那也放到webroot下，赶紧wget然后删除，然后解压缩……</p>
<p>新开一个ssh连接，哇，活了……当然了host keys是另一台服务器的，密码也是，主机名也是……这就好像换头术哦！</p>
<h2 id="篡改记忆"><a href="#篡改记忆" class="headerlink" title="篡改记忆"></a>篡改记忆</h2><p>医学史上换头术难度极高，也可能有一些伦理问题，但是咱这来说，这就像是换了个身体，灵魂还是另一个服务器……还要做一些配置的</p>
<h3 id="重新生成ssh-host-key"><a href="#重新生成ssh-host-key" class="headerlink" title="重新生成ssh host key"></a>重新生成ssh host key</h3><p>咱着让两台服务器的host key都一样，自己用起来太不好了，所以要重新生成一组</p>
<p>rm -v &#x2F;etc&#x2F;ssh&#x2F;ssh_host_*<br>dpkg-reconfigure openssh-server</p>
<h3 id="修改密码"><a href="#修改密码" class="headerlink" title="修改密码"></a>修改密码</h3><p>这点就不用说了</p>
<h3 id="重新申请SSL证书"><a href="#重新申请SSL证书" class="headerlink" title="重新申请SSL证书"></a>重新申请SSL证书</h3><p>由于整个letsencrypt目录也没了，所以也没办法revoke证书，直接删除<code>/etc/letsencrypt</code>然后<code>apt install certbot</code>，然后再重新申请一个证书好了</p>
<p><strong>我还是年轻啊，我做完这些的时候我觉得差不多了，就一个reboot重启了。当然了这怎么够啊……fstab呢，网络呢！！很悲剧的，我ssh不上，还好VNC是好用的</strong></p>
<h3 id="fstab"><a href="#fstab" class="headerlink" title="fstab"></a>fstab</h3><p>于是我VNC登录上，看着这台服务器还叫着别人的名字，唉……</p>
<p>由于现在大家基本上是用UUID挂载的磁盘，很少有人直接指定设备名了，所以这里肯定有问题啦。解决办法很简单，remount为rw，改一下下</p>
<p>mount &#x2F;dev&#x2F;vda1 –o remount,rw &#x2F;</p>
<p>这样根就是可以读写的了，然后看情况更改<code>/etc/fstab</code></p>
<h3 id="重新配置网络"><a href="#重新配置网络" class="headerlink" title="重新配置网络"></a>重新配置网络</h3><p>另一台服务器使用的是静态IP，这台服务器使用的是DHCP，所以网络是肯定不通的。首先<code>ifconfig</code>确定下我的网卡叫ens3，由于我用的是Ubuntu 18.04，所以要去修改netplan的配置文件<code>/etc/netplan/01-netcfg.yaml</code>，写如下配置：</p>
<p>network:<br>  version: 2<br>  renderer: networkd<br>  ethernets:<br>    ens3:<br>        dhcp4: true</p>
<p>确定缩进也没问题，应用下配置</p>
<p>netplan apply</p>
<p>之后再curl下，网络通了</p>
<h3 id="修改主机名"><a href="#修改主机名" class="headerlink" title="修改主机名"></a>修改主机名</h3><p>hostnamectl set-hostname abcde</p>
<h3 id="检查其他配置与服务"><a href="#检查其他配置与服务" class="headerlink" title="检查其他配置与服务"></a>检查其他配置与服务</h3><p>这点就因人而异啦~</p>
<h2 id="后遗症"><a href="#后遗症" class="headerlink" title="后遗症"></a>后遗症</h2><p>毕竟咱这个<code>/etc</code>是别人的，所以有些地方肯定是有问题的。比如说……</p>
<h3 id="文件和目录的所有者可能会改变"><a href="#文件和目录的所有者可能会改变" class="headerlink" title="文件和目录的所有者可能会改变"></a>文件和目录的所有者可能会改变</h3><p>毕竟uid不同，所以遇到这种情况只能手动改改啦</p>
<h3 id="某些服务可能启动不了"><a href="#某些服务可能启动不了" class="headerlink" title="某些服务可能启动不了"></a>某些服务可能启动不了</h3><p>比如在我这里就是MySQL启动不起来。第一猜想是权限不够？chown了也不对</p>
<p>后来发现报错mysqld_safe –malloc-lib can not be read and will not be used</p>
<p>后来发现把<code>my.cnf</code>里的<code>malloc-lib=/usr/lib/libtcmalloc.so</code>注释了就好</p>
<p>然后突然想起来，这两台服务器似乎是曾经做的主从，于是现在农奴翻身把歌唱，大家都是奴隶了呗？</p>
<h3 id="断掉的符号链接"><a href="#断掉的符号链接" class="headerlink" title="断掉的符号链接"></a>断掉的符号链接</h3><p>有些<code>/etc</code>里的文件可能是符号链接到其他目录的，那就自己重新弄下吧。</p>
<h2 id="损失了什么"><a href="#损失了什么" class="headerlink" title="损失了什么"></a>损失了什么</h2><p>在这接近两个小时（15:45-17:55，包括给人送文件和回家路上），总结下来，我只损失了一套SSL证书，大概半小时左右的网站宕机时间。</p>
<p>当然如果处置得当，宕机时间应该可以保证在一分钟之内的（重启验证是否恢复）。唉，还是年轻啊。</p>
<h2 id="哦？"><a href="#哦？" class="headerlink" title="哦？"></a>哦？</h2><p>事后回想起来，直接不检查复制粘贴回车别人的命令真的很危险，这还不是恶意的那种，只是写错了，外加我手抖了一下。</p>
<p>恶意的命令是什么呢？</p>
<p>有种命令，复制的和粘贴的不一样哦，这个技术叫<a target="_blank" rel="noopener" href="https://github.com/dxa4481/Pastejacking">pastehijack</a>哦。这时候有一个聪明的SSH工具就很重要了。</p>
<p><img src="/images/201906271148135.png"></p>
<p>另外还有一种可能，假如我当初在<code>/</code>下，那这条命令一贴——凉凉。</p>
<p>行了我也不说啥了，不想引战，管他原创不原创转载不转载的，怪我自己粗心了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/06/27/rm-etc/index/" data-id="clhp7rtil007ts2qraxrm6600" data-title="手一抖，我删除了etc目录" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-vps-more-disk/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/06/23/vps-more-disk/index/" class="article-date">
  <time class="dt-published" datetime="2019-06-23T00:00:00.000Z" itemprop="datePublished">2019-06-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/linux/">linux</a>►<a class="article-category-link" href="/categories/linux/website/">website</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/06/23/vps-more-disk/index/">vps硬盘不够了怎么办</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>自从搭建了<a target="_blank" rel="noopener" href="https://gakki.photos/">一个图床</a>之后，我开始发现vps的硬盘空间开始慢慢不够用了。随着时间的增长，上传的图片也越来越多。贫穷总是会限制我的想象力，那么有哪些解决方案呢？</p>
<h2 id="世界加钱可及"><a href="#世界加钱可及" class="headerlink" title="世界加钱可及"></a>世界加钱可及</h2><h3 id="加钱升级配置"><a href="#加钱升级配置" class="headerlink" title="加钱升级配置"></a>加钱升级配置</h3><p>加钱，去服务商那里升级配置就好了，好多钱钱~</p>
<h3 id="使用block-storage"><a href="#使用block-storage" class="headerlink" title="使用block storage"></a>使用block storage</h3><p>有些服务商可能提供类似block storage这种存储服务（如vultr、DigitalOcean），那就花钱钱买点，然后挂载上就好了。假如不提供这些服务的话，可以考虑试试<a target="_blank" rel="noopener" href="https://cloud.google.com/storage/?hl=zh-cn">Google Cloud Storage</a>，然后挂载到本地，价格也还是可以接受的~</p>
<h2 id="使用rclone挂载网络硬盘"><a href="#使用rclone挂载网络硬盘" class="headerlink" title="使用rclone挂载网络硬盘"></a>使用rclone挂载网络硬盘</h2><p>可是我是穷人唉，$1都出不起，那该怎么办呢……可不可以把Google Drive、OneDrive、Dropbox什么的挂载上呢？Google Drive有15G，Dropbox有2G，OneDrive有5G，这加起来就是22G，那就是$2.2呢！</p>
<p>淘宝花个几块钱扩容什么的，那就是血赚啊！</p>
<p>rclone挂载Google Drive什么的很容易，有很多人写文件介绍过，比如说<a target="_blank" rel="noopener" href="https://moonagic.com/mount-google-drive-with-rclone/">这篇</a>，只不过有两点需要注意的：</p>
<p>使用mount挂载之后，这个程序会“阻塞”，另开一个窗口<code>df –h</code>就会发现有了</p>
<p><img src="/images/2019062307425439.png"></p>
<p>5T滑稽?</p>
<p>但是咱也不能一直开着，跑个screen也不好，所以还是写个systemd单元文件吧</p>
<p>[Unit]<br>Description&#x3D;Google Drive mounter<br>After&#x3D;network.target network-online.target nss-lookup.target</p>
<p>[Service]<br>Restart&#x3D;on-failure<br>Type&#x3D;simple<br>ExecStart&#x3D;&#x2F;usr&#x2F;bin&#x2F;rclone mount gdrive_goldstein:&#x2F; &#x2F;mnt&#x2F;gdrive&#x2F; –allow-non-empty –vfs-cache-mode writes –allow-other</p>
<p>[Install]<br>WantedBy&#x3D;multi-user.target</p>
<p>非常需要注意这个<code>--allow-other</code>参数，如果没有的话，从nginx的webroot下做过来的符号链接www用户无权访问，那就403了哦</p>
<h2 id="iSCSI"><a href="#iSCSI" class="headerlink" title="iSCSI"></a>iSCSI</h2><p>这网络存储有的时候可能也有点不太够（5T都不够吗？），那该怎么办呢？不如买个大硬盘的vps，然后试试iSCSI！（看来这RHCE是没白考啊ε&#x3D;ε&#x3D;ε&#x3D;(<del>￣▽￣)</del></p>
<p><a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/ISCSI">iSCSI是个啥呢？Internet小型计算机系统接口</a>，简单理解就是客户端可以通过网络让自己有&#x2F;dev&#x2F;sd*这样的“真实”的物理设备，然后随便格式化挂载什么的。</p>
<p>iSCSI一般来说是局域网使用的，一般不会跨公网玩，因为这东西对延迟丢包有点敏感。当然了用是能用的，只不过配置起来有点麻烦，而且传输过程是不加密的。(′д｀ )…彡…彡</p>
<p>iSCSI传输不是加密的这个消息不太好，但是有一些解决方案的，比如套个IPSec啦，比如走个SSH隧道啦。</p>
<p>本着灵活应用的道理，咱就来挂载个玩玩……</p>
<h3 id="概念解析"><a href="#概念解析" class="headerlink" title="概念解析"></a>概念解析</h3><p>target – 理解成服务器；initiator – 理解成客户端</p>
<h3 id="准备“硬盘”"><a href="#准备“硬盘”" class="headerlink" title="准备“硬盘”"></a>准备“硬盘”</h3><p>对于服务端来说，提供服务的“硬盘”可以选择块设备（硬盘啊，U盘啊什么的），也可以选择文件设备，甚至内存够大做ramdisk都是可以的~</p>
<p>为了方便扩展，我们这里就做一个逻辑卷，这样以后也可以看心情随时扩容的。</p>
<p>首先~登录到server，需要进行一下分区，总之就是搞出来一个sdb2这种分区做逻辑卷。使</p>
<h4 id="分区"><a href="#分区" class="headerlink" title="分区"></a>分区</h4><p>用fdisk进行类似操作：</p>
<p>root@server:~# fdisk &#x2F;dev&#x2F;sda<br>Welcome to fdisk (util-linux 2.31.1).<br>Changes will remain in memory only, until you decide to write them.<br>Be careful before using the write command.</p>
<p>Command (m for help): p<br>Disk &#x2F;dev&#x2F;sda: 20 GiB, 21474836480 bytes, 41943040 sectors<br>Units: sectors of 1 * 512 &#x3D; 512 bytes<br>Sector size (logical&#x2F;physical): 512 bytes &#x2F; 512 bytes<br>I&#x2F;O size (minimum&#x2F;optimal): 512 bytes &#x2F; 512 bytes<br>Disklabel type: gpt<br>Disk identifier: DCBEF2AD-7269-4B63-BA34-AE2F15A6D9F7<br>Device Start End Sectors Size Type<br>&#x2F;dev&#x2F;sda1 2048 4095 2048 1M BIOS boot<br>&#x2F;dev&#x2F;sda2 4096 20975615 20971520 10G Linux filesystem</p>
<p>Command (m for help): n</p>
<p>Partition number (3-128, default 3):<br>First sector (20975616-41943006, default 20975616):<br>Last sector, +sectors or +size{K,M,G,T,P} (20975616-41943006, default 41943006):<br>Created a new partition 3 of type ‘Linux filesystem’ and of size 10 GiB.</p>
<p>Command (m for help): w</p>
<p>The partition table has been altered.<br>Syncing disks.</p>
<p>输入<code>partprobe</code>更新分区表，这里新分区为sda3，大小10G</p>
<h4 id="创建逻辑卷"><a href="#创建逻辑卷" class="headerlink" title="创建逻辑卷"></a>创建逻辑卷</h4><p>root@server:~# pvcreate &#x2F;dev&#x2F;sda3<br>Physical volume “&#x2F;dev&#x2F;sda3” successfully created.</p>
<p>默认的Volume Group大小是4MiB，当然这个创建vg的时候可以改。</p>
<p>root@server:~# vgcreate idata &#x2F;dev&#x2F;sda3<br>Volume group “idata” successfully created</p>
<p>创建Logic Volume的时候，n表示名字；大小方面，可以指定是多少个PE，也可以直接写大小，使用l指定多少个PE，256个也就是1G了，L指定大小，</p>
<p>root@server:~# lvcreate -n iscsi_data -l 256 idata<br>Logical volume “iscsi_data” created.</p>
<h1 id="直接指定3G"><a href="#直接指定3G" class="headerlink" title="直接指定3G"></a>直接指定3G</h1><p>root@server:~# lvcreate -n test -L 3G idata<br>Logical volume “test” created.</p>
<p>查看一下 确定信息无误</p>
<p>root@server:~# lvdisplay</p>
<p>— Logical volume —<br>LV Path &#x2F;dev&#x2F;idata&#x2F;iscsi_data<br>LV Name iscsi_data<br>VG Name idata<br>LV UUID ueP2uS-zEOG-6B1q-5GuD-9L5f-1ZyZ-86E4ee<br>LV Write Access read&#x2F;write<br>LV Creation host, time server, 2019-06-23 06:19:06 +0000<br>LV Status available</p>
<h1 id="open-0"><a href="#open-0" class="headerlink" title="open 0"></a>open 0</h1><p>LV Size 1.00 GiB<br>Current LE 256<br>Segments 1<br>Allocation inherit<br>Read ahead sectors auto</p>
<ul>
<li>currently set to 256<br>Block device 253:0</li>
</ul>
<p>[v_blue]叮咚提示：</p>
<p>有些vps上来就是一个&#x2F;，这种情况下根本用不了fdisk给分出来空间的。那咋办呢？有这么几种思路，fileio，livecd用gparted，手动重装系统[&#x2F;v_blue]</p>
<h3 id="配置target"><a href="#配置target" class="headerlink" title="配置target"></a>配置target</h3><p>就假定服务端和客户端都是Ubuntu 啦，16.04之后应该操作都差不多的</p>
<p>apt install targetcli-fb</p>
<p>输入<code>targetcli</code>进入交互页面，输入ls可以看下大体情况</p>
<p><img src="/images/2019062307425576.png"></p>
<p>我们要做这么几件事情：创建backstore，给backstore增加LUNS，ACL，PORTAL</p>
<h4 id="创建backstore"><a href="#创建backstore" class="headerlink" title="创建backstore"></a>创建backstore</h4><p>创建block设备</p>
<p>&#x2F;backstores&#x2F;block create name&#x3D;client1_data dev&#x3D;&#x2F;dev&#x2F;idata&#x2F;iscsi_data</p>
<p><code>/dev/idata/iscsi_data</code> 就是我们刚刚创建的逻辑卷，name 是名字</p>
<p>创建iSCSI</p>
<p>&#x2F;iscsi create wwn&#x3D;iqn.2019-06.com.bennythink:server</p>
<p>回车之后会发现自动帮我们创建好了portal</p>
<p>创建luns，这里的<code>client1_data</code>就是我们第一步创建的name</p>
<p>&#x2F;iscsi&#x2F;iqn.2019-06.com.bennythink:server&#x2F;tpg1&#x2F;luns create &#x2F;backstores&#x2F;block&#x2F;client1_data</p>
<p>创建acl</p>
<p>&#x2F;iscsi&#x2F;iqn.2019-06.com.bennythink:server&#x2F;tpg1&#x2F;acls create wwn&#x3D;iqn.2019-06.com.bennythink:client1</p>
<p>这几步都做完了之后，ls一下，大概的结构应该是这样的：</p>
<p><img src="/images/2019062307425778.png"></p>
<p><code>saveconfig</code>保存退出</p>
<h3 id="配置客户端"><a href="#配置客户端" class="headerlink" title="配置客户端"></a>配置客户端</h3><p>客户端的配置相比之下就简单多了，只需要改下配置文件就好了</p>
<h4 id="安装与修改配置"><a href="#安装与修改配置" class="headerlink" title="安装与修改配置"></a>安装与修改配置</h4><p>apt install open-iscsi</p>
<h1 id="编辑-x2F-etc-x2F-iscsi-x2F-initiatorname-iscsi"><a href="#编辑-x2F-etc-x2F-iscsi-x2F-initiatorname-iscsi" class="headerlink" title="编辑&#x2F;etc&#x2F;iscsi&#x2F;initiatorname.iscsi"></a>编辑&#x2F;etc&#x2F;iscsi&#x2F;initiatorname.iscsi</h1><p>vim &#x2F;etc&#x2F;iscsi&#x2F;initiatorname.iscsi</p>
<h1 id="把InitiatorName改成我们ACL中配置的那个，也就是iqn-2019-06-com-bennythink-client1"><a href="#把InitiatorName改成我们ACL中配置的那个，也就是iqn-2019-06-com-bennythink-client1" class="headerlink" title="把InitiatorName改成我们ACL中配置的那个，也就是iqn.2019-06.com.bennythink:client1"></a>把InitiatorName改成我们ACL中配置的那个，也就是iqn.2019-06.com.bennythink:client1</h1><p>InitiatorName&#x3D;iqn.2019-06.com.bennythink:client1</p>
<h1 id="设置自动login"><a href="#设置自动login" class="headerlink" title="设置自动login"></a>设置自动login</h1><p>vim &#x2F;etc&#x2F;iscsi&#x2F;iscsid.conf</p>
<h1 id="原来是manual"><a href="#原来是manual" class="headerlink" title="原来是manual"></a>原来是manual</h1><p>node.startup &#x3D; automatic</p>
<h4 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h4><p>systemctl restart iscsi<br>systemctl restart iscsid<br>systemctl enable iscsid</p>
<h4 id="发现与登录节点"><a href="#发现与登录节点" class="headerlink" title="发现与登录节点"></a>发现与登录节点</h4><p>server可以写服务端的域名，或者IP也可以</p>
<p>root@client:~# iscsiadm –mode discoverydb –type sendtargets –portal server –discover<br>172.21.174.180:3260,1 iqn.2019-06.com.bennythink:server</p>
<h1 id="把上一步拿到的iqn写到这里"><a href="#把上一步拿到的iqn写到这里" class="headerlink" title="把上一步拿到的iqn写到这里"></a>把上一步拿到的iqn写到这里</h1><p>root@client:~# iscsiadm –mode node –targetname iqn.2019-06.com.bennythink:server –portal server:3260 –login<br>Logging in to [iface: default, target: iqn.2019-06.com.bennythink:server, portal: 172.21.174.180,3260] (multiple)<br>Login to [iface: default, target: iqn.2019-06.com.bennythink:server, portal: 172.21.174.180,3260] successful.</p>
<p>此时就应该多出来一个<code>/dev/sdb</code>了</p>
<h4 id="分区、格式化与挂载"><a href="#分区、格式化与挂载" class="headerlink" title="分区、格式化与挂载"></a>分区、格式化与挂载</h4><p>使用fdisk对sdb进行分区，这里想怎么分都行，我就直接都分一个主分区了</p>
<p>root@client:~# fdisk &#x2F;dev&#x2F;sdb<br>Welcome to fdisk (util-linux 2.31.1).<br>Changes will remain in memory only, until you decide to write them.<br>Be careful before using the write command.<br>Device does not contain a recognized partition table.<br>Created a new DOS disklabel with disk identifier 0x2afb442f.</p>
<p>Command (m for help): n<br>Partition type<br>p primary (0 primary, 0 extended, 4 free)<br>e extended (container for logical partitions)<br>Select (default p):<br>Using default response p.<br>Partition number (1-4, default 1):<br>First sector (8192-2097151, default 8192):<br>Last sector, +sectors or +size{K,M,G,T,P} (8192-2097151, default 2097151):<br>Created a new partition 1 of type ‘Linux’ and of size 1020 MiB.</p>
<p>Command (m for help): w<br>The partition table has been altered.<br>Calling ioctl() to re-read partition table.<br>Syncing disks.</p>
<p>进行格式化、挂载</p>
<p>mkfs.ext4 &#x2F;dev&#x2F;sdb1<br>mount &#x2F;dev&#x2F;sdb1 &#x2F;mnt&#x2F;data&#x2F;</p>
<p><img src="/images/2019062307425926.png"></p>
<h4 id="重启之后自动挂载"><a href="#重启之后自动挂载" class="headerlink" title="重启之后自动挂载"></a>重启之后自动挂载</h4><p>为了确保重启之后自动挂载，我们需要更改fstab</p>
<p>&#x2F;dev&#x2F;sdb1 &#x2F;mnt&#x2F;data ext4 defaults,_netdev 0 0</p>
<h3 id="安全使用iSCSI"><a href="#安全使用iSCSI" class="headerlink" title="安全使用iSCSI"></a>安全使用iSCSI</h3><p>由于iSCSI的传输数据的过程并不是加密的，所以如果跨公网使用，给人的感觉总是不好。为了解决这一问题，我们可以在客户端挂个VPN到服务端，可以用SSH隧道，可以用IPSec保护iSCSI，也可以加密sdb（比如用LUKS、VeraCrypt等呗）</p>
<p>咱这里就开个SSH隧道吧！要在<strong>配置客户端之前</strong>做好哦</p>
<p>修改服务端配置<code>vim /etc/ssh/sshd_config</code>，修改如下配置</p>
<p>PermitTunnel yes</p>
<p>然后重启sshd</p>
<p>systemctl restart sshd</p>
<p>然后输入如下命令，其中<code>root@server</code>替换成自己的服务器</p>
<p>sudo -E \<br>  ssh -F &#x2F;dev&#x2F;null \<br>  -o PermitLocalCommand&#x3D;yes \<br>  -o LocalCommand&#x3D;”ifconfig tun0 172.18.0.2 pointopoint 172.18.0.1 netmask 255.255.255.0” \<br>  -o ServerAliveInterval&#x3D;60 \<br>  -w 0:0 root@server \<br>  ‘sudo ifconfig tun0 172.18.0.1 pointopoint 172.18.0.2 netmask 255.255.255.0; hostname; echo tun0 ready’</p>
<p>之后再开一个窗口，discover &amp; login</p>
<p>iscsiadm –mode discoverydb –type sendtargets –portal 172.18.0.1 –discover<br>iscsiadm –mode node –targetname iqn.2019-06.com.bennythink:server –portal 172.18.0.1:3260 –login</p>
<p>当然理想方式是用key，然后systemd管这个SSH Tunnel啦！</p>
<p>(′д｀ )…彡…彡还是<a target="_blank" rel="noopener" href="https://nova.moe/deploy-wireguard-on-ubuntu-bionic/">用wireguard</a>吧</p>
<h3 id="iSCSI空间不够了怎么办"><a href="#iSCSI空间不够了怎么办" class="headerlink" title="iSCSI空间不够了怎么办"></a>iSCSI空间不够了怎么办</h3><p>还记得我们是使用的Logical Volume创建的吗！此时只需要<code>lvextend -L 10G /dev/idata/iscsi_data</code>就可以把分区调整为10G，然后客户端那边fdisk就能看见</p>
<p> </p>
<h2 id="其他类似技术"><a href="#其他类似技术" class="headerlink" title="其他类似技术"></a>其他类似技术</h2><h3 id="NFS、Samba"><a href="#NFS、Samba" class="headerlink" title="NFS、Samba"></a>NFS、Samba</h3><p>同理?</p>
<h3 id="GlusterFS"><a href="#GlusterFS" class="headerlink" title="GlusterFS"></a>GlusterFS</h3><p>萌新不懂，萌新瑟瑟发抖</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>折腾一大圈，不还是得买大盘鸡吗?还不是贫穷限制了我的想象力</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/06/23/vps-more-disk/index/" data-id="clhp7rtmx00axs2qrev3d07vv" data-title="vps硬盘不够了怎么办" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/8/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/10/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/azure/">azure</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/china/">china</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/china/justsay/">justsay</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/cloudflare/">cloudflare</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/gfw/">gfw</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/">it</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/it/justsay/">justsay</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/security/">security</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/share/">share</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/">justsay</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/gfw/">gfw</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/linux/security/">security</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/website/">website</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/program/">program</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/program/share/">share</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/security/">security</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/security/justsay/">justsay</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/security/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/share/">share</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/website/">website</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/website/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/what/">what</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/what/gfw/">gfw</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/ubuntu/" style="font-size: 10px;">ubuntu</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/10/">October 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">September 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">August 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">July 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">April 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">March 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">February 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/10/06/aca-vm-scale/index/">Azure Container Apps 连接到虚拟机并配置CPU自动缩放</a>
          </li>
        
          <li>
            <a href="/2024/09/28/worker-image-metadata/index/">使用 Cloudflare Worker获取图片元数据</a>
          </li>
        
          <li>
            <a href="/2024/09/27/workers-function/index/">将 Cloudflare Workers 迁移到 Azure Function</a>
          </li>
        
          <li>
            <a href="/2024/09/21/one-api-clickhouse/index/">one-api/new-api性能优化：使用 ClickHouse 作为日志系统</a>
          </li>
        
          <li>
            <a href="/2024/08/03/stripe-fraud/index/">Stripe 如何安全收款并避免盗刷与测卡</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 Benny小土豆<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>