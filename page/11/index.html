<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>土豆不好吃</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="土豆不好吃">
<meta property="og:url" content="http://example.com/page/11/index.html">
<meta property="og:site_name" content="土豆不好吃">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Benny小土豆">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="土豆不好吃" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">土豆不好吃</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-pyweathercn/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/08/18/pyweathercn/index/" class="article-date">
  <time class="dt-published" datetime="2018-08-18T00:00:00.000Z" itemprop="datePublished">2018-08-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/program/">program</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/08/18/pyweathercn/index/">一个简单强大的Python天气预报库pyweathercn</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>今天向大家介绍一款可以用来查询国内绝大部分城市天气预报的Python库pyweathercn，网上搜到的基本都不能用啦……</p>
<p>pyweathercn的作者正是大名鼎鼎的本人。</p>
<p>好吧，其实这个库我早在5月份的时候就写好了，但是由于太忙一直忘了这回事……</p>
<p>demo: <a target="_blank" rel="noopener" href="https://weather.bennythink.com/">https://weather.bennythink.com</a></p>
<h2 id="特色"><a href="#特色" class="headerlink" title="特色"></a>特色</h2><p>用法简洁</p>
<p>支持开启REST API风格的服务器，一库多用，异步非阻塞支持高并发，支持https</p>
<h2 id="为啥要开发这个"><a href="#为啥要开发这个" class="headerlink" title="为啥要开发这个"></a>为啥要开发这个</h2><p>因为我需要啊！上网搜罗了一波，各种天气预报API基本上都得注册，可能还得要钱，或者限制访问频率，这就让我非常不开心了。那么既然没人写过，那咱就只好自己写一个了啊。</p>
<p>不过需要注意的是，这个原理是爬虫并解析<a target="_blank" rel="noopener" href="http://www.weather.com.cn/">www.weather.com.cn</a>，所以如果某天不好用了，很有可能就是人家网站改版了……</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>需要注意的是，这个库并不支持Python 2，所以请使用Python 3</p>
<p>pip install pyweathercn</p>
<p>如果需要请自行替换为<code>pip3</code></p>
<p>另外，如果你使用国内的PyPi源，可能现在还没更新到1.0.3呢……</p>
<p>其实这个库本应该是支持Python 2的，因为也没用什么Python 3才有的特性和语法用了一些的，但是我就是不想支持Python 2，不爽你来打我啊。不过非得想支持Python 2 的话，你可以下载tar包解压缩到site-packages啊</p>
<h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><h3 id="普通模式"><a href="#普通模式" class="headerlink" title="普通模式"></a>普通模式</h3><p>非常简单，支持chain call和实例模式，来几个例子：</p>
<p>&gt;&gt;&gt; import pyweathercn</p>
<blockquote>
<blockquote>
<blockquote>
<p>pyweathercn.Weather(‘重庆’).temp()</p>
</blockquote>
</blockquote>
</blockquote>
<p>‘重庆：20’</p>
<blockquote>
<blockquote>
<blockquote>
<p>w &#x3D; pyweathercn.Weather(‘北京’)</p>
</blockquote>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>w.data</p>
</blockquote>
</blockquote>
</blockquote>
<p>{‘data’: {‘city’: ‘北京’, ‘aqi’: ‘159’, ‘tip’: ‘紫外线指数很强涂擦SPF20以上，PA++护肤品，避强光。穿衣指数热适合穿T恤、短薄外套等夏季服装。’, ‘temp’: ‘20’, ‘forecast’: [{‘date’: ‘23日（今天）’, ‘type’: ‘晴’, ‘temp’: ‘15℃’, ‘wind’: ‘西南风 3-4级’}, {‘date’: ‘24日（明天）’, ‘type’: ‘晴’, ‘temp’: ‘31℃&#x2F;17℃’, ‘wind’: ‘南风 3-4级’}, {‘date’: ‘25日（后天）’, ‘type’: ‘晴转多云’, ‘temp’: ‘31℃&#x2F;19℃’, ‘wind’: ‘西南风 &lt;3级’}, {‘date’: ‘26日（周六）’, ‘type’: ‘阴转多云’, ‘temp’: ‘30℃&#x2F;16℃’, ‘wind’: ‘西风 &lt;3级’}, {‘date’: ‘27日（周日）’, ‘type’: ‘多云’, ‘temp’: ‘29℃&#x2F;15℃’, ‘wind’: ‘南风 &lt;3级’}, {‘date’: ‘28日（周一）’, ‘type’: ‘多云’, ‘temp’: ‘25℃&#x2F;15℃’, ‘wind’: ‘东北风 &lt;3级’}, {‘date’: ‘29日（周二）’, ‘type’: ‘晴’, ‘temp’: ‘29℃&#x2F;15℃’, ‘wind’: ‘西南风 &lt;3级’}]}, ‘status’: 0, ‘message’: ‘success’}</p>
<blockquote>
<blockquote>
<blockquote>
<p>w.today()</p>
</blockquote>
</blockquote>
</blockquote>
<p>‘北京：23日（今天）晴15℃西南风 3-4级’</p>
<blockquote>
<blockquote>
<blockquote>
<p>w.tomorrow(True)</p>
</blockquote>
</blockquote>
</blockquote>
<p>{‘date’: ‘24日（明天）’, ‘type’: ‘晴’, ‘temp’: ‘31℃&#x2F;17℃’, ‘wind’: ‘南风 3-4级’}</p>
<blockquote>
<blockquote>
<blockquote>
<p>w.tip()</p>
</blockquote>
</blockquote>
</blockquote>
<p>‘北京温馨提示：紫外线指数很强涂擦SPF20以上，PA++护肤品，避强光。穿衣指数热适合穿T恤、短薄外套等夏季服装。’</p>
<blockquote>
<blockquote>
<blockquote>
<p>w.forecast(False,5)</p>
</blockquote>
</blockquote>
</blockquote>
<p>‘北京：28日（周一）多云25℃&#x2F;15℃东北风 &lt;3级’</p>
<p>其中tomorrow 等类方法的参数如果传布尔真值的话，将会显示原始json响应，不传或者传布尔假值会显示易于阅读的字符串。</p>
<p>其他的一些类方法，咱的IDE都有提示，我注释写的还算简单易懂，这里就不细说了</p>
<h3 id="服务器模式"><a href="#服务器模式" class="headerlink" title="服务器模式"></a>服务器模式</h3><p>import pyweather</p>
<h1 id="running-on-http-127-0-0-1-8888"><a href="#running-on-http-127-0-0-1-8888" class="headerlink" title="running on http://127.0.0.1:8888"></a>running on <a target="_blank" rel="noopener" href="http://127.0.0.1:8888/">http://127.0.0.1:8888</a></h1><p>pyweathercn.server(host&#x3D;’127.0.0.1’)</p>
<h1 id="running-on-http-0-0-0-0-3333"><a href="#running-on-http-0-0-0-0-3333" class="headerlink" title="running on http://0.0.0.0:3333"></a>running on <a target="_blank" rel="noopener" href="http://0.0.0.0:3333/">http://0.0.0.0:3333</a></h1><p>pyweathercn.server(3333)</p>
<h1 id="support-ssl-https-www-example-com-8888"><a href="#support-ssl-https-www-example-com-8888" class="headerlink" title="support ssl: https://www.example.com:8888"></a>support ssl: <a target="_blank" rel="noopener" href="https://www.example.com:8888/">https://www.example.com:8888</a></h1><p>pyweathercn.server(‘8888’, ‘<a target="_blank" rel="noopener" href="http://www.example.com/">www.example.com</a>‘, ssl_options&#x3D;{<br>“certfile”: “fullchain.pem”,<br>“keyfile”: “privkey.pem”})</p>
<p>哪位好心人我啊可以开放一个<a target="_blank" rel="noopener" href="https://weather.bennythink.com/">公开的API</a>给大家用，哈哈。</p>
<p>在服务器模式下的调用方法，需要请求<code>/weather</code>路由，必须参数为city，可选参数为day，使用get方法的url参数或者post方法的url-encode form，目前还不支持post json。</p>
<p> </p>
<h4 id="Nginx-反向代理"><a href="#Nginx-反向代理" class="headerlink" title="Nginx 反向代理"></a>Nginx 反向代理</h4><p>服务器用systemd等运行一个监听127.0.0.1的服务器模式python脚本，server块如下配置：</p>
<p>server {<br>listen 80;<br>server_name <a target="_blank" rel="noopener" href="http://www.siteone.com/">www.siteone.com</a>; # 你的域名<br>location &#x2F; {<br>proxy_pass <a target="_blank" rel="noopener" href="http://127.0.0.1:8888/">http://127.0.0.1:8888</a>;<br>}</p>
<p>如果需要https支持，可以参考<a target="_blank" rel="noopener" href="https://github.com/BennyThink/tools/blob/master/weather.conf">这个配置文件</a></p>
<h4 id="例子1-GET：呃请原谅我的pangu把url搞成了带空格的……"><a href="#例子1-GET：呃请原谅我的pangu把url搞成了带空格的……" class="headerlink" title="例子1 GET：呃请原谅我的pangu把url搞成了带空格的……"></a>例子1 GET：呃请原谅我的pangu把url搞成了带空格的……</h4><p><a target="_blank" rel="noopener" href="http://127.0.0.1:8888/weather?city=%E4%B8%8A%E6%B5%B7">http://127.0.0.1:8888/weather?city=上海</a></p>
<p><img src="/images/2018081808175847.png"></p>
<h4 id="例子2-GET："><a href="#例子2-GET：" class="headerlink" title="例子2 GET："></a>例子2 GET：</h4><p><a target="_blank" rel="noopener" href="http://127.0.0.1:8888/weather?city=%E4%B8%8A%E6%B5%B7&day=3">http://127.0.0.1:8888/weather?city=上海&amp;day=3</a></p>
<p><img src="/images/2018081808175971.png"></p>
<h4 id="例子3-POST："><a href="#例子3-POST：" class="headerlink" title="例子3 POST："></a>例子3 POST：</h4><p><img src="/images/2018081808180288.png"></p>
<h2 id="PyPi仓库地址"><a href="#PyPi仓库地址" class="headerlink" title="PyPi仓库地址"></a>PyPi仓库地址</h2><p><a target="_blank" rel="noopener" href="https://pypi.org/project/pyweathercn/">https://pypi.org/project/pyweathercn/</a></p>
<h2 id="GitHub源代码"><a href="#GitHub源代码" class="headerlink" title="GitHub源代码"></a>GitHub源代码</h2><p>[gt href&#x3D;’<a target="_blank" rel="noopener" href="https://github.com/BennyThink/pyweathercn'/]%E5%BC%80%E6%BA%90%E5%9C%B0%E5%9D%80/[/gt/]">https://github.com/BennyThink/pyweathercn&#39;\]开源地址\[/gt\]</a> 欢迎star、fork、PR</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/08/18/pyweathercn/index/" data-id="clhp7rtif0075s2qr7l5c31yj" data-title="一个简单强大的Python天气预报库pyweathercn" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-x1c-hdmi/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/08/09/x1c-hdmi/index/" class="article-date">
  <time class="dt-published" datetime="2018-08-09T00:00:00.000Z" itemprop="datePublished">2018-08-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/it/">it</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/08/09/x1c-hdmi/index/">X1 Carbon的HDMI不好用了怎么办</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>X1C的HDMI不好用了怎么办，捅屁股啊</p>
<p>Lenovo X1 Carbon 6th 是一款非常优(áng)秀(guì)、轻薄的商务本。某天，我照常连接显示器的时候，发现竟然没有输出了。考虑到Windows 10是一个日常抽风的操作系统，第一反应当然是重启啦。</p>
<p>当然是不好用的啦。</p>
<p>那么就替换法，依次替换转接头、用同事电脑测试，得出的结论是：HDMI转接头没坏、VGA线没坏，显示器没坏，是我电脑炸了。至于是软件还是硬件……要不我先做个Ubuntu Live Disk试试？</p>
<p>后来再联想官网搜到了解决方案，如果你的设备管理器中System Device下没有看到ThunderBolt字样的设备，那么就可以跟着这个方法来一遍。</p>
<p><img src="/images/2018080904481293.png"></p>
<p>关机，拔掉电源，把电脑翻过来，找到背面的小孔，用一个回形针捅大概5秒。然后，开机，设备管理器里是不是就有了，是不是就好用了</p>
<p><img src="/images/201808090448151.png"></p>
<p><strong>喂(#`O′)我说，你要是用百度，下辈子也搜不到这个结果。李彦宏你就别出来丢人现眼了</strong></p>
<p>参考资料：</p>
<p><a target="_blank" rel="noopener" href="https://forums.lenovo.com/t5/ThinkPad-X-Series-Laptops/X1-Carbon-6th-gen-HDMI-not-working/td-p/4091511">X1 Carbon 6th gen HDMI not working</a></p>
<p><a target="_blank" rel="noopener" href="https://is.wfu.edu/help-articles/hard-reset-for-lenovo-x1-carbon/">Hard Reset for Lenovo X1 Carbon</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/08/09/x1c-hdmi/index/" data-id="clhp7rtnm00bks2qr30sc2jf9" data-title="X1 Carbon的HDMI不好用了怎么办" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-ntpdate-problem/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/07/12/ntpdate-problem/index/" class="article-date">
  <time class="dt-published" datetime="2018-07-12T00:00:00.000Z" itemprop="datePublished">2018-07-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/linux/">linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/07/12/ntpdate-problem/index/">Ntpdate调整时间no server suitable for synchronization found</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>小葵花妈妈课堂开课啦</p>
<h2 id="关于俺近期的静默"><a href="#关于俺近期的静默" class="headerlink" title="关于俺近期的静默"></a>关于俺近期的静默</h2><p>最近两个多月，俺确实比较忙（在前几篇博文中也多次提及这点），导致博客更新频率下降。在此，先向各位读者表示抱歉 :(</p>
<p>划掉划掉，其实是最近比较忙，又觉得没什么可以写的。</p>
<h2 id="NTP问题"><a href="#NTP问题" class="headerlink" title="NTP问题"></a>NTP问题</h2><p>最近在公司服务器上进行一些操作，需要比较精确的时间，但是发现服务器时间慢了接近半小时。</p>
<p>对于我这么懒的人，怎么会自己用date去设置时间啊，于是自然用ntpdate同步时间啊。</p>
<p>于是很自然的，用阿里云的ntp服务器吧</p>
<p>[root@XXX ~]# ntpdate -v ntp1.aliyun.com<br>12 Jul 13:25:56 ntpdate[5547]: ntpdate <a href="mailto:&#52;&#46;&#50;&#x2e;&#54;&#112;&#x35;&#x40;&#49;&#x2e;&#50;&#51;&#x34;&#x39;&#x2d;&#x6f;">&#52;&#46;&#50;&#x2e;&#54;&#112;&#x35;&#x40;&#49;&#x2e;&#50;&#51;&#x34;&#x39;&#x2d;&#x6f;</a> Thu Oct 26 10:57:33 UTC 2017 (1)<br>12 Jul 13:26:01 ntpdate[5547]: no server suitable for synchronization found</p>
<p>啊噗，这是个什么报错，莫非阿里云挂了？换到自己的服务器上发现没问题啊……</p>
<p>别说了，网上搜那堆东西真是<a target="_blank" rel="noopener" href="https://dmesg.app/mysql-es-mongo.html#title-3">你抄我我抄你，你说有用吧还说得过去，都是没用的错误的，有意思嘛。</a></p>
<p>后来想了想，可能是因为公司服务器有一些网络限制，导致只能使用内部的NTP服务器吧？于是上employee communities上搜了下，找了一个，再试试……</p>
<p>[root@XXX ~]# ntpdate -v 1.ntp.company.com<br>12 Jul 13:42:25 ntpdate[5825]: ntpdate <a href="mailto:&#x34;&#x2e;&#50;&#x2e;&#x36;&#x70;&#53;&#x40;&#49;&#46;&#x32;&#x33;&#x34;&#57;&#x2d;&#111;">&#x34;&#x2e;&#50;&#x2e;&#x36;&#x70;&#53;&#x40;&#49;&#46;&#x32;&#x33;&#x34;&#57;&#x2d;&#111;</a> Thu Oct 26 10:57:33 UTC 2017 (1)<br>12 Jul 13:42:26 ntpdate[5825]: adjust time server 88.99.77.66 offset -0.009861 sec</p>
<p>你看行了吧</p>
<h2 id="关于近期和未来的计划"><a href="#关于近期和未来的计划" class="headerlink" title="关于近期和未来的计划"></a>关于近期和未来的计划</h2><p>由于工作稍微有点忙，所以除了安静的过好每一天，暂时没有什么太大的安排。</p>
<p>非得要说说的嘛……那就是研究下<a target="_blank" rel="noopener" href="https://www.jetbrains.com/license-server/outdated-ls/">新版本的JetBrains License Server</a>? 要是能有好心人提供一个抓包样本就好了。</p>
<p>更多详细信息可以戳这篇<a target="_blank" rel="noopener" href="https://dmesg.app/jbls.html">《JetBrains License Server 原理及 40 行 Python 代码的实现》</a></p>
<h2 id="于是就这么水了一贴……"><a href="#于是就这么水了一贴……" class="headerlink" title="于是就这么水了一贴……?"></a>于是就这么水了一贴……?</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/07/12/ntpdate-problem/index/" data-id="clhp7rthv0067s2qr2t8o1dpu" data-title="Ntpdate调整时间no server suitable for synchronization found" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-padavan-radius/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/05/13/padavan-radius/index/" class="article-date">
  <time class="dt-published" datetime="2018-05-13T00:00:00.000Z" itemprop="datePublished">2018-05-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/it/">it</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/05/13/padavan-radius/index/">在Padavan上简单的使用Radius进行802.1x认证</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>注意看，是Radius，不是Redis</p>
<p>通常来说，我们的无线网络一般是使用WPA2-Personal保护的，但是如果能够使用802.1x，每位用户输入自己的用户名密码，类似某些企业、学校那种认证方式，岂不是很好玩？</p>
<p>当然了，咱只是为了好玩……好像并没什么卵用的样子</p>
<h2 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h2><h3 id="需要有一台支持WPA2-Enterprise的路由器"><a href="#需要有一台支持WPA2-Enterprise的路由器" class="headerlink" title="需要有一台支持WPA2-Enterprise的路由器"></a>需要有一台支持WPA2-Enterprise的路由器</h3><p>包括但不限于Padavan等第三方固件。某些路由器的官方固件也是支持的。</p>
<p>比如，在这款TP-LINK固件中无线安全的设置下我们可以看到这个：</p>
<p><img src="/images/2018051308413275.png"></p>
<p>Padavan固件中可以看到这些</p>
<p><img src="/images/2018051308413667.png"></p>
<h3 id="一台服务器"><a href="#一台服务器" class="headerlink" title="一台服务器"></a>一台服务器</h3><p>无论这台服务器是在内网的，还是在外网（比如说腾讯云的也可以）的都可以，只要能和路由器互相通信，并且拥有一个固定的IP即可。</p>
<p>当然了，我这么穷，肯定是拿树莓派做Radius服务器啦。如果想拿Padavan自身做Radius服务器……嗯~ o(<em>￣▽￣</em>)o这个还是算了吧，交叉编译太麻烦，性能也有点太差劲呢。</p>
<p>当然了，这台服务器是要装好一个Linux发行版的。方便起见，这里我用的是Ubuntu Mate 16.04，IP地址为192.168.7.193.当然了，我已经在Padavan中绑定了这个IP，这样就不会因为种种原因导致分配了其他的IP地址啦。 [v_blue] 小提示：固定IP分配方法 高级配置-内部网络-DHCP服务器，最下方的手动指定 IP 的 DHCP 列表。</p>
<p>其他固件可以参考类似条目或者IP与MAC绑定等。 [&#x2F;v_blue]</p>
<h2 id="准备Radius服务器"><a href="#准备Radius服务器" class="headerlink" title="准备Radius服务器"></a>准备Radius服务器</h2><p>既然要使用WPA2-Enterprise，咱就要有Radius服务器来提供认证。这里咱就选择<a target="_blank" rel="noopener" href="https://freeradius.org/">freeRadius</a>啦。</p>
<p>所以就是编译编译咯。以Ubuntu、freeRadius 3.0.x为例：</p>
<p>sudo apt update<br>sudo apt install libtalloc-dev libssl-dev build-essential<br>wget <a href="ftp://ftp.freeradius.org/pub/freeradius/freeradius-server-3.0.17.tar.gz">ftp://ftp.freeradius.org/pub/freeradius/freeradius-server-3.0.17.tar.gz</a><br>tar xf freeradius-server-3.0.17.tar.gz &amp;&amp; rm freeradius-server-3.0.17.tar.gz<br>cd freeradius-server-3.0.17<br>.&#x2F;configure<br>make -j4 &amp;&amp; sudo make install</p>
<p>在最后一步<code>make install</code>时，由于树莓派这孱弱的性能，生成DH密钥花了很长时间（超过半小时哦） <img src="/images/2018051308413833.png"> </p>
<h2 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h2><p>经过漫长的编译之后，如果确认编译成功的话，那咱们就开始配置吧。</p>
<p>以root权限执行如下命令开启调试模式：</p>
<p>sudo radiusd -X</p>
<p>不出意外的话你会看到这样的报错：</p>
<p>Debugger not attached<br>Refusing to start with libssl version OpenSSL 1.0.2g 1 Mar 2016 0x1000207f (1.0.2g release) (in range 1.0.2 release - 1.0.2h rele)<br>Security advisory CVE-2016-6304 (OCSP status request extension)<br>For more information see <a target="_blank" rel="noopener" href="https://www.openssl.org/news/secadv/20160922.txt">https://www.openssl.org/news/secadv/20160922.txt</a><br>Once you have verified libssl has been correctly patched, set security.allow_vulnerable_openssl &#x3D; ‘CVE-2016-6304’</p>
<p>要么更新OpenSSL到1.0.2h之后的，要么……禁用这个检查呗。鉴于OpenSSL实在是太基础的东西，怕更新出乱子，还是禁用吧</p>
<p>sudo vim &#x2F;usr&#x2F;local&#x2F;etc&#x2F;raddb&#x2F;radiusd.conf</p>
<p>找到<code>allow_vulnerable_openssl = no</code>，把no改成yes</p>
<p>此时再运行<code>sudo radius -X</code>，就应该能看到Ready to process requests字样了。</p>
<h2 id="添加认证信息"><a href="#添加认证信息" class="headerlink" title="添加认证信息"></a>添加认证信息</h2><p>我们需要配置两个认证信息，一个是路由器连接到Radius的认证信息，一个是客户用于连接到热点的信息。</p>
<p>sudo vim &#x2F;usr&#x2F;local&#x2F;etc&#x2F;raddb&#x2F;clients.conf</p>
<p>在文件末尾添加如下信息：</p>
<p>client new {<br>ipaddr &#x3D; 192.168.7.1<br>secret &#x3D; pi.lan<br>}</p>
<p>其中IP地址是路由器的IP地址，secret是设置的密码。</p>
<p>sudo vim &#x2F;usr&#x2F;local&#x2F;etc&#x2F;raddb&#x2F;mods-config&#x2F;files&#x2F;authorize</p>
<p>在文件的开头（或者找到取消注释）添加如下信息：</p>
<p>bob Cleartext-Password :&#x3D; “hello”<br>Reply-Message :&#x3D; “Hello, %{User-Name}”</p>
<p>这行配置的意思是，用户名为bob，密码为hello</p>
<p>保存退出，再次运行<code>sudo radiusd -X</code></p>
<p>另开一个窗口，运行如下命令：</p>
<p>radtest bob hello 127.0.0.1 0 test<br>ing123</p>
<p>如果出现如下图所示的Access-Accept那么就是配置成功了</p>
<p><img src="/images/2018051308413973.png"></p>
<h2 id="配置路由器"><a href="#配置路由器" class="headerlink" title="配置路由器"></a>配置路由器</h2><p>在路由器中找到对应的WPA2-Enterprise的配置，大概如下设置：</p>
<p><img src="/images/2018051308414048.png"></p>
<p>之后保存即可</p>
<h2 id="客户端连接"><a href="#客户端连接" class="headerlink" title="客户端连接"></a>客户端连接</h2><p>之后拿起你的手机，找到刚刚的热点，会发现已经变成802.1x认证了，输入用户名bob，密码hello，就可以成功连接啦。</p>
<p><img src="/images/201805130841428.png"></p>
<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>这只是一个非常简单的基础配置教程，可能存在一些不安全的因素。所以以后说不定出系列呗？比如说用数据库，提升安全性……？</p>
<p>更多详情，还是看下面的参考资料吧</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://wiki.freeradius.org/building/Home">https://wiki.freeradius.org/building/Home</a></p>
<p><a target="_blank" rel="noopener" href="https://freeradius.org/documentation/">https://freeradius.org/documentation/</a></p>
<p><a target="_blank" rel="noopener" href="https://freeradius.org/doc/getting_started.html">https://freeradius.org/doc/getting_started.html</a></p>
<p><a target="_blank" rel="noopener" href="http://networkradius.com/doc/FreeRADIUS%20Technical%20Guide.pdf">http://networkradius.com/doc/FreeRADIUS%20Technical%20Guide.pdf</a></p>
<p><a target="_blank" rel="noopener" href="https://depthsecurity.com/blog/when-802-1x-peap-eap-ttls-is-worse-than-no-wireless-security">https://depthsecurity.com/blog/when-802-1x-peap-eap-ttls-is-worse-than-no-wireless-security</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/05/13/padavan-radius/index/" data-id="clhp7rthz006fs2qr4gdzgi3c" data-title="在Padavan上简单的使用Radius进行802.1x认证" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-hopeless-future/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/04/22/hopeless-future/index/" class="article-date">
  <time class="dt-published" datetime="2018-04-22T00:00:00.000Z" itemprop="datePublished">2018-04-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/justsay/">justsay</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/04/22/hopeless-future/index/">看不到希望的未来</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>[netmusic play&#x3D;’0’]41636941[&#x2F;netmusic]</p>
<p>如果能回到过去，我肯定会选择大学时光。那时候无忧无虑，不愁吃穿，可以尽情的钻研技术，也可以浑浑噩噩的打游戏，简而言之就是可以很任性。看看现在已经工作快一年了，这段时间唯一的更深的感觉就是，远远的、看不到希望的、未知的未来。</p>
<p>这个未来，可怕的不在于未知，而在于看不到希望。</p>
<p>我现在住在一个老小破的房子里，手边有着游戏机，酒杯里有清澈的酒，银行卡里有着一小笔存款，可以买自己喜欢的东西，可以为喜欢的女生孤注一掷的买点什么，可以与美女同学一起去樱花园，可以开开心心的吃顿大餐。十分明确的一点是，我的收入要远远高于房租，我能够凭借自己的力量生存下去。</p>
<p>也许这对于一个刚刚步入社会，甚至可以说还未走出校园的人来说，算是混得很好的吧？简单的想一想好像真的是这样，在身边的人可能还需要家里帮忙拿点房租钱的时候，我已经能够自己承担房租，还活得很滋润，简单的想想还是有一些自豪或者是优越感的。</p>
<p>可是如果稍微深入一些，便会发现这只是杯水车薪，对于我的未来而言，我看不到希望。</p>
<p>一个人的新的一段人生，该从哪里开始呢？我想应该是结婚生子，初为人父吧。然而，在我这样一个高消费的、房价飞涨的、收入却还不算很高的城市里，想买一套房子几乎就是很困难的事情。即使月入万元，也很难买得起1平方米的70年的地，10年来，做工程师赚的钱，只有房产升值的零头。工资增长的斜率远远比不过房产升值的斜率。</p>
<p>为什么不找父母要点钱呢，为什么不贷款呢？也许我不曾说过我出生于怎样的家庭。那好吧，我出生于一个很普通的、甚至可以说是贫穷的工人家庭吧。在我之前家里有个姐姐，后来因为生病所以才又有了我。父母辛苦一辈子才攒了这么点钱，说真的我不好意思拿。而且我还有个对我那么好的那么支持我的姐姐，更不好意思了。更别说父母一辈子的积蓄也到不了首付。</p>
<p>所以这么一想，其实未来是没什么希望的。现在的每一天看起来过得很滋润，却隐藏着对未来的不确定性。不当家不知柴米贵,不养儿不知父母恩。现在的人们都很现实啊，哪个姑娘愿意嫁给一个没房没车的古怪的穷小子？潜力股又有什么用。</p>
<p>突然想感叹，不知道前任如何选择了我。她很漂亮，明知我矮穷挫可却还选择和我在一起，甚至都已经考虑了结婚和未来的事情。也许那个时候我们都很幼稚吧，不知道生活有多么残酷，也许那个时候爱情都是很纯真美好的吧。感谢她放弃了我，和我在一起应该会吃很多苦的，她应该会找到更好的归宿的。</p>
<p>即使我离开这座城市，去往机遇更多的北上广，凭借着自己的一技之长也许能够赚更多的钱，但是也同样要面临可能会更多的压力。也许最好的选择是出国吧，然而这对我来说真的只是天方夜谭，就如同想象着努力工作，被调职到北京、上海，然后加入美国总部一样的天方夜谭。这是梦里都没想过的事情。</p>
<p>一个小小的银行职员最后加入了东京中央银行，一个不起眼的木讷的草食系程序员最后却娶到了森山实栗，对不起，这样的故事在中国根本不现实。</p>
<p>一直以为学好技术，或许能有发展，也许能够出人头地，但是我还是太年轻了。踏出大学之后我才知道，中国不像美国，中国没有硅谷，在国内之重视金钱而忽略技术。人无生存压力，自然就可以为了理想和兴趣而工作。现在，生不逢时的年轻人，在这个生存压力无穷大的国家里，为了生存不得不抛弃理想和兴趣。难怪呢，光怪陆离的现实。</p>
<p>这是一个<strong>被吸血的时代</strong>，这是一个看不到希望的连尽头都看不到的未来。</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2018/04/201804220404294.jpg"><img src="/images/201804220404294.jpg"></a></p>
<p>桜の花?。大好きだ。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/04/22/hopeless-future/index/" data-id="clhp7rtgq003vs2qr8o1rbntu" data-title="看不到希望的未来" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-python2-3-port/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/04/17/python2-3-port/index/" class="article-date">
  <time class="dt-published" datetime="2018-04-17T00:00:00.000Z" itemprop="datePublished">2018-04-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/program/">program</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/04/17/python2-3-port/index/">一次找不到错误的巨坑的http header的url编码的Python 3迁移问题</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="起源"><a href="#起源" class="headerlink" title="起源"></a>起源</h2><p>近期，我把一个Python 2 的项目迁移到了Python 3，今早在进行最后一次测试时，发现下载的一个按钮是失效的。当时立刻就想，完蛋了，难道是遇到了跨平台的问题？那就糟糕了啊，跨平台问题都不太好处理的。</p>
<p>试了下原来的Python 2版本的还正常，那么就是这次迁移有点小问题了。</p>
<p><img src="/images/201804170754535.png"></p>
<h2 id="确定复现"><a href="#确定复现" class="headerlink" title="确定复现"></a>确定复现</h2><p>经过一系列绝望的瞎猫碰死耗子的尝试，发现了当要下载的文件是第三个，就会触发这个错误，抛的异常如下：</p>
<p>[E 180417 11:03:48 web:1590] Uncaught exception GET &#x2F;apps&#x2F;scenario_change&#x2F;page&#x2F;download?_id&#x3D;5aab8287e138235c1c9fa9ea&amp;type&#x3D;task (127.0.0.1)<br>    HTTPServerRequest(protocol&#x3D;’http’, host&#x3D;’127.0.0.1:9118’, method&#x3D;’GET’, uri&#x3D;’&#x2F;apps&#x2F;scenario_change&#x2F;page&#x2F;download?_id&#x3D;5aab8287e138235c1c9fa9ea&amp;type&#x3D;task’, version&#x3D;’HTTP&#x2F;1.1’, remote_ip&#x3D;’127.0.0.1’, headers&#x3D;{‘Host’: ‘127.0.0.1:9118’, ‘Connection’: ‘keep-alive’, ‘Upgrade-Insecure-Requests’: ‘1’, ‘User-Agent’: ‘Mozilla&#x2F;5.0 (Macintosh; U; Intel Mac OS X 10.11; rv:54.0) Gecko&#x2F;20100101 Firefox&#x2F;54.0’, ‘Accept’: ‘text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8’, ‘Dnt’: ‘1’, ‘Referer’: ‘<a target="_blank" rel="noopener" href="http://127.0.0.1:9118/apps/scenario/_change/task/_management.html">http://127.0.0.1:9118/apps/scenario\_change/task\_management.html</a>‘, ‘Accept-Encoding’: ‘gzip, deflate, br’, ‘Accept-Language’: ‘zh-CN,zh;q&#x3D;0.9,en-US;q&#x3D;0.8,en;q&#x3D;0.7’})<br>    Traceback (most recent call last):<br>      File “C:\Python36\lib\site-packages\tornado\web.py”, line 1513, in _execute<br>        self.finish()<br>      File “C:\Python36\lib\site-packages\tornado\web.py”, line 991, in finish<br>        self.flush(include_footers&#x3D;True)<br>      File “C:\Python36\lib\site-packages\tornado\web.py”, line 947, in flush<br>        start_line, self._headers, chunk, callback&#x3D;callback)<br>      File “C:\Python36\lib\site-packages\tornado\http1connection.py”, line 381, in write_headers<br>        lines.extend(l.encode(‘latin1’) for l in header_lines)<br>      File “C:\Python36\lib\site-packages\tornado\http1connection.py”, line 381, in<br>        lines.extend(l.encode(‘latin1’) for l in header_lines)<br>    UnicodeEncodeError: ‘latin-1’ codec can’t encode characters in position 45-46: ordinal not in range(256)<br>[E 180417 11:03:48 web:1015] Cannot send error response after headers written<br>[E 180417 11:03:48 web:1025] Failed to flush partial response<br>    Traceback (most recent call last):<br>      File “C:\Python36\lib\site-packages\tornado\web.py”, line 1513, in _execute<br>        self.finish()<br>      File “C:\Python36\lib\site-packages\tornado\web.py”, line 991, in finish<br>        self.flush(include_footers&#x3D;True)<br>      File “C:\Python36\lib\site-packages\tornado\web.py”, line 947, in flush<br>        start_line, self._headers, chunk, callback&#x3D;callback)<br>      File “C:\Python36\lib\site-packages\tornado\http1connection.py”, line 381, in write_headers<br>        lines.extend(l.encode(‘latin1’) for l in header_lines)<br>      File “C:\Python36\lib\site-packages\tornado\http1connection.py”, line 381, in<br>        lines.extend(l.encode(‘latin1’) for l in header_lines)<br>    UnicodeEncodeError: ‘latin-1’ codec can’t encode characters in position 45-46: ordinal not in range(256)</p>
<pre><code>During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File &quot;C:\\Python36\\lib\\site-packages\\tornado\\web.py&quot;, line 1022, in send\_error
    self.finish()
  File &quot;C:\\Python36\\lib\\site-packages\\tornado\\web.py&quot;, line 992, in finish
    self.request.finish()
  File &quot;C:\\Python36\\lib\\site-packages\\tornado\\httputil.py&quot;, line 419, in finish
    self.connection.finish()
  File &quot;C:\\Python36\\lib\\site-packages\\tornado\\http1connection.py&quot;, line 448, in finish
    self.\_expected\_content\_remaining)
tornado.httputil.HTTPOutputError: Tried to write 8015 bytes less than Content-Length
</code></pre>
<h2 id="追踪异常1：白高兴"><a href="#追踪异常1：白高兴" class="headerlink" title="追踪异常1：白高兴"></a>追踪异常1：白高兴</h2><p>按照常理讲，咱代码出了异常，咱就定位到报错的最后一行（most recent call last嘛，最后一次调用），看下异常是什么知道个大概，然后跳过去，该回溯的回溯，管它是高级的打断点开debug还是低级的一顿print的，确定问题根源然后修改。</p>
<p>看一眼这个异常，<strong>Tried to write 8015 bytes less than Content-Length</strong>，看样子好像是指定了一个Content-Length但是实际上发送的文件却比这个短8015字节。莫非是迁移到3的过程中对Unicode与bytes应用了错误的<code>len()</code>导致抛异常？</p>
<p>那简单了，看一眼是不是设错了headers就好了啊，Edit - Find - Find in path，限定文件类型为py，开搜！</p>
<p><img src="/images/201804170754546.png"></p>
<p>啥？逗我呢？没有？ [v_tips] 小提示：为啥第一想法要怀疑Content-Length的长度设置错了呢？</p>
<p>很简单啦，Python 2对Unicode的实现emmm这么说吧，在Python 2里，<code>&#39;hello&#39;</code>是二进制（字节流 bytes），<code>u&#39;hello&#39;</code>才是Unicode；但是在3里呢，<code>&#39;hello&#39;</code>是Unicode，<code>b&#39;hello&#39;</code>才是二进制。唉，谁叫Python 问世（第一版发布于1991.02）的时候Unicode标准（1991.10）还没出来呢。</p>
<p>以防你们不晓得这么个大坑，看下图：</p>
<p><img src="/images/2018041707545544.png"></p>
<p>以后在有人跟你说一个汉字是两个字节，你就拿这个图怼死他：不说编码就说一个汉字是几个字节就是耍流氓，<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E4%B8%AD%E6%97%A5%E9%9F%93%E7%B5%B1%E4%B8%80%E8%A1%A8%E6%84%8F%E6%96%87%E5%AD%97">说了编码那也是耍流氓</a>。[&#x2F;v_tips]</p>
<h2 id="追踪异常2：找到根源"><a href="#追踪异常2：找到根源" class="headerlink" title="追踪异常2：找到根源"></a>追踪异常2：找到根源</h2><p>有点扫兴，竟然没有Content-Length，那是因为啥呢？那就继续看着报错回溯呗。扫了一眼，啥，<strong>都是tornado的错</strong>，<strong>不是我的错</strong>？难道我要怀疑编译器解释器和久负盛名的tornado……？ [v_blue] 扩展阅读：</p>
<p>《<a target="_blank" rel="noopener" href="https://v2mm.tech/topic/830/%E5%A4%A7%E5%AE%B6%E6%9C%89%E4%BB%80%E4%B9%88%E5%86%99%E4%BB%A3%E7%A0%81%E5%86%99%E5%88%B0%E6%80%80%E7%96%91%E4%BA%BA%E7%94%9F-%E6%80%80%E7%96%91%E7%BC%96%E8%AF%91%E5%99%A8%E8%A7%A3%E9%87%8A%E5%99%A8%E7%9A%84%E7%BB%8F%E5%8E%86%E5%90%97">大家有什么写代码写到怀疑人生、怀疑编译器解释器的经历吗</a>》</p>
<p>cookies的时间戳，C语言标准for循环<code>for(int i=0;i++;i&lt;10)</code>，mian，ture，全角符号，以及<code>&lt;link href</code>……[&#x2F;v_blue]</p>
<p>又仔细看了一眼，发现这么一段话：<strong>During handling of the above exception, another exception occurred</strong>:</p>
<p>处理上面这个异常的时候，又来了个这么异常。</p>
<p>啊原来我刚刚看的是后来的异常啊，那我得看第一个异常的尾巴：</p>
<p><strong>UnicodeEncodeError: ‘latin-1’ codec can’t encode characters in position 45-46: ordinal not in range(256)</strong></p>
<p>多少年了，无数的Python程序员都曾经被UnicodeEncodeError与UnicodeDecodeError坑的说不出话来。</p>
<p>可是依旧没有我的代码啊。</p>
<p>终于，通过搜索.txt（下载的文件的扩展名）我成功找到了这一行：</p>
<p>file_name &#x3D; response[‘data’][0][‘task_name’] + ‘.txt’</p>
<p>看来是这句话负责生成文件名的，找到这句的函数定义，继续找调用者，叮咚！</p>
<p>一看函数名叫download，看样子下图这里就是该排错的地方</p>
<p><img src="/images/2018041707545536.png"></p>
<h2 id="解决异常1：瞎比划"><a href="#解决异常1：瞎比划" class="headerlink" title="解决异常1：瞎比划"></a>解决异常1：瞎比划</h2><h3 id="加个Content-Length"><a href="#加个Content-Length" class="headerlink" title="加个Content-Length"></a>加个Content-Length</h3><p>大致看了眼，好像没啥问题。要不在这里加上个Content-Length试试？</p>
<p>self.set_header(“Content-Length”, len(file_content.encode(‘utf-8’)))</p>
<p><img src="/images/2018041707545689.png"></p>
<p>我的基础还是很牢固的，没算错，一点问题都没有，肯定没错啊。但是<strong>Tried to write 8015 bytes less than Content-Length</strong>这个异常还是抛了。</p>
<h3 id="数据类型错了"><a href="#数据类型错了" class="headerlink" title="数据类型错了"></a>数据类型错了</h3><p>也许是数据类型错了？说不定<code>file_name</code>, <code>file_content</code>需要字节流而不是字符串呢？这好像有点接近Unicode错误了。简单的<code>encode(&#39;utf-8&#39;)</code>一下，当然还是继续错啦。</p>
<h3 id="也许是因为header的事情"><a href="#也许是因为header的事情" class="headerlink" title="也许是因为header的事情"></a>也许是因为header的事情</h3><p>那就把header都注释了看看。于是在浏览器里打开了文件……</p>
<p><img src="/images/2018041707545712.png"></p>
<p>那我只留Content-Type</p>
<p><img src="/images/2018041707545743.png"></p>
<p>噗(&#x2F;≧▽≦)&#x2F;我的文件名呢，内容是正确的。</p>
<p>啊，原来是靠的Content-Disposition这个响应头来强制浏览器下载文件，指定文件名什么的啊……</p>
<h2 id="解决异常2：确定问题"><a href="#解决异常2：确定问题" class="headerlink" title="解决异常2：确定问题"></a>解决异常2：确定问题</h2><p>终于，我确定了出错的代码在这一行</p>
<p>self.set_header(“Content-Disposition”, “attachment; filename&#x3D;%s” % file_name)</p>
<p>看样子是文件名。那就把filename替换成硬编码的<code>test.txt</code>，正常下载；再换成<code>tes啊t.txt</code>，一模一样的报错。</p>
<p>于是我果断的搜索了Content-Disposition encoding以及Content-Disposition 编码，看到<a target="_blank" rel="noopener" href="https://blog.robotshell.org/2012/deal-with-http-header-encoding-for-file-download/">这么一篇说得还挺有道理的文章</a>：</p>
<p>Content-Disposition: attachment;filename&#x3D;”$encoded_fname”;<br>filename*&#x3D;utf-8’’$encoded_fname</p>
<p>当然了我没看到下面那句话（<strong>读书要读全啊</strong>），直接套上了</p>
<p>self.set_header(“Content-Disposition”, “attachment; filename*&#x3D;utf-8’’%s” % file_name)</p>
<p>当然继续报错啦。还是<code>file_name</code>数据类型不对？encode成UTF-8？差点用上decode（字符串怎么可能再decode嘛？必然要报错的）</p>
<p><img src="/images/201804170754585.png"></p>
<p>噗，这倒真是<code>tes的t.txt</code>这个字符串的UTF-8编码。</p>
<p>这就纠结了，难道我要把文件名搞成什么ASCII的？比如干脆是几个真伪随机数吧？</p>
<h2 id="解决异常3：解决"><a href="#解决异常3：解决" class="headerlink" title="解决异常3：解决"></a>解决异常3：解决</h2><p>然后又找到了这么一篇<a target="_blank" rel="noopener" href="http://lgbolgger.iteye.com/blog/2108396">例子丰富的文章</a>，看到一半突然想起了，既然要给任意文字编码成ASCII字符集内的，那就用base64啊，但是浏览器又不懂base64没办法给还原回来啊……</p>
<p>唉？？不是有个东西叫URL编码吗？迅速翻了翻例子丰富的文章，还真提了一句……</p>
<p>from urllib.parse import quote<br>self.set_header(“Content-Disposition”, “attachment; filename&#x3D;%s” % quote(‘tes的t.txt’))</p>
<p><img src="/images/2018041707545941.png"></p>
<p>我爱emoji，emoji也爱我。???典型的傲娇受。</p>
<p>??? ??? ??? ??? ??? ??? ???</p>
<p>其实<a target="_blank" rel="noopener" href="https://blog.robotshell.org/2012/deal-with-http-header-encoding-for-file-download/">第一篇文章</a>提了一句的：其中， <code>$encoded_fname</code>指的是将 UTF-8 编码的原始文件名按照 RFC 3986 进行百分号编码（percent encoding）后得到的。</p>
<p>百分号编码就是<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-hans/%E7%99%BE%E5%88%86%E5%8F%B7%E7%BC%96%E7%A0%81">URL编码</a>啦……</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这个小问题其实隐藏的还是很深的，而且奇特的是在Python 2没有问题但是到了3就冒出来了。</p>
<p>光看报错基本上没什么线索，只能靠对业务的熟悉摸索找到对应的代码，仔细排查最终确定导致出错的代码……然后解决之。</p>
<p>就我这水平啊，还是别怀疑编译器解释器，也别怀疑久负盛名的库了，绝对是我错了。</p>
<blockquote>
<p>You tell me I’m wrong, then you’d better prove you’re right. ——M.J.</p>
</blockquote>
<h2 id="后续"><a href="#后续" class="headerlink" title="后续"></a>后续</h2><p>经过一小段时间的阅读源代码，在tornado源代码中发现了问题的根源。跟着我的节奏走！先看下抓包的结果吧：</p>
<p>Python 2未编码 <a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2018/04/2018041803535426.png"><img src="/images/2018041803535426.png"></a></p>
<p>Python 2 URL编码 <a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2018/04/2018041803535177.png"><img src="/images/2018041803535177.png"></a></p>
<p>Python 3 URL编码 <a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2018/04/2018041803535360.png"><img src="/images/2018041803535360.png"></a></p>
<p>我们知道问题是由set_header引起的，所以看一下set_header的源代码：</p>
<p>def set_header(self, name, value):<br>        # type: (str, _HeaderTypes) -&gt; None<br>        “””Sets the given response header name and value.</p>
<pre><code>    If a datetime is given, we automatically format it according to the
    HTTP specification. If the value is not a string, we convert it to
    a string. All header values are then encoded as UTF-8.
    &quot;&quot;&quot;
    self.\_headers\[name\] = self.\_convert\_header\_value(value)
</code></pre>
<p>非常清楚的看到调用了一个<code>_convert_header_value()</code>，继续追溯</p>
<pre><code>def \_convert\_header\_value(self, value):
    # type: (\_HeaderTypes) -&gt; str

    # Convert the input value to a str. This type check is a bit
    # subtle: The bytes case only executes on python 3, and the
    # unicode case only executes on python 2, because the other
    # cases are covered by the first match for str.
    if isinstance(value, str):
        retval = value
    elif isinstance(value, bytes):  # py3
        # Non-ascii characters in headers are not well supported,
        # but if you pass bytes, use latin1 so they pass through as-is.
        retval = value.decode(&#39;latin1&#39;)
    elif isinstance(value, unicode\_type):  # py2
        # TODO: This is inconsistent with the use of latin1 above,
        # but it&#39;s been that way for a long time. Should it change?
        retval = escape.utf8(value)
    elif isinstance(value, numbers.Integral):
        # return immediately since we know the converted value will be safe
        return str(value)
    elif isinstance(value, datetime.datetime):
        return httputil.format\_timestamp(value)
    else:
        raise TypeError(&quot;Unsupported header value %r&quot; % value)
    # If \\n is allowed into the header, it is possible to inject
    # additional headers or split the request.
    if RequestHandler.\_INVALID\_HEADER\_CHAR\_RE.search(retval):
        raise ValueError(&quot;Unsafe header value %r&quot;, retval)
    return retval
</code></pre>
<p>这段代码有点冗长，但实际上只做了一件事情，将传递过来的value转换为字符串，更进一步，在Python 2中，如果传过来的是<code>&#39;hello&#39;</code>，那么直接返回；如果类型是<code>u&#39;hello&#39;</code>, 那么<code>escape.utf8(value)</code>。在Python 3中如果是<code>&#39;hello&#39;</code>那么直接返回，如果是<code>&#39;hello你&#39;.encode(&#39;utf-8&#39;)</code>，那么用latin1解码。</p>
<p>最终这段代码会保证返回的类型是对应Python 2&#x2F;3的str类型。</p>
<p>但其实这段代码并没有什么错，不过确实写的有点难懂。 之后继续追溯到<code>write_headers()</code>，在http1connection.py的第380行左右：</p>
<p>if PY3:<br>            lines.extend(l.encode(‘latin1’) for l in header_lines)<br>        else:<br>            lines.extend(header_lines)</p>
<p>其中header_lines是一个生成器对象，包含了所有的headers，其类型为str（对应2&#x2F;3的类型） 那么错误就显然易见了，在Python 3中对<code>&#39;hello&#39;.encode(&#39;latin1&#39;)</code>是没有任何问题的，但是<code>&#39;hello和&#39;.encode(&#39;latin1&#39;)</code>肯定会报UnicodeEncodeError啊，这也印证了我最开始发现的编码错误。</p>
<p>但是在Python 2，直接就走了下面extend进去了，自然也没问题了。 但是如果我们调用set_header时传递的参数是<code>&#39;hell你&#39;.encode(&#39;utf-8&#39;)</code>，那么在<code>_convert_header_value</code>中会被用latin1解码，在这里又使用latin1编码，又回到了utf-8编码之后的形态，所以自然会出现对应文件名的UTF-8编码，也印证了上面下载出来的乱码文件。</p>
<p>所以，如果要修复这个问题，要么我们保证只传递过来ASCII的文件名（进行URL编码），这样用latin1编码就不会错了。要么直接把这俩latin1改成utf-8。</p>
<p>不过根据<a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc7230#section-3.2.4">RFC7230 section 3.2.4</a>:</p>
<blockquote>
<p>Historically, HTTP has allowed field content with text in the ISO-8859-1 charset [ISO-8859-1], supporting other charsets only through use of [RFC2047] encoding. In practice, most HTTP header field values use only a subset of the US-ASCII charset [USASCII]. Newly defined header fields SHOULD limit their field values to US-ASCII octets. A recipient SHOULD treat other octets in field content (obs-text) as opaque data.</p>
</blockquote>
<p>这么做其实是有悖标准的，但是Python 2的版本直接不管不顾发出去了啊，实际上Python 2版本的应该拒绝这种headers的。我也很纠结，我也觉得没办法啊。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/04/17/python2-3-port/index/" data-id="clhp7rtie0073s2qrhi226brl" data-title="一次找不到错误的巨坑的http header的url编码的Python 3迁移问题" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-python-longpoll-db/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/04/13/python-longpoll-db/index/" class="article-date">
  <time class="dt-published" datetime="2018-04-13T00:00:00.000Z" itemprop="datePublished">2018-04-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/program/">program</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/04/13/python-longpoll-db/index/">Python长期连接数据库的最不佳实践：Lost connection to MySQL server during query</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="问题来源"><a href="#问题来源" class="headerlink" title="问题来源"></a>问题来源</h2><p>前几天用Tornado做Web服务器起了一个简单的以表格显示数据库中内容的网页，然后把它放到lab服务器上做demo。卧病几天之后打开邮箱，发现mentor邮件说表格中不显示数据。赶紧登上服务器screen回去看下，发现抛了个这么异常：Lost connection to MySQL server during query</p>
<p><img src="/images/2018041314312651.png"></p>
<p>当然也说不定会是MySQL server has gone away</p>
<blockquote>
<p>Python：我这么爱你，你为什么要离开我？</p>
<p>MySQL：你丫八个小时都不跟俺说一句话，想起来了就冷不丁的冒一句，然后就消失，就这样还是俺真爱？哼！</p>
<p>Python：……（好吧，被你发现了，我就是玩玩而已你还认真了，真是的?）</p>
</blockquote>
<p>以上内容纯属虚构，请勿对号入座（咋想也没办法对号入座啊）</p>
<h2 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h2><p>造成这个异常的原因其实非常简单，就是基本上没啥人访问我的demo link，导致连接对象超过了wait_timeout的默认28800秒（即8小时），然后MySQL就关闭了这个连接。由于TCP的特性，Python的驱动并不会知道被甩了，当有人访问demo link也就是进行一次查询的时候，就会触发异常，于是表格自然就是空白的啦。</p>
<p>为了更进一步的说明这个问题并提供若干最不佳实践，咱先简单的说说这段代码……GitHub可以戳下面的触手猫（commit为959ce78f854894397a75bad0efef4ef0de06b7ca） [gt href&#x3D;’<a target="_blank" rel="noopener" href="https://github.com/BennyThink/Intern-Life/blob/959ce78f854894397a75bad0efef4ef0de06b7ca/mission%208/front-end-pagination.py'/]%E8%A7%A6%E6%89%8B%E7%8C%AB%E5%8D%81%E5%91%A8%E5%B9%B4%E5%95%A6/[/gt/]">https://github.com/BennyThink/Intern-Life/blob/959ce78f854894397a75bad0efef4ef0de06b7ca/mission%208/front-end-pagination.py&#39;\]触手猫十周年啦\[/gt\]</a></p>
<h3 id="开头"><a href="#开头" class="headerlink" title="开头"></a>开头</h3><p>首先在开头引入几个库，然后新建两个全局的对象：一个是用于数据库连接的con，一个是查询游标cur</p>
<p>con &#x3D; mysql.connector.connect(host&#x3D;’127.0.0.1’, user&#x3D;’root’, password&#x3D;’root’, database&#x3D;’san’)<br>cur &#x3D; con.cursor()</p>
<h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><p>在make_app函数中我们可以看到定义了俩路由，&#x2F;对应Index类，&#x2F;list&#x2F;对应Retrive类。</p>
<p>Retrive类重载了get方法，返回的是一个函数get_data，而get_data则是进行数据库相关操作的函数，代码如下：</p>
<p>def get_data():<br>    cur.execute(‘SHOW COLUMNS from switch_device’)<br>    col_data &#x3D; cur.fetchall()<br>    col_field &#x3D; [i[0] for i in col_data]<br>    cur.execute(‘SELECT * FROM switch_device’)<br>    data &#x3D; cur.fetchall()</p>
<pre><code>bulk\_dic = \[\]
for i in range(len(data)):
    es\_dic = dict(zip(col\_field, data\[i\]))
    bulk\_dic.append(es\_dic)
return json.dumps(bulk\_dic)
</code></pre>
<p><strong>我不由得想起了我最爱的列表推导</strong>……反正就是查询了两次，根据列名和数据把表中的内容组成了一个json。可惜啊我不知道<a target="_blank" rel="noopener" href="https://dmesg.app/mysql-es-mongo.html">DictCursor</a></p>
<h3 id="入口"><a href="#入口" class="headerlink" title="入口"></a>入口</h3><p>入口非常简单，就是启动tornado而已。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>通篇可以看到有这么几个特点：</p>
<ol>
<li><strong>cur和con是全局的</strong>，只要Python脚本在运行，那么这俩对象的id（内存地址）就不会改变，无论多少次的页面刷新（数据库查询操作）都是由cur这个全局对象执行的</li>
<li>并没有对connection进行close。脚本在收到相应的信号量时会执行对应的行为，比如SIGINT也即Ctrl+C，自然就退出了，连接自然也就被释放了。</li>
</ol>
<h3 id="再一次说明问题原因"><a href="#再一次说明问题原因" class="headerlink" title="再一次说明问题原因"></a>再一次说明问题原因</h3><p>再一次总结出错原因：demo太冷门没人看，<strong>连接闲置时间超过wait_timeout，MySQL关闭连接</strong>，然后再次触发查询的时候，自然而然就会报错了。</p>
<p>针对这个问题，我想了几种个人觉得不咋样的解决方法，所以被称之为“<strong>最不佳实践</strong>”。当然提前说一个比较好的办法，那就是用数据库框架啊，类似SQLAlchemy什么的，这类框架应该会处理这类问题的；还有就是，如果对应的驱动程序提供了类似<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/c-api-auto-reconnect.html">automatic reconnection</a>这种特性，那也好办多啦</p>
<p>注意：为了方便叙述，下面的get_data()就是指代数据库操作啦！</p>
<h2 id="方法1：增加wait-timeout时间"><a href="#方法1：增加wait-timeout时间" class="headerlink" title="方法1：增加wait_timeout时间"></a>方法1：增加wait_timeout时间</h2><p>既然数据库小姐默认的“生气时间”是28800秒，那咱简单的给它调大点不就好了。</p>
<blockquote>
<p>Python：亲爱的，你以后要多点耐心，小不忍则乱大谋啊~ MySQL：好吧好吧，那我就多点耐心。 <em>一年之后……</em> Python：亲爱的，干嘛呢？ MySQL：老娘不认识你，丨。 <em>Python吸取教训，不能冷落小姐姐太久，于是再次通过自己的阴谋诡计取得小姐姐的好感与信任。</em> Python：亲爱的，你以后要多点耐心，小不忍则乱大谋啊~ MySQL：好吧好吧，那我就多点耐心。 <em>十几天之后……</em> Python：亲爱的，干嘛呢？ MySQL：忙着呢，没空理你。 Python：…………（算了，干嘛一棵树上吊死）</p>
</blockquote>
<p>简单的在得到游标之后来这么一句：</p>
<p>cur.execute(‘SET SESSION WAIT_TIMEOUT &#x3D; 2147483’)</p>
<p>注：</p>
<p>2147483（约24天）是Windows平台的MySQL的WAIT_TIMEOUT最大值，其他平台为31536000（一年）</p>
<p>如果有必要的话咱还可以<code>SET GLOBAL WAIT_TIMEOUT = 2147483</code>，不过你真的确定要global么，说不好DoS了，查完日志就该回家种田了啊。</p>
<p>但实际上这是一种想当然一拍脑门一跺脚的<strong>完全不现实</strong>的不经过仔细思考的解决方案。为啥捏，待我慢慢道来。</p>
<h3 id="治标不治本"><a href="#治标不治本" class="headerlink" title="治标不治本"></a>治标不治本</h3><p>不，这个三级标题是错误的。这种解决方案<strong>不仅不治标，更不治本</strong>！甚至有损于数据库的性能。暂且不考虑平台兼容性（设置为31536000对Windows平台就是无效值了啊），如果真的就是连接限制了超过timeout的时间，然后突然有了一次访问，那还不是照样挂？</p>
<h3 id="影响数据库性能"><a href="#影响数据库性能" class="headerlink" title="影响数据库性能"></a>影响数据库性能</h3><p>MySQL为什么要有这样一个参数？很简单啊，为了提高服务器性能啊。每维持一个连接都是需要耗费一定的内存和CPU资源的，关闭长期不使用的连接自然节约了资源，同时也避免了max_connections达到上限造成了DoS的结果。</p>
<p>即使我们把max_connections的值调到很高尽可能避免DoS，这对于服务器的性能也是不利的，需要更多内存，更多文件描述符。这同样也是一个<strong>既不治标也不治本</strong>的解决“解决方案”的方案。堆硬件？有那钱还不如打赏辛苦写作本文的俺呐！</p>
<p>注：max_connections默认值为151，上限为100000，同时还要受到文件描述符（用ulimit查看）的限制。</p>
<h3 id="一句话总结"><a href="#一句话总结" class="headerlink" title="一句话总结"></a>一句话总结</h3><p>放弃吧，别用这种不太好的办法了。</p>
<h2 id="方法2：每次刷新页面都新建连接-查询-关闭连接"><a href="#方法2：每次刷新页面都新建连接-查询-关闭连接" class="headerlink" title="方法2：每次刷新页面都新建连接-查询-关闭连接"></a>方法2：每次刷新页面都新建连接-查询-关闭连接</h2><p>既然问题在于连接限制，那咱就每次数据库相关的操作都新建连接-查询-关闭连接。代码也很简单，把全局的数据库连接移动到函数内：</p>
<p>con &#x3D; mysql.connector.connect(host&#x3D;’127.0.0.1’, user&#x3D;’root’, password&#x3D;’root’, database&#x3D;’san’)<br>cur &#x3D; con.cursor()</p>
<h1 id="执行操作"><a href="#执行操作" class="headerlink" title="执行操作"></a>执行操作</h1><p>con.close()<br>return some_value</p>
<p>这确实是一个非常简单的处理方式，很强，没有bug，绝对管用，不仅治标也治本。只是有一个问题，新建连接会慢点，在某些场景可能会稍差一点点</p>
<p>新建一次连接自然是比较费时、费资源的啦，说不定要0.1秒呢，那如果同时访问的人多了造成大并发的局面（tornado是多线程非阻塞的服务器，所以短时间内可能会创建很多个con对象），那可能速度就要稍微慢一点了。</p>
<p>不过这种方法确实好用，因为抓住了问题的本质：<strong>闲置连接被关闭</strong>。绝大部分情况下用这个方案就可以啦</p>
<h2 id="方法3：数据库的操作之前con-reconnect"><a href="#方法3：数据库的操作之前con-reconnect" class="headerlink" title="方法3：数据库的操作之前con.reconnect()"></a>方法3：数据库的操作之前con.reconnect()</h2><p>从方法3中我们发现了<code>con.reconnect()</code>这个神奇的小东西，那么我们在数据库操作之前执行这个，这样每次都会重新连接，那就可以啦。</p>
<p>con.reconnect()<br>get_data()</p>
<p>这个方法大概相当于方法2的改进版，每次操作没有重新新建con对象而是<strong>无论连接是否被MySQL关闭，都重新连接</strong>。没毛病，问题完美解决，只是也有一点点性能损失：</p>
<p>连接关闭了reconnect倒好，但是没关闭却reconnect了那不就浪费了嘛？</p>
<p>虽说如此，但是这个方法的性能会比方法2稍好一些。</p>
<h2 id="方法4：数据库操作时try…except，异常重连"><a href="#方法4：数据库操作时try…except，异常重连" class="headerlink" title="方法4：数据库操作时try…except，异常重连"></a>方法4：数据库操作时try…except，异常重连</h2><p>针对方法4，很容易就可以进行一下改进，那咱先毫无顾虑的执行，出问题了捕获异常就好了。</p>
<p>try:<br>    get_data()<br>except mysql.connector.errors.OperationalError:<br>    con.reconnect()<br>    get_data()</p>
<p>两次<code>get_data()</code>有点不雅啊，唉灵机一动：</p>
<p>try:<br>    cur.execute(‘select version()’)<br>except mysql.connector.errors.OperationalError:<br>    con.reconnect()<br>finally:<br>    get_data()</p>
<p>或者不用finally直接开始写新的语句块，也是可以的！</p>
<p>随便执行个查询操作来看看连接有没有被关闭，然后finally无论怎么都会被执行的，好办法好办法，拍案叫绝！</p>
<p>只是也稍微有那么一丁点不好，白白的让数据库执行了一个没有用的查询，多多少少还是浪费了一丢丢资源啦。</p>
<p>于是我又灵机一动，诞生了方法5.</p>
<h2 id="方法5：数据库操作之前进行con-ping-，异常重连"><a href="#方法5：数据库操作之前进行con-ping-，异常重连" class="headerlink" title="方法5：数据库操作之前进行con.ping()，异常重连"></a>方法5：数据库操作之前进行con.ping()，异常重连</h2><p>用一次con.ping()检测连接是否还在，不在的话就重新连接，finally里执行查询，哇(o゜▽゜)o☆</p>
<p>try:<br>    con.ping()<br>except mysql.connector.errors.InterfaceError:<br>    con.reconnect()<br>finally:<br>    get_data()</p>
<p>同上，不用finally直接开始写新的语句块，也是可以的！<code>con.ping()</code>的性能开销应该比较理想的。</p>
<p>需要注意的是，不同的库可能有一点不同，比如pymysql的<code>con.ping()</code>包含一个reconnect的参数，默认为True的时候就会自动重连。所以如果你使用pymysql，直接在数据库操作之前使用<code>con.ping()</code>就可以了。</p>
<p>另外一个需要注意的点，多线程情况下使用全局的con可能会触发线程安全相关的问题。以及如果涉及事务，要注意提交、回滚的操作，免得发生幻读之类的状况</p>
<h2 id="方法7：连接池"><a href="#方法7：连接池" class="headerlink" title="方法7：连接池"></a>方法7：连接池</h2><p>等有空再说吧~</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>需要注意一个问题，如果数据库开启了事务，你的应用程序涉及到了多线程等并发问题，那么在全局使用一个connection时一定要注意线程安全和事务相关的问题。一旦代码写的不完善，就很容易出现类似幻读、脏读这种事务相关的问题。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/04/13/python-longpoll-db/index/" data-id="clhp7rtie0071s2qr49ru776m" data-title="Python长期连接数据库的最不佳实践：Lost connection to MySQL server during query" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-systemd-accounting/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/04/06/systemd-accounting/index/" class="article-date">
  <time class="dt-published" datetime="2018-04-06T00:00:00.000Z" itemprop="datePublished">2018-04-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/linux/">linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/04/06/systemd-accounting/index/">systemd - systemctl不显示内存CPU信息</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>刚刚发现树莓派上的Ubuntu Mate用systemctl status查看服务状态的时候不显示CPU和内存信息，而其他系统下都是显示的。</p>
<p><img src="/images/201804061054053.png"></p>
<p><img src="/images/2018040610540091.png"></p>
<p> </p>
<p>再来一个不显示的CentOS</p>
<p><img src="/images/2018040610540888.png"></p>
<p>后来通过<code>systemctl show</code>发现好像有个参数能设置，通过手册<code>man systemd-system.conf</code></p>
<p>查看到配置文件中写了这么一段话：</p>
<blockquote>
<p>DefaultCPUAccounting&#x3D;, DefaultBlockIOAccounting&#x3D;, DefaultMemoryAccounting&#x3D;, DefaultTasksAccounting&#x3D;</p>
<p>Configure the default resource accounting settings, as configured per-unit by CPUAccounting&#x3D;, BlockIOAccounting&#x3D;, MemoryAccounting&#x3D;</p>
<p>and TasksAccounting&#x3D;. See systemd.resource-control(5) for details on the per-unit settings.</p>
</blockquote>
<p>啊那咱去改配置文件呗？</p>
<p>sudo vim &#x2F;etc&#x2F;systemd&#x2F;system.conf</p>
<p>找到这么几行，取消注释改成yes，然后重启下或者<code>systemctl daemon-reload</code>就好了啦。</p>
<p>DefaultCPUAccounting&#x3D;yes<br>DefaultMemoryAccounting&#x3D;yes<br>DefaultTasksAccounting&#x3D;yes</p>
<p>你看都出来了吧（不过为啥<code>TasksAccounting=yes</code>都是yes了还不显示tasks数目呢？</p>
<p><img src="/images/2018040610541099.png"></p>
<p><img src="/images/2018040610541286.png"></p>
<hr>
<p>但这都不是重点！重点是，</p>
<p>谁来<a target="_blank" rel="noopener" href="https://github.com/BennyThink/ServerSan">拯救我这个Python程序</a>？占用这么多内存，看样子应该是死锁了……</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2018/04/2018040610584428.jpg"><img src="/images/2018040610584428.jpg"></a></p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2018/04/2018040611030523.jpg"><img src="/images/2018040611030523.jpg"></a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/04/06/systemd-accounting/index/" data-id="clhp7rtkp009cs2qrg4vq9a59" data-title="systemd - systemctl不显示内存CPU信息" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-my-lovestory/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/03/10/my-lovestory/index/" class="article-date">
  <time class="dt-published" datetime="2018-03-10T00:00:00.000Z" itemprop="datePublished">2018-03-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/justsay/">justsay</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/03/10/my-lovestory/index/">我的爱情故事</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>第一个爱情故事 [netmusic play&#x3D;’0’]3560431[&#x2F;netmusic]</p>
<p>就如标题所言，这是一个关于你我的爱情故事。这个故事拥有一个美妙的开头，拥有一个破茧成蝶的过程，但是它的结果呢？我希望会有好的结果，但是将来时，只有等它变成进行时甚至是过去时才能知晓结果。而我现在正在等待，正在努力。</p>
<p>时光倒退到N天前，那一天晚上。不是18岁的远行，但我同样不后悔那天的决定。我们的爱情开始于那一个吻，开始于多日的朝夕相处，开始于漆黑的那间屋子。</p>
<p>在那天之前，你挽着我的手臂穿过商场，我叫你老年人；我骑着自行车在蒙蒙细雨中载着你飞向学校，而你则紧紧地搂住了我的腰；你从身后抱住我，轻轻的吻了我的脸颊，跟我说我是好人。</p>
<p>似乎有了你，紧张的应考氛围就突然变得轻松了。偶然中奖得了一张电影票，于是你我去看了第一场电影，好像是特种部队2，你紧张地握着我的手；之后我期待万分的钢铁侠3也上映了，于是你抽出时间陪我去看。唯一有点遗憾的是，看到高潮的时候竟然黑屏了。</p>
<p>在最后的时光里，我们一起挺过高考。最后一科英语考完走出考场，感觉整个世界都解放了。穿着粉红色体恤的你，也在很开心的笑着。我们一起走过了这些磨难，听到了诅咒也得到了祝福，终于可以一直陪伴你了。</p>
<p>人们都总喜欢说事与愿违，事实还总是这样。报志愿的时候，我一时犹豫没有让你报考和我同市的学校。在得知录取结果的时候，感觉世界瞬间崩溃了，说后悔也没有用，我们没在一个城市。暗自庆幸的说，我们相隔说不上天涯海角，几个小时的动车高铁就可以把我带到你的身边。</p>
<p>决策胜于祈祷。如果当初是强迫你改掉报名志愿，也就没有剩下的祈祷与担忧了，也就不会有这一切了。可是，“<strong>决策胜于祈祷</strong>”可能也是太伤人了吧，无论怎么说，我们接受了异地恋。</p>
<p>在高考之后的那个暑假里，你尽可能的出来找我，那个时候你尚未公开你的爱情。</p>
<p>那一年夏天，姐姐辞职来到我家，带着外甥女。 你还记得小孩和你很合得来吗？你还记得“孩儿她舅妈”这句话吗？你还记得听到小孩稚嫩的叫着舅妈时是怎样的心动吗？</p>
<p>那一年夏天，我们一起出去玩，一起漫步走过数不清的街道，我们一起过了七夕，一起去唱歌看电影。还记得烈日当头你把我叫出来去超市吗？接近三个月的时间不算很短，仿佛人生最后的狂欢，我们也给对方留下了那么多美好的回忆。</p>
<p>然后，随着开学，我们的异地恋也算开始。那天你送我到火车站，你说你不想离开我。火车开动，我在窗口最后的边缘看见了默默流泪的你。你的身影渐渐远去，我却不知要何时才能再见。</p>
<p>最初的时候我还无法接受，可事实也就是这样。我为你许下了太多承诺。我对你说十一能回去，我会给你惊喜，我们会一起去选戒指，我会向你求婚，我会带你去海边去海边漫步，我会带你去看樱花，会与你共进烛光晚宴。我深知自己欠你太多承诺没有实现，而有一些已经过去，那些没有过去的将来时，我希望还会为你呈现。</p>
<p>不知道怀着怎样激动与兴奋的心情，十二月的时候，是我第一次自己坐火车，准确的说是动车。那是分别几个月以来第一次去看你。人们都说异地恋在一起的时间总是特别短，而在一起的时候，分分秒秒总是弥足珍贵的。我们以天为单位的倒计时，以小时甚至是分钟为单位的相聚，我很感动。</p>
<p>那一年的最后一天你说你要来找我，要陪我跨年，因为这一次跨年意味着一生一世永不分离。我仿佛看见了你像小女孩一样天真纯洁的愿望与眼神。我说给你买卧铺，个人技术问题没买到下铺，因为考试我还回去晚了。还记得那次考试帮室友打字呢，好害怕被老师抓走。</p>
<p>在姐姐家里，那晚，你坐在我的身边，趴在我的肩膀上喃喃道你困了，想让我哄你睡。可我却给索爱Mt51i刷机而跨越了一生一世，那是我们第一次跨年，如果可以，我希望我们还可以跨越更多美妙的瞬间。</p>
<p>第一个寒假里，你妈妈生病了，整个寒假也没出来太多次。第一次是1月26日，以班级聚会的借口出来到我家。后来因为社会实践，我终于可以经常看见你。你在书店做帮工，你说推荐一首很好玩的歌给我听，the fox.然后我帮你码字写报告，我们一起去逛街，一起看电影。在二月末的时候，我甚至还以修手机为名义去了次你家，哎这是看岳母啊。</p>
<p> </p>
<p>随着开学，我们讨厌的异地恋又要到来了。完成了八分之一，还有七个学期。<strong>听不到的心跳，看不见的面容，掩不住的孤独，触不及的温暖。</strong>四月份趁着动车没有变成高铁，我再次来到你的身边。最不幸的丢了钱包，挨了骂。你在车上不停的流眼泪，好像丢的不是钱包而是我，好像丢了你的钱包。不过好在后来我们都慢慢解决了这些问题，我们一起手拉手看了第一场IMAX电影，第一次真正的经历磨难。</p>
<p>五一之后你一直特别忙，可能广播台制作部的工作太繁忙，也可能有别的原因。本来25日说好了和姐姐一家人去海边玩，结果你却因为家人要去看你突然回去了。在你确认这条消息的时候，我正在帮你查着什么网课的答案，默默地留下了眼泪。那时候你的心情一定很复杂吧，不仅仅是因为提前的分离，还有你内心深处的犹豫吧。此次分离，下次相聚在何时。</p>
<p>之后我发现事情越来越不对劲，你开始不愿意理我。当我开始搜集信息的时候，你突然跟我说，要不分手吧。我拒绝了，在收集到更多信息的时候，发现你把你的爱分给了别人……你去质问你，你找借口搪塞，直到我拿出关键性证据，你也不愿意承认这一切。在你把你的手伸向别人的时候，不知道你有没有想过我的感受。或许在那时，你已经不爱我了吧。我预见了这件事情，却没预料到这个结果。</p>
<p>我瞒着姐姐，买了多坐了一站的票去看你。你告诉我你在学校里骂了我半个小时，在车上骂了我半个小时。是我的错，we create our own demons.</p>
<p> </p>
<p>我去商场买了一支玫瑰，那是我第一次送你花。你说，你很喜欢，那也是你第一次收到玫瑰。你还说你要拍照留恋，很不幸的我们把它忘在了旅馆。我安慰你说，没事，等回去了我再送你啊。</p>
<p>你还记得那次向全校广播的“音乐晚点名”吗？我留言说，无论我们相距多远，我都不会离开你，不离不弃，守侯终生。还有几天就可以看到你，还有几周就可以拥抱你，还有一辈子的时间可以跟你戏耍玩闹。我们还有一辈子的幸福生活，我爱你。</p>
<p>你说你要努力学习，你告诉我，如果你不挂科，回去就向你的父母公开恋情。我诚恳的希望你带回家的会是我，而不会是其他人。</p>
<p>对不起，我没能给你爱情中本应该有的惊喜，没能给你爱情故事里的陪伴与照顾。我欠你那么多，就像那首小诗里说的一样：有很多事情你都没做，容忍我包容我，有许多许多的事情我要回报你，等你从越南回来。但是你没有。我也没有。</p>
<p>远方的你要照顾好自己。你并不孤独，尽管我不能陪在你身边，可是你并不孤独。孤独寂寞并不能成为爱情的羁绊。</p>
<p>你是我这辈子遇见的人，我愿以我毕生之力给你应有的幸福。你还年轻，让我陪你一起白发苍苍；你还幼稚，让我陪你渐渐成熟。无论是否命中注定，你都已经成为我生命里的一部分。你是我的家人，我的家人也把你当做家庭的一分子。也许远水不解近渴，远亲不如近邻。尽我微薄之力，给你最多的幸福。</p>
<p>而在这，我可以说吗？不用等到熬过异地，我娶你可好？你并不孤独，我陪伴在你的身边。不管你多远，我守候在天边。</p>
<p>在火车站分别之前你轻轻对我说，我爱你。也许这是这个世界上最美妙的情话。我再也忍不住我的泪水，我也爱你啊。我们暑假的时候就可以见面了。</p>
<p>我相信你，张开臂膀给你回归的拥抱。</p>
<p>在经过了这一切的闹剧之后，我心生邪念，我用了一切不合理的手段去得到我想要的信息。备份，克隆，截图，上传，猜测密码。我拿到了我的杀手锏——所谓的证据。</p>
<p>在闹剧之后，你要参加一个比赛的啦啦队，于是我放假回去看你。我不知道那个时候我是有多傻，你就是随口说了一句想吃高中附近的章鱼小丸子了，于是第二天我就傻乎乎的去买了，坐着一个小时多的脏乱拥挤的绿皮车，冒着大雨送着冰凉的章鱼小丸子给你。你生气了，可是你又很感动，你说以后别这样再傻了。是不是觉得很像小说里的剧情？</p>
<p>随着我慢慢的重新相信你，我以为，可以开始新的生活了。直到十月末，同样的事情同样的人再一次上演。放弃吧，恰巧两次回家，那是我们吵的最厉害的时候——我在六楼七楼之间。你求我不要分开，你一直在哭泣，可我却面无表情，因为我真的绝望了，我不敢相信你们都做了什么，我们互相坦白甩底线，我把一切都告诉了你，我也曾是一个卑鄙小人，为了自己的欲望而不择手段。</p>
<p>怎么都没想到的是，后来因为的表白墙，他觉得被侮辱了和你大吵一架，我的目的竟然达到了，我们竟然意外的化解了所有的矛盾。生日那天你和我们十一个人在一起，T跟我们说，希望我们以后会好好的，不计前嫌。我们说，好。那时的感觉就像是初恋一样，一切都是那么清新。</p>
<p>我真的以为这一切都好了，这真的是一个关于你我的幸福爱情故事。这就是我们说的恩恩爱爱不计前嫌，是史密斯夫妇。直到Q告诉我这一切的变化：</p>
<p>所有的一切都不再是我记忆中的样子，所有的一切能表明我们曾是爱人的印记都消失了，一点都没剩下…是我太窝囊了，一点都没有给你女人想要的安全感，我知道是我做的不对做的不好…是我的错。一切都是我的软弱。</p>
<p>接近两年的努力和付出，就这样悄然结束了。从来没想到自己会如此骄傲的把你介绍给所有人，而在那时，我也从来没想过今天的我会如此的狼狈不堪…我们还是输了，是我，最终还是输给了异地输给了距离输给了曾经想都没有想过的隔阂。相爱的往日，熟悉的温度，紧紧相拥着度过的夜晚。</p>
<p>好像一场梦啊。在这些个不眠夜里，我每天起床，吃饭，生活，慢慢的，我也就不用再提醒自己起床吃饭生活。慢慢的，我也就会忘记那些曾经的温暖与甜蜜。那个跨越时空的邂逅，那些个不眠夜的痛苦。</p>
<p>在爱你的两年里，我的心从来没有变过；细水长流，爱你的这两年里，我无悔。感谢你的存在与陪伴，感谢你的亲吻与拥抱。或是此生无缘，或是阴差阳错，或许我们就注定不能修成正果。如今你带回家的人，已经不会是我了…</p>
<p>这是一个关于你我的心酸的爱情故事，它意外终结了。本以为会在某一年由我们两人一同续写，可没想到却在今天由我一人续结。纪念我们的青春爱情。</p>
<p>CH说，主动爱一个人很辛苦，每天追着他到处跑，想在他身边，结果他留给你的，全都是背影。本以为心灰意冷再寻他人，可连自己可能都不清楚他始终在心里。看着他离开你，和别人欢笑。直到看见他和其他女生在一起了，才知道嫉妒是件多么恶心的事情。</p>
<p><img src="/images/2018030604125295.jpeg" alt="http://b200.photo.store.qq.com/psb?/fec831d1-b737-4e4a-8f00-c90a396e2d35/XHJ5eucgnBpLOUQwAV03NbN3uKhpMMLoakL1fiTfVcM!/b/dA5ZPXczGwAA&amp;bo=gAJvBAAAAAAFAMo!&amp;rf=viewer_311"></p>
<p>开学当我再次回到学校的时候，想起了这里曾经站着等我的你：</p>
<p>再一次来到这里，再一次来到这个怦然心动的地方。这里，是你那年的回忆，是我昨日的记忆。</p>
<p>很快两年了。</p>
<p>再一次来到这里，再一次来到这个怦然心动的地方。可这里，<strong>已不是你那年的回忆，却依旧是我昨日的记忆。</strong></p>
<p>很快三年了。</p>
<p>在分开整整三年之后，我偶然看到你与相爱三年的另一个他分开了。我看到了你的背影，你扎着麻花辫，背着那个我还认得出来的五年前的淡蓝色书包。你说你最喜欢蓝色了。安好，愿求一切安好，愿求你不再为爱情伤，愿你幸福。</p>
<p>很快六年了。</p>
<p>短暂的重逢之后，我们又走向了不同的道路。我会永远记得我对你的亏欠，可是我知道我们再也回不到过去了。</p>
<p>Even when we’ve gone to separate ways, in my heart you’ll always stay.</p>
<p>第二个爱情故事</p>
<p>[netmusic play&#x3D;’0’]27711790[&#x2F;netmusic] 我曾经喜欢过一个人。</p>
<p>我和你相识于差不多2016年 12 月 9 日，我记得这么清楚是因为那晚我几乎没睡觉。为什么没睡觉呢，导员给我一个MacBook Pro让我给装双系统，可是又偏偏不记得密码，大概是有点兴奋吧。半夜里突然醒来，打开手机，发现她竟然也给我发了正确的密码。新的MacBook还是很好的，用BootCamp装双系统很容易，旧的型号可能会比较困难（毕竟俺不是专家嘛）。</p>
<p>下午去图书馆，有个学弟恰巧看到我，说一会可能有个学妹要找我。我说好啊。大概傍晚时刻，“偏执狂”的你来找我，是因为你也想像我一样，有一个自己的博客。于是便聊得很开心，有一种相见恨晚的感觉，毕竟能够在身边遇到一个喜欢写博客的人还是很少见的。</p>
<p>也许就是因为这些很相似的感觉，我发现我似乎喜欢上你了。《影响力》中不是说过嘛，<strong>我们喜欢与自己相似的人</strong>。不管相似之处是在观点、个性、背景还是生活方式上，我们总有这样的倾向；我们会下意识地向跟自己相似的人作出正面反应。</p>
<p>后来在 23 日，也真的是很巧的一天，我把你约出来见面。我说我能在五分钟之内帮你搭建一个“Hello World”的 博客，于是真的在五分钟内帮你搭建了 Typecho 的博客。尽管我的心意早已被你发现，也早已被拒绝，但还是觉得这样无所谓的努力挺好的。</p>
<p>然后一切就这样进行着，也许有些暧昧。为了你二次开发了一款功能强大的漂亮的 Typecho 主题，为你提供了很多学习资源，也准备了很多资料，因为对我来说你已经不是轻易地可以去放弃的人。甚至是，我没有忘记随想说的一句话，<strong>尽可能的去影响身边的人</strong>。于是我写出了很多针对性非常强的文章，或者在你的启发引导刺激下写出了很多自觉优秀的文章，有些文章甚至得到了很多人的赏识与称赞。甚至是，我带领着你来到墙外，去使用 Google，去使用 Twitter，去使用那些优秀的产品与服务，去接受自由思想与批判性思维，甚至到后来你有了一个只有我一个联系人的聊天应用：Telegram。</p>
<p>在接下来的生活中，一切突然开始变得有些愚蠢。恰巧在一年前，我偶然发现周一上午你我前后在同一间教室上课。我傻乎乎的提前去教室门口等着，只是为了能够在你下课的时候见你一面。也许是一个假期没见吧，可能那时候脑海中已经逐渐模糊了你的面容，但是在看到你从教室里走出来的时候，突然感到一丝心动：I flipped.只是很不幸的两周之后我换了教室，再也不能这样创造偶遇了。</p>
<p>如果说偶遇是偶然遇见，是小概率事件，那么我这里的偶遇，大概有一半以上都是被我硬生生的创造出来的。我精巧的计算着时间，思考着路程，像小偷一样四处张望生怕错过每一次可能的”偶遇”。四处张望寻求的虚假偶遇与昙花一现的短暂美好，想想也是很可爱的。</p>
<p>那句话是怎么说的，黄色的道路上分出了两条路，我选择了绕远的那条路，是因为我知道哪怕有万分之一遇见你的机会也是值得的。那次我绕远取快递，真的没想到回来的路上遇见了你。喂，下次走路的时候要记得看见我啊，不要让我每次都喊你的名字。</p>
<p>实习之前的那个暑假，听人说偶遇你，唉，看到别人说的偶遇，都感觉是一种幸福。曾经张望了四个月的偶遇吧。也许你不曾知道，The tiniest possibility of seeing you again excites me.</p>
<p>也许就是在这种不明所以的情况下，我开始像有了目标有了动力一样。我还记得，第一次见面的晚上你说她喜欢 Linux 和英语好的人，那时我心里暗想，这好像在说我。然后我通过了专八，找到了满意的工作，也更进一步接近了 Linux。</p>
<p> </p>
<p>我记不清我都做了些什么，但是每件事情都已经倾尽全力。我们曾经一起出来学习，也去看过 IMAX 电影。在我最难过最绝望最需要拥抱的时候，你买了樱桃陪我在操场聊天。<strong>如果那时牵起你的手，你会是什么表情，你会作何反应？</strong></p>
<p>我永远也无法忘记见到你时的兴奋感，永远也无法忘记听到你说话时的幸福感，永远也无法忘记看到你嘴角微笑时的满足感。我还记得你的眉眼，还记得你的曼妙身姿，还记得你的温暖与心跳，还记得与你相处的每一片美好记忆。</p>
<p>在某一个时间点，我以为这一切都开始发生了转变，我以为我们在一起了。我好想抱抱你啊，你说，这不是抱到了吗。我都快忘记了这种温暖的拥抱的感觉了。那次在影院里一起看的《敦刻尔克》可能是人生中最美好的一次观影体验了。</p>
<p>然而这一切并没有我想的那么简单。直到我知道你的故事，我才意识到我只完成了前两个梦想。两个月，变化的这么快，连 Telegram 都从你的手机里消失不见了，不知道一起消失不见的是否也有自由思想、独立思考与批判性思维。我甚至开始害怕发生《伤仲永》那样的事情，可能也许是我想太多了吧。</p>
<p>但这些都是我的主观看法啊，也许你只是一直很厌烦我吧，也许我只是在自作多情吧，也许你该生我的气了吧。将两个人的过去，全部破坏掉吧，快变的讨厌我吧。你的博客停留在半年前的更新，你的面容也定格在两个月之前。如果我足够理性，我应该继续帮你维护博客，去做一些尽可能的事情，而不是 “删库与跑路” 吧。不知你夜里的梦中或白天的记忆中是否有我。我魂牵梦萦的你，是否也思念着我。人若有灵魂，皆因心间有爱；不畏时间的考验，不受死亡的束缚。</p>
<p>也许无论我曾怎样努力，无论我曾怎样与你拥抱，真的要认清这一切了吧……也许你不曾记得你拉着我的手的时候，也许你不曾记得那天的日出，也许你不曾记得相拥时的温暖与心跳……如果是梦那么该多么美好啊，还可以在梦里看到你。黑暗中追寻着你的背影，那轮廓记忆犹新……此情可待成追忆，只是当时已惘然。</p>
<p>恰如溺水的人，想尽最后一番挣扎，可是我却无法改变你离去的幻梦。<strong>迷失在谎言与真相之中，我想我该死心了。一如往常就好，我放弃了，我累了，什么也不做，什么也不求。</strong>??</p>
<p>也许我该很俗的说一句，祝你幸福。可能也就这样了吧。只是，这里没有末路，你从不曾孤独，你是我曾经深爱的那个人。</p>
<p>可是，当这一切都变得复杂万分，当我渐渐了解到你对我的信任，当我逐渐了解这一切的来龙去脉、知道这些背景与故事之时，我却不知道该如何是好。<strong>眼见何事，情系何处，身在何方，心思何人。</strong>你在何方，心思何人？ 第三个爱情故事 人们都希望被别人需要，却往往事与愿违。 [netmusic play&#x3D;’0’]448917334[&#x2F;netmusic]</p>
<p>其实这里根本没有第三个爱情故事。所谓的第三个爱情故事，甚至都不存在于梦中。</p>
<p><img src="/images/2018030604125565.jpeg" alt="平匡与实栗"></p>
<p>もう やめる、もう疲れた。何もしない、何も求めない。</p>
<p>电车上的你，一点点的表情都在说着难过。你说你放弃了，累了，什么也不做，什么也不求。一边的眼睛湿润了，流泪了，车到站了，笑着说，我们走吧。</p>
<p><img src="/images/201803060412557.jpeg" alt="平匡与实栗"></p>
<p>希望被选中，希望得到认可，然而我却与理想中的自己渐行渐远了。</p>
<p>如此温柔的两个人。</p>
<p>你是我永远无法企及的梦想，却又是我孤独的生活的一丝希望与慰藉。马上就要看到你，马上就要再一次被你治愈♥</p>
<p>当再一次被你治愈之时，我就往往会想，如果此时身边能够有人给我一个拥抱就好了；在想着，如果有人需要我就好了；在想着如果能被选中、被认可就好了。可是到头来我却还是孤独一人。生于黑暗还是适应黑暗——也许我并不会从黑暗中崛起。</p>
<p>结衣酱，请你再一次治愈我。 [netmusic play&#x3D;’0’]41636941[&#x2F;netmusic]</p>
<p>其实我是一个挺懦弱、胆小怕事的人。在面试X公司之前，我几乎没有什么面试经验；来到X公司，看到身边一些人主动离职之后，我还是觉得能够留在这里挺幸运的。可能对于我来说，我需要的就是一个稳定的工作与收入了。就像对于今日子小姐来说，人生中只要有钱再稍加些谜团就够了。</p>
<p>我一直觉得能够在当前的环境下生活下去就很好。其实自己一个人也挺好嘛，生活（生存）压力比较小，无忧无虑，能够养活自己，想干嘛就干嘛，还能攒下很多钱。可能我的生活也就是这样了吧。没有什么特殊的意义，只是普普通通的生活。</p>
<p>也许这一切的过程都看起来很傻很天真，傻到足以被千夫所指，但至少我曾认真对待，至少我未曾轻浮……至少我不应该只能听到这样不经心的评论，至少我应该能够得到一点点认真的肯定。</p>
<p><strong>这三个爱情故事本不存在，都是我一个人的单相思与痴心妄想，散了吧。</strong>只是……</p>
<p><strong>下次见面时 请你重新再追求我一次</strong>?</p>
<p><img src="/images/2018030604125651.jpeg" alt="https://pbs.twimg.com/media/DWKmGjkXkAArVn8.jpg"></p>
<p>第四个爱情故事</p>
<p>我以为这次重逢会有结果，可是并没有如我所愿。</p>
<p>谢谢你带给了我这么多美妙的体验与经历，就让这一切在此结束吧。</p>
<p>迷失。</p>
<p>第四个爱情故事</p>
<p>认识你2600多天，从来没想到我会被你的一句话触动到，从来没想到我会这样迅速的迷恋于你。</p>
<p>你的一言一语，你的每一朵小花花，每一颗小心心，每一句关怀和问候，都像磁性越来越强的磁铁，越来越快、越来越强地吸引着我。我不知道终点是什么，我不知道最终的碰撞会怎样，我只知道这一切仿佛就是物理定律，无法抵抗。</p>
<p>可是，我心里很清楚，这是我不应该做的事情，我不可以喜欢上不应该喜欢的人。我已经在拼命克制了啊。</p>
<hr>
<p>希望疫情赶紧过去，好在夏日里不顾一切去见一个人，去拥抱对方，说我好喜欢你。</p>
<p>我们说好了要一起走的，我也不会离开你，你不会抛下我的对吧。</p>
<p>I’m with you all the way You’re with me all the way You came and saved me through the night ……. So I promise you I’ll be by your side</p>
<blockquote>
<p>I wonder if I come to you at night, in dreams;</p>
<p>in the day, as memories.</p>
<p><strong>Do I haunt your hours the way you haunted mine?</strong></p>
<p>If we have souls, they are made of the love we share.</p>
<p>Undimmed by time.</p>
<p>Unbound by death.</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/03/10/my-lovestory/index/" data-id="clhp7rthl0057s2qreclc9sl3" data-title="我的爱情故事" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-padavan-vypr/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/02/23/padavan-vypr/index/" class="article-date">
  <time class="dt-published" datetime="2018-02-23T00:00:00.000Z" itemprop="datePublished">2018-02-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/gfw/">gfw</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/02/23/padavan-vypr/index/">在路由器（padavan）上使用VPN客户端</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="为什么"><a href="#为什么" class="headerlink" title="为什么"></a>为什么</h2><p>好好的，为什么要在路由器上挂VPN呢？</p>
<ul>
<li>我有一个<a target="_blank" rel="noopener" href="https://dmesg.app/y1s.html">刷了padavan的联想y1s</a></li>
<li>我买了个Xbox，想玩外服游戏ε&#x3D;(´ο｀*)）)唉以及加速下载数字版游戏</li>
<li>有点闲的没事干</li>
</ul>
<h2 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h2><p>咱需要点啥呢……</p>
<ul>
<li>需要一个刷了padavan的路由器（或者是支持OpenVPN客户端的路由器）</li>
<li>需要<a target="_blank" rel="noopener" href="https://dmesg.app/all-platform-scientific-internet-all-in-one.html/3">一个VyprVPN账号</a>，或者是其他能用的OpenVPN（比如说我搭建在腾讯云的也算呗）</li>
<li>还需要一台电脑（这不废话嘛）</li>
</ul>
<h2 id="一些背景知识"><a href="#一些背景知识" class="headerlink" title="一些背景知识"></a>一些背景知识</h2><p>首先，<a target="_blank" rel="noopener" href="https://dmesg.app/all-platform-scientific-internet-all-in-one.html/3">VyprVPN</a>支持OpenVPN、L2TP&#x2F;IPSec、PPTP以及自创的Chameleon协议，<strong>Chameleon穿透GFW的效果还是比较理想的</strong>。</p>
<p>既然是标准的VPN协议，那我们就拿OpenVPN做例子试试在路由器上部署啦。</p>
<h3 id="Router-App"><a href="#Router-App" class="headerlink" title="Router App"></a>Router App</h3><p>非常不幸的是，VyprVPN Router App仅支持Tomato by Shibby这一个衍生固件，所以还是不要尝试了吧，port会很累的。</p>
<h2 id="Padavan的VPN客户端设置"><a href="#Padavan的VPN客户端设置" class="headerlink" title="Padavan的VPN客户端设置"></a>Padavan的VPN客户端设置</h2><p><img src="/images/2018022308363418.png"></p>
<p>我们需要配置如下信息：</p>
<ul>
<li>VPN协议</li>
<li>远程VPN服务器</li>
<li>通信端口</li>
<li>通信协议</li>
<li>封装层</li>
<li>认证类型与用户名密码</li>
<li>认证算法</li>
<li>加密算法</li>
<li>HMAc签名检查</li>
<li>公钥</li>
</ul>
<p>一个完整的ovpn配置文件恰巧会包含一部分如上信息，通过下载opvn文件并打开，我们可以发现如下对应关系：</p>
<p><img src="/images/2018022308363860.jpeg"></p>
<h3 id="添加基本信息"><a href="#添加基本信息" class="headerlink" title="添加基本信息"></a>添加基本信息</h3><p>所以在padavan中我们如下图和opvn配置文件中的信息设置就好了：</p>
<p><img src="/images/2018022308364623.jpeg"></p>
<h2 id="扩展配置"><a href="#扩展配置" class="headerlink" title="扩展配置"></a>扩展配置</h2><p>OpenVPN扩展配置需要添加如下内容：</p>
<p>resolv-retry infinite<br>keepalive 10 60<br>nobind<br>persist-key<br>persist-tun<br>persist-remote-ip<br>verify-x509-name 服务器域名 name<br>verb 3<br>auth SHA256<br>tls-cipher TLS-DHE-RSA-WITH-AES-256-CBC-SHA</p>
<h3 id="添加公钥"><a href="#添加公钥" class="headerlink" title="添加公钥"></a>添加公钥</h3><p>切换到选项卡“OpenVPN证书和密钥”，将opvn配置文件中的公钥贴进去，如下：</p>
<p><img src="/images/2018022308364958.png"></p>
<h3 id="其他选项"><a href="#其他选项" class="headerlink" title="其他选项"></a>其他选项</h3><ul>
<li>VPN 国内外自动分流：顾名思义，自动分流</li>
<li>通过 VPN 接口转发所有流量：顾名思义，如果选择是，那么所有流量都会通过VPN</li>
</ul>
<h3 id="保存设置"><a href="#保存设置" class="headerlink" title="保存设置"></a>保存设置</h3><p>如果没有问题的话，刷新路由器控制页面就会看到已经连接成功了，打开ipip.net也会看到IP变成了服务器IP</p>
<h2 id="测速"><a href="#测速" class="headerlink" title="测速"></a>测速</h2><p>需要注意的是，路由器可能会存在CPU性能瓶颈，所以可能会有一些影响。不过能够开国内外分流是<strong>一大优点，这样就不用走全局啦</strong>。 <img src="/images/201802230836549.png"></p>
<h2 id="感想"><a href="#感想" class="headerlink" title="感想"></a>感想</h2><ul>
<li>速度还是挺快的，于是我就这么水了一贴……？</li>
<li>如果某些网游加速器（比如说网易UU）也是通过建立VPN连接的话，那么我可以抓包，获取到对应的认证信息，然后放到路由器上给Xbox加速用……（然而失败惹</li>
<li>我感觉好像回到了<a target="_blank" rel="noopener" href="https://dmesg.app/internship.html">X公司的N号楼</a>，出口就是香港</li>
</ul>
<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>请严格根据你的opvn文件来进行配置，比如有的opvn会有两个证书，那么就两个都贴进去；有的会要求HMAC TLS-Auth，也要乖乖贴进去哦。</p>
<p>另外SoftEther VPN搭建的Open VPN，只要贴第一个CA就好了。默认配置文件再&#x2F;etc&#x2F;openvpn下</p>
<h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><h3 id="VPN总是自动断开"><a href="#VPN总是自动断开" class="headerlink" title="VPN总是自动断开"></a>VPN总是自动断开</h3><p>感谢<a target="_blank" rel="noopener" href="https://dmesg.app/padavan-vypr.html/comment-page-1#comment-4337">评论区chq123的测试</a>，<strong>终于研究出来了，把 启用 LZO 数据压缩 这个选 否 ，就不会自动重启了。。。哇感动啊，弄了这么久终于弄出来了</strong></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://support.goldenfrog.com/hc/en-us/articles/222083028-VyprVPN-OpenVPN-Setup-for-AsusWRT">VyprVPN OpenVPN Setup for AsusWRT</a></p>
<p><a target="_blank" rel="noopener" href="https://support.goldenfrog.com/hc/en-us/articles/204088603-VyprVPN-OpenVPN-Setup-for-Tomato">VyprVPN OpenVPN Setup for Tomato</a></p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/all-platform-scientific-internet-all-in-one.html/3">VyprVPN详细信息</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/02/23/padavan-vypr/index/" data-id="clhp7rti0006hs2qr22877noc" data-title="在路由器（padavan）上使用VPN客户端" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/10/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="page-number" href="/page/10/">10</a><span class="page-number current">11</span><a class="page-number" href="/page/12/">12</a><a class="page-number" href="/page/13/">13</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/12/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/azure/">azure</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/china/">china</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/china/justsay/">justsay</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/cloudflare/">cloudflare</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/gfw/">gfw</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/">it</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/it/justsay/">justsay</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/security/">security</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/share/">share</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/">justsay</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/gfw/">gfw</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/linux/security/">security</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/website/">website</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/program/">program</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/program/share/">share</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/security/">security</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/security/justsay/">justsay</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/security/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/share/">share</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/website/">website</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/website/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/what/">what</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/what/gfw/">gfw</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/ubuntu/" style="font-size: 10px;">ubuntu</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">September 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">August 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">July 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">April 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">March 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">February 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/09/27/workers-function/index/">将 Cloudflare Workers 迁移到 Azure Function</a>
          </li>
        
          <li>
            <a href="/2024/09/21/one-api-clickhouse/index/">one-api/new-api性能优化：使用 ClickHouse 作为日志系统</a>
          </li>
        
          <li>
            <a href="/2024/08/03/stripe-fraud/index/">Stripe 如何安全收款并避免盗刷与测卡</a>
          </li>
        
          <li>
            <a href="/2024/07/27/hide-in-cf/index/">隐藏于 Cloudflare 的全球网络之中</a>
          </li>
        
          <li>
            <a href="/2024/07/17/azure-waf/index/">救命！我的 Azure Front Door WAF 规则不生效怎么办！</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 Benny小土豆<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>