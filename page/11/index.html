<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>土豆不好吃</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="土豆不好吃">
<meta property="og:url" content="http://example.com/page/11/index.html">
<meta property="og:site_name" content="土豆不好吃">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Benny小土豆">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="土豆不好吃" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">土豆不好吃</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-confess-for-what/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/11/03/confess-for-what/index/" class="article-date">
  <time class="dt-published" datetime="2018-11-03T00:00:00.000Z" itemprop="datePublished">2018-11-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/justsay/">justsay</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/11/03/confess-for-what/index/">面壁思过...？</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>晚上女神突然来找我，我很开心。我知道这段时间她一定会比较频繁的找我，所以也并没有感到有什么意外。本来以为是因为毕设的原因来找我帮忙，没想到是想去Quora让我帮忙搜几个问题(去给留学生的作业什么的)。不过你懂的，我们的GFW是多么伟大啊。</p>
<p>后来这么一说，事情就简单了，我直接找几篇发给她参考下，也省得帮她配置shadowsocks什么的，尽管我十分愿意，毕竟，这也是为了<a target="_blank" rel="noopener" href="https://program-think.blogspot.com/2009/10/use-people-war-to-anti-gfw.html">让GFW陷入人民战争的汪洋大海</a>而做的微不足道的努力吧。话说回来，问题也很简单：为什么最近几年人们都选择移民美国，美国应该紧缩还是宽松移民政策？</p>
<p>这是个很好的问题啊，很值得讨论。我就顺便说了一句，我无时无刻不在想着逃走。我以前从来不会跟人说我的任何倾向和想法，因为我觉得就某人说的一样：我关注的都是大家不关注的。大家关注的我都没有精力去关注。</p>
<p>之所以敢和她这么说一句，可能是因为我认为她最近这一两年的经历与思想转变更像是<a target="_blank" rel="noopener" href="https://program-think.blogspot.com/2014/02/brainwash-and-idiot.html">“觉醒”的人</a>吧。我还跟人吹嘘过说我认识这种“异类觉醒”的人呢。呃似乎我这么说人家不太好吧。</p>
<p>也许她是受到了我当初无心插柳送给她的《1984》的影响吧，也许是那一年遇到了各种奇怪的社会现象吧。总之这种“觉醒”的人越来越多总是好的，虽说从觉醒程度上来讲可能并不足够深、并不理想。</p>
<p>但是想都没想到，我竟然被她狠狠的训了、或者说是凶了一次。感觉平时那么温文儒雅的她好像是第一次用这么大的声音、这么强烈的语气、加重了的力度的词语跟我说话……我记得她的声音分明是很甜美很温柔的那种圆滚滚的可爱的样子的啊……</p>
<p>大概就是说作为华人会被歧视，只看到了白板上一个黑点，只想追求自己的所谓的什么什么的。说实话我觉得这些观点都是没什么的，是的<strong>我不同意你的观点，但是我却愿意捍卫你说这些话的权利</strong>。即使我们的思想截然相反，但是思想一旦发生碰撞，就会溅出曼妙的火花。而这种思维火花往往对彼此的发展有积极性作用的。</p>
<p>只是很平静的说出这些其实也没什么，心情好的话，也许就可以你一句我一句的讨论，找出论据支撑自己的观点，用事实来说明观点，也许在这种事情里并没有绝对的对错（可能这样说也不对，但是至少我很清楚，我不会一定要像古美门那样不择手段的不留余地，毕竟跟我对话的人可是女神），可能经过这样一次讨论，我们对彼此的理解会更加深一点，或者是学习了解到了一些自己的思维体系中原本并不存在的一些观点。<strong>所谓思维的碰撞嘛，本应该就是这样美好的设想的</strong>。</p>
<p>唯一不同的是，她并不是心态平和的说出了这些，而是以着一种盛气凌人的、怒发冲冠的非常强烈的训斥般的语气说出了这些，如果是一些逻辑严谨的证明也就算了，但是给我的感觉却是分分钟走下滑坡。</p>
<p>上次有人用这种居高临下盛气凌人的语气跟我说话，还是8月中旬看电影时发生的小意外。不过好歹我和他也不认识，打不打招呼能咋样，又不给我发钱，并不在乎。可是今晚……想一想，是不是我太脆弱了，是不是我太过于看重别人对我的看法了，是不是我太玻璃心了。一定是这样的吧。为什么要轻易相信别人，为什么要轻易的把自己的内心、把自己的想法告诉别人呢？</p>
<p>我一句话都没敢反驳，甚至都不敢接茬。我立刻怂了，一丁点观点都不敢表达，一丁点事实都不敢描述。我立刻很委婉纠结的试探着问下不会是生气了吧……当然了这么问当然是无用功了。</p>
<p>得了，先别想这些，怀着忐忑不安的心情，我还是尽全力认真完成她拜托我的事情吧。我才不在乎别人是怎么拜托她的，也不在乎她能拿到什么好处。我所在乎的就是她来找我，她需要我帮忙我这一个环节，在那一瞬间我知道我是被人需要的，还是被女神需要的，所以自然要尽全力的认真的做好交代给我的事情，这样下次她才会更愿意来拜托我。至于其他的环节，其实我并不是很在乎的。</p>
<p>然后就到了现在。我本来只是想写几个字平静下自己的内心，却开始发现自己的情绪变得越来越不稳定、越来越激动。</p>
<p>莫非我这是PTSD了？所以我才这样敏感……说出去会被嫌弃笑话的吧。不过也没关系啊，我的心理太阴暗了，我一点都不积极，我总是看不到阳光的那一面，我总是倾向于选择自我毁灭，偶尔还会有着自暴自弃的想法。谁能喜欢这样性情多变的人就怪了。所以我不值得被爱啊，这些全都是我自己作死的后果。</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2018/11/2018110316142082.jpg"><img src="/images/2018110316142082.jpg"></a> 和你一起面壁思过好了。</p>
<p>也许吧，我再也不是那个你们认识的我了。终有一天我们之间的关系会逐渐切断，终有一天我们会把对方从彼此的记忆中清除。我一直认为自己是一个很绝情的人，所以这些对我来说是都是可以接受的。只是你现在还需要我，那就让我心甘情愿的完成为数不多的几次收官之作吧。</p>
<p>最后，还是想起了一句话：</p>
<blockquote>
<p>宪法原则中最重要的是“自由思想的原则”——不是确保我们喜欢的思想的自由，而是确保我们所憎恨的思想的自由</p>
<p>if there is any principle of the Constitution that more imperatively calls for attachment than any other it is the principle of free thought—not free thought for those who agree with us but freedom for the thought that we hate.</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/11/03/confess-for-what/index/" data-id="clhp7rtf5001gs2qr3eps78rt" data-title="面壁思过...？" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-python-excel-add-column/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/09/19/python-excel-add-column/index/" class="article-date">
  <time class="dt-published" datetime="2018-09-19T00:00:00.000Z" itemprop="datePublished">2018-09-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/program/">program</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/09/19/python-excel-add-column/index/">使用Python给带合并单元格的Excel加一列</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>前几天有这么一个需求，要给Excel表格的最前面加入两列。我想这不是非常简单吗？几行代码而已：</p>
<p>import openpyxl</p>
<p>wb &#x3D; openpyxl.load_workbook(‘simple.xlsx’)<br>sh &#x3D; wb.active<br>sh.insert_cols(1)<br>wb.save(‘result.xlsx’)</p>
<p>非常简单，自己还找了个表格试了下，好像没问题。</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2018/09/2018091913193939.png"><img src="/images/2018091913193939.png"></a></p>
<p>然后我发现我要处理的表格是带有合并单元格的，用这几行代码处理下发现……</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2018/09/2018091913194017.png"><img src="/images/2018091913194017.png"></a></p>
<p>我的单元格都乱套了……</p>
<p>这可咋整……不管了，掏出了openpyxl</p>
<h2 id="openpyxl"><a href="#openpyxl" class="headerlink" title="openpyxl"></a>openpyxl</h2><h3 id="处理xlsx合并单元格插入列"><a href="#处理xlsx合并单元格插入列" class="headerlink" title="处理xlsx合并单元格插入列"></a>处理xlsx合并单元格插入列</h3><p>其实处理思路很简单，遍历每一个单元格，给纵坐标+2，然后样式什么的也拷贝一份写到新的表格里就好了。但是一片不大不小的水域，总是有那么不多不少的水坑。</p>
<h3 id="如何判断合并单元格"><a href="#如何判断合并单元格" class="headerlink" title="如何判断合并单元格"></a>如何判断合并单元格</h3><p>在openpyxl中， 合并单元格是以<code>ws.merged_cells</code>这个列表表示的，这个列表里面的形式如下：I1:I2 D1:E1 A1:A2 B1:C1 F1:H1，每一对用冒号连接的坐标表示这两个之间是合并的。</p>
<p>这样问题就简单啦，我们只需要把坐标+2就好了，比如说A1:B2变C1:E2，K1:J5变M1:L1，Z1:AA1变AB1:AC1，等等什么？Z1:AA1变AB1:AC1？没办法我这个Excel有点长……</p>
<p>这个不是普通的加法啊，通过<code>ord()</code>和<code>chr()</code>来回转换吧？进坑了吧少年?</p>
<h3 id="二十六进制？？"><a href="#二十六进制？？" class="headerlink" title="二十六进制？？"></a>二十六进制？？</h3><p>我们了解到，Excel的坐标变化是字母表的进位，也就是26进制！这……二进制，八进制，十六进制都是咱比较常用的，这二十六进制是什么鬼？来我们<code>if…elif…elif….elif</code>写一波……</p>
<p>def twenty_six(coord, size):</p>
<h1 id="A1-B2-AB1-AC2"><a href="#A1-B2-AB1-AC2" class="headerlink" title="A1:B2, AB1:AC2"></a>A1:B2, AB1:AC2</h1><pre><code>left = coord.split(&#39;:&#39;)\[0\]
right = coord.split(&#39;:&#39;)\[-1\]
left\_char = left\[0\]
right\_char = right\[0\]

if len(left\_char) == 1 and len(right\_char) == 1:
    return &quot;%s:%s&quot; % (chr(ord(left\_char + size)), chr(ord(right\_char + size)))
elif len(left\_char) == 2 and len(right\_char) == 2:
    return &quot;%s:%s&quot; % (chr(ord(left\_char + size)), chr(ord(right\_char + size)))
</code></pre>
<p>哎？那要坐标是A1:AZ3的呢？不用想了这段代码是错的⛲</p>
<p>那么我们来创造人类史上的第一个26进制吧！小伙子，又进坑了吧……?</p>
<p>要什么26进制啊，直接弄个A, B, C, D….AA, AB, AC….BC, BD….ZZ一共26*26个元素的列表，通过index查得了。</p>
<p>所以所谓的“26进制”咱可以这么处理一波：</p>
<p>import itertools<br>import string</p>
<p>table &#x3D; list(itertools.chain(string.ascii_uppercase,(‘’.join(pair) for pair in itertools.product(string.ascii_uppercase, repeat&#x3D;2))))</p>
<p>def twenty_six(char, size):<br>    index &#x3D; table.index(char)<br>    return table[index + size]</p>
<p>其中<code>char</code>是表示字母（不带数字的那种）</p>
<p>喜欢挑刺的童鞋们可能会说，你这是列表，列表查找可能得全都遍历完了才查找到，你这太浪费时间了。得用字典。</p>
<p>喂(#`O′)童鞋，如果用字典的话，那么需要不仅能从键（字母）找到值，还得需要通过值找到键，这……行行行，没啥不可能的，键值对反转嘛，面试必会题目。那么用字典，table大概就是这么构造：</p>
<p>使用dict方法</p>
<p>table &#x3D; [dict(zip(itertools.chain(string.ascii_uppercase,<br>(‘’.join(pair) for pair in itertools.product(string.ascii_uppercase, repeat&#x3D;2))),<br>[i for i in range(26 * 26)])),<br>dict(zip([i for i in range(26 * 26)], itertools.chain(string.ascii_uppercase,<br>(‘’.join(pair) for pair in itertools.product(string.ascii_uppercase, repeat&#x3D;2)))))]</p>
<p>使用字典推导(ﾉ*･ω･)ﾉ：</p>
<p>base &#x3D; dict(zip(itertools.chain(string.ascii_uppercase,<br>(‘’.join(pair) for pair in itertools.product(string.ascii_uppercase, repeat&#x3D;2))),<br>[i for i in range(26 * 26)]))</p>
<p>table &#x3D; [base, {v: k for k, v in base.items()}]</p>
<p><code>table[0]</code>表示从字母查找数字，给数字+2之后在<code>table[1]</code>从数字查找字母，调用就更简单了。我爱(ﾉ*･ω･)ﾉ。</p>
<p>然而实际上，676个元素有点少，字典的空间换时间几乎是划不来的。而且<code>dict()</code>和<code>zip()</code>方法以及遍历字典也会花费一点时间，代码还写得很长，所以简单起见生成个列表就够了。</p>
<h3 id="处理字母式坐标"><a href="#处理字母式坐标" class="headerlink" title="处理字母式坐标"></a>处理字母式坐标</h3><p>在解决了26进制之后，我们只需要把字母从一个合并单元格坐标中提取出来就可以了，要完成这项工作其实方法挺多的，比较简单的方法是直接用正则表达式。一搜就有。这里就不写了。</p>
<h3 id="遍历单元格内容和样式"><a href="#遍历单元格内容和样式" class="headerlink" title="遍历单元格内容和样式"></a>遍历单元格内容和样式</h3><p>我们需要遍历每个单元格，多亏了PyCharm的Evaluate Expression功能，很容易就发现遍历单元格的方法：</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2018/09/2018091913194476.png"><img src="/images/2018091913194476.png"></a></p>
<p>我们可以很清楚的看到，i这个变量的每一个元素都包含了这个表格的全部信息，包括内容，边框，填充，字体等等。那么获取到这些信息就很简单了，一个双循环即可：</p>
<p>for i in ws.rows:<br>    for v in i:<br>        print(v.coordinate, v.fill, v.border, v.value)</p>
<p><code>v.coordinate</code>表示的是单元格的字母式坐标，我们可以给上面封装好的twenty_six调用下，就能够做好新的移动之后的坐标了。</p>
<p>那么拷贝样式吧。</p>
<h3 id="拷贝单元格样式"><a href="#拷贝单元格样式" class="headerlink" title="拷贝单元格样式"></a>拷贝单元格样式</h3><p>在openpyxl中，给单元格写入样式非常简单，大概如下就可以了：</p>
<p><code>ws[&#39;A1&#39;].fill=&#39;Your fill style&#39;</code></p>
<p>我们把上面遍历过来的内容直接赋值就可以了，大概如下：</p>
<p>for i in ws.rows:<br>    for v in i:<br>        coord &#x3D; ‘移动之后的坐标’<br>        # copy fill border and everything<br>        write_ws[coord].fill &#x3D; v.fill<br>        write_ws[coord].font &#x3D; v.border<br>        write_ws[coord].border &#x3D; v.border</p>
<p>童鞋，你又进坑了━((*′д｀)爻(′д｀*))━!!!!</p>
<p>尽管通过Evaluate能够看到右面的类型是左边接受的类型，但是还是报错。为什么不尝试下浅拷贝呢？嗯这是好用的。</p>
<p><code>from copy import copy</code>把<code>v.fill</code>替换成<code>copy(v.fill)</code>就好了</p>
<h3 id="给合并单元格应用样式"><a href="#给合并单元格应用样式" class="headerlink" title="给合并单元格应用样式"></a>给合并单元格应用样式</h3><p>这个有点特殊，<a target="_blank" rel="noopener" href="https://openpyxl.readthedocs.io/en/stable/styles.html#styling-merged-cells">openpyxl官网写好</a>了一个，咱拿过来直接用就好了。</p>
<h3 id="拷贝单元格内容"><a href="#拷贝单元格内容" class="headerlink" title="拷贝单元格内容"></a>拷贝单元格内容</h3><p>单元格内容用<code>v.value</code>就能读到了。但是那些合并了的单元格，究竟是读取哪个坐标才能读到呢?别猜了，让我来告诉你，左上角的。其他的读取出来的都是<code>None</code></p>
<p>所以拷贝单元格内容就太简单了，判断下就好了。</p>
<p>if v.value:<br>    self.write_ws[coord] &#x3D; v.value</p>
<p>啪(￣ε(#￣)打飞你。如果某个单元格的内容是0，0是布尔假值啊……那岂不是丢数据了？？</p>
<p>小可爱，判断下，这是个特例。于是乎吭哧吭哧……</p>
<p>elif type(v.value) &#x3D;&#x3D; int:<br>    pass</p>
<p>啪(。&gt;︿&lt;)_θ再次打飞你。难道不知道有个东西叫<code>isinstance()</code>嘛？后面的类型可以是元组，列表或者单个类型（类啊，int啊，float啊啥的都可以）</p>
<p>elif isinstance(v.value, float):<br>    pass</p>
<h3 id="组装……"><a href="#组装……" class="headerlink" title="组装……"></a>组装……</h3><p>好吧，那么坑都踩的差不多了，组装组装就好了，先拷贝每个单元格，再给<code>merge_cell</code>拷贝过去，基本上就没啥了。</p>
<p>biu biu biu于是别人给你发了一个xls格式的Excel。</p>
<p>openpyxl不支持xls哦。</p>
<h3 id="转换格式？"><a href="#转换格式？" class="headerlink" title="转换格式？"></a>转换格式？</h3><p>怕啥，openpyxl不支持读xls，我们就找个东西给转换成xlsx，再拿他处理。什么pandas啊，pyexcel啊都行，要不随手找个什么在线转换的支持REST API的咱用requests走起啊……</p>
<p>你看，这个?是什么，黑乎乎的我看不清，要不你跳进去看下。</p>
<p>不用试了，那些库把xls转换成xlsx之后，合并单元格基本丢的差不多的了。用在线转换，比如说牛逼哄哄的Google Docs？恐怕我是要请<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/Legal_High">黛真知子</a>当我的辩护律师呀……啊不，我愿意，非常愿意，真的真的那就在线转换吧。小黛请你为我唱一首歌(&#x2F;≧▽≦)&#x2F;</p>
<iframe src="//player.bilibili.com/player.html?aid=4012670&amp;cid=6469605&amp;page=1" frameborder="no" scrolling="no" allowfullscreen="allowfullscreen"></iframe>

<p>哦那个对不起，其实我家小黛唱歌好好听的。爱老婆的清唱??(*￣3￣)╭</p>
<iframe src="//player.bilibili.com/player.html?aid=2440565&amp;cid=3820356&amp;page=1" frameborder="no" scrolling="no" allowfullscreen="allowfullscreen"></iframe>

<p>(づ￣ 3￣)づ</p>
<h2 id="xlrd-xlwt-xlutils"><a href="#xlrd-xlwt-xlutils" class="headerlink" title="xlrd xlwt xlutils"></a>xlrd xlwt xlutils</h2><p>所以说到底，我们又用回来了xlrd这一系列？不过好在思路已经有了，那么就简单了。</p>
<h3 id="读取合并单元格"><a href="#读取合并单元格" class="headerlink" title="读取合并单元格"></a>读取合并单元格</h3><p>同样的，借助PyCharm的Debug，咱很快就找到了合并单元格存于<code>read_ws.merged_cells</code>中。当然要遍历啦，每个元素都是一个包含了四个数字的元组。这四个数字都是啥啊……哎嘿嘿坐标呗，↖↘酱紫的呗，从0开始数数哦，前开后闭哦（哦对不起我高中数学就没及格过）。</p>
<p>for (rlow, rhigh, clow, chigh) in read_ws.merged_cells:<br>    print(rlow, rhigh, clow, chigh)</p>
<p>那怎么读取到合并单元格的值呢？当然还是左上角的坐标啦。那是什么呢，反正就4个数字，排列组合也就十几种，哎……好吧，是rlow和clow啦。读取的话就<code>read_ws.cell(1,2).value</code>就拿到了。</p>
<h3 id="写入合并单元格"><a href="#写入合并单元格" class="headerlink" title="写入合并单元格"></a>写入合并单元格</h3><p>这个也很简单啦，<code>write_merge()</code>接受4个必选参数，也就是坐标，1个可选参数插入的值，另一个可选参数样式。</p>
<p>所以复制合并单元格就这样子：</p>
<p>for (rlow, rhigh, clow, chigh) in read_ws.merged_cells:<br>    # 2nd &amp; 4th parameter have to -1<br>    write_ws.write_merge(rlow, rhigh - 1, clow + size, chigh - 1 + size, read_ws.cell(rlow, clow).value)</p>
<h3 id="读取单元格样式"><a href="#读取单元格样式" class="headerlink" title="读取单元格样式"></a>读取单元格样式</h3><p>xlrd的样式是怎么读出来的呢？找遍了<code>sh.cell()</code>的返回值也没发现有什么结构是存着样式的。</p>
<p>猛然间发现一个<code>sh.cell_xf_index()</code>似乎可以拿到样式的索引的……还有个<code>wb.xf_list</code>，于是用索引去取，完美了。</p>
<h3 id="应用单元格样式"><a href="#应用单元格样式" class="headerlink" title="应用单元格样式"></a>应用单元格样式</h3><p>样式已经取到了，那么赋值给关键字参数style，❌；copy一下赋值，❌……类型似乎正确啊……</p>
<p>一把梭一把梭，拿起来就是干，我不会编程，全都是抄StackOverflow的。</p>
<p>xlrd的样式不能应用给xlwt哦亲亲。(╯‵□′)╯︵┻━┻气得我当场就把桌子掀了。</p>
<p>w &#x3D; XLWTWriter()<br>process(XLRDReader(wb, ‘unknown.xls’), w)<br>w.style_list</p>
<p>从这个<code>w.style_list</code>取下标，这个值就是可以传给xlwt的关键字参数style的了✔○( ＾皿＾)っHiahiahia…</p>
<h3 id="遍历并写入单元格内容和样式"><a href="#遍历并写入单元格内容和样式" class="headerlink" title="遍历并写入单元格内容和样式"></a>遍历并写入单元格内容和样式</h3><p>xlrd的<code>read_ws.nrows</code>和<code>read_ws.ncols</code>表示了这个表格总计的行数和列数，简单粗暴双循环，同样需要注意布尔值为假的0：</p>
<p>for i in range(__nrows):<br>    for j in range(__ncols):<br>        # copy style and value<br>        if read_ws.cell(i, j).value:<br>            write_ws.write(i, j + size, read_ws.cell(i, j).value, style&#x3D;__generate_style(i, j))<br>        elif isinstance(read_ws.cell(i, j).value, float):<br>            write_ws.write(i, j + size, read_ws.cell(i, j).value)</p>
<p>?<strong>是一种神奇的东西，我们每个人都见过，但是却又不知道它的本质，不知道它究竟为何。</strong></p>
<p>?有的时候，可能某些单元格，它是有填充色的，但是内容为空哦。那你这……不就错了吗？</p>
<p>解决方案也很简单，再来个else，继续copy style但是插入空值呗……哎？有没有人想问下openpyxl就没有这个问题啊，怎么这就出现了……(*&#x2F;ω＼*)那个你最好看下openpyxl我是在哪里应用的样式。</p>
<p>人生在世，?总是有的，说不定哪一天走在马路上就……这样做可能会抛出ValueError的异常。</p>
<p>这是为啥呢？其实我也不知道。try一波捕获了就好了。</p>
<h2 id="那么封装成一个类"><a href="#那么封装成一个类" class="headerlink" title="那么封装成一个类"></a>那么封装成一个类</h2><p>这还用说嘛，简单，把openpyxl和xlrd家族的封装到类里，<code>__init__()</code>接受俩参数，也就是输入和输出文件名，该用双下划线“保护”的成员变量就写上，该静态方法就静态方法，最后保留一个<code>insert_col()</code>接受一个size参数，一个<code>save()</code>保存文件就得了，实例能访问读取和写入的workbook和worksheet就足够了。</p>
<h3 id="为什么要有save-呢？"><a href="#为什么要有save-呢？" class="headerlink" title="为什么要有save()呢？"></a>为什么要有save()呢？</h3><p>因为灵活啊，万一人家想插了两列空白，顺便加点字呢？难不成要让人再打开一遍文件啊？当然不了，直接实例调用写入的worksheet的那个变量，想怎么来就怎么来了。</p>
<h2 id="这个新的列的表头也得你加"><a href="#这个新的列的表头也得你加" class="headerlink" title="这个新的列的表头也得你加"></a>这个新的列的表头也得你加</h2><h3 id="自定义前景色"><a href="#自定义前景色" class="headerlink" title="自定义前景色"></a>自定义前景色</h3><p>这没啥，很简单，xlwt和openpyxl都带，自己看下文档，很容易就做出来了。</p>
<p>不过需要注意的是，xlwt的设计有一点秀逗，这个插入的背景色的话，如果想自定义的话，是用不了十六进制的颜色值的……那么自定义颜色值大概是……</p>
<p>pattern &#x3D; xlwt.Pattern()<br>xlwt.add_palette_colour(“custom_color”, 0x21)<br>c.write_wb.set_colour_RGB(0x21, 0, 204, 255)<br>pattern.pattern &#x3D; xlwt.Pattern.SOLID_PATTERN<br>pattern.pattern_fore_colour &#x3D; 0x21</p>
<h3 id="这个新加的表头也要封装"><a href="#这个新加的表头也要封装" class="headerlink" title="这个新加的表头也要封装"></a>这个新加的表头也要封装</h3><p>于是咱咔咔咔的要给这个类再加个方法，再给构造方法添加个参数啥的（因为要处理两个不同的表头样式）</p>
<p>啪ㄟ( ▔, ▔ )ㄏ手疼ヽ(*。&gt;Д&lt;)o゜</p>
<p>难道不知道有个东西叫做继承吗？这个类已经很纯粹了，就是给Excel前面加两列，这么加个不相干的方法进去那就是老鼠屎里进了米饭……啊不是米饭里进了老鼠屎。继承下更好哟(＾Ｕ＾)ノ~ＹＯ</p>
<h2 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h2><p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2018/09/2018091913194557.png"><img src="/images/2018091913194557.png"></a></p>
<p>完美(o゜▽゜)o☆</p>
<p>全部源代码以及示例文件可以戳下面的章鱼猫哦o(&#x3D;•ェ•&#x3D;)m [gt href&#x3D;’<a target="_blank" rel="noopener" href="https://github.com/BennyThink/tools/tree/master/xls'/]%E5%BC%80%E6%BA%90%E5%9C%B0%E5%9D%80/[/gt/]">https://github.com/BennyThink/tools/tree/master/xls&#39;\]开源地址\[/gt\]</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/09/19/python-excel-add-column/index/" data-id="clhp7rtid006zs2qrhodr75sd" data-title="使用Python给带合并单元格的Excel加一列" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-purpose-of-life/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/08/27/purpose-of-life/index/" class="article-date">
  <time class="dt-published" datetime="2018-08-27T00:00:00.000Z" itemprop="datePublished">2018-08-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/justsay/">justsay</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/08/27/purpose-of-life/index/">生活啊，究竟是为了什么呢</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <blockquote>
<p>A true suicide is a paced, disciplined certainty.</p>
<p>People pontificate “Suicide is a coward’s act”.</p>
<p>Couldn’t be further from the truth.</p>
<p>Suicide takes tremendous courage.</p>
<p>真正的自杀是一场深思熟虑的谋划</p>
<p>人们断言，自杀系懦夫之为</p>
<p>事实却是大相径庭</p>
<p>自杀需要极大的勇气</p>
</blockquote>
<h2 id="选择"><a href="#选择" class="headerlink" title="选择"></a>选择</h2><p>生活啊，究竟是为了什么呢？是为了奔向更美好的未来，还是为了生存下去？</p>
<p>我想，对于我来说，只是单纯的为了生存下去，我只是想活下去，但是却又不敢有一丝的对未来的奢望。</p>
<p>是我选择让生活变得更糟糕的。我自己作死，怪得了谁呢？</p>
<p>真的是这样吗？只是因为我不想再跟父母要一分钱，只是因为我想自己努力去创造未来。</p>
<p>生于穷人家的孩子总是在体验同龄人都在毕业游而我却要为生活而奔波的<a target="_blank" rel="noopener" href="https://twitter.com/BennyThinks/status/1011895319100051456">落差感</a>，总是在感受别人父母都已经准备好一切而我却想要拒绝些许帮助的无力感。是的，这就是生活，永远孤独一人，只能指望自己。</p>
<p>然而无论我怎么选择，似乎还是看不见未来呢。</p>
<p>房价高到望尘莫及，物价高到无法理喻，可收入却低到深不见底。好吧我承认我说错了，收入没那么低，物价虽说高但是也没到吃不起的份上，可是房价却是实实在在的无法理喻。</p>
<p>可不是嘛，住不起、行不起、生不起、病不起、死不起、结不起，总之总之，什么都不起，除了吃得起让你饿不死。</p>
<p>生活变得越来越糟糕了，越来越看不到未来的任何希望了。</p>
<p>生活失去希望，虽生犹死。</p>
<p><img src="/images/2018082713432951.jpeg" alt="To live without hope is to cease to life"></p>
<h2 id="假象"><a href="#假象" class="headerlink" title="假象"></a>假象</h2><p>似乎我曾经说过，我的生活还算滋润？好像是这样啊，工作上的事情处理来得心应手，有人需要我；家庭和睦幸福，父母身体很好，还可以戳小孩子的脸；有着游戏机，吃喝不愁可能还会比较奢侈，有着足够让我无收入活过一年半载的积蓄，可以开开心心的吃顿大餐，可以孤注一掷的为喜欢的人买点什么。这好像可以算作说得过去的才毕业两个月的应届生了？在同龄人中还算是说得过去的了？</p>
<p>看着很潇洒，很得意自由是吧。然而背后的真相就是，这些都无法改变我是小白兔的事实。</p>
<p><a target="_blank" rel="noopener" href="https://program-think.blogspot.com/2013/03/weekly-share-42.html#head-1">我是只可爱的小白兔啊</a>，可爱的小白兔啊，非常萌的萌到爆的那种。然后某天突然意识到自己变成了没有脚的绿油油的韭菜。</p>
<p>小白兔活得多不容易啊，然而被狼，狐狸和王八割了个溜光。</p>
<h2 id="伊人"><a href="#伊人" class="headerlink" title="伊人"></a>伊人</h2><p>我总是会想起<a target="_blank" rel="noopener" href="https://dmesg.app/my-lovestory.html">她</a>。尽管她也许做的不对，但是不知为何我总是回忆起那些日子里她对我的信任。</p>
<p>她那么漂亮，却选择和矮穷挫的我在一起，甚至考虑了未来。也许那个时候我们都很幼稚吧，不知道生活有多么残酷，也许那个时候爱情都是很纯真美好的吧。也许分开对她而言是更好的选择，和我在一起会吃苦的。</p>
<p>曾经互相凝视时看到你眼中含着的笑容，那种很温柔的充满了爱意的笑眼。即使感觉整个内心世界似乎都可以被一个拥抱填满，即使在某些时刻我觉得自己是被需要的，即使这样，也只不过是过去的美好记忆，也许是三年前的记忆，也许是三天前的记忆。</p>
<p>要习惯被拒绝，习惯被忽视，习惯被讨厌，并且要不带任何情绪的一笑而过。希望我能够不带任何情绪的，很快的就忘记这些吧。然而我深深地知道，喜欢的人是不可能的，想要的东西是拿不到的，未来是看不见的。只剩下绝望，只剩下逃离。</p>
<p>在看不到希望的未来里，我能够遇见你，能够与你共同玩耍，能够注视你的笑眼，能够与你牵手拥抱哪怕只有一瞬间，我觉得这也是很美妙的事情。</p>
<p>卖火柴的小女孩最终划亮了最后一根火柴，希望也在她的眼中渐渐流逝。</p>
<p><img src="/images/2018082713433041.png"></p>
<p>最爱的结衣老婆，求你快来治愈我…… 你的笑容已经了我的精神支柱……</p>
<h2 id="离去"><a href="#离去" class="headerlink" title="离去"></a>离去</h2><p>唉。</p>
<p>看不到希望的未来，看不到未来的希望?看不到一丝一毫的生活能变得起色的样子。</p>
<p>没有希望，没有未来。在这个看不到希望的未来里，我连你也看不到呢……</p>
<p>即使看不到希望，也一定要努力生存下去，坚持到这一天吧……还是要努力的，为了逃离，为了Exodus……?</p>
<p><img src="/images/2018082713433171.jpeg"></p>
<h2 id="……"><a href="#……" class="headerlink" title="……"></a>……</h2><p>新出的电影可以去看，喜欢的游戏可以去买，想吃什么也可以吃，想喝冰酒也可以毫不犹豫的加到购物车里。看着很潇洒，很得意自由，光鲜亮丽的生活是吧。然而背后的真相就是，这些都无法改变我是小白兔的事实。其实更多的是对未来生活的无望。不知道是看不到未来的希望还是看不到希望的未来</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/08/27/purpose-of-life/index/" data-id="clhp7rti3006ts2qrckke3fbh" data-title="生活啊，究竟是为了什么呢" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-pyweathercn/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/08/18/pyweathercn/index/" class="article-date">
  <time class="dt-published" datetime="2018-08-18T00:00:00.000Z" itemprop="datePublished">2018-08-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/program/">program</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/08/18/pyweathercn/index/">一个简单强大的Python天气预报库pyweathercn</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>今天向大家介绍一款可以用来查询国内绝大部分城市天气预报的Python库pyweathercn，网上搜到的基本都不能用啦……</p>
<p>pyweathercn的作者正是大名鼎鼎的本人。</p>
<p>好吧，其实这个库我早在5月份的时候就写好了，但是由于太忙一直忘了这回事……</p>
<p>demo: <a target="_blank" rel="noopener" href="https://weather.bennythink.com/">https://weather.bennythink.com</a></p>
<h2 id="特色"><a href="#特色" class="headerlink" title="特色"></a>特色</h2><p>用法简洁</p>
<p>支持开启REST API风格的服务器，一库多用，异步非阻塞支持高并发，支持https</p>
<h2 id="为啥要开发这个"><a href="#为啥要开发这个" class="headerlink" title="为啥要开发这个"></a>为啥要开发这个</h2><p>因为我需要啊！上网搜罗了一波，各种天气预报API基本上都得注册，可能还得要钱，或者限制访问频率，这就让我非常不开心了。那么既然没人写过，那咱就只好自己写一个了啊。</p>
<p>不过需要注意的是，这个原理是爬虫并解析<a target="_blank" rel="noopener" href="http://www.weather.com.cn/">www.weather.com.cn</a>，所以如果某天不好用了，很有可能就是人家网站改版了……</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>需要注意的是，这个库并不支持Python 2，所以请使用Python 3</p>
<p>pip install pyweathercn</p>
<p>如果需要请自行替换为<code>pip3</code></p>
<p>另外，如果你使用国内的PyPi源，可能现在还没更新到1.0.3呢……</p>
<p>其实这个库本应该是支持Python 2的，因为也没用什么Python 3才有的特性和语法用了一些的，但是我就是不想支持Python 2，不爽你来打我啊。不过非得想支持Python 2 的话，你可以下载tar包解压缩到site-packages啊</p>
<h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><h3 id="普通模式"><a href="#普通模式" class="headerlink" title="普通模式"></a>普通模式</h3><p>非常简单，支持chain call和实例模式，来几个例子：</p>
<p>&gt;&gt;&gt; import pyweathercn</p>
<blockquote>
<blockquote>
<blockquote>
<p>pyweathercn.Weather(‘重庆’).temp()</p>
</blockquote>
</blockquote>
</blockquote>
<p>‘重庆：20’</p>
<blockquote>
<blockquote>
<blockquote>
<p>w &#x3D; pyweathercn.Weather(‘北京’)</p>
</blockquote>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>w.data</p>
</blockquote>
</blockquote>
</blockquote>
<p>{‘data’: {‘city’: ‘北京’, ‘aqi’: ‘159’, ‘tip’: ‘紫外线指数很强涂擦SPF20以上，PA++护肤品，避强光。穿衣指数热适合穿T恤、短薄外套等夏季服装。’, ‘temp’: ‘20’, ‘forecast’: [{‘date’: ‘23日（今天）’, ‘type’: ‘晴’, ‘temp’: ‘15℃’, ‘wind’: ‘西南风 3-4级’}, {‘date’: ‘24日（明天）’, ‘type’: ‘晴’, ‘temp’: ‘31℃&#x2F;17℃’, ‘wind’: ‘南风 3-4级’}, {‘date’: ‘25日（后天）’, ‘type’: ‘晴转多云’, ‘temp’: ‘31℃&#x2F;19℃’, ‘wind’: ‘西南风 &lt;3级’}, {‘date’: ‘26日（周六）’, ‘type’: ‘阴转多云’, ‘temp’: ‘30℃&#x2F;16℃’, ‘wind’: ‘西风 &lt;3级’}, {‘date’: ‘27日（周日）’, ‘type’: ‘多云’, ‘temp’: ‘29℃&#x2F;15℃’, ‘wind’: ‘南风 &lt;3级’}, {‘date’: ‘28日（周一）’, ‘type’: ‘多云’, ‘temp’: ‘25℃&#x2F;15℃’, ‘wind’: ‘东北风 &lt;3级’}, {‘date’: ‘29日（周二）’, ‘type’: ‘晴’, ‘temp’: ‘29℃&#x2F;15℃’, ‘wind’: ‘西南风 &lt;3级’}]}, ‘status’: 0, ‘message’: ‘success’}</p>
<blockquote>
<blockquote>
<blockquote>
<p>w.today()</p>
</blockquote>
</blockquote>
</blockquote>
<p>‘北京：23日（今天）晴15℃西南风 3-4级’</p>
<blockquote>
<blockquote>
<blockquote>
<p>w.tomorrow(True)</p>
</blockquote>
</blockquote>
</blockquote>
<p>{‘date’: ‘24日（明天）’, ‘type’: ‘晴’, ‘temp’: ‘31℃&#x2F;17℃’, ‘wind’: ‘南风 3-4级’}</p>
<blockquote>
<blockquote>
<blockquote>
<p>w.tip()</p>
</blockquote>
</blockquote>
</blockquote>
<p>‘北京温馨提示：紫外线指数很强涂擦SPF20以上，PA++护肤品，避强光。穿衣指数热适合穿T恤、短薄外套等夏季服装。’</p>
<blockquote>
<blockquote>
<blockquote>
<p>w.forecast(False,5)</p>
</blockquote>
</blockquote>
</blockquote>
<p>‘北京：28日（周一）多云25℃&#x2F;15℃东北风 &lt;3级’</p>
<p>其中tomorrow 等类方法的参数如果传布尔真值的话，将会显示原始json响应，不传或者传布尔假值会显示易于阅读的字符串。</p>
<p>其他的一些类方法，咱的IDE都有提示，我注释写的还算简单易懂，这里就不细说了</p>
<h3 id="服务器模式"><a href="#服务器模式" class="headerlink" title="服务器模式"></a>服务器模式</h3><p>import pyweather</p>
<h1 id="running-on-http-127-0-0-1-8888"><a href="#running-on-http-127-0-0-1-8888" class="headerlink" title="running on http://127.0.0.1:8888"></a>running on <a target="_blank" rel="noopener" href="http://127.0.0.1:8888/">http://127.0.0.1:8888</a></h1><p>pyweathercn.server(host&#x3D;’127.0.0.1’)</p>
<h1 id="running-on-http-0-0-0-0-3333"><a href="#running-on-http-0-0-0-0-3333" class="headerlink" title="running on http://0.0.0.0:3333"></a>running on <a target="_blank" rel="noopener" href="http://0.0.0.0:3333/">http://0.0.0.0:3333</a></h1><p>pyweathercn.server(3333)</p>
<h1 id="support-ssl-https-www-example-com-8888"><a href="#support-ssl-https-www-example-com-8888" class="headerlink" title="support ssl: https://www.example.com:8888"></a>support ssl: <a target="_blank" rel="noopener" href="https://www.example.com:8888/">https://www.example.com:8888</a></h1><p>pyweathercn.server(‘8888’, ‘<a target="_blank" rel="noopener" href="http://www.example.com/">www.example.com</a>‘, ssl_options&#x3D;{<br>“certfile”: “fullchain.pem”,<br>“keyfile”: “privkey.pem”})</p>
<p>哪位好心人我啊可以开放一个<a target="_blank" rel="noopener" href="https://weather.bennythink.com/">公开的API</a>给大家用，哈哈。</p>
<p>在服务器模式下的调用方法，需要请求<code>/weather</code>路由，必须参数为city，可选参数为day，使用get方法的url参数或者post方法的url-encode form，目前还不支持post json。</p>
<p> </p>
<h4 id="Nginx-反向代理"><a href="#Nginx-反向代理" class="headerlink" title="Nginx 反向代理"></a>Nginx 反向代理</h4><p>服务器用systemd等运行一个监听127.0.0.1的服务器模式python脚本，server块如下配置：</p>
<p>server {<br>listen 80;<br>server_name <a target="_blank" rel="noopener" href="http://www.siteone.com/">www.siteone.com</a>; # 你的域名<br>location &#x2F; {<br>proxy_pass <a target="_blank" rel="noopener" href="http://127.0.0.1:8888/">http://127.0.0.1:8888</a>;<br>}</p>
<p>如果需要https支持，可以参考<a target="_blank" rel="noopener" href="https://github.com/BennyThink/tools/blob/master/weather.conf">这个配置文件</a></p>
<h4 id="例子1-GET：呃请原谅我的pangu把url搞成了带空格的……"><a href="#例子1-GET：呃请原谅我的pangu把url搞成了带空格的……" class="headerlink" title="例子1 GET：呃请原谅我的pangu把url搞成了带空格的……"></a>例子1 GET：呃请原谅我的pangu把url搞成了带空格的……</h4><p><a target="_blank" rel="noopener" href="http://127.0.0.1:8888/weather?city=%E4%B8%8A%E6%B5%B7">http://127.0.0.1:8888/weather?city=上海</a></p>
<p><img src="/images/2018081808175847.png"></p>
<h4 id="例子2-GET："><a href="#例子2-GET：" class="headerlink" title="例子2 GET："></a>例子2 GET：</h4><p><a target="_blank" rel="noopener" href="http://127.0.0.1:8888/weather?city=%E4%B8%8A%E6%B5%B7&day=3">http://127.0.0.1:8888/weather?city=上海&amp;day=3</a></p>
<p><img src="/images/2018081808175971.png"></p>
<h4 id="例子3-POST："><a href="#例子3-POST：" class="headerlink" title="例子3 POST："></a>例子3 POST：</h4><p><img src="/images/2018081808180288.png"></p>
<h2 id="PyPi仓库地址"><a href="#PyPi仓库地址" class="headerlink" title="PyPi仓库地址"></a>PyPi仓库地址</h2><p><a target="_blank" rel="noopener" href="https://pypi.org/project/pyweathercn/">https://pypi.org/project/pyweathercn/</a></p>
<h2 id="GitHub源代码"><a href="#GitHub源代码" class="headerlink" title="GitHub源代码"></a>GitHub源代码</h2><p>[gt href&#x3D;’<a target="_blank" rel="noopener" href="https://github.com/BennyThink/pyweathercn'/]%E5%BC%80%E6%BA%90%E5%9C%B0%E5%9D%80/[/gt/]">https://github.com/BennyThink/pyweathercn&#39;\]开源地址\[/gt\]</a> 欢迎star、fork、PR</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/08/18/pyweathercn/index/" data-id="clhp7rtif0075s2qr7l5c31yj" data-title="一个简单强大的Python天气预报库pyweathercn" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-x1c-hdmi/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/08/09/x1c-hdmi/index/" class="article-date">
  <time class="dt-published" datetime="2018-08-09T00:00:00.000Z" itemprop="datePublished">2018-08-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/it/">it</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/08/09/x1c-hdmi/index/">X1 Carbon的HDMI不好用了怎么办</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>X1C的HDMI不好用了怎么办，捅屁股啊</p>
<p>Lenovo X1 Carbon 6th 是一款非常优(áng)秀(guì)、轻薄的商务本。某天，我照常连接显示器的时候，发现竟然没有输出了。考虑到Windows 10是一个日常抽风的操作系统，第一反应当然是重启啦。</p>
<p>当然是不好用的啦。</p>
<p>那么就替换法，依次替换转接头、用同事电脑测试，得出的结论是：HDMI转接头没坏、VGA线没坏，显示器没坏，是我电脑炸了。至于是软件还是硬件……要不我先做个Ubuntu Live Disk试试？</p>
<p>后来再联想官网搜到了解决方案，如果你的设备管理器中System Device下没有看到ThunderBolt字样的设备，那么就可以跟着这个方法来一遍。</p>
<p><img src="/images/2018080904481293.png"></p>
<p>关机，拔掉电源，把电脑翻过来，找到背面的小孔，用一个回形针捅大概5秒。然后，开机，设备管理器里是不是就有了，是不是就好用了</p>
<p><img src="/images/201808090448151.png"></p>
<p><strong>喂(#`O′)我说，你要是用百度，下辈子也搜不到这个结果。李彦宏你就别出来丢人现眼了</strong></p>
<p>参考资料：</p>
<p><a target="_blank" rel="noopener" href="https://forums.lenovo.com/t5/ThinkPad-X-Series-Laptops/X1-Carbon-6th-gen-HDMI-not-working/td-p/4091511">X1 Carbon 6th gen HDMI not working</a></p>
<p><a target="_blank" rel="noopener" href="https://is.wfu.edu/help-articles/hard-reset-for-lenovo-x1-carbon/">Hard Reset for Lenovo X1 Carbon</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/08/09/x1c-hdmi/index/" data-id="clhp7rtnm00bks2qr30sc2jf9" data-title="X1 Carbon的HDMI不好用了怎么办" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-ntpdate-problem/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/07/12/ntpdate-problem/index/" class="article-date">
  <time class="dt-published" datetime="2018-07-12T00:00:00.000Z" itemprop="datePublished">2018-07-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/linux/">linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/07/12/ntpdate-problem/index/">Ntpdate调整时间no server suitable for synchronization found</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>小葵花妈妈课堂开课啦</p>
<h2 id="关于俺近期的静默"><a href="#关于俺近期的静默" class="headerlink" title="关于俺近期的静默"></a>关于俺近期的静默</h2><p>最近两个多月，俺确实比较忙（在前几篇博文中也多次提及这点），导致博客更新频率下降。在此，先向各位读者表示抱歉 :(</p>
<p>划掉划掉，其实是最近比较忙，又觉得没什么可以写的。</p>
<h2 id="NTP问题"><a href="#NTP问题" class="headerlink" title="NTP问题"></a>NTP问题</h2><p>最近在公司服务器上进行一些操作，需要比较精确的时间，但是发现服务器时间慢了接近半小时。</p>
<p>对于我这么懒的人，怎么会自己用date去设置时间啊，于是自然用ntpdate同步时间啊。</p>
<p>于是很自然的，用阿里云的ntp服务器吧</p>
<p>[root@XXX ~]# ntpdate -v ntp1.aliyun.com<br>12 Jul 13:25:56 ntpdate[5547]: ntpdate <a href="mailto:&#52;&#46;&#50;&#x2e;&#54;&#112;&#x35;&#x40;&#49;&#x2e;&#50;&#51;&#x34;&#x39;&#x2d;&#x6f;">&#52;&#46;&#50;&#x2e;&#54;&#112;&#x35;&#x40;&#49;&#x2e;&#50;&#51;&#x34;&#x39;&#x2d;&#x6f;</a> Thu Oct 26 10:57:33 UTC 2017 (1)<br>12 Jul 13:26:01 ntpdate[5547]: no server suitable for synchronization found</p>
<p>啊噗，这是个什么报错，莫非阿里云挂了？换到自己的服务器上发现没问题啊……</p>
<p>别说了，网上搜那堆东西真是<a target="_blank" rel="noopener" href="https://dmesg.app/mysql-es-mongo.html#title-3">你抄我我抄你，你说有用吧还说得过去，都是没用的错误的，有意思嘛。</a></p>
<p>后来想了想，可能是因为公司服务器有一些网络限制，导致只能使用内部的NTP服务器吧？于是上employee communities上搜了下，找了一个，再试试……</p>
<p>[root@XXX ~]# ntpdate -v 1.ntp.company.com<br>12 Jul 13:42:25 ntpdate[5825]: ntpdate <a href="mailto:&#x34;&#x2e;&#50;&#x2e;&#x36;&#x70;&#53;&#x40;&#49;&#46;&#x32;&#x33;&#x34;&#57;&#x2d;&#111;">&#x34;&#x2e;&#50;&#x2e;&#x36;&#x70;&#53;&#x40;&#49;&#46;&#x32;&#x33;&#x34;&#57;&#x2d;&#111;</a> Thu Oct 26 10:57:33 UTC 2017 (1)<br>12 Jul 13:42:26 ntpdate[5825]: adjust time server 88.99.77.66 offset -0.009861 sec</p>
<p>你看行了吧</p>
<h2 id="关于近期和未来的计划"><a href="#关于近期和未来的计划" class="headerlink" title="关于近期和未来的计划"></a>关于近期和未来的计划</h2><p>由于工作稍微有点忙，所以除了安静的过好每一天，暂时没有什么太大的安排。</p>
<p>非得要说说的嘛……那就是研究下<a target="_blank" rel="noopener" href="https://www.jetbrains.com/license-server/outdated-ls/">新版本的JetBrains License Server</a>? 要是能有好心人提供一个抓包样本就好了。</p>
<p>更多详细信息可以戳这篇<a target="_blank" rel="noopener" href="https://dmesg.app/jbls.html">《JetBrains License Server 原理及 40 行 Python 代码的实现》</a></p>
<h2 id="于是就这么水了一贴……"><a href="#于是就这么水了一贴……" class="headerlink" title="于是就这么水了一贴……?"></a>于是就这么水了一贴……?</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/07/12/ntpdate-problem/index/" data-id="clhp7rthv0067s2qr2t8o1dpu" data-title="Ntpdate调整时间no server suitable for synchronization found" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-padavan-radius/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/05/13/padavan-radius/index/" class="article-date">
  <time class="dt-published" datetime="2018-05-13T00:00:00.000Z" itemprop="datePublished">2018-05-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/it/">it</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/05/13/padavan-radius/index/">在Padavan上简单的使用Radius进行802.1x认证</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>注意看，是Radius，不是Redis</p>
<p>通常来说，我们的无线网络一般是使用WPA2-Personal保护的，但是如果能够使用802.1x，每位用户输入自己的用户名密码，类似某些企业、学校那种认证方式，岂不是很好玩？</p>
<p>当然了，咱只是为了好玩……好像并没什么卵用的样子</p>
<h2 id="前置条件"><a href="#前置条件" class="headerlink" title="前置条件"></a>前置条件</h2><h3 id="需要有一台支持WPA2-Enterprise的路由器"><a href="#需要有一台支持WPA2-Enterprise的路由器" class="headerlink" title="需要有一台支持WPA2-Enterprise的路由器"></a>需要有一台支持WPA2-Enterprise的路由器</h3><p>包括但不限于Padavan等第三方固件。某些路由器的官方固件也是支持的。</p>
<p>比如，在这款TP-LINK固件中无线安全的设置下我们可以看到这个：</p>
<p><img src="/images/2018051308413275.png"></p>
<p>Padavan固件中可以看到这些</p>
<p><img src="/images/2018051308413667.png"></p>
<h3 id="一台服务器"><a href="#一台服务器" class="headerlink" title="一台服务器"></a>一台服务器</h3><p>无论这台服务器是在内网的，还是在外网（比如说腾讯云的也可以）的都可以，只要能和路由器互相通信，并且拥有一个固定的IP即可。</p>
<p>当然了，我这么穷，肯定是拿树莓派做Radius服务器啦。如果想拿Padavan自身做Radius服务器……嗯~ o(<em>￣▽￣</em>)o这个还是算了吧，交叉编译太麻烦，性能也有点太差劲呢。</p>
<p>当然了，这台服务器是要装好一个Linux发行版的。方便起见，这里我用的是Ubuntu Mate 16.04，IP地址为192.168.7.193.当然了，我已经在Padavan中绑定了这个IP，这样就不会因为种种原因导致分配了其他的IP地址啦。 [v_blue] 小提示：固定IP分配方法 高级配置-内部网络-DHCP服务器，最下方的手动指定 IP 的 DHCP 列表。</p>
<p>其他固件可以参考类似条目或者IP与MAC绑定等。 [&#x2F;v_blue]</p>
<h2 id="准备Radius服务器"><a href="#准备Radius服务器" class="headerlink" title="准备Radius服务器"></a>准备Radius服务器</h2><p>既然要使用WPA2-Enterprise，咱就要有Radius服务器来提供认证。这里咱就选择<a target="_blank" rel="noopener" href="https://freeradius.org/">freeRadius</a>啦。</p>
<p>所以就是编译编译咯。以Ubuntu、freeRadius 3.0.x为例：</p>
<p>sudo apt update<br>sudo apt install libtalloc-dev libssl-dev build-essential<br>wget <a href="ftp://ftp.freeradius.org/pub/freeradius/freeradius-server-3.0.17.tar.gz">ftp://ftp.freeradius.org/pub/freeradius/freeradius-server-3.0.17.tar.gz</a><br>tar xf freeradius-server-3.0.17.tar.gz &amp;&amp; rm freeradius-server-3.0.17.tar.gz<br>cd freeradius-server-3.0.17<br>.&#x2F;configure<br>make -j4 &amp;&amp; sudo make install</p>
<p>在最后一步<code>make install</code>时，由于树莓派这孱弱的性能，生成DH密钥花了很长时间（超过半小时哦） <img src="/images/2018051308413833.png"> </p>
<h2 id="修改配置"><a href="#修改配置" class="headerlink" title="修改配置"></a>修改配置</h2><p>经过漫长的编译之后，如果确认编译成功的话，那咱们就开始配置吧。</p>
<p>以root权限执行如下命令开启调试模式：</p>
<p>sudo radiusd -X</p>
<p>不出意外的话你会看到这样的报错：</p>
<p>Debugger not attached<br>Refusing to start with libssl version OpenSSL 1.0.2g 1 Mar 2016 0x1000207f (1.0.2g release) (in range 1.0.2 release - 1.0.2h rele)<br>Security advisory CVE-2016-6304 (OCSP status request extension)<br>For more information see <a target="_blank" rel="noopener" href="https://www.openssl.org/news/secadv/20160922.txt">https://www.openssl.org/news/secadv/20160922.txt</a><br>Once you have verified libssl has been correctly patched, set security.allow_vulnerable_openssl &#x3D; ‘CVE-2016-6304’</p>
<p>要么更新OpenSSL到1.0.2h之后的，要么……禁用这个检查呗。鉴于OpenSSL实在是太基础的东西，怕更新出乱子，还是禁用吧</p>
<p>sudo vim &#x2F;usr&#x2F;local&#x2F;etc&#x2F;raddb&#x2F;radiusd.conf</p>
<p>找到<code>allow_vulnerable_openssl = no</code>，把no改成yes</p>
<p>此时再运行<code>sudo radius -X</code>，就应该能看到Ready to process requests字样了。</p>
<h2 id="添加认证信息"><a href="#添加认证信息" class="headerlink" title="添加认证信息"></a>添加认证信息</h2><p>我们需要配置两个认证信息，一个是路由器连接到Radius的认证信息，一个是客户用于连接到热点的信息。</p>
<p>sudo vim &#x2F;usr&#x2F;local&#x2F;etc&#x2F;raddb&#x2F;clients.conf</p>
<p>在文件末尾添加如下信息：</p>
<p>client new {<br>ipaddr &#x3D; 192.168.7.1<br>secret &#x3D; pi.lan<br>}</p>
<p>其中IP地址是路由器的IP地址，secret是设置的密码。</p>
<p>sudo vim &#x2F;usr&#x2F;local&#x2F;etc&#x2F;raddb&#x2F;mods-config&#x2F;files&#x2F;authorize</p>
<p>在文件的开头（或者找到取消注释）添加如下信息：</p>
<p>bob Cleartext-Password :&#x3D; “hello”<br>Reply-Message :&#x3D; “Hello, %{User-Name}”</p>
<p>这行配置的意思是，用户名为bob，密码为hello</p>
<p>保存退出，再次运行<code>sudo radiusd -X</code></p>
<p>另开一个窗口，运行如下命令：</p>
<p>radtest bob hello 127.0.0.1 0 test<br>ing123</p>
<p>如果出现如下图所示的Access-Accept那么就是配置成功了</p>
<p><img src="/images/2018051308413973.png"></p>
<h2 id="配置路由器"><a href="#配置路由器" class="headerlink" title="配置路由器"></a>配置路由器</h2><p>在路由器中找到对应的WPA2-Enterprise的配置，大概如下设置：</p>
<p><img src="/images/2018051308414048.png"></p>
<p>之后保存即可</p>
<h2 id="客户端连接"><a href="#客户端连接" class="headerlink" title="客户端连接"></a>客户端连接</h2><p>之后拿起你的手机，找到刚刚的热点，会发现已经变成802.1x认证了，输入用户名bob，密码hello，就可以成功连接啦。</p>
<p><img src="/images/201805130841428.png"></p>
<h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p>这只是一个非常简单的基础配置教程，可能存在一些不安全的因素。所以以后说不定出系列呗？比如说用数据库，提升安全性……？</p>
<p>更多详情，还是看下面的参考资料吧</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://wiki.freeradius.org/building/Home">https://wiki.freeradius.org/building/Home</a></p>
<p><a target="_blank" rel="noopener" href="https://freeradius.org/documentation/">https://freeradius.org/documentation/</a></p>
<p><a target="_blank" rel="noopener" href="https://freeradius.org/doc/getting_started.html">https://freeradius.org/doc/getting_started.html</a></p>
<p><a target="_blank" rel="noopener" href="http://networkradius.com/doc/FreeRADIUS%20Technical%20Guide.pdf">http://networkradius.com/doc/FreeRADIUS%20Technical%20Guide.pdf</a></p>
<p><a target="_blank" rel="noopener" href="https://depthsecurity.com/blog/when-802-1x-peap-eap-ttls-is-worse-than-no-wireless-security">https://depthsecurity.com/blog/when-802-1x-peap-eap-ttls-is-worse-than-no-wireless-security</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/05/13/padavan-radius/index/" data-id="clhp7rthz006fs2qr4gdzgi3c" data-title="在Padavan上简单的使用Radius进行802.1x认证" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-hopeless-future/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/04/22/hopeless-future/index/" class="article-date">
  <time class="dt-published" datetime="2018-04-22T00:00:00.000Z" itemprop="datePublished">2018-04-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/justsay/">justsay</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/04/22/hopeless-future/index/">看不到希望的未来</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>[netmusic play&#x3D;’0’]41636941[&#x2F;netmusic]</p>
<p>如果能回到过去，我肯定会选择大学时光。那时候无忧无虑，不愁吃穿，可以尽情的钻研技术，也可以浑浑噩噩的打游戏，简而言之就是可以很任性。看看现在已经工作快一年了，这段时间唯一的更深的感觉就是，远远的、看不到希望的、未知的未来。</p>
<p>这个未来，可怕的不在于未知，而在于看不到希望。</p>
<p>我现在住在一个老小破的房子里，手边有着游戏机，酒杯里有清澈的酒，银行卡里有着一小笔存款，可以买自己喜欢的东西，可以为喜欢的女生孤注一掷的买点什么，可以与美女同学一起去樱花园，可以开开心心的吃顿大餐。十分明确的一点是，我的收入要远远高于房租，我能够凭借自己的力量生存下去。</p>
<p>也许这对于一个刚刚步入社会，甚至可以说还未走出校园的人来说，算是混得很好的吧？简单的想一想好像真的是这样，在身边的人可能还需要家里帮忙拿点房租钱的时候，我已经能够自己承担房租，还活得很滋润，简单的想想还是有一些自豪或者是优越感的。</p>
<p>可是如果稍微深入一些，便会发现这只是杯水车薪，对于我的未来而言，我看不到希望。</p>
<p>一个人的新的一段人生，该从哪里开始呢？我想应该是结婚生子，初为人父吧。然而，在我这样一个高消费的、房价飞涨的、收入却还不算很高的城市里，想买一套房子几乎就是很困难的事情。即使月入万元，也很难买得起1平方米的70年的地，10年来，做工程师赚的钱，只有房产升值的零头。工资增长的斜率远远比不过房产升值的斜率。</p>
<p>为什么不找父母要点钱呢，为什么不贷款呢？也许我不曾说过我出生于怎样的家庭。那好吧，我出生于一个很普通的、甚至可以说是贫穷的工人家庭吧。在我之前家里有个姐姐，后来因为生病所以才又有了我。父母辛苦一辈子才攒了这么点钱，说真的我不好意思拿。而且我还有个对我那么好的那么支持我的姐姐，更不好意思了。更别说父母一辈子的积蓄也到不了首付。</p>
<p>所以这么一想，其实未来是没什么希望的。现在的每一天看起来过得很滋润，却隐藏着对未来的不确定性。不当家不知柴米贵,不养儿不知父母恩。现在的人们都很现实啊，哪个姑娘愿意嫁给一个没房没车的古怪的穷小子？潜力股又有什么用。</p>
<p>突然想感叹，不知道前任如何选择了我。她很漂亮，明知我矮穷挫可却还选择和我在一起，甚至都已经考虑了结婚和未来的事情。也许那个时候我们都很幼稚吧，不知道生活有多么残酷，也许那个时候爱情都是很纯真美好的吧。感谢她放弃了我，和我在一起应该会吃很多苦的，她应该会找到更好的归宿的。</p>
<p>即使我离开这座城市，去往机遇更多的北上广，凭借着自己的一技之长也许能够赚更多的钱，但是也同样要面临可能会更多的压力。也许最好的选择是出国吧，然而这对我来说真的只是天方夜谭，就如同想象着努力工作，被调职到北京、上海，然后加入美国总部一样的天方夜谭。这是梦里都没想过的事情。</p>
<p>一个小小的银行职员最后加入了东京中央银行，一个不起眼的木讷的草食系程序员最后却娶到了森山实栗，对不起，这样的故事在中国根本不现实。</p>
<p>一直以为学好技术，或许能有发展，也许能够出人头地，但是我还是太年轻了。踏出大学之后我才知道，中国不像美国，中国没有硅谷，在国内之重视金钱而忽略技术。人无生存压力，自然就可以为了理想和兴趣而工作。现在，生不逢时的年轻人，在这个生存压力无穷大的国家里，为了生存不得不抛弃理想和兴趣。难怪呢，光怪陆离的现实。</p>
<p>这是一个<strong>被吸血的时代</strong>，这是一个看不到希望的连尽头都看不到的未来。</p>
<p><a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2018/04/201804220404294.jpg"><img src="/images/201804220404294.jpg"></a></p>
<p>桜の花?。大好きだ。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/04/22/hopeless-future/index/" data-id="clhp7rtgq003vs2qr8o1rbntu" data-title="看不到希望的未来" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-python2-3-port/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/04/17/python2-3-port/index/" class="article-date">
  <time class="dt-published" datetime="2018-04-17T00:00:00.000Z" itemprop="datePublished">2018-04-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/program/">program</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/04/17/python2-3-port/index/">一次找不到错误的巨坑的http header的url编码的Python 3迁移问题</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="起源"><a href="#起源" class="headerlink" title="起源"></a>起源</h2><p>近期，我把一个Python 2 的项目迁移到了Python 3，今早在进行最后一次测试时，发现下载的一个按钮是失效的。当时立刻就想，完蛋了，难道是遇到了跨平台的问题？那就糟糕了啊，跨平台问题都不太好处理的。</p>
<p>试了下原来的Python 2版本的还正常，那么就是这次迁移有点小问题了。</p>
<p><img src="/images/201804170754535.png"></p>
<h2 id="确定复现"><a href="#确定复现" class="headerlink" title="确定复现"></a>确定复现</h2><p>经过一系列绝望的瞎猫碰死耗子的尝试，发现了当要下载的文件是第三个，就会触发这个错误，抛的异常如下：</p>
<p>[E 180417 11:03:48 web:1590] Uncaught exception GET &#x2F;apps&#x2F;scenario_change&#x2F;page&#x2F;download?_id&#x3D;5aab8287e138235c1c9fa9ea&amp;type&#x3D;task (127.0.0.1)<br>    HTTPServerRequest(protocol&#x3D;’http’, host&#x3D;’127.0.0.1:9118’, method&#x3D;’GET’, uri&#x3D;’&#x2F;apps&#x2F;scenario_change&#x2F;page&#x2F;download?_id&#x3D;5aab8287e138235c1c9fa9ea&amp;type&#x3D;task’, version&#x3D;’HTTP&#x2F;1.1’, remote_ip&#x3D;’127.0.0.1’, headers&#x3D;{‘Host’: ‘127.0.0.1:9118’, ‘Connection’: ‘keep-alive’, ‘Upgrade-Insecure-Requests’: ‘1’, ‘User-Agent’: ‘Mozilla&#x2F;5.0 (Macintosh; U; Intel Mac OS X 10.11; rv:54.0) Gecko&#x2F;20100101 Firefox&#x2F;54.0’, ‘Accept’: ‘text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8’, ‘Dnt’: ‘1’, ‘Referer’: ‘<a target="_blank" rel="noopener" href="http://127.0.0.1:9118/apps/scenario/_change/task/_management.html">http://127.0.0.1:9118/apps/scenario\_change/task\_management.html</a>‘, ‘Accept-Encoding’: ‘gzip, deflate, br’, ‘Accept-Language’: ‘zh-CN,zh;q&#x3D;0.9,en-US;q&#x3D;0.8,en;q&#x3D;0.7’})<br>    Traceback (most recent call last):<br>      File “C:\Python36\lib\site-packages\tornado\web.py”, line 1513, in _execute<br>        self.finish()<br>      File “C:\Python36\lib\site-packages\tornado\web.py”, line 991, in finish<br>        self.flush(include_footers&#x3D;True)<br>      File “C:\Python36\lib\site-packages\tornado\web.py”, line 947, in flush<br>        start_line, self._headers, chunk, callback&#x3D;callback)<br>      File “C:\Python36\lib\site-packages\tornado\http1connection.py”, line 381, in write_headers<br>        lines.extend(l.encode(‘latin1’) for l in header_lines)<br>      File “C:\Python36\lib\site-packages\tornado\http1connection.py”, line 381, in<br>        lines.extend(l.encode(‘latin1’) for l in header_lines)<br>    UnicodeEncodeError: ‘latin-1’ codec can’t encode characters in position 45-46: ordinal not in range(256)<br>[E 180417 11:03:48 web:1015] Cannot send error response after headers written<br>[E 180417 11:03:48 web:1025] Failed to flush partial response<br>    Traceback (most recent call last):<br>      File “C:\Python36\lib\site-packages\tornado\web.py”, line 1513, in _execute<br>        self.finish()<br>      File “C:\Python36\lib\site-packages\tornado\web.py”, line 991, in finish<br>        self.flush(include_footers&#x3D;True)<br>      File “C:\Python36\lib\site-packages\tornado\web.py”, line 947, in flush<br>        start_line, self._headers, chunk, callback&#x3D;callback)<br>      File “C:\Python36\lib\site-packages\tornado\http1connection.py”, line 381, in write_headers<br>        lines.extend(l.encode(‘latin1’) for l in header_lines)<br>      File “C:\Python36\lib\site-packages\tornado\http1connection.py”, line 381, in<br>        lines.extend(l.encode(‘latin1’) for l in header_lines)<br>    UnicodeEncodeError: ‘latin-1’ codec can’t encode characters in position 45-46: ordinal not in range(256)</p>
<pre><code>During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File &quot;C:\\Python36\\lib\\site-packages\\tornado\\web.py&quot;, line 1022, in send\_error
    self.finish()
  File &quot;C:\\Python36\\lib\\site-packages\\tornado\\web.py&quot;, line 992, in finish
    self.request.finish()
  File &quot;C:\\Python36\\lib\\site-packages\\tornado\\httputil.py&quot;, line 419, in finish
    self.connection.finish()
  File &quot;C:\\Python36\\lib\\site-packages\\tornado\\http1connection.py&quot;, line 448, in finish
    self.\_expected\_content\_remaining)
tornado.httputil.HTTPOutputError: Tried to write 8015 bytes less than Content-Length
</code></pre>
<h2 id="追踪异常1：白高兴"><a href="#追踪异常1：白高兴" class="headerlink" title="追踪异常1：白高兴"></a>追踪异常1：白高兴</h2><p>按照常理讲，咱代码出了异常，咱就定位到报错的最后一行（most recent call last嘛，最后一次调用），看下异常是什么知道个大概，然后跳过去，该回溯的回溯，管它是高级的打断点开debug还是低级的一顿print的，确定问题根源然后修改。</p>
<p>看一眼这个异常，<strong>Tried to write 8015 bytes less than Content-Length</strong>，看样子好像是指定了一个Content-Length但是实际上发送的文件却比这个短8015字节。莫非是迁移到3的过程中对Unicode与bytes应用了错误的<code>len()</code>导致抛异常？</p>
<p>那简单了，看一眼是不是设错了headers就好了啊，Edit - Find - Find in path，限定文件类型为py，开搜！</p>
<p><img src="/images/201804170754546.png"></p>
<p>啥？逗我呢？没有？ [v_tips] 小提示：为啥第一想法要怀疑Content-Length的长度设置错了呢？</p>
<p>很简单啦，Python 2对Unicode的实现emmm这么说吧，在Python 2里，<code>&#39;hello&#39;</code>是二进制（字节流 bytes），<code>u&#39;hello&#39;</code>才是Unicode；但是在3里呢，<code>&#39;hello&#39;</code>是Unicode，<code>b&#39;hello&#39;</code>才是二进制。唉，谁叫Python 问世（第一版发布于1991.02）的时候Unicode标准（1991.10）还没出来呢。</p>
<p>以防你们不晓得这么个大坑，看下图：</p>
<p><img src="/images/2018041707545544.png"></p>
<p>以后在有人跟你说一个汉字是两个字节，你就拿这个图怼死他：不说编码就说一个汉字是几个字节就是耍流氓，<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E4%B8%AD%E6%97%A5%E9%9F%93%E7%B5%B1%E4%B8%80%E8%A1%A8%E6%84%8F%E6%96%87%E5%AD%97">说了编码那也是耍流氓</a>。[&#x2F;v_tips]</p>
<h2 id="追踪异常2：找到根源"><a href="#追踪异常2：找到根源" class="headerlink" title="追踪异常2：找到根源"></a>追踪异常2：找到根源</h2><p>有点扫兴，竟然没有Content-Length，那是因为啥呢？那就继续看着报错回溯呗。扫了一眼，啥，<strong>都是tornado的错</strong>，<strong>不是我的错</strong>？难道我要怀疑编译器解释器和久负盛名的tornado……？ [v_blue] 扩展阅读：</p>
<p>《<a target="_blank" rel="noopener" href="https://v2mm.tech/topic/830/%E5%A4%A7%E5%AE%B6%E6%9C%89%E4%BB%80%E4%B9%88%E5%86%99%E4%BB%A3%E7%A0%81%E5%86%99%E5%88%B0%E6%80%80%E7%96%91%E4%BA%BA%E7%94%9F-%E6%80%80%E7%96%91%E7%BC%96%E8%AF%91%E5%99%A8%E8%A7%A3%E9%87%8A%E5%99%A8%E7%9A%84%E7%BB%8F%E5%8E%86%E5%90%97">大家有什么写代码写到怀疑人生、怀疑编译器解释器的经历吗</a>》</p>
<p>cookies的时间戳，C语言标准for循环<code>for(int i=0;i++;i&lt;10)</code>，mian，ture，全角符号，以及<code>&lt;link href</code>……[&#x2F;v_blue]</p>
<p>又仔细看了一眼，发现这么一段话：<strong>During handling of the above exception, another exception occurred</strong>:</p>
<p>处理上面这个异常的时候，又来了个这么异常。</p>
<p>啊原来我刚刚看的是后来的异常啊，那我得看第一个异常的尾巴：</p>
<p><strong>UnicodeEncodeError: ‘latin-1’ codec can’t encode characters in position 45-46: ordinal not in range(256)</strong></p>
<p>多少年了，无数的Python程序员都曾经被UnicodeEncodeError与UnicodeDecodeError坑的说不出话来。</p>
<p>可是依旧没有我的代码啊。</p>
<p>终于，通过搜索.txt（下载的文件的扩展名）我成功找到了这一行：</p>
<p>file_name &#x3D; response[‘data’][0][‘task_name’] + ‘.txt’</p>
<p>看来是这句话负责生成文件名的，找到这句的函数定义，继续找调用者，叮咚！</p>
<p>一看函数名叫download，看样子下图这里就是该排错的地方</p>
<p><img src="/images/2018041707545536.png"></p>
<h2 id="解决异常1：瞎比划"><a href="#解决异常1：瞎比划" class="headerlink" title="解决异常1：瞎比划"></a>解决异常1：瞎比划</h2><h3 id="加个Content-Length"><a href="#加个Content-Length" class="headerlink" title="加个Content-Length"></a>加个Content-Length</h3><p>大致看了眼，好像没啥问题。要不在这里加上个Content-Length试试？</p>
<p>self.set_header(“Content-Length”, len(file_content.encode(‘utf-8’)))</p>
<p><img src="/images/2018041707545689.png"></p>
<p>我的基础还是很牢固的，没算错，一点问题都没有，肯定没错啊。但是<strong>Tried to write 8015 bytes less than Content-Length</strong>这个异常还是抛了。</p>
<h3 id="数据类型错了"><a href="#数据类型错了" class="headerlink" title="数据类型错了"></a>数据类型错了</h3><p>也许是数据类型错了？说不定<code>file_name</code>, <code>file_content</code>需要字节流而不是字符串呢？这好像有点接近Unicode错误了。简单的<code>encode(&#39;utf-8&#39;)</code>一下，当然还是继续错啦。</p>
<h3 id="也许是因为header的事情"><a href="#也许是因为header的事情" class="headerlink" title="也许是因为header的事情"></a>也许是因为header的事情</h3><p>那就把header都注释了看看。于是在浏览器里打开了文件……</p>
<p><img src="/images/2018041707545712.png"></p>
<p>那我只留Content-Type</p>
<p><img src="/images/2018041707545743.png"></p>
<p>噗(&#x2F;≧▽≦)&#x2F;我的文件名呢，内容是正确的。</p>
<p>啊，原来是靠的Content-Disposition这个响应头来强制浏览器下载文件，指定文件名什么的啊……</p>
<h2 id="解决异常2：确定问题"><a href="#解决异常2：确定问题" class="headerlink" title="解决异常2：确定问题"></a>解决异常2：确定问题</h2><p>终于，我确定了出错的代码在这一行</p>
<p>self.set_header(“Content-Disposition”, “attachment; filename&#x3D;%s” % file_name)</p>
<p>看样子是文件名。那就把filename替换成硬编码的<code>test.txt</code>，正常下载；再换成<code>tes啊t.txt</code>，一模一样的报错。</p>
<p>于是我果断的搜索了Content-Disposition encoding以及Content-Disposition 编码，看到<a target="_blank" rel="noopener" href="https://blog.robotshell.org/2012/deal-with-http-header-encoding-for-file-download/">这么一篇说得还挺有道理的文章</a>：</p>
<p>Content-Disposition: attachment;filename&#x3D;”$encoded_fname”;<br>filename*&#x3D;utf-8’’$encoded_fname</p>
<p>当然了我没看到下面那句话（<strong>读书要读全啊</strong>），直接套上了</p>
<p>self.set_header(“Content-Disposition”, “attachment; filename*&#x3D;utf-8’’%s” % file_name)</p>
<p>当然继续报错啦。还是<code>file_name</code>数据类型不对？encode成UTF-8？差点用上decode（字符串怎么可能再decode嘛？必然要报错的）</p>
<p><img src="/images/201804170754585.png"></p>
<p>噗，这倒真是<code>tes的t.txt</code>这个字符串的UTF-8编码。</p>
<p>这就纠结了，难道我要把文件名搞成什么ASCII的？比如干脆是几个真伪随机数吧？</p>
<h2 id="解决异常3：解决"><a href="#解决异常3：解决" class="headerlink" title="解决异常3：解决"></a>解决异常3：解决</h2><p>然后又找到了这么一篇<a target="_blank" rel="noopener" href="http://lgbolgger.iteye.com/blog/2108396">例子丰富的文章</a>，看到一半突然想起了，既然要给任意文字编码成ASCII字符集内的，那就用base64啊，但是浏览器又不懂base64没办法给还原回来啊……</p>
<p>唉？？不是有个东西叫URL编码吗？迅速翻了翻例子丰富的文章，还真提了一句……</p>
<p>from urllib.parse import quote<br>self.set_header(“Content-Disposition”, “attachment; filename&#x3D;%s” % quote(‘tes的t.txt’))</p>
<p><img src="/images/2018041707545941.png"></p>
<p>我爱emoji，emoji也爱我。???典型的傲娇受。</p>
<p>??? ??? ??? ??? ??? ??? ???</p>
<p>其实<a target="_blank" rel="noopener" href="https://blog.robotshell.org/2012/deal-with-http-header-encoding-for-file-download/">第一篇文章</a>提了一句的：其中， <code>$encoded_fname</code>指的是将 UTF-8 编码的原始文件名按照 RFC 3986 进行百分号编码（percent encoding）后得到的。</p>
<p>百分号编码就是<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-hans/%E7%99%BE%E5%88%86%E5%8F%B7%E7%BC%96%E7%A0%81">URL编码</a>啦……</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这个小问题其实隐藏的还是很深的，而且奇特的是在Python 2没有问题但是到了3就冒出来了。</p>
<p>光看报错基本上没什么线索，只能靠对业务的熟悉摸索找到对应的代码，仔细排查最终确定导致出错的代码……然后解决之。</p>
<p>就我这水平啊，还是别怀疑编译器解释器，也别怀疑久负盛名的库了，绝对是我错了。</p>
<blockquote>
<p>You tell me I’m wrong, then you’d better prove you’re right. ——M.J.</p>
</blockquote>
<h2 id="后续"><a href="#后续" class="headerlink" title="后续"></a>后续</h2><p>经过一小段时间的阅读源代码，在tornado源代码中发现了问题的根源。跟着我的节奏走！先看下抓包的结果吧：</p>
<p>Python 2未编码 <a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2018/04/2018041803535426.png"><img src="/images/2018041803535426.png"></a></p>
<p>Python 2 URL编码 <a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2018/04/2018041803535177.png"><img src="/images/2018041803535177.png"></a></p>
<p>Python 3 URL编码 <a target="_blank" rel="noopener" href="https://dmesg.app/wp-content/uploads/2018/04/2018041803535360.png"><img src="/images/2018041803535360.png"></a></p>
<p>我们知道问题是由set_header引起的，所以看一下set_header的源代码：</p>
<p>def set_header(self, name, value):<br>        # type: (str, _HeaderTypes) -&gt; None<br>        “””Sets the given response header name and value.</p>
<pre><code>    If a datetime is given, we automatically format it according to the
    HTTP specification. If the value is not a string, we convert it to
    a string. All header values are then encoded as UTF-8.
    &quot;&quot;&quot;
    self.\_headers\[name\] = self.\_convert\_header\_value(value)
</code></pre>
<p>非常清楚的看到调用了一个<code>_convert_header_value()</code>，继续追溯</p>
<pre><code>def \_convert\_header\_value(self, value):
    # type: (\_HeaderTypes) -&gt; str

    # Convert the input value to a str. This type check is a bit
    # subtle: The bytes case only executes on python 3, and the
    # unicode case only executes on python 2, because the other
    # cases are covered by the first match for str.
    if isinstance(value, str):
        retval = value
    elif isinstance(value, bytes):  # py3
        # Non-ascii characters in headers are not well supported,
        # but if you pass bytes, use latin1 so they pass through as-is.
        retval = value.decode(&#39;latin1&#39;)
    elif isinstance(value, unicode\_type):  # py2
        # TODO: This is inconsistent with the use of latin1 above,
        # but it&#39;s been that way for a long time. Should it change?
        retval = escape.utf8(value)
    elif isinstance(value, numbers.Integral):
        # return immediately since we know the converted value will be safe
        return str(value)
    elif isinstance(value, datetime.datetime):
        return httputil.format\_timestamp(value)
    else:
        raise TypeError(&quot;Unsupported header value %r&quot; % value)
    # If \\n is allowed into the header, it is possible to inject
    # additional headers or split the request.
    if RequestHandler.\_INVALID\_HEADER\_CHAR\_RE.search(retval):
        raise ValueError(&quot;Unsafe header value %r&quot;, retval)
    return retval
</code></pre>
<p>这段代码有点冗长，但实际上只做了一件事情，将传递过来的value转换为字符串，更进一步，在Python 2中，如果传过来的是<code>&#39;hello&#39;</code>，那么直接返回；如果类型是<code>u&#39;hello&#39;</code>, 那么<code>escape.utf8(value)</code>。在Python 3中如果是<code>&#39;hello&#39;</code>那么直接返回，如果是<code>&#39;hello你&#39;.encode(&#39;utf-8&#39;)</code>，那么用latin1解码。</p>
<p>最终这段代码会保证返回的类型是对应Python 2&#x2F;3的str类型。</p>
<p>但其实这段代码并没有什么错，不过确实写的有点难懂。 之后继续追溯到<code>write_headers()</code>，在http1connection.py的第380行左右：</p>
<p>if PY3:<br>            lines.extend(l.encode(‘latin1’) for l in header_lines)<br>        else:<br>            lines.extend(header_lines)</p>
<p>其中header_lines是一个生成器对象，包含了所有的headers，其类型为str（对应2&#x2F;3的类型） 那么错误就显然易见了，在Python 3中对<code>&#39;hello&#39;.encode(&#39;latin1&#39;)</code>是没有任何问题的，但是<code>&#39;hello和&#39;.encode(&#39;latin1&#39;)</code>肯定会报UnicodeEncodeError啊，这也印证了我最开始发现的编码错误。</p>
<p>但是在Python 2，直接就走了下面extend进去了，自然也没问题了。 但是如果我们调用set_header时传递的参数是<code>&#39;hell你&#39;.encode(&#39;utf-8&#39;)</code>，那么在<code>_convert_header_value</code>中会被用latin1解码，在这里又使用latin1编码，又回到了utf-8编码之后的形态，所以自然会出现对应文件名的UTF-8编码，也印证了上面下载出来的乱码文件。</p>
<p>所以，如果要修复这个问题，要么我们保证只传递过来ASCII的文件名（进行URL编码），这样用latin1编码就不会错了。要么直接把这俩latin1改成utf-8。</p>
<p>不过根据<a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc7230#section-3.2.4">RFC7230 section 3.2.4</a>:</p>
<blockquote>
<p>Historically, HTTP has allowed field content with text in the ISO-8859-1 charset [ISO-8859-1], supporting other charsets only through use of [RFC2047] encoding. In practice, most HTTP header field values use only a subset of the US-ASCII charset [USASCII]. Newly defined header fields SHOULD limit their field values to US-ASCII octets. A recipient SHOULD treat other octets in field content (obs-text) as opaque data.</p>
</blockquote>
<p>这么做其实是有悖标准的，但是Python 2的版本直接不管不顾发出去了啊，实际上Python 2版本的应该拒绝这种headers的。我也很纠结，我也觉得没办法啊。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/04/17/python2-3-port/index/" data-id="clhp7rtie0073s2qrhi226brl" data-title="一次找不到错误的巨坑的http header的url编码的Python 3迁移问题" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-python-longpoll-db/index" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/04/13/python-longpoll-db/index/" class="article-date">
  <time class="dt-published" datetime="2018-04-13T00:00:00.000Z" itemprop="datePublished">2018-04-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/program/">program</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/04/13/python-longpoll-db/index/">Python长期连接数据库的最不佳实践：Lost connection to MySQL server during query</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="问题来源"><a href="#问题来源" class="headerlink" title="问题来源"></a>问题来源</h2><p>前几天用Tornado做Web服务器起了一个简单的以表格显示数据库中内容的网页，然后把它放到lab服务器上做demo。卧病几天之后打开邮箱，发现mentor邮件说表格中不显示数据。赶紧登上服务器screen回去看下，发现抛了个这么异常：Lost connection to MySQL server during query</p>
<p><img src="/images/2018041314312651.png"></p>
<p>当然也说不定会是MySQL server has gone away</p>
<blockquote>
<p>Python：我这么爱你，你为什么要离开我？</p>
<p>MySQL：你丫八个小时都不跟俺说一句话，想起来了就冷不丁的冒一句，然后就消失，就这样还是俺真爱？哼！</p>
<p>Python：……（好吧，被你发现了，我就是玩玩而已你还认真了，真是的?）</p>
</blockquote>
<p>以上内容纯属虚构，请勿对号入座（咋想也没办法对号入座啊）</p>
<h2 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h2><p>造成这个异常的原因其实非常简单，就是基本上没啥人访问我的demo link，导致连接对象超过了wait_timeout的默认28800秒（即8小时），然后MySQL就关闭了这个连接。由于TCP的特性，Python的驱动并不会知道被甩了，当有人访问demo link也就是进行一次查询的时候，就会触发异常，于是表格自然就是空白的啦。</p>
<p>为了更进一步的说明这个问题并提供若干最不佳实践，咱先简单的说说这段代码……GitHub可以戳下面的触手猫（commit为959ce78f854894397a75bad0efef4ef0de06b7ca） [gt href&#x3D;’<a target="_blank" rel="noopener" href="https://github.com/BennyThink/Intern-Life/blob/959ce78f854894397a75bad0efef4ef0de06b7ca/mission%208/front-end-pagination.py'/]%E8%A7%A6%E6%89%8B%E7%8C%AB%E5%8D%81%E5%91%A8%E5%B9%B4%E5%95%A6/[/gt/]">https://github.com/BennyThink/Intern-Life/blob/959ce78f854894397a75bad0efef4ef0de06b7ca/mission%208/front-end-pagination.py&#39;\]触手猫十周年啦\[/gt\]</a></p>
<h3 id="开头"><a href="#开头" class="headerlink" title="开头"></a>开头</h3><p>首先在开头引入几个库，然后新建两个全局的对象：一个是用于数据库连接的con，一个是查询游标cur</p>
<p>con &#x3D; mysql.connector.connect(host&#x3D;’127.0.0.1’, user&#x3D;’root’, password&#x3D;’root’, database&#x3D;’san’)<br>cur &#x3D; con.cursor()</p>
<h3 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h3><p>在make_app函数中我们可以看到定义了俩路由，&#x2F;对应Index类，&#x2F;list&#x2F;对应Retrive类。</p>
<p>Retrive类重载了get方法，返回的是一个函数get_data，而get_data则是进行数据库相关操作的函数，代码如下：</p>
<p>def get_data():<br>    cur.execute(‘SHOW COLUMNS from switch_device’)<br>    col_data &#x3D; cur.fetchall()<br>    col_field &#x3D; [i[0] for i in col_data]<br>    cur.execute(‘SELECT * FROM switch_device’)<br>    data &#x3D; cur.fetchall()</p>
<pre><code>bulk\_dic = \[\]
for i in range(len(data)):
    es\_dic = dict(zip(col\_field, data\[i\]))
    bulk\_dic.append(es\_dic)
return json.dumps(bulk\_dic)
</code></pre>
<p><strong>我不由得想起了我最爱的列表推导</strong>……反正就是查询了两次，根据列名和数据把表中的内容组成了一个json。可惜啊我不知道<a target="_blank" rel="noopener" href="https://dmesg.app/mysql-es-mongo.html">DictCursor</a></p>
<h3 id="入口"><a href="#入口" class="headerlink" title="入口"></a>入口</h3><p>入口非常简单，就是启动tornado而已。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>通篇可以看到有这么几个特点：</p>
<ol>
<li><strong>cur和con是全局的</strong>，只要Python脚本在运行，那么这俩对象的id（内存地址）就不会改变，无论多少次的页面刷新（数据库查询操作）都是由cur这个全局对象执行的</li>
<li>并没有对connection进行close。脚本在收到相应的信号量时会执行对应的行为，比如SIGINT也即Ctrl+C，自然就退出了，连接自然也就被释放了。</li>
</ol>
<h3 id="再一次说明问题原因"><a href="#再一次说明问题原因" class="headerlink" title="再一次说明问题原因"></a>再一次说明问题原因</h3><p>再一次总结出错原因：demo太冷门没人看，<strong>连接闲置时间超过wait_timeout，MySQL关闭连接</strong>，然后再次触发查询的时候，自然而然就会报错了。</p>
<p>针对这个问题，我想了几种个人觉得不咋样的解决方法，所以被称之为“<strong>最不佳实践</strong>”。当然提前说一个比较好的办法，那就是用数据库框架啊，类似SQLAlchemy什么的，这类框架应该会处理这类问题的；还有就是，如果对应的驱动程序提供了类似<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/5.7/en/c-api-auto-reconnect.html">automatic reconnection</a>这种特性，那也好办多啦</p>
<p>注意：为了方便叙述，下面的get_data()就是指代数据库操作啦！</p>
<h2 id="方法1：增加wait-timeout时间"><a href="#方法1：增加wait-timeout时间" class="headerlink" title="方法1：增加wait_timeout时间"></a>方法1：增加wait_timeout时间</h2><p>既然数据库小姐默认的“生气时间”是28800秒，那咱简单的给它调大点不就好了。</p>
<blockquote>
<p>Python：亲爱的，你以后要多点耐心，小不忍则乱大谋啊~ MySQL：好吧好吧，那我就多点耐心。 <em>一年之后……</em> Python：亲爱的，干嘛呢？ MySQL：老娘不认识你，丨。 <em>Python吸取教训，不能冷落小姐姐太久，于是再次通过自己的阴谋诡计取得小姐姐的好感与信任。</em> Python：亲爱的，你以后要多点耐心，小不忍则乱大谋啊~ MySQL：好吧好吧，那我就多点耐心。 <em>十几天之后……</em> Python：亲爱的，干嘛呢？ MySQL：忙着呢，没空理你。 Python：…………（算了，干嘛一棵树上吊死）</p>
</blockquote>
<p>简单的在得到游标之后来这么一句：</p>
<p>cur.execute(‘SET SESSION WAIT_TIMEOUT &#x3D; 2147483’)</p>
<p>注：</p>
<p>2147483（约24天）是Windows平台的MySQL的WAIT_TIMEOUT最大值，其他平台为31536000（一年）</p>
<p>如果有必要的话咱还可以<code>SET GLOBAL WAIT_TIMEOUT = 2147483</code>，不过你真的确定要global么，说不好DoS了，查完日志就该回家种田了啊。</p>
<p>但实际上这是一种想当然一拍脑门一跺脚的<strong>完全不现实</strong>的不经过仔细思考的解决方案。为啥捏，待我慢慢道来。</p>
<h3 id="治标不治本"><a href="#治标不治本" class="headerlink" title="治标不治本"></a>治标不治本</h3><p>不，这个三级标题是错误的。这种解决方案<strong>不仅不治标，更不治本</strong>！甚至有损于数据库的性能。暂且不考虑平台兼容性（设置为31536000对Windows平台就是无效值了啊），如果真的就是连接限制了超过timeout的时间，然后突然有了一次访问，那还不是照样挂？</p>
<h3 id="影响数据库性能"><a href="#影响数据库性能" class="headerlink" title="影响数据库性能"></a>影响数据库性能</h3><p>MySQL为什么要有这样一个参数？很简单啊，为了提高服务器性能啊。每维持一个连接都是需要耗费一定的内存和CPU资源的，关闭长期不使用的连接自然节约了资源，同时也避免了max_connections达到上限造成了DoS的结果。</p>
<p>即使我们把max_connections的值调到很高尽可能避免DoS，这对于服务器的性能也是不利的，需要更多内存，更多文件描述符。这同样也是一个<strong>既不治标也不治本</strong>的解决“解决方案”的方案。堆硬件？有那钱还不如打赏辛苦写作本文的俺呐！</p>
<p>注：max_connections默认值为151，上限为100000，同时还要受到文件描述符（用ulimit查看）的限制。</p>
<h3 id="一句话总结"><a href="#一句话总结" class="headerlink" title="一句话总结"></a>一句话总结</h3><p>放弃吧，别用这种不太好的办法了。</p>
<h2 id="方法2：每次刷新页面都新建连接-查询-关闭连接"><a href="#方法2：每次刷新页面都新建连接-查询-关闭连接" class="headerlink" title="方法2：每次刷新页面都新建连接-查询-关闭连接"></a>方法2：每次刷新页面都新建连接-查询-关闭连接</h2><p>既然问题在于连接限制，那咱就每次数据库相关的操作都新建连接-查询-关闭连接。代码也很简单，把全局的数据库连接移动到函数内：</p>
<p>con &#x3D; mysql.connector.connect(host&#x3D;’127.0.0.1’, user&#x3D;’root’, password&#x3D;’root’, database&#x3D;’san’)<br>cur &#x3D; con.cursor()</p>
<h1 id="执行操作"><a href="#执行操作" class="headerlink" title="执行操作"></a>执行操作</h1><p>con.close()<br>return some_value</p>
<p>这确实是一个非常简单的处理方式，很强，没有bug，绝对管用，不仅治标也治本。只是有一个问题，新建连接会慢点，在某些场景可能会稍差一点点</p>
<p>新建一次连接自然是比较费时、费资源的啦，说不定要0.1秒呢，那如果同时访问的人多了造成大并发的局面（tornado是多线程非阻塞的服务器，所以短时间内可能会创建很多个con对象），那可能速度就要稍微慢一点了。</p>
<p>不过这种方法确实好用，因为抓住了问题的本质：<strong>闲置连接被关闭</strong>。绝大部分情况下用这个方案就可以啦</p>
<h2 id="方法3：数据库的操作之前con-reconnect"><a href="#方法3：数据库的操作之前con-reconnect" class="headerlink" title="方法3：数据库的操作之前con.reconnect()"></a>方法3：数据库的操作之前con.reconnect()</h2><p>从方法3中我们发现了<code>con.reconnect()</code>这个神奇的小东西，那么我们在数据库操作之前执行这个，这样每次都会重新连接，那就可以啦。</p>
<p>con.reconnect()<br>get_data()</p>
<p>这个方法大概相当于方法2的改进版，每次操作没有重新新建con对象而是<strong>无论连接是否被MySQL关闭，都重新连接</strong>。没毛病，问题完美解决，只是也有一点点性能损失：</p>
<p>连接关闭了reconnect倒好，但是没关闭却reconnect了那不就浪费了嘛？</p>
<p>虽说如此，但是这个方法的性能会比方法2稍好一些。</p>
<h2 id="方法4：数据库操作时try…except，异常重连"><a href="#方法4：数据库操作时try…except，异常重连" class="headerlink" title="方法4：数据库操作时try…except，异常重连"></a>方法4：数据库操作时try…except，异常重连</h2><p>针对方法4，很容易就可以进行一下改进，那咱先毫无顾虑的执行，出问题了捕获异常就好了。</p>
<p>try:<br>    get_data()<br>except mysql.connector.errors.OperationalError:<br>    con.reconnect()<br>    get_data()</p>
<p>两次<code>get_data()</code>有点不雅啊，唉灵机一动：</p>
<p>try:<br>    cur.execute(‘select version()’)<br>except mysql.connector.errors.OperationalError:<br>    con.reconnect()<br>finally:<br>    get_data()</p>
<p>或者不用finally直接开始写新的语句块，也是可以的！</p>
<p>随便执行个查询操作来看看连接有没有被关闭，然后finally无论怎么都会被执行的，好办法好办法，拍案叫绝！</p>
<p>只是也稍微有那么一丁点不好，白白的让数据库执行了一个没有用的查询，多多少少还是浪费了一丢丢资源啦。</p>
<p>于是我又灵机一动，诞生了方法5.</p>
<h2 id="方法5：数据库操作之前进行con-ping-，异常重连"><a href="#方法5：数据库操作之前进行con-ping-，异常重连" class="headerlink" title="方法5：数据库操作之前进行con.ping()，异常重连"></a>方法5：数据库操作之前进行con.ping()，异常重连</h2><p>用一次con.ping()检测连接是否还在，不在的话就重新连接，finally里执行查询，哇(o゜▽゜)o☆</p>
<p>try:<br>    con.ping()<br>except mysql.connector.errors.InterfaceError:<br>    con.reconnect()<br>finally:<br>    get_data()</p>
<p>同上，不用finally直接开始写新的语句块，也是可以的！<code>con.ping()</code>的性能开销应该比较理想的。</p>
<p>需要注意的是，不同的库可能有一点不同，比如pymysql的<code>con.ping()</code>包含一个reconnect的参数，默认为True的时候就会自动重连。所以如果你使用pymysql，直接在数据库操作之前使用<code>con.ping()</code>就可以了。</p>
<p>另外一个需要注意的点，多线程情况下使用全局的con可能会触发线程安全相关的问题。以及如果涉及事务，要注意提交、回滚的操作，免得发生幻读之类的状况</p>
<h2 id="方法7：连接池"><a href="#方法7：连接池" class="headerlink" title="方法7：连接池"></a>方法7：连接池</h2><p>等有空再说吧~</p>
<h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>需要注意一个问题，如果数据库开启了事务，你的应用程序涉及到了多线程等并发问题，那么在全局使用一个connection时一定要注意线程安全和事务相关的问题。一旦代码写的不完善，就很容易出现类似幻读、脏读这种事务相关的问题。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/04/13/python-longpoll-db/index/" data-id="clhp7rtie0071s2qr49ru776m" data-title="Python长期连接数据库的最不佳实践：Lost connection to MySQL server during query" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/10/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="page-number" href="/page/10/">10</a><span class="page-number current">11</span><a class="page-number" href="/page/12/">12</a><a class="page-number" href="/page/13/">13</a><span class="space">&hellip;</span><a class="page-number" href="/page/23/">23</a><a class="extend next" rel="next" href="/page/12/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/azure/">azure</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/china/">china</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/china/justsay/">justsay</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/cloudflare/">cloudflare</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/gfw/">gfw</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/">it</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/it/justsay/">justsay</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/security/">security</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/it/share/">share</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/">justsay</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/gfw/">gfw</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/justsay/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/linux/security/">security</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/website/">website</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/program/">program</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/program/share/">share</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/security/">security</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/security/justsay/">justsay</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/security/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/share/">share</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/website/">website</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/website/program/">program</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/what/">what</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/what/gfw/">gfw</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/ubuntu/" style="font-size: 10px;">ubuntu</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/10/">October 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/09/">September 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">August 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">July 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">April 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">March 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">February 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/11/">November 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/04/">April 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">February 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">February 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">February 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/08/">August 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/10/12/aca-php/index/">用 Azure Container Apps 运行PHP网站</a>
          </li>
        
          <li>
            <a href="/2024/10/06/aca-vm-scale/index/">Azure Container Apps 连接到虚拟机并配置CPU自动缩放</a>
          </li>
        
          <li>
            <a href="/2024/09/28/worker-image-metadata/index/">使用 Cloudflare Worker获取图片元数据</a>
          </li>
        
          <li>
            <a href="/2024/09/27/workers-function/index/">将 Cloudflare Workers 迁移到 Azure Function</a>
          </li>
        
          <li>
            <a href="/2024/09/21/one-api-clickhouse/index/">one-api/new-api性能优化：使用 ClickHouse 作为日志系统</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 Benny小土豆<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>